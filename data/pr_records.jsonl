{"repo": "openshift/cert-manager-operator", "pr_number": 278, "file_path": "pkg/operator/optionalinformer/optional_informer.go", "line_start": 58, "line_end": null, "diff_context": "", "comment_body": "Should we handle the error?\r\n\r\n`k8s.io/apimachinery/pkg/api/errors`\r\n```suggestion\r\n\tif err != nil {\r\n\t        if errors.IsNotFound(err) {\r\n\t\t        return false, nil\r\n                }\r\n                return false, err\r\n\t}\r\n```", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2145266247", "pull_request_review_id": 2925057638, "id": 2145266247, "node_id": "PRRC_kwDOFdFn9s5_3ipH", "diff_hunk": "@@ -0,0 +1,60 @@\n+package optionalinformer\n+\n+import (\n+\t\"context\"\n+\n+\t\"k8s.io/apimachinery/pkg/runtime/schema\"\n+\t\"k8s.io/client-go/discovery\"\n+)\n+\n+type OptionalInformer[GroupInformer any] struct {\n+\tgvr             schema.GroupVersionResource\n+\tdiscoveryClient discovery.DiscoveryInterface\n+\n+\tInformerFactory *GroupInformer\n+}\n+\n+func NewOptionalInformer[groupInformer any](\n+\tctx context.Context,\n+\tgvr schema.GroupVersionResource,\n+\tdiscoveryClient discovery.DiscoveryInterface,\n+\tinformerInitFunc func() groupInformer,\n+) *OptionalInformer[groupInformer] {\n+\to := &OptionalInformer[groupInformer]{\n+\t\tgvr:             gvr,\n+\t\tdiscoveryClient: discoveryClient,\n+\t}\n+\n+\tif o.Discover() {\n+\t\tinformer := informerInitFunc()\n+\t\to.InformerFactory = &informer\n+\t}\n+\n+\treturn o\n+}\n+\n+// Applicable determines if an active informer was successfully created\n+func (o *OptionalInformer[GroupInformer]) Applicable() bool {\n+\treturn o.InformerFactory != nil\n+}\n+\n+// Discover returns if the required CRD is present on the cluster or not\n+func (o *OptionalInformer[GroupInformer]) Discover() bool {\n+\tresources, err := o.discoveryClient.ServerResourcesForGroupVersion(o.gvr.GroupVersion().String())\n+\n+\t// NOTE: When using with configv1.Infrastructure,\n+\t// on a microshift cluster, here ALWAYS errors out with:\n+\t// \"the server could not find the requested resource\"\n+\t// probably, because the \"config.openshift.io\" API group is absent?\n+\tif err != nil {\n+\t\treturn false\n+\t}", "path": "pkg/operator/optionalinformer/optional_informer.go", "commit_id": "c92f513be225ae5a8ebd2b99c1e3571a67fe5c7b", "original_commit_id": "9bc26056c9b141d9a8ca64c0e6139420f7296d16", "user": {"login": "bharath-b-rh", "id": 92782575, "node_id": "U_kgDOBYe_7w", "avatar_url": "https://avatars.githubusercontent.com/u/92782575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bharath-b-rh", "html_url": "https://github.com/bharath-b-rh", "followers_url": "https://api.github.com/users/bharath-b-rh/followers", "following_url": "https://api.github.com/users/bharath-b-rh/following{/other_user}", "gists_url": "https://api.github.com/users/bharath-b-rh/gists{/gist_id}", "starred_url": "https://api.github.com/users/bharath-b-rh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bharath-b-rh/subscriptions", "organizations_url": "https://api.github.com/users/bharath-b-rh/orgs", "repos_url": "https://api.github.com/users/bharath-b-rh/repos", "events_url": "https://api.github.com/users/bharath-b-rh/events{/privacy}", "received_events_url": "https://api.github.com/users/bharath-b-rh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "Should we handle the error?\r\n\r\n`k8s.io/apimachinery/pkg/api/errors`\r\n```suggestion\r\n\tif err != nil {\r\n\t        if errors.IsNotFound(err) {\r\n\t\t        return false, nil\r\n                }\r\n                return false, err\r\n\t}\r\n```", "created_at": "2025-06-13T14:50:12Z", "updated_at": "2025-06-13T14:52:15Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/278#discussion_r2145266247", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/278", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2145266247"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/278#discussion_r2145266247"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/278"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2145266247/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 49, "start_side": "RIGHT", "line": null, "original_line": 58, "side": "RIGHT", "author_association": "MEMBER", "original_position": 51, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 279, "file_path": "test/e2e/overrides_test.go", "line_start": 119, "line_end": null, "diff_context": "", "comment_body": "```suggestion\r\n\t\t\t\t[]string{certManagerController}, invalidOperatorStatusConditions,\r\n```", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2115583046", "pull_request_review_id": 2880845474, "id": 2115583046, "node_id": "PRRC_kwDOFdFn9s5-GTxG", "diff_hunk": "@@ -107,7 +115,9 @@ var _ = Describe(\"Overrides test\", Ordered, func() {\n \t\t\tExpect(err).NotTo(HaveOccurred())\n \n \t\t\tBy(\"Waiting for cert-manager controller status to become degraded\")\n-\t\t\terr = verifyOperatorStatusCondition(certmanageroperatorclient, []string{certManagerControllerDeploymentControllerName}, invalidOperatorStatusConditions)\n+\t\t\terr = verifyOperatorStatusCondition(certmanageroperatorclient, GenerateConditionMatchers(\n+\t\t\t\t[]string{certManagerController}, validOperatorStatusConditions,", "path": "test/e2e/overrides_test.go", "commit_id": "350edbf01e2fab22b130a0beedc73030d31c8df8", "original_commit_id": "8dcbe0eddbbffe650b137ce0e8a246dc3c7f6123", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "```suggestion\r\n\t\t\t\t[]string{certManagerController}, invalidOperatorStatusConditions,\r\n```", "created_at": "2025-05-30T10:09:26Z", "updated_at": "2025-05-30T10:12:22Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2115583046", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2115583046"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2115583046"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2115583046/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 119, "side": "RIGHT", "author_association": "MEMBER", "original_position": 56, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 279, "file_path": "test/e2e/overrides_test.go", "line_start": 140, "line_end": null, "diff_context": "", "comment_body": "```suggestion\r\n\t\t\t\t[]string{certManagerCAInjector}, invalidOperatorStatusConditions,\r\n```", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2115583504", "pull_request_review_id": 2880845474, "id": 2115583504, "node_id": "PRRC_kwDOFdFn9s5-GT4Q", "diff_hunk": "@@ -126,7 +136,9 @@ var _ = Describe(\"Overrides test\", Ordered, func() {\n \t\t\tExpect(err).NotTo(HaveOccurred())\n \n \t\t\tBy(\"Waiting for cert-manager webhook controller status to become degraded\")\n-\t\t\terr = verifyOperatorStatusCondition(certmanageroperatorclient, []string{certManagerWebhookDeploymentControllerName}, invalidOperatorStatusConditions)\n+\t\t\terr = verifyOperatorStatusCondition(certmanageroperatorclient, GenerateConditionMatchers(\n+\t\t\t\t[]string{certManagerCAInjector}, validOperatorStatusConditions,", "path": "test/e2e/overrides_test.go", "commit_id": "350edbf01e2fab22b130a0beedc73030d31c8df8", "original_commit_id": "8dcbe0eddbbffe650b137ce0e8a246dc3c7f6123", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "```suggestion\r\n\t\t\t\t[]string{certManagerCAInjector}, invalidOperatorStatusConditions,\r\n```", "created_at": "2025-05-30T10:09:38Z", "updated_at": "2025-05-30T10:12:22Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2115583504", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2115583504"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2115583504"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2115583504/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 140, "side": "RIGHT", "author_association": "MEMBER", "original_position": 67, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 279, "file_path": "test/e2e/overrides_test.go", "line_start": 161, "line_end": null, "diff_context": "", "comment_body": "```suggestion\r\n\t\t\t\t[]string{certManagerCAInjector}, invalidOperatorStatusConditions,\r\n```", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2115584176", "pull_request_review_id": 2880845474, "id": 2115584176, "node_id": "PRRC_kwDOFdFn9s5-GUCw", "diff_hunk": "@@ -145,7 +157,9 @@ var _ = Describe(\"Overrides test\", Ordered, func() {\n \t\t\tExpect(err).NotTo(HaveOccurred())\n \n \t\t\tBy(\"Waiting for cert-manager cainjector controller status to become degraded\")\n-\t\t\terr = verifyOperatorStatusCondition(certmanageroperatorclient, []string{certManagerCAInjectorDeploymentControllerName}, invalidOperatorStatusConditions)\n+\t\t\terr = verifyOperatorStatusCondition(certmanageroperatorclient, GenerateConditionMatchers(\n+\t\t\t\t[]string{certManagerCAInjector}, validOperatorStatusConditions,", "path": "test/e2e/overrides_test.go", "commit_id": "350edbf01e2fab22b130a0beedc73030d31c8df8", "original_commit_id": "8dcbe0eddbbffe650b137ce0e8a246dc3c7f6123", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "```suggestion\r\n\t\t\t\t[]string{certManagerCAInjector}, invalidOperatorStatusConditions,\r\n```", "created_at": "2025-05-30T10:09:49Z", "updated_at": "2025-05-30T10:12:22Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2115584176", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2115584176"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2115584176"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2115584176/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 161, "side": "RIGHT", "author_association": "MEMBER", "original_position": 78, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 279, "file_path": "test/e2e/overrides_test.go", "line_start": 279, "line_end": null, "diff_context": "", "comment_body": "```suggestion\r\n\t\t\t\t[]string{certManagerController}, invalidOperatorStatusConditions,\r\n```", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2115584682", "pull_request_review_id": 2880845474, "id": 2115584682, "node_id": "PRRC_kwDOFdFn9s5-GUKq", "diff_hunk": "@@ -255,7 +275,9 @@ var _ = Describe(\"Overrides test\", Ordered, func() {\n \t\t\tExpect(err).NotTo(HaveOccurred())\n \n \t\t\tBy(\"Waiting for cert-manager controller status to become degraded\")\n-\t\t\terr = verifyOperatorStatusCondition(certmanageroperatorclient, []string{certManagerControllerDeploymentControllerName}, invalidOperatorStatusConditions)\n+\t\t\terr = verifyOperatorStatusCondition(certmanageroperatorclient, GenerateConditionMatchers(\n+\t\t\t\t[]string{certManagerController}, validOperatorStatusConditions,", "path": "test/e2e/overrides_test.go", "commit_id": "350edbf01e2fab22b130a0beedc73030d31c8df8", "original_commit_id": "8dcbe0eddbbffe650b137ce0e8a246dc3c7f6123", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "```suggestion\r\n\t\t\t\t[]string{certManagerController}, invalidOperatorStatusConditions,\r\n```", "created_at": "2025-05-30T10:10:03Z", "updated_at": "2025-05-30T10:12:22Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2115584682", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2115584682"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2115584682"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2115584682/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 279, "side": "RIGHT", "author_association": "MEMBER", "original_position": 122, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 279, "file_path": "test/e2e/overrides_test.go", "line_start": 335, "line_end": null, "diff_context": "", "comment_body": "```suggestion\r\n\t\t\t\t[]string{certManagerCAInjector}, invalidOperatorStatusConditions,\r\n```", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2115585274", "pull_request_review_id": 2880845474, "id": 2115585274, "node_id": "PRRC_kwDOFdFn9s5-GUT6", "diff_hunk": "@@ -307,7 +331,9 @@ var _ = Describe(\"Overrides test\", Ordered, func() {\n \t\t\tExpect(err).NotTo(HaveOccurred())\n \n \t\t\tBy(\"Waiting for cert-manager cainjector controller status to become degraded\")\n-\t\t\terr = verifyOperatorStatusCondition(certmanageroperatorclient, []string{certManagerCAInjectorDeploymentControllerName}, invalidOperatorStatusConditions)\n+\t\t\terr = verifyOperatorStatusCondition(certmanageroperatorclient, GenerateConditionMatchers(\n+\t\t\t\t[]string{certManagerCAInjector}, validOperatorStatusConditions,", "path": "test/e2e/overrides_test.go", "commit_id": "350edbf01e2fab22b130a0beedc73030d31c8df8", "original_commit_id": "8dcbe0eddbbffe650b137ce0e8a246dc3c7f6123", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "```suggestion\r\n\t\t\t\t[]string{certManagerCAInjector}, invalidOperatorStatusConditions,\r\n```", "created_at": "2025-05-30T10:10:19Z", "updated_at": "2025-05-30T10:12:22Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2115585274", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2115585274"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2115585274"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2115585274/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 335, "side": "RIGHT", "author_association": "MEMBER", "original_position": 144, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 279, "file_path": "test/e2e/overrides_test.go", "line_start": 464, "line_end": null, "diff_context": "", "comment_body": "```suggestion\r\n\t\t\t\t[]string{certManagerController}, invalidOperatorStatusConditions,\r\n```", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2115585553", "pull_request_review_id": 2880845474, "id": 2115585553, "node_id": "PRRC_kwDOFdFn9s5-GUYR", "diff_hunk": "@@ -428,7 +460,9 @@ var _ = Describe(\"Overrides test\", Ordered, func() {\n \t\t\tExpect(err).NotTo(HaveOccurred())\n \n \t\t\tBy(\"Waiting for cert-manager controller status to become degraded\")\n-\t\t\terr = verifyOperatorStatusCondition(certmanageroperatorclient, []string{certManagerControllerDeploymentControllerName}, invalidOperatorStatusConditions)\n+\t\t\terr = verifyOperatorStatusCondition(certmanageroperatorclient, GenerateConditionMatchers(\n+\t\t\t\t[]string{certManagerController}, validOperatorStatusConditions,", "path": "test/e2e/overrides_test.go", "commit_id": "350edbf01e2fab22b130a0beedc73030d31c8df8", "original_commit_id": "8dcbe0eddbbffe650b137ce0e8a246dc3c7f6123", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "```suggestion\r\n\t\t\t\t[]string{certManagerController}, invalidOperatorStatusConditions,\r\n```", "created_at": "2025-05-30T10:10:29Z", "updated_at": "2025-05-30T10:12:22Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2115585553", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2115585553"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2115585553"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2115585553/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 464, "side": "RIGHT", "author_association": "MEMBER", "original_position": 188, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 279, "file_path": "test/e2e/overrides_test.go", "line_start": 530, "line_end": null, "diff_context": "", "comment_body": "```suggestion\r\n\t\t\t\t[]string{certManagerCAInjector}, invalidOperatorStatusConditions,\r\n```", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2115586122", "pull_request_review_id": 2880845474, "id": 2115586122, "node_id": "PRRC_kwDOFdFn9s5-GUhK", "diff_hunk": "@@ -490,7 +526,9 @@ var _ = Describe(\"Overrides test\", Ordered, func() {\n \t\t\tExpect(err).NotTo(HaveOccurred())\n \n \t\t\tBy(\"Waiting for cert-manager cainjector controller status to become degraded\")\n-\t\t\terr = verifyOperatorStatusCondition(certmanageroperatorclient, []string{certManagerCAInjectorDeploymentControllerName}, invalidOperatorStatusConditions)\n+\t\t\terr = verifyOperatorStatusCondition(certmanageroperatorclient, GenerateConditionMatchers(\n+\t\t\t\t[]string{certManagerCAInjector}, validOperatorStatusConditions,", "path": "test/e2e/overrides_test.go", "commit_id": "350edbf01e2fab22b130a0beedc73030d31c8df8", "original_commit_id": "8dcbe0eddbbffe650b137ce0e8a246dc3c7f6123", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "```suggestion\r\n\t\t\t\t[]string{certManagerCAInjector}, invalidOperatorStatusConditions,\r\n```", "created_at": "2025-05-30T10:10:48Z", "updated_at": "2025-05-30T10:12:22Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2115586122", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2115586122"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2115586122"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2115586122/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 530, "side": "RIGHT", "author_association": "MEMBER", "original_position": 210, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 279, "file_path": "test/e2e/overrides_test.go", "line_start": 572, "line_end": null, "diff_context": "", "comment_body": "```suggestion\r\n\t\t\t\t[]string{certManagerController}, invalidOperatorStatusConditions,\r\n```", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2115586414", "pull_request_review_id": 2880845474, "id": 2115586414, "node_id": "PRRC_kwDOFdFn9s5-GUlu", "diff_hunk": "@@ -528,7 +568,9 @@ var _ = Describe(\"Overrides test\", Ordered, func() {\n \t\t\tExpect(err).NotTo(HaveOccurred())\n \n \t\t\tBy(\"Waiting for cert-manager controller status to become degraded\")\n-\t\t\terr = verifyOperatorStatusCondition(certmanageroperatorclient, []string{certManagerControllerDeploymentControllerName}, invalidOperatorStatusConditions)\n+\t\t\terr = verifyOperatorStatusCondition(certmanageroperatorclient, GenerateConditionMatchers(\n+\t\t\t\t[]string{certManagerController}, validOperatorStatusConditions,", "path": "test/e2e/overrides_test.go", "commit_id": "350edbf01e2fab22b130a0beedc73030d31c8df8", "original_commit_id": "8dcbe0eddbbffe650b137ce0e8a246dc3c7f6123", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "```suggestion\r\n\t\t\t\t[]string{certManagerController}, invalidOperatorStatusConditions,\r\n```", "created_at": "2025-05-30T10:10:59Z", "updated_at": "2025-05-30T10:12:22Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2115586414", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2115586414"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2115586414"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2115586414/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 572, "side": "RIGHT", "author_association": "MEMBER", "original_position": 232, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 279, "file_path": "test/e2e/utils_test.go", "line_start": 130, "line_end": null, "diff_context": "", "comment_body": "It seems that this might not always work when matching degrade condition, because each operand has two `Degrade` types:\r\n\r\n```\r\n  {\r\n    \"type\": \"cert-manager-controller-deploymentDegraded\",\r\n    \"status\": \"True\",\r\n    \"lastTransitionTime\": \"2025-05-30T13:50:57Z\",\r\n    \"reason\": \"SyncError\",\r\n    \"message\": \"error running hook function (index=5): validation failed due to unsupported arg \\\"--invalid-args\\\"=\\\"foo\\\"\"\r\n  },\r\n...\r\n  {\r\n    \"type\": \"cert-manager-controller-static-resources-Degraded\",\r\n    \"status\": \"False\",\r\n    \"lastTransitionTime\": \"2025-05-30T13:38:54Z\",\r\n    \"reason\": \"AsExpected\"\r\n  }\r\n```\r\n\r\nFrom log https://prow.ci.openshift.org/view/gs/test-platform-results/logs/multi-pr-openshift-cert-manager-operator-280-openshift-cert-manager-operator-279-e2e-operator/1928424453042081792#1:build-log.txt%3A194, it matchs `-static-resources-Degraded` and exits, while we expect it can also match `-deploymentDegraded`.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2119901984", "pull_request_review_id": 2881787308, "id": 2119901984, "node_id": "PRRC_kwDOFdFn9s5-WyMg", "diff_hunk": "@@ -57,55 +58,105 @@ var subscriptionSchema = schema.GroupVersionResource{\n \tResource: \"subscriptions\",\n }\n \n+// ConditionMatcher tracks a regex pattern cond.Type with an expected cond.Status\n+type ConditionMatcher struct {\n+\tTypePattern    *regexp.Regexp\n+\tExpectedStatus opv1.ConditionStatus\n+}\n+\n+// Matches returns true if the provided Condition.Type satisfies regex pattern\n+func (m *ConditionMatcher) MatchesType(cond *opv1.OperatorCondition) bool {\n+\treturn m.TypePattern.MatchString(cond.Type)\n+}\n+\n+func (m *ConditionMatcher) MatchesStatus(cond *opv1.OperatorCondition) bool {\n+\treturn cond.Status == m.ExpectedStatus\n+}\n+\n+func GenerateConditionMatchers(prefixes []string, expectedConditions map[string]opv1.ConditionStatus) []ConditionMatcher {\n+\tmatchers := make([]ConditionMatcher, len(prefixes)*len(expectedConditions))\n+\n+\tidx := 0\n+\tfor _, prefix := range prefixes {\n+\t\tfor suffix, state := range expectedConditions {\n+\t\t\tmatchers[idx] = ConditionMatcher{\n+\t\t\t\tTypePattern:    regexp.MustCompile(\"^\" + prefix + \".*\" + suffix + \"$\"),\n+\t\t\t\tExpectedStatus: state,\n+\t\t\t}\n+\t\t\tidx += 1\n+\t\t}\n+\t}\n+\treturn matchers\n+}\n+\n // verifyOperatorStatusCondition polls every 1 second to check if the status of each of the controllers\n // match with the expected conditions. It returns an error if a timeout (5 mins) occurs or an error was\n // encountered which polling the status. For each controller a the polling happens in separate go-routines.\n-func verifyOperatorStatusCondition(client *certmanoperatorclient.Clientset, controllerNames []string, expectedConditionMap map[string]opv1.ConditionStatus) error {\n+func verifyOperatorStatusCondition(client *certmanoperatorclient.Clientset, conditionMatchers []ConditionMatcher) error {\n+\tvar lastUnmatchedCondition *opv1.OperatorCondition\n+\tvar lastFetchedConditions []opv1.OperatorCondition\n \n-\tvar wg sync.WaitGroup\n-\terrs := make([]error, len(controllerNames))\n-\tfor index := range controllerNames {\n-\t\twg.Add(1)\n-\t\tgo func(index int) {\n-\t\t\tdefer wg.Done()\n-\t\t\terr := wait.PollUntilContextTimeout(context.TODO(), time.Second*1, time.Minute*5, true, func(context.Context) (bool, error) {\n-\t\t\t\toperator, err := client.OperatorV1alpha1().CertManagers().Get(context.TODO(), \"cluster\", metav1.GetOptions{})\n-\t\t\t\tif err != nil {\n-\t\t\t\t\tif apierrors.IsNotFound(err) {\n+\terr := wait.PollUntilContextTimeout(context.TODO(), time.Second*1, time.Minute*5, true, func(context.Context) (bool, error) {\n+\t\toperator, err := client.OperatorV1alpha1().CertManagers().Get(context.TODO(), \"cluster\", metav1.GetOptions{})\n+\t\tif err != nil {\n+\t\t\tif apierrors.IsNotFound(err) {\n+\t\t\t\treturn false, nil\n+\t\t\t}\n+\t\t\treturn false, err\n+\t\t}\n+\n+\t\tif operator.DeletionTimestamp != nil {\n+\t\t\treturn false, nil\n+\t\t}\n+\n+\t\tlastFetchedConditions = operator.Status.DeepCopy().Conditions\n+\n+\t\tmatches := make([]bool, len(conditionMatchers))\n+\t\tfor _, cond := range operator.Status.Conditions {\n+\t\t\tfor i, matcher := range conditionMatchers {\n+\t\t\t\tif matcher.MatchesType(&cond) {\n+\t\t\t\t\tif !matcher.MatchesStatus(&cond) {\n+\t\t\t\t\t\t// track the last known state of an unmatched Condition\n+\t\t\t\t\t\tlastUnmatchedCondition = cond.DeepCopy()\n+\n+\t\t\t\t\t\t// [retry] false: when expected condition Type\n+\t\t\t\t\t\t//                found but is not expected Status\n \t\t\t\t\t\treturn false, nil\n \t\t\t\t\t}\n-\t\t\t\t\treturn false, err\n-\t\t\t\t}\n \n-\t\t\t\tif operator.DeletionTimestamp != nil {\n-\t\t\t\t\treturn false, nil\n+\t\t\t\t\tmatches[i] = true\n \t\t\t\t}\n+\t\t\t}\n+\t\t}", "path": "test/e2e/utils_test.go", "commit_id": "350edbf01e2fab22b130a0beedc73030d31c8df8", "original_commit_id": "8002426b0933efb663c2328380beccf17d542df0", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "It seems that this might not always work when matching degrade condition, because each operand has two `Degrade` types:\r\n\r\n```\r\n  {\r\n    \"type\": \"cert-manager-controller-deploymentDegraded\",\r\n    \"status\": \"True\",\r\n    \"lastTransitionTime\": \"2025-05-30T13:50:57Z\",\r\n    \"reason\": \"SyncError\",\r\n    \"message\": \"error running hook function (index=5): validation failed due to unsupported arg \\\"--invalid-args\\\"=\\\"foo\\\"\"\r\n  },\r\n...\r\n  {\r\n    \"type\": \"cert-manager-controller-static-resources-Degraded\",\r\n    \"status\": \"False\",\r\n    \"lastTransitionTime\": \"2025-05-30T13:38:54Z\",\r\n    \"reason\": \"AsExpected\"\r\n  }\r\n```\r\n\r\nFrom log https://prow.ci.openshift.org/view/gs/test-platform-results/logs/multi-pr-openshift-cert-manager-operator-280-openshift-cert-manager-operator-279-e2e-operator/1928424453042081792#1:build-log.txt%3A194, it matchs `-static-resources-Degraded` and exits, while we expect it can also match `-deploymentDegraded`.", "created_at": "2025-06-02T02:46:02Z", "updated_at": "2025-06-02T02:46:40Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2119901984", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2119901984"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2119901984"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2119901984/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 115, "start_side": "RIGHT", "line": null, "original_line": 130, "side": "RIGHT", "author_association": "MEMBER", "original_position": 99, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 279, "file_path": "test/e2e/overrides_test.go", "line_start": 140, "line_end": null, "diff_context": "", "comment_body": "```suggestion\r\n\t\t\t\t[]string{certManagerWebhook}, invalidOperatorStatusConditions,\r\n```", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2119902292", "pull_request_review_id": 2881787308, "id": 2119902292, "node_id": "PRRC_kwDOFdFn9s5-WyRU", "diff_hunk": "@@ -126,7 +136,9 @@ var _ = Describe(\"Overrides test\", Ordered, func() {\n \t\t\tExpect(err).NotTo(HaveOccurred())\n \n \t\t\tBy(\"Waiting for cert-manager webhook controller status to become degraded\")\n-\t\t\terr = verifyOperatorStatusCondition(certmanageroperatorclient, []string{certManagerWebhookDeploymentControllerName}, invalidOperatorStatusConditions)\n+\t\t\terr = verifyOperatorStatusCondition(certmanageroperatorclient, GenerateConditionMatchers(\n+\t\t\t\t[]string{certManagerCAInjector}, invalidOperatorStatusConditions,", "path": "test/e2e/overrides_test.go", "commit_id": "350edbf01e2fab22b130a0beedc73030d31c8df8", "original_commit_id": "8002426b0933efb663c2328380beccf17d542df0", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "```suggestion\r\n\t\t\t\t[]string{certManagerWebhook}, invalidOperatorStatusConditions,\r\n```", "created_at": "2025-06-02T02:46:26Z", "updated_at": "2025-06-02T02:46:40Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2119902292", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2119902292"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2119902292"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2119902292/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 140, "side": "RIGHT", "author_association": "MEMBER", "original_position": 67, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 279, "file_path": "test/e2e/utils_test.go", "line_start": 130, "line_end": null, "diff_context": "", "comment_body": "Yeah, needed to rewrite/refactor the Conditions matcher.\r\n\r\nIn process, have had to write a unit test to test the verify func effectively,\r\nhttps://github.com/openshift/cert-manager-operator/blob/354fbb34077d10d2989efad93f4c8bc58e0c91e2/test/e2e/condition_matcher_test_test.go (supports MatchAny and MatchAll for specific cases now).", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2124218090", "pull_request_review_id": 2893022176, "id": 2124218090, "node_id": "PRRC_kwDOFdFn9s5-nP7q", "diff_hunk": "@@ -57,55 +58,105 @@ var subscriptionSchema = schema.GroupVersionResource{\n \tResource: \"subscriptions\",\n }\n \n+// ConditionMatcher tracks a regex pattern cond.Type with an expected cond.Status\n+type ConditionMatcher struct {\n+\tTypePattern    *regexp.Regexp\n+\tExpectedStatus opv1.ConditionStatus\n+}\n+\n+// Matches returns true if the provided Condition.Type satisfies regex pattern\n+func (m *ConditionMatcher) MatchesType(cond *opv1.OperatorCondition) bool {\n+\treturn m.TypePattern.MatchString(cond.Type)\n+}\n+\n+func (m *ConditionMatcher) MatchesStatus(cond *opv1.OperatorCondition) bool {\n+\treturn cond.Status == m.ExpectedStatus\n+}\n+\n+func GenerateConditionMatchers(prefixes []string, expectedConditions map[string]opv1.ConditionStatus) []ConditionMatcher {\n+\tmatchers := make([]ConditionMatcher, len(prefixes)*len(expectedConditions))\n+\n+\tidx := 0\n+\tfor _, prefix := range prefixes {\n+\t\tfor suffix, state := range expectedConditions {\n+\t\t\tmatchers[idx] = ConditionMatcher{\n+\t\t\t\tTypePattern:    regexp.MustCompile(\"^\" + prefix + \".*\" + suffix + \"$\"),\n+\t\t\t\tExpectedStatus: state,\n+\t\t\t}\n+\t\t\tidx += 1\n+\t\t}\n+\t}\n+\treturn matchers\n+}\n+\n // verifyOperatorStatusCondition polls every 1 second to check if the status of each of the controllers\n // match with the expected conditions. It returns an error if a timeout (5 mins) occurs or an error was\n // encountered which polling the status. For each controller a the polling happens in separate go-routines.\n-func verifyOperatorStatusCondition(client *certmanoperatorclient.Clientset, controllerNames []string, expectedConditionMap map[string]opv1.ConditionStatus) error {\n+func verifyOperatorStatusCondition(client *certmanoperatorclient.Clientset, conditionMatchers []ConditionMatcher) error {\n+\tvar lastUnmatchedCondition *opv1.OperatorCondition\n+\tvar lastFetchedConditions []opv1.OperatorCondition\n \n-\tvar wg sync.WaitGroup\n-\terrs := make([]error, len(controllerNames))\n-\tfor index := range controllerNames {\n-\t\twg.Add(1)\n-\t\tgo func(index int) {\n-\t\t\tdefer wg.Done()\n-\t\t\terr := wait.PollUntilContextTimeout(context.TODO(), time.Second*1, time.Minute*5, true, func(context.Context) (bool, error) {\n-\t\t\t\toperator, err := client.OperatorV1alpha1().CertManagers().Get(context.TODO(), \"cluster\", metav1.GetOptions{})\n-\t\t\t\tif err != nil {\n-\t\t\t\t\tif apierrors.IsNotFound(err) {\n+\terr := wait.PollUntilContextTimeout(context.TODO(), time.Second*1, time.Minute*5, true, func(context.Context) (bool, error) {\n+\t\toperator, err := client.OperatorV1alpha1().CertManagers().Get(context.TODO(), \"cluster\", metav1.GetOptions{})\n+\t\tif err != nil {\n+\t\t\tif apierrors.IsNotFound(err) {\n+\t\t\t\treturn false, nil\n+\t\t\t}\n+\t\t\treturn false, err\n+\t\t}\n+\n+\t\tif operator.DeletionTimestamp != nil {\n+\t\t\treturn false, nil\n+\t\t}\n+\n+\t\tlastFetchedConditions = operator.Status.DeepCopy().Conditions\n+\n+\t\tmatches := make([]bool, len(conditionMatchers))\n+\t\tfor _, cond := range operator.Status.Conditions {\n+\t\t\tfor i, matcher := range conditionMatchers {\n+\t\t\t\tif matcher.MatchesType(&cond) {\n+\t\t\t\t\tif !matcher.MatchesStatus(&cond) {\n+\t\t\t\t\t\t// track the last known state of an unmatched Condition\n+\t\t\t\t\t\tlastUnmatchedCondition = cond.DeepCopy()\n+\n+\t\t\t\t\t\t// [retry] false: when expected condition Type\n+\t\t\t\t\t\t//                found but is not expected Status\n \t\t\t\t\t\treturn false, nil\n \t\t\t\t\t}\n-\t\t\t\t\treturn false, err\n-\t\t\t\t}\n \n-\t\t\t\tif operator.DeletionTimestamp != nil {\n-\t\t\t\t\treturn false, nil\n+\t\t\t\t\tmatches[i] = true\n \t\t\t\t}\n+\t\t\t}\n+\t\t}", "path": "test/e2e/utils_test.go", "commit_id": "350edbf01e2fab22b130a0beedc73030d31c8df8", "original_commit_id": "8002426b0933efb663c2328380beccf17d542df0", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "Yeah, needed to rewrite/refactor the Conditions matcher.\r\n\r\nIn process, have had to write a unit test to test the verify func effectively,\r\nhttps://github.com/openshift/cert-manager-operator/blob/354fbb34077d10d2989efad93f4c8bc58e0c91e2/test/e2e/condition_matcher_test_test.go (supports MatchAny and MatchAll for specific cases now).", "created_at": "2025-06-03T15:20:38Z", "updated_at": "2025-06-03T15:21:09Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2124218090", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2124218090"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2124218090"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2124218090/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 115, "start_side": "RIGHT", "line": null, "original_line": 130, "side": "RIGHT", "in_reply_to_id": 2119901984, "author_association": "MEMBER", "original_position": 99, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 279, "file_path": "test/e2e/utils_test.go", "line_start": 48, "line_end": null, "diff_context": "", "comment_body": "It appears that this change has affected the `TestTimeout` value in other test suites. \r\n\r\nhttps://prow.ci.openshift.org/view/gs/test-platform-results/logs/multi-pr-openshift-cert-manager-operator-280-openshift-cert-manager-operator-279-e2e-operator/1930112189952167936\r\n\r\nThere are some `context deadline exceeded` errors due to the actual wait-poll period is only 5s.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2125902437", "pull_request_review_id": 2895635278, "id": 2125902437, "node_id": "PRRC_kwDOFdFn9s5-trJl", "diff_hunk": "@@ -43,9 +43,9 @@ import (\n \t\"k8s.io/client-go/util/retry\"\n )\n \n-const (\n+var (\n \tPollInterval = 5 * time.Second\n-\tTestTimeout  = 10 * time.Minute\n+\tTestTimeout  = 5 * time.Minute", "path": "test/e2e/utils_test.go", "commit_id": "350edbf01e2fab22b130a0beedc73030d31c8df8", "original_commit_id": "32c235e2118862122ee869c295c3846993831b12", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "It appears that this change has affected the `TestTimeout` value in other test suites. \r\n\r\nhttps://prow.ci.openshift.org/view/gs/test-platform-results/logs/multi-pr-openshift-cert-manager-operator-280-openshift-cert-manager-operator-279-e2e-operator/1930112189952167936\r\n\r\nThere are some `context deadline exceeded` errors due to the actual wait-poll period is only 5s.", "created_at": "2025-06-04T07:38:50Z", "updated_at": "2025-06-04T07:39:51Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2125902437", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2125902437"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2125902437"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2125902437/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 46, "start_side": "RIGHT", "line": null, "original_line": 48, "side": "RIGHT", "author_association": "MEMBER", "original_position": 18, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 279, "file_path": "test/e2e/utils_test.go", "line_start": 48, "line_end": null, "diff_context": "", "comment_body": "Yup, fixed and reverted to older timeouts.\r\n\r\nhttps://github.com/openshift/cert-manager-operator/blob/e5a6034f5574429c4bacce4a311412ffebdbaff5/test/e2e/utils_test.go#L46-L63", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2126126148", "pull_request_review_id": 2895976725, "id": 2126126148, "node_id": "PRRC_kwDOFdFn9s5-uhxE", "diff_hunk": "@@ -43,9 +43,9 @@ import (\n \t\"k8s.io/client-go/util/retry\"\n )\n \n-const (\n+var (\n \tPollInterval = 5 * time.Second\n-\tTestTimeout  = 10 * time.Minute\n+\tTestTimeout  = 5 * time.Minute", "path": "test/e2e/utils_test.go", "commit_id": "350edbf01e2fab22b130a0beedc73030d31c8df8", "original_commit_id": "32c235e2118862122ee869c295c3846993831b12", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "Yup, fixed and reverted to older timeouts.\r\n\r\nhttps://github.com/openshift/cert-manager-operator/blob/e5a6034f5574429c4bacce4a311412ffebdbaff5/test/e2e/utils_test.go#L46-L63", "created_at": "2025-06-04T09:24:10Z", "updated_at": "2025-06-04T09:25:52Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2126126148", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2126126148"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2126126148"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2126126148/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 46, "start_side": "RIGHT", "line": null, "original_line": 48, "side": "RIGHT", "in_reply_to_id": 2125902437, "author_association": "MEMBER", "original_position": 18, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 279, "file_path": "test/e2e/condition_matcher_test.go", "line_start": 127, "line_end": null, "diff_context": "", "comment_body": "Oops, I missed it during refactor/rebase.\r\n\r\nDue the fact that now we're using `ConditionMatcher` directly with `Matches` on `conditions`, cleaned it up a bit which should hopefully be enough informative to let us know what went wrong when it fails.\r\n\r\nhttps://github.com/openshift/cert-manager-operator/blob/4be9ffb8a845f5f2291ed8666ec26274aad74a45/test/e2e/condition_matcher_test.go#L125-L132\r\n", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2127290263", "pull_request_review_id": 2897866234, "id": 2127290263, "node_id": "PRRC_kwDOFdFn9s5-y9-X", "diff_hunk": "@@ -0,0 +1,148 @@\n+//go:build e2e\n+// +build e2e\n+\n+package e2e\n+\n+import (\n+\t\"regexp\"\n+\n+\t\"context\"\n+\t\"encoding/json\"\n+\t\"fmt\"\n+\t\"log\"\n+\n+\tapierrors \"k8s.io/apimachinery/pkg/api/errors\"\n+\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n+\t\"k8s.io/apimachinery/pkg/util/wait\"\n+\n+\topv1 \"github.com/openshift/api/operator/v1\"\n+\tv1alpha1client \"github.com/openshift/cert-manager-operator/pkg/operator/clientset/versioned/typed/operator/v1alpha1\"\n+)\n+\n+// ConditionMatcher tracks a regex pattern cond.Type with an expected cond.Status\n+type ConditionMatcher struct {\n+\tTypePattern    *regexp.Regexp\n+\tExpectedStatus opv1.ConditionStatus\n+\n+\t// Any when true will expect matcher to succeed\n+\t// when atleast one conditions match, default is false when\n+\t// matcher will succeed only on matching all pattern conditions.\n+\tAny bool\n+}\n+\n+// MatchesType returns true if the provided Condition.Type satisfies regex pattern\n+func (m *ConditionMatcher) MatchesType(cond *opv1.OperatorCondition) bool {\n+\treturn m.TypePattern.MatchString(cond.Type)\n+}\n+\n+// MatchesStatus returns true if the provided Condition.Status is same as ExpectedStatus\n+func (m *ConditionMatcher) MatchesStatus(cond *opv1.OperatorCondition) bool {\n+\treturn cond.Status == m.ExpectedStatus\n+}\n+\n+func (m *ConditionMatcher) Matches(conditions []opv1.OperatorCondition) bool {\n+\tmatchCount := 0\n+\tfor _, cond := range conditions {\n+\t\tif m.MatchesType(&cond) && m.MatchesStatus(&cond) {\n+\n+\t\t\tif m.Any {\n+\t\t\t\treturn true\n+\t\t\t}\n+\n+\t\t\tmatchCount += 1\n+\t\t}\n+\n+\t\tif m.MatchesType(&cond) && !m.MatchesStatus(&cond) {\n+\t\t\treturn false\n+\t\t}\n+\t}\n+\n+\treturn matchCount > 0\n+}\n+\n+const (\n+\tMatchAnyCondition  bool = true\n+\tMatchAllConditions bool = false\n+)\n+\n+// PrefixAndMatchTypeTuple is a tuple containing\n+// controller name (i.e. the condition prefix)\n+// and the condition matcher type be ANY or ALL.\n+type PrefixAndMatchTypeTuple struct {\n+\tPrefix         string\n+\tShouldMatchAny bool\n+}\n+\n+func GenerateConditionMatchers(tuples []PrefixAndMatchTypeTuple, expectedConditions map[string]opv1.ConditionStatus) []ConditionMatcher {\n+\tmatchers := make([]ConditionMatcher, len(tuples)*len(expectedConditions))\n+\n+\tidx := 0\n+\tfor _, t := range tuples {\n+\t\tfor suffix, state := range expectedConditions {\n+\t\t\tmatchers[idx] = ConditionMatcher{\n+\t\t\t\tTypePattern:    regexp.MustCompile(\"^\" + t.Prefix + \".*\" + suffix + \"$\"),\n+\t\t\t\tExpectedStatus: state,\n+\t\t\t\tAny:            t.ShouldMatchAny,\n+\t\t\t}\n+\t\t\tidx += 1\n+\t\t}\n+\t}\n+\treturn matchers\n+}\n+\n+// verifyOperatorStatusCondition polls every few second to check if the status of each of the controllers\n+// match with the expected conditions. It returns an error if a timeout (few mins) occurs or an error was\n+// encountered which polls the status.\n+func verifyOperatorStatusCondition(client v1alpha1client.OperatorV1alpha1Interface, conditionMatchers []ConditionMatcher) error {\n+\tvar lastUnmatchedCondition *opv1.OperatorCondition\n+\tvar lastFetchedConditions []opv1.OperatorCondition\n+\n+\terr := wait.PollUntilContextTimeout(context.TODO(), fastPollInterval, lowTimeout, true, func(context.Context) (bool, error) {\n+\t\toperator, err := client.CertManagers().Get(context.TODO(), \"cluster\", metav1.GetOptions{})\n+\t\tif err != nil {\n+\t\t\tif apierrors.IsNotFound(err) {\n+\t\t\t\treturn false, nil\n+\t\t\t}\n+\t\t\treturn false, err\n+\t\t}\n+\n+\t\tif operator.DeletionTimestamp != nil {\n+\t\t\treturn false, nil\n+\t\t}\n+\n+\t\tlastFetchedConditions = operator.Status.DeepCopy().Conditions\n+\t\tfor _, matcher := range conditionMatchers {\n+\t\t\tif !matcher.Matches(lastFetchedConditions) {\n+\n+\t\t\t\t// [retry] false:   NOT match as desired\n+\t\t\t\treturn false, nil\n+\t\t\t}\n+\t\t}\n+\n+\t\t// [no-retry] true: when ALL match as desired\n+\t\treturn true, nil\n+\t})\n+\n+\tif err != nil {\n+\t\tlog.Printf(\"condition is not expected, %v\", lastUnmatchedCondition)", "path": "test/e2e/condition_matcher_test.go", "commit_id": "350edbf01e2fab22b130a0beedc73030d31c8df8", "original_commit_id": "e5a6034f5574429c4bacce4a311412ffebdbaff5", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "Oops, I missed it during refactor/rebase.\r\n\r\nDue the fact that now we're using `ConditionMatcher` directly with `Matches` on `conditions`, cleaned it up a bit which should hopefully be enough informative to let us know what went wrong when it fails.\r\n\r\nhttps://github.com/openshift/cert-manager-operator/blob/4be9ffb8a845f5f2291ed8666ec26274aad74a45/test/e2e/condition_matcher_test.go#L125-L132\r\n", "created_at": "2025-06-04T19:27:29Z", "updated_at": "2025-06-04T19:27:30Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2127290263", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2127290263"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2127290263"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2127290263/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 127, "side": "RIGHT", "in_reply_to_id": 2126961217, "author_association": "MEMBER", "original_position": 127, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 279, "file_path": "test/e2e/condition_matcher_unit_test.go", "line_start": 41, "line_end": null, "diff_context": "", "comment_body": "I suspect that the change here overrides the global value, because according to log [L204](https://prow.ci.openshift.org/view/gs/test-platform-results/logs/multi-pr-openshift-cert-manager-operator-280-openshift-cert-manager-operator-279-e2e-operator/1930345908772278272#1:build-log.txt%3A204) & [L302](https://prow.ci.openshift.org/view/gs/test-platform-results/logs/multi-pr-openshift-cert-manager-operator-280-openshift-cert-manager-operator-279-e2e-operator/1930345908772278272#1:build-log.txt%3A302), `VerifyHealthyOperatorConditions` only waited for 5 seconds. \ud83e\udd72", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2127850089", "pull_request_review_id": 2898730836, "id": 2127850089, "node_id": "PRRC_kwDOFdFn9s5-1Gpp", "diff_hunk": "@@ -0,0 +1,159 @@\n+//go:build e2e\n+// +build e2e\n+\n+package e2e\n+\n+import (\n+\t\"strings\"\n+\t\"testing\"\n+\t\"time\"\n+\n+\topv1 \"github.com/openshift/api/operator/v1\"\n+\toperatorv1alpha1 \"github.com/openshift/cert-manager-operator/api/operator/v1alpha1\"\n+\tfakecertmanclient \"github.com/openshift/cert-manager-operator/pkg/operator/clientset/versioned/fake\"\n+\n+\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n+\t\"k8s.io/apimachinery/pkg/runtime\"\n+)\n+\n+// TestVerifyOperatorStatusCondition unit test for verifyOperatorStatusCondition func\n+func TestVerifyOperatorStatusCondition(t *testing.T) {\n+\tcontrollerPrefix := \"foo-controller\"\n+\n+\tnewCertManagerObjectWithConditions := func(conditions ...opv1.OperatorCondition) *operatorv1alpha1.CertManager {\n+\t\treturn &operatorv1alpha1.CertManager{\n+\t\t\tObjectMeta: metav1.ObjectMeta{\n+\t\t\t\tName: \"cluster\",\n+\t\t\t},\n+\t\t\tStatus: operatorv1alpha1.CertManagerStatus{\n+\t\t\t\tOperatorStatus: opv1.OperatorStatus{\n+\t\t\t\t\tConditions: conditions,\n+\t\t\t\t},\n+\t\t\t},\n+\t\t}\n+\t}\n+\n+\t// override the times, to respond quicker on wait.Poll\n+\tpreTestTimeoutValue := lowTimeout\n+\tlowTimeout = 5 * time.Second\n+\tdefer func() {\n+\t\tlowTimeout = preTestTimeoutValue\n+\t}()", "path": "test/e2e/condition_matcher_unit_test.go", "commit_id": "350edbf01e2fab22b130a0beedc73030d31c8df8", "original_commit_id": "4be9ffb8a845f5f2291ed8666ec26274aad74a45", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "I suspect that the change here overrides the global value, because according to log [L204](https://prow.ci.openshift.org/view/gs/test-platform-results/logs/multi-pr-openshift-cert-manager-operator-280-openshift-cert-manager-operator-279-e2e-operator/1930345908772278272#1:build-log.txt%3A204) & [L302](https://prow.ci.openshift.org/view/gs/test-platform-results/logs/multi-pr-openshift-cert-manager-operator-280-openshift-cert-manager-operator-279-e2e-operator/1930345908772278272#1:build-log.txt%3A302), `VerifyHealthyOperatorConditions` only waited for 5 seconds. \ud83e\udd72", "created_at": "2025-06-05T03:05:27Z", "updated_at": "2025-06-05T03:05:28Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2127850089", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2127850089"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/279#discussion_r2127850089"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/279"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2127850089/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 36, "start_side": "RIGHT", "line": null, "original_line": 41, "side": "RIGHT", "author_association": "MEMBER", "original_position": 41, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 288, "file_path": "test/e2e/overrides_test.go", "line_start": 63, "line_end": null, "diff_context": "", "comment_body": "Port 9403 conflicts with an existing cert-manager-controller port `http-healthz` https://github.com/openshift/cert-manager-operator/blob/b6b2d69c98c31e9772546f5b9f7aff5efb99e725/bindata/cert-manager-deployment/controller/cert-manager-deployment.yaml#L63-L65\r\n\r\n```\r\nI0721 10:15:13.318951       1 controller.go:102] \"listening for insecure connections\" logger=\"cert-manager.controller\" address=\"0.0.0.0:9403\"\r\nE0721 10:15:13.319411       1 main.go:40] \"error executing command\" err=\"failed to listen on healthz address 0.0.0.0:9403: listen tcp 0.0.0.0:9403: bind: address already in use\" logger=\"cert-manager\"\r\n```", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2218765366", "pull_request_review_id": 3037434858, "id": 2218765366, "node_id": "PRRC_kwDOFdFn9s6EP6w2", "diff_hunk": "@@ -41,7 +41,27 @@ var _ = Describe(\"Overrides test\", Ordered, func() {\n \t\tIt(\"should add the args to the cert-manager controller deployment\", func() {\n \n \t\t\tBy(\"Adding cert-manager controller override args to the cert-managaer operator object\")\n-\t\t\targs := []string{\"--dns01-recursive-nameservers=10.10.10.10:53\", \"--dns01-recursive-nameservers-only\", \"--enable-certificate-owner-ref\", \"--v=3\"}\n+\t\t\targs := []string{\n+\t\t\t\t// good-have to sync these args updated with the args present in\n+\t\t\t\t// pkg/controller/deployment/deployment_overrides_validation.go,\n+\t\t\t\t// so the e2e is self-aware of overrideArgs.\n+\n+\t\t\t\t\"--acme-http01-solver-resource-limits-cpu=150m\",\n+\t\t\t\t\"--acme-http01-solver-resource-limits-memory=100Mi\",\n+\t\t\t\t\"--acme-http01-solver-resource-request-cpu=50m\",\n+\t\t\t\t\"--acme-http01-solver-resource-request-memory=100Mi\",\n+\n+\t\t\t\t\"--dns01-recursive-nameservers=10.10.10.10:53\",\n+\t\t\t\t\"--dns01-recursive-nameservers-only\",\n+\n+\t\t\t\t\"--enable-certificate-owner-ref\",\n+\n+\t\t\t\t\"--issuer-ambient-credentials\",\n+\n+\t\t\t\t\"--v=5\",\n+\n+\t\t\t\t\"--metrics-listen-address=0.0.0.0:9403\",", "path": "test/e2e/overrides_test.go", "commit_id": "5da1b7d7b92744227ee78dbe85e7477eff294fad", "original_commit_id": "8b7650b2f375e3f0455764625620cb8c4bd6a15b", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "Port 9403 conflicts with an existing cert-manager-controller port `http-healthz` https://github.com/openshift/cert-manager-operator/blob/b6b2d69c98c31e9772546f5b9f7aff5efb99e725/bindata/cert-manager-deployment/controller/cert-manager-deployment.yaml#L63-L65\r\n\r\n```\r\nI0721 10:15:13.318951       1 controller.go:102] \"listening for insecure connections\" logger=\"cert-manager.controller\" address=\"0.0.0.0:9403\"\r\nE0721 10:15:13.319411       1 main.go:40] \"error executing command\" err=\"failed to listen on healthz address 0.0.0.0:9403: listen tcp 0.0.0.0:9403: bind: address already in use\" logger=\"cert-manager\"\r\n```", "created_at": "2025-07-21T10:22:59Z", "updated_at": "2025-07-21T10:22:59Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/288#discussion_r2218765366", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/288", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2218765366"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/288#discussion_r2218765366"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/288"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2218765366/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 63, "side": "RIGHT", "author_association": "MEMBER", "original_position": 24, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 293, "file_path": "bundle/manifests/cert-manager-operator.clusterserviceversion.yaml", "line_start": 253, "line_end": 253, "diff_context": "", "comment_body": "This OLM upgrade path is unlike other z-stream\r\nreleases to help users in <=1.15.1 to entirely avoid OCPBUGS-56758.\r\nSee [this](https://issues.redhat.com/browse/CM-604?focusedId=27441517&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-27441517) for the upgrade path strategy. ", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2174286476", "pull_request_review_id": 2969997319, "id": 2174286476, "node_id": "PRRC_kwDOFdFn9s6BmPqM", "diff_hunk": "@@ -250,7 +250,7 @@ metadata:\n     features.operators.openshift.io/token-auth-aws: \"true\"\n     features.operators.openshift.io/token-auth-azure: \"true\"\n     features.operators.openshift.io/token-auth-gcp: \"true\"\n-    olm.skipRange: '>=1.15.1 <1.16.0'\n+    olm.skipRange: '>=1.15.1 <1.16.1'", "path": "bundle/manifests/cert-manager-operator.clusterserviceversion.yaml", "commit_id": "f0aac3e435693674ac85b115d51ca718ce4a5842", "original_commit_id": "8256d20da6bfb1f432e2fb009da0b7f4a729d332", "user": {"login": "chiragkyal", "id": 43825954, "node_id": "MDQ6VXNlcjQzODI1OTU0", "avatar_url": "https://avatars.githubusercontent.com/u/43825954?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chiragkyal", "html_url": "https://github.com/chiragkyal", "followers_url": "https://api.github.com/users/chiragkyal/followers", "following_url": "https://api.github.com/users/chiragkyal/following{/other_user}", "gists_url": "https://api.github.com/users/chiragkyal/gists{/gist_id}", "starred_url": "https://api.github.com/users/chiragkyal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chiragkyal/subscriptions", "organizations_url": "https://api.github.com/users/chiragkyal/orgs", "repos_url": "https://api.github.com/users/chiragkyal/repos", "events_url": "https://api.github.com/users/chiragkyal/events{/privacy}", "received_events_url": "https://api.github.com/users/chiragkyal/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "This OLM upgrade path is unlike other z-stream\r\nreleases to help users in <=1.15.1 to entirely avoid OCPBUGS-56758.\r\nSee [this](https://issues.redhat.com/browse/CM-604?focusedId=27441517&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-27441517) for the upgrade path strategy. ", "created_at": "2025-06-30T06:01:16Z", "updated_at": "2025-06-30T06:01:17Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/293#discussion_r2174286476", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/293", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2174286476"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/293#discussion_r2174286476"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/293"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2174286476/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 253, "original_start_line": 253, "start_side": "LEFT", "line": 253, "original_line": 253, "side": "RIGHT", "author_association": "MEMBER", "original_position": 5, "position": 5, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 293, "file_path": "config/manifests/bases/cert-manager-operator.clusterserviceversion.yaml", "line_start": 110, "line_end": 110, "diff_context": "", "comment_body": "Due to https://github.com/openshift/cert-manager-operator/pull/293#discussion_r2174286476", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2174288532", "pull_request_review_id": 2970000480, "id": 2174288532, "node_id": "PRRC_kwDOFdFn9s6BmQKU", "diff_hunk": "@@ -104,5 +104,7 @@ spec:\n   minKubeVersion: 1.27.0\n   provider:\n     name: Red Hat\n-  replaces: cert-manager-operator.v1.15.1\n-  version: 1.16.0\n+  replaces: cert-manager-operator.v1.16.0\n+  skips:\n+  - cert-manager-operator.v1.15.1\n+  version: 1.16.1", "path": "config/manifests/bases/cert-manager-operator.clusterserviceversion.yaml", "commit_id": "f0aac3e435693674ac85b115d51ca718ce4a5842", "original_commit_id": "8256d20da6bfb1f432e2fb009da0b7f4a729d332", "user": {"login": "chiragkyal", "id": 43825954, "node_id": "MDQ6VXNlcjQzODI1OTU0", "avatar_url": "https://avatars.githubusercontent.com/u/43825954?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chiragkyal", "html_url": "https://github.com/chiragkyal", "followers_url": "https://api.github.com/users/chiragkyal/followers", "following_url": "https://api.github.com/users/chiragkyal/following{/other_user}", "gists_url": "https://api.github.com/users/chiragkyal/gists{/gist_id}", "starred_url": "https://api.github.com/users/chiragkyal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chiragkyal/subscriptions", "organizations_url": "https://api.github.com/users/chiragkyal/orgs", "repos_url": "https://api.github.com/users/chiragkyal/repos", "events_url": "https://api.github.com/users/chiragkyal/events{/privacy}", "received_events_url": "https://api.github.com/users/chiragkyal/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "Due to https://github.com/openshift/cert-manager-operator/pull/293#discussion_r2174286476", "created_at": "2025-06-30T06:03:08Z", "updated_at": "2025-06-30T06:03:08Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/293#discussion_r2174288532", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/293", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2174288532"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/293#discussion_r2174288532"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/293"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2174288532/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 107, "original_start_line": 107, "start_side": "RIGHT", "line": 110, "original_line": 110, "side": "RIGHT", "author_association": "MEMBER", "original_position": 36, "position": 36, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 293, "file_path": "go.mod", "line_start": 3, "line_end": null, "diff_context": "", "comment_body": "As per the above Slack thread, \r\n> Update to 1.23.9 golang version for both operator and operand\r\n\r\nHow are we planning to update the golang version for operand repo? Do we need some `<carry>` patch in https://github.com/openshift/jetstack-cert-manager/blob/v1.16.5/go.mod#L3 ?", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2182069078", "pull_request_review_id": 2982063398, "id": 2182069078, "node_id": "PRRC_kwDOFdFn9s6CD7tW", "diff_hunk": "@@ -1,11 +1,11 @@\n module github.com/openshift/cert-manager-operator\n \n-go 1.23.0\n+go 1.23.8", "path": "go.mod", "commit_id": "f0aac3e435693674ac85b115d51ca718ce4a5842", "original_commit_id": "8256d20da6bfb1f432e2fb009da0b7f4a729d332", "user": {"login": "chiragkyal", "id": 43825954, "node_id": "MDQ6VXNlcjQzODI1OTU0", "avatar_url": "https://avatars.githubusercontent.com/u/43825954?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chiragkyal", "html_url": "https://github.com/chiragkyal", "followers_url": "https://api.github.com/users/chiragkyal/followers", "following_url": "https://api.github.com/users/chiragkyal/following{/other_user}", "gists_url": "https://api.github.com/users/chiragkyal/gists{/gist_id}", "starred_url": "https://api.github.com/users/chiragkyal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chiragkyal/subscriptions", "organizations_url": "https://api.github.com/users/chiragkyal/orgs", "repos_url": "https://api.github.com/users/chiragkyal/repos", "events_url": "https://api.github.com/users/chiragkyal/events{/privacy}", "received_events_url": "https://api.github.com/users/chiragkyal/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "As per the above Slack thread, \r\n> Update to 1.23.9 golang version for both operator and operand\r\n\r\nHow are we planning to update the golang version for operand repo? Do we need some `<carry>` patch in https://github.com/openshift/jetstack-cert-manager/blob/v1.16.5/go.mod#L3 ?", "created_at": "2025-07-03T07:30:00Z", "updated_at": "2025-07-03T07:30:00Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/293#discussion_r2182069078", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/293", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2182069078"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/293#discussion_r2182069078"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/293"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2182069078/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 3, "start_side": "LEFT", "line": null, "original_line": 3, "side": "RIGHT", "in_reply_to_id": 2174304856, "author_association": "MEMBER", "original_position": 4, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 293, "file_path": "go.mod", "line_start": 3, "line_end": null, "diff_context": "", "comment_body": "Updated in https://github.com/openshift/cert-manager-operator/pull/293/commits/f0aac3e435693674ac85b115d51ca718ce4a5842 commit. ", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2182158569", "pull_request_review_id": 2982195458, "id": 2182158569, "node_id": "PRRC_kwDOFdFn9s6CERjp", "diff_hunk": "@@ -1,11 +1,11 @@\n module github.com/openshift/cert-manager-operator\n \n-go 1.23.0\n+go 1.23.8", "path": "go.mod", "commit_id": "f0aac3e435693674ac85b115d51ca718ce4a5842", "original_commit_id": "8256d20da6bfb1f432e2fb009da0b7f4a729d332", "user": {"login": "chiragkyal", "id": 43825954, "node_id": "MDQ6VXNlcjQzODI1OTU0", "avatar_url": "https://avatars.githubusercontent.com/u/43825954?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chiragkyal", "html_url": "https://github.com/chiragkyal", "followers_url": "https://api.github.com/users/chiragkyal/followers", "following_url": "https://api.github.com/users/chiragkyal/following{/other_user}", "gists_url": "https://api.github.com/users/chiragkyal/gists{/gist_id}", "starred_url": "https://api.github.com/users/chiragkyal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chiragkyal/subscriptions", "organizations_url": "https://api.github.com/users/chiragkyal/orgs", "repos_url": "https://api.github.com/users/chiragkyal/repos", "events_url": "https://api.github.com/users/chiragkyal/events{/privacy}", "received_events_url": "https://api.github.com/users/chiragkyal/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "Updated in https://github.com/openshift/cert-manager-operator/pull/293/commits/f0aac3e435693674ac85b115d51ca718ce4a5842 commit. ", "created_at": "2025-07-03T08:15:20Z", "updated_at": "2025-07-03T08:15:20Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/293#discussion_r2182158569", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/293", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2182158569"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/293#discussion_r2182158569"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/293"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2182158569/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 3, "start_side": "LEFT", "line": null, "original_line": 3, "side": "RIGHT", "in_reply_to_id": 2174304856, "author_association": "MEMBER", "original_position": 4, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 296, "file_path": "pkg/controller/istiocsr/core_validation_helpers_duplication.go", "line_start": 45, "line_end": 45, "diff_context": "", "comment_body": "ValidateNodeSelector has been added a new parameter `allowInvalidLabelValueInRequiredNodeAffinity` since v1.32.0 in this [commit](https://github.com/kubernetes/kubernetes/commit/3075a9ae968bb995bc170b966a48e052d18c75c0)\r\n\r\nhttps://pkg.go.dev/k8s.io/kubernetes@v1.31.7/pkg/apis/core/validation#ValidateNodeSelector\r\n\r\nhttps://pkg.go.dev/k8s.io/kubernetes@v1.33.2/pkg/apis/core/validation#ValidateNodeSelector", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2206487739", "pull_request_review_id": 3018811550, "id": 2206487739, "node_id": "PRRC_kwDOFdFn9s6DhFS7", "diff_hunk": "@@ -42,7 +42,7 @@ func validateNodeAffinity(na *core.NodeAffinity, fldPath *field.Path) field.Erro\n \t//\tallErrs = append(allErrs, ValidateNodeSelector(na.RequiredDuringSchedulingRequiredDuringExecution, fldPath.Child(\"requiredDuringSchedulingRequiredDuringExecution\"))...)\n \t// }\n \tif na.RequiredDuringSchedulingIgnoredDuringExecution != nil {\n-\t\tallErrs = append(allErrs, corevalidation.ValidateNodeSelector(na.RequiredDuringSchedulingIgnoredDuringExecution, fldPath.Child(\"requiredDuringSchedulingIgnoredDuringExecution\"))...)\n+\t\tallErrs = append(allErrs, corevalidation.ValidateNodeSelector(na.RequiredDuringSchedulingIgnoredDuringExecution, false, fldPath.Child(\"requiredDuringSchedulingIgnoredDuringExecution\"))...)", "path": "pkg/controller/istiocsr/core_validation_helpers_duplication.go", "commit_id": "4b7ef324bdbce35f1d784693080205adc058ef79", "original_commit_id": "8b46489b4fb92d1277a039924eb2fda454860eb9", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "ValidateNodeSelector has been added a new parameter `allowInvalidLabelValueInRequiredNodeAffinity` since v1.32.0 in this [commit](https://github.com/kubernetes/kubernetes/commit/3075a9ae968bb995bc170b966a48e052d18c75c0)\r\n\r\nhttps://pkg.go.dev/k8s.io/kubernetes@v1.31.7/pkg/apis/core/validation#ValidateNodeSelector\r\n\r\nhttps://pkg.go.dev/k8s.io/kubernetes@v1.33.2/pkg/apis/core/validation#ValidateNodeSelector", "created_at": "2025-07-15T06:11:24Z", "updated_at": "2025-07-15T06:29:34Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/296#discussion_r2206487739", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/296", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2206487739"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/296#discussion_r2206487739"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/296"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2206487739/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 45, "original_line": 45, "side": "RIGHT", "author_association": "MEMBER", "original_position": 5, "position": 5, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 296, "file_path": "pkg/controller/istiocsr/deployments.go", "line_start": 436, "line_end": 436, "diff_context": "", "comment_body": "ValidateResourceRequirements has been changed to ValidateContainerResourceRequirements since v1.32.0 in this [commit](https://github.com/kubernetes/kubernetes/commit/8a8dc27b4e1317ff58c776643d7f175c870d4dbe)\r\n\r\nhttps://pkg.go.dev/k8s.io/kubernetes@v1.31.7/pkg/apis/core/validation#ValidateResourceRequirements\r\n\r\nhttps://pkg.go.dev/k8s.io/kubernetes@v1.33.2/pkg/apis/core/validation#ValidateContainerResourceRequirements", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2206503700", "pull_request_review_id": 3018811550, "id": 2206503700, "node_id": "PRRC_kwDOFdFn9s6DhJMU", "diff_hunk": "@@ -433,7 +433,7 @@ func validateTolerationsConfig(tolerations []corev1.Toleration, fldPath *field.P\n func validateResourceRequirements(requirements corev1.ResourceRequirements, fldPath *field.Path) error {\n \t// convert corev1.ResourceRequirements to core.ResourceRequirements, required for validation.\n \tconvRequirements := *(*core.ResourceRequirements)(unsafe.Pointer(&requirements))\n-\treturn corevalidation.ValidateResourceRequirements(&convRequirements, nil, fldPath.Child(\"resources\"), corevalidation.PodValidationOptions{}).ToAggregate()\n+\treturn corevalidation.ValidateContainerResourceRequirements(&convRequirements, nil, fldPath.Child(\"resources\"), corevalidation.PodValidationOptions{}).ToAggregate()", "path": "pkg/controller/istiocsr/deployments.go", "commit_id": "4b7ef324bdbce35f1d784693080205adc058ef79", "original_commit_id": "8b46489b4fb92d1277a039924eb2fda454860eb9", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "ValidateResourceRequirements has been changed to ValidateContainerResourceRequirements since v1.32.0 in this [commit](https://github.com/kubernetes/kubernetes/commit/8a8dc27b4e1317ff58c776643d7f175c870d4dbe)\r\n\r\nhttps://pkg.go.dev/k8s.io/kubernetes@v1.31.7/pkg/apis/core/validation#ValidateResourceRequirements\r\n\r\nhttps://pkg.go.dev/k8s.io/kubernetes@v1.33.2/pkg/apis/core/validation#ValidateContainerResourceRequirements", "created_at": "2025-07-15T06:21:16Z", "updated_at": "2025-07-15T06:29:34Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/296#discussion_r2206503700", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/296", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2206503700"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/296#discussion_r2206503700"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/296"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2206503700/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 436, "original_line": 436, "side": "RIGHT", "author_association": "MEMBER", "original_position": 5, "position": 5, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 296, "file_path": "pkg/operator/applyconfigurations/internal/internal.go", "line_start": 7, "line_end": 7, "diff_context": "", "comment_body": "Changes under path `pkg/operator` in commit https://github.com/openshift/cert-manager-operator/pull/296/commits/5b863384555bd915f76cffc459810895b0660ff4 are auto generated by `make generate` (part of [make update](https://github.com/openshift/cert-manager-operator/blob/55787ccef486cd2f55fa73459957906dd3bddb9f/Makefile#L153))", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2209135869", "pull_request_review_id": 3022980998, "id": 2209135869, "node_id": "PRRC_kwDOFdFn9s6DrLz9", "diff_hunk": "@@ -3,8 +3,8 @@\n package internal\n \n import (\n-\t\"fmt\"\n-\t\"sync\"\n+\tfmt \"fmt\"\n+\tsync \"sync\"", "path": "pkg/operator/applyconfigurations/internal/internal.go", "commit_id": "4b7ef324bdbce35f1d784693080205adc058ef79", "original_commit_id": "8c5553f97021257355c5f464a402e07ec5f44b3d", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "Changes under path `pkg/operator` in commit https://github.com/openshift/cert-manager-operator/pull/296/commits/5b863384555bd915f76cffc459810895b0660ff4 are auto generated by `make generate` (part of [make update](https://github.com/openshift/cert-manager-operator/blob/55787ccef486cd2f55fa73459957906dd3bddb9f/Makefile#L153))", "created_at": "2025-07-16T03:34:22Z", "updated_at": "2025-07-16T03:34:22Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/296#discussion_r2209135869", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/296", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2209135869"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/296#discussion_r2209135869"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/296"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2209135869/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 6, "original_start_line": 6, "start_side": "RIGHT", "line": 7, "original_line": 7, "side": "RIGHT", "in_reply_to_id": 2207861642, "author_association": "MEMBER", "original_position": 7, "position": 7, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 296, "file_path": "config/manifests/bases/cert-manager-operator.clusterserviceversion.yaml", "line_start": 108, "line_end": 108, "diff_context": "", "comment_body": "It's an intentional change since `skips` was added to overcome that buggy version https://github.com/openshift/cert-manager-operator/pull/293/commits/8256d20da6bfb1f432e2fb009da0b7f4a729d332#r2174288532", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2210629018", "pull_request_review_id": 3025343757, "id": 2210629018, "node_id": "PRRC_kwDOFdFn9s6Dw4Wa", "diff_hunk": "@@ -104,7 +104,5 @@ spec:\n   minKubeVersion: 1.27.0\n   provider:\n     name: Red Hat\n-  replaces: cert-manager-operator.v1.16.0\n-  skips:", "path": "config/manifests/bases/cert-manager-operator.clusterserviceversion.yaml", "commit_id": "4b7ef324bdbce35f1d784693080205adc058ef79", "original_commit_id": "59a9c0515797ef886331288de886e38d16beb1e2", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "It's an intentional change since `skips` was added to overcome that buggy version https://github.com/openshift/cert-manager-operator/pull/293/commits/8256d20da6bfb1f432e2fb009da0b7f4a729d332#r2174288532", "created_at": "2025-07-16T14:38:45Z", "updated_at": "2025-07-16T14:38:45Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/296#discussion_r2210629018", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/296", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2210629018"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/296#discussion_r2210629018"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/296"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2210629018/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 108, "original_line": 108, "side": "LEFT", "in_reply_to_id": 2209579043, "author_association": "MEMBER", "original_position": 23, "position": 32, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 296, "file_path": "pkg/operator/applyconfigurations/internal/internal.go", "line_start": 7, "line_end": 7, "diff_context": "", "comment_body": "@chiragkyal / @bharath-b-rh `make generate` calls [hack/update-clientgen.sh](https://github.com/openshift/cert-manager-operator/blob/master/hack/update-clientgen.sh) to leverage the `vendor/k8s.io/code-generator` to do the codegen, there should be some changes, but I unfortunately wasn't able to find a way to disable it.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2210643526", "pull_request_review_id": 3025370643, "id": 2210643526, "node_id": "PRRC_kwDOFdFn9s6Dw75G", "diff_hunk": "@@ -3,8 +3,8 @@\n package internal\n \n import (\n-\t\"fmt\"\n-\t\"sync\"\n+\tfmt \"fmt\"\n+\tsync \"sync\"", "path": "pkg/operator/applyconfigurations/internal/internal.go", "commit_id": "4b7ef324bdbce35f1d784693080205adc058ef79", "original_commit_id": "8c5553f97021257355c5f464a402e07ec5f44b3d", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "@chiragkyal / @bharath-b-rh `make generate` calls [hack/update-clientgen.sh](https://github.com/openshift/cert-manager-operator/blob/master/hack/update-clientgen.sh) to leverage the `vendor/k8s.io/code-generator` to do the codegen, there should be some changes, but I unfortunately wasn't able to find a way to disable it.", "created_at": "2025-07-16T14:44:16Z", "updated_at": "2025-07-16T14:44:16Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/296#discussion_r2210643526", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/296", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2210643526"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/296#discussion_r2210643526"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/296"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2210643526/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 6, "original_start_line": 6, "start_side": "RIGHT", "line": 7, "original_line": 7, "side": "RIGHT", "in_reply_to_id": 2207861642, "author_association": "MEMBER", "original_position": 7, "position": 7, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 296, "file_path": "pkg/operator/assets/bindata.go", "line_start": 1, "line_end": 1, "diff_context": "", "comment_body": "Hi @bharath-b-rh, I think bindata.go was updated in this commit https://github.com/openshift/cert-manager-operator/pull/296/commits/259f84ce519cb5ae89353a09a8e7adf4a0c88f20. Rerun `make update-bindata` won't generate new diffs", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2212406772", "pull_request_review_id": 3028102590, "id": 2212406772, "node_id": "PRRC_kwDOFdFn9s6D3qX0", "diff_hunk": "", "path": "pkg/operator/assets/bindata.go", "commit_id": "f92b029952337acf7dcec98ae4a14078340fbc86", "original_commit_id": "259f84ce519cb5ae89353a09a8e7adf4a0c88f20", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "Hi @bharath-b-rh, I think bindata.go was updated in this commit https://github.com/openshift/cert-manager-operator/pull/296/commits/259f84ce519cb5ae89353a09a8e7adf4a0c88f20. Rerun `make update-bindata` won't generate new diffs", "created_at": "2025-07-17T06:36:18Z", "updated_at": "2025-07-17T06:39:03Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/296#discussion_r2212406772", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/296", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2212406772"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/296#discussion_r2212406772"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/296"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2212406772/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 1, "original_line": 1, "side": "RIGHT", "author_association": "MEMBER", "original_position": 1, "position": 1, "subject_type": "file"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 298, "file_path": "test/e2e/certificates_test.go", "line_start": 512, "line_end": 512, "diff_context": "", "comment_body": "Yes, `WithTemplateValues` is also helpful with dynamic values, but I'd like the creation to be more extensible for simple objects like issuer/cert. We need either make all runtime-required values that are used in many places templated `{{. }}`, or just use API-based object creation.\r\n\r\n`CreateFromFile` and `WithTemplateValues` are still useful when handling large/complex or purely static objects. I only evaluate `testdata/acme` involved for this PR, we could revisit others in future", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2239353992", "pull_request_review_id": 3066817967, "id": 2239353992, "node_id": "PRRC_kwDOFdFn9s6FedSI", "diff_hunk": "@@ -507,32 +522,71 @@ var _ = Describe(\"ACME Certificate\", Ordered, func() {\n \t\t\tExpect(gcpProjectId).NotTo(Equal(\"\"))\n \n \t\t\tBy(\"Creating new certificate ClusterIssuer\")\n-\t\t\t// The name is defined by the testdata YAML file clusterissuer_gcp.yaml\n \t\t\tclusterIssuerName := \"acme-dns01-clouddns-ambient\"\n-\t\t\tloader.CreateFromFile(AssetFunc(testassets.ReadFile).WithTemplateValues(", "path": "test/e2e/certificates_test.go", "commit_id": "ddbd0d1ed8abfc6477b75b6ea99d7b186d985b09", "original_commit_id": "94eb53c45adce7c36c4d5a15f180c05401ca17cb", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "Yes, `WithTemplateValues` is also helpful with dynamic values, but I'd like the creation to be more extensible for simple objects like issuer/cert. We need either make all runtime-required values that are used in many places templated `{{. }}`, or just use API-based object creation.\r\n\r\n`CreateFromFile` and `WithTemplateValues` are still useful when handling large/complex or purely static objects. I only evaluate `testdata/acme` involved for this PR, we could revisit others in future", "created_at": "2025-07-29T10:38:52Z", "updated_at": "2025-07-29T10:38:52Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/298#discussion_r2239353992", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/298", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2239353992"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/298#discussion_r2239353992"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/298"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2239353992/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 512, "original_line": 512, "side": "LEFT", "in_reply_to_id": 2239087970, "author_association": "MEMBER", "original_position": 140, "position": 186, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 302, "file_path": "bindata/cert-manager-deployment/controller/cert-manager-svc.yaml", "line_start": 17, "line_end": 17, "diff_context": "", "comment_body": "Should we also update our [sample ServiceMonitor](https://docs.redhat.com/en/documentation/openshift_container_platform/4.19/html/security_and_compliance/cert-manager-operator-for-red-hat-openshift#cert-manager-monitoring:~:text=scrapeTimeout%3A%2030s-,targetPort%3A%209402,-selector%3A%0A%20%20%20%20matchExpressions) object in our docs to use the same, named port?", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2253428170", "pull_request_review_id": 3086524548, "id": 2253428170, "node_id": "PRRC_kwDOFdFn9s6GUJXK", "diff_hunk": "@@ -6,15 +6,15 @@ metadata:\n     app.kubernetes.io/component: controller\n     app.kubernetes.io/instance: cert-manager\n     app.kubernetes.io/name: cert-manager\n-    app.kubernetes.io/version: v1.17.4\n+    app.kubernetes.io/version: v1.18.2\n   name: cert-manager\n   namespace: cert-manager\n spec:\n   ports:\n     - name: tcp-prometheus-servicemonitor\n       port: 9402\n       protocol: TCP\n-      targetPort: 9402\n+      targetPort: http-metrics", "path": "bindata/cert-manager-deployment/controller/cert-manager-svc.yaml", "commit_id": "ad3efec7a08f0dfe939138e5299ce5a1de2cd1ff", "original_commit_id": "1f4dcf8f8b13bdadae9e2b750a82306e322dc74d", "user": {"login": "bharath-b-rh", "id": 92782575, "node_id": "U_kgDOBYe_7w", "avatar_url": "https://avatars.githubusercontent.com/u/92782575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bharath-b-rh", "html_url": "https://github.com/bharath-b-rh", "followers_url": "https://api.github.com/users/bharath-b-rh/followers", "following_url": "https://api.github.com/users/bharath-b-rh/following{/other_user}", "gists_url": "https://api.github.com/users/bharath-b-rh/gists{/gist_id}", "starred_url": "https://api.github.com/users/bharath-b-rh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bharath-b-rh/subscriptions", "organizations_url": "https://api.github.com/users/bharath-b-rh/orgs", "repos_url": "https://api.github.com/users/bharath-b-rh/repos", "events_url": "https://api.github.com/users/bharath-b-rh/events{/privacy}", "received_events_url": "https://api.github.com/users/bharath-b-rh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "Should we also update our [sample ServiceMonitor](https://docs.redhat.com/en/documentation/openshift_container_platform/4.19/html/security_and_compliance/cert-manager-operator-for-red-hat-openshift#cert-manager-monitoring:~:text=scrapeTimeout%3A%2030s-,targetPort%3A%209402,-selector%3A%0A%20%20%20%20matchExpressions) object in our docs to use the same, named port?", "created_at": "2025-08-05T07:39:15Z", "updated_at": "2025-08-05T08:25:47Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/302#discussion_r2253428170", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/302", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2253428170"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/302#discussion_r2253428170"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/302"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2253428170/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 17, "original_line": 17, "side": "RIGHT", "author_association": "MEMBER", "original_position": 14, "position": 14, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 302, "file_path": "config/manager/manager.yaml", "line_start": 84, "line_end": 84, "diff_context": "", "comment_body": "> can we add version tags for other images too\r\n\r\nit'll break the CI replacement logic, if other images are tagged as non-`latest`.\r\n\r\nhttps://github.com/openshift/release/blob/master/ci-operator/config/openshift/cert-manager-operator/openshift-cert-manager-operator-master.yaml#L37-L45 i.e. having latest here and in the CI config, helps avoid the repetitive need to update the tag in the CI config for every release.\r\n", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2268668884", "pull_request_review_id": 3108659208, "id": 2268668884, "node_id": "PRRC_kwDOFdFn9s6HOSPU", "diff_hunk": "@@ -81,15 +81,15 @@ spec:\n             - name: RELATED_IMAGE_CERT_MANAGER_CONTROLLER\n               value: quay.io/jetstack/cert-manager-controller:latest\n             - name: RELATED_IMAGE_CERT_MANAGER_ACMESOLVER\n-              value: quay.io/jetstack/cert-manager-acmesolver:v1.17.4\n+              value: quay.io/jetstack/cert-manager-acmesolver:v1.18.2", "path": "config/manager/manager.yaml", "commit_id": "ad3efec7a08f0dfe939138e5299ce5a1de2cd1ff", "original_commit_id": "1f4dcf8f8b13bdadae9e2b750a82306e322dc74d", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "> can we add version tags for other images too\r\n\r\nit'll break the CI replacement logic, if other images are tagged as non-`latest`.\r\n\r\nhttps://github.com/openshift/release/blob/master/ci-operator/config/openshift/cert-manager-operator/openshift-cert-manager-operator-master.yaml#L37-L45 i.e. having latest here and in the CI config, helps avoid the repetitive need to update the tag in the CI config for every release.\r\n", "created_at": "2025-08-12T05:54:44Z", "updated_at": "2025-08-12T05:54:44Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/302#discussion_r2268668884", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/302", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2268668884"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/302#discussion_r2268668884"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/302"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2268668884/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 84, "original_line": 84, "side": "RIGHT", "in_reply_to_id": 2253119556, "author_association": "MEMBER", "original_position": 5, "position": 5, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 305, "file_path": "api/operator/v1alpha1/istiocsr_types.go", "line_start": 141, "line_end": null, "diff_context": "", "comment_body": "I'll modify the field name and validations as per the EP discussion : https://github.com/openshift/enhancements/pull/1837", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2332023621", "pull_request_review_id": 3199225921, "id": 2332023621, "node_id": "PRRC_kwDOFdFn9s6K_9tF", "diff_hunk": "@@ -132,6 +132,13 @@ type IstioCSRConfig struct {\n \t// +optional\n \t// +mapType=atomic\n \tNodeSelector map[string]string `json:\"nodeSelector,omitempty\"`\n+\n+\t// configMapNamespaceSelector is a label selector to filter on namespaces where the controller creates\n+\t// istio-ca-root-cert ConfigMap. Supports '=', '==', and '!='.(e.g. key1=value1,key2=value2).\n+\t// When not set, the CA certificate is copied to every namespace in the cluster.\n+\t// +kubebuilder:validation:Optional\n+\t// +optional\n+\tConfigMapNamespaceSelector string `json:\"configMapNamespaceSelector,omitempty\"`", "path": "api/operator/v1alpha1/istiocsr_types.go", "commit_id": "7a61c713f60d94b109c17a95e2a0f455d67fe3c5", "original_commit_id": "4a61f323ecae2647279e807a90717f1714ff02f9", "user": {"login": "chiragkyal", "id": 43825954, "node_id": "MDQ6VXNlcjQzODI1OTU0", "avatar_url": "https://avatars.githubusercontent.com/u/43825954?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chiragkyal", "html_url": "https://github.com/chiragkyal", "followers_url": "https://api.github.com/users/chiragkyal/followers", "following_url": "https://api.github.com/users/chiragkyal/following{/other_user}", "gists_url": "https://api.github.com/users/chiragkyal/gists{/gist_id}", "starred_url": "https://api.github.com/users/chiragkyal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chiragkyal/subscriptions", "organizations_url": "https://api.github.com/users/chiragkyal/orgs", "repos_url": "https://api.github.com/users/chiragkyal/repos", "events_url": "https://api.github.com/users/chiragkyal/events{/privacy}", "received_events_url": "https://api.github.com/users/chiragkyal/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "I'll modify the field name and validations as per the EP discussion : https://github.com/openshift/enhancements/pull/1837", "created_at": "2025-09-09T05:05:23Z", "updated_at": "2025-09-09T05:05:24Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/305#discussion_r2332023621", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/305", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2332023621"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/305#discussion_r2332023621"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/305"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2332023621/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 141, "side": "RIGHT", "author_association": "MEMBER", "original_position": 10, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 305, "file_path": "api/operator/v1alpha1/istiocsr_types.go", "line_start": 141, "line_end": null, "diff_context": "", "comment_body": "The API has been updated as per the EP", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2388448583", "pull_request_review_id": 3280556115, "id": 2388448583, "node_id": "PRRC_kwDOFdFn9s6OXNVH", "diff_hunk": "@@ -132,6 +132,13 @@ type IstioCSRConfig struct {\n \t// +optional\n \t// +mapType=atomic\n \tNodeSelector map[string]string `json:\"nodeSelector,omitempty\"`\n+\n+\t// configMapNamespaceSelector is a label selector to filter on namespaces where the controller creates\n+\t// istio-ca-root-cert ConfigMap. Supports '=', '==', and '!='.(e.g. key1=value1,key2=value2).\n+\t// When not set, the CA certificate is copied to every namespace in the cluster.\n+\t// +kubebuilder:validation:Optional\n+\t// +optional\n+\tConfigMapNamespaceSelector string `json:\"configMapNamespaceSelector,omitempty\"`", "path": "api/operator/v1alpha1/istiocsr_types.go", "commit_id": "7a61c713f60d94b109c17a95e2a0f455d67fe3c5", "original_commit_id": "4a61f323ecae2647279e807a90717f1714ff02f9", "user": {"login": "chiragkyal", "id": 43825954, "node_id": "MDQ6VXNlcjQzODI1OTU0", "avatar_url": "https://avatars.githubusercontent.com/u/43825954?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chiragkyal", "html_url": "https://github.com/chiragkyal", "followers_url": "https://api.github.com/users/chiragkyal/followers", "following_url": "https://api.github.com/users/chiragkyal/following{/other_user}", "gists_url": "https://api.github.com/users/chiragkyal/gists{/gist_id}", "starred_url": "https://api.github.com/users/chiragkyal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chiragkyal/subscriptions", "organizations_url": "https://api.github.com/users/chiragkyal/orgs", "repos_url": "https://api.github.com/users/chiragkyal/repos", "events_url": "https://api.github.com/users/chiragkyal/events{/privacy}", "received_events_url": "https://api.github.com/users/chiragkyal/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "The API has been updated as per the EP", "created_at": "2025-09-29T15:43:59Z", "updated_at": "2025-09-29T15:43:59Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/305#discussion_r2388448583", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/305", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2388448583"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/305#discussion_r2388448583"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/305"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2388448583/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 141, "side": "RIGHT", "in_reply_to_id": 2332023621, "author_association": "MEMBER", "original_position": 10, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 310, "file_path": "api/operator/v1alpha1/features.go", "line_start": 20, "line_end": 20, "diff_context": "", "comment_body": "_\ud83d\udca1 Verification agent_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**IstioCSR GA + default-on looks good; confirm upgrade/test/docs alignment**\n\nChange is correct for GA defaulting. Please ensure e2e/unit tests and user docs reflect IstioCSR being enabled by default, and verify there\u2019s no legacy TechPreview override path lingering.\n\n\nRun:\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Verify usages/tests assume default-on\nrg -nP --type=go -C2 '\\bFeatureIstioCSR\\b|OperatorFeatureGates'\n\n# Check samples/CRDs mention GA/default enabled\nrg -nP -C2 'IstioCSR|istio-csr' config/ docs/ samples/ || true\n```\n\nLength of output: 14379\n\n---\n\n\n\n</details>\n\n**IstioCSR GA default \u2013 tests, docs & sample CR updates required**\n\n- Add or update e2e and unit tests to assume `FeatureIstioCSR` is enabled by default (remove any explicit enablement flags).  \n- Update user documentation to state that IstioCSR is GA and on by default.  \n- Relocate or remove the legacy TechPreview sample at `config/samples/tech-preview/operator.openshift.io_v1alpha1_istiocsr.yaml`, and provide a stable sample reflecting default-on behavior.\n\n<!-- fingerprinting:phantom:medusa:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2329153197", "pull_request_review_id": 3194984842, "id": 2329153197, "node_id": "PRRC_kwDOFdFn9s6K1A6t", "diff_hunk": "@@ -18,5 +16,5 @@ var (\n )\n \n var OperatorFeatureGates = map[featuregate.Feature]featuregate.FeatureSpec{\n-\tFeatureIstioCSR: {Default: false, PreRelease: \"TechPreview\"},\n+\tFeatureIstioCSR: {Default: true, PreRelease: featuregate.GA},\n }", "path": "api/operator/v1alpha1/features.go", "commit_id": "0959a86dc23d32087be1748ef22fe819d4b21c75", "original_commit_id": "bfc1e236115c8e32031b2dc57d9f527be9a69997", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\ud83d\udca1 Verification agent_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**IstioCSR GA + default-on looks good; confirm upgrade/test/docs alignment**\n\nChange is correct for GA defaulting. Please ensure e2e/unit tests and user docs reflect IstioCSR being enabled by default, and verify there\u2019s no legacy TechPreview override path lingering.\n\n\nRun:\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Verify usages/tests assume default-on\nrg -nP --type=go -C2 '\\bFeatureIstioCSR\\b|OperatorFeatureGates'\n\n# Check samples/CRDs mention GA/default enabled\nrg -nP -C2 'IstioCSR|istio-csr' config/ docs/ samples/ || true\n```\n\nLength of output: 14379\n\n---\n\n\n\n</details>\n\n**IstioCSR GA default \u2013 tests, docs & sample CR updates required**\n\n- Add or update e2e and unit tests to assume `FeatureIstioCSR` is enabled by default (remove any explicit enablement flags).  \n- Update user documentation to state that IstioCSR is GA and on by default.  \n- Relocate or remove the legacy TechPreview sample at `config/samples/tech-preview/operator.openshift.io_v1alpha1_istiocsr.yaml`, and provide a stable sample reflecting default-on behavior.\n\n<!-- fingerprinting:phantom:medusa:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "created_at": "2025-09-08T05:13:45Z", "updated_at": "2025-09-08T05:13:47Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2329153197", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2329153197"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2329153197"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2329153197/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 19, "original_start_line": 19, "start_side": "RIGHT", "line": 20, "original_line": 20, "side": "RIGHT", "author_association": "NONE", "original_position": 15, "position": 15, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 310, "file_path": "api/operator/v1alpha1/istiocsr_types.go", "line_start": 73, "line_end": 73, "diff_context": "", "comment_body": "_\ud83d\udca1 Verification agent_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Non-pointer IstioCSRConfig: check upgrade/backward-compat and defaulting.**\n\nSwitching to a value type plus \u201cRequired\u201d can reject pre-existing CRs that relied on omission. Confirm: stored objects from earlier operators won\u2019t be blocked on update.\n\nRun:\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Look for defaulting code paths that assumed nil pointers\nrg -nP --type=go -C2 'default.*IstioCSRConfig|if\\s+.*IstioCSRConfig\\s*==\\s*nil' api pkg\n\n# Check CR samples/manifests ensure istioCSRConfig is always present\nrg -nP -n 'istioCSRConfig' -g 'config/**' -g 'samples/**'\n```\n\nLength of output: 589\n\n---\n\n\n\n</details>\n\n**Add defaulting or migration for IstioCSRConfig**  \nSwitching IstioCSRConfig to a non-pointer with `+required` enforces `.spec.istioCSRConfig` on every update; no defaulting logic or CRD default was found. Provide a mutating webhook or CRD schema default (or document a migration) to populate this field for existing CRs and preserve upgrade compatibility.\n\n<!-- fingerprinting:phantom:medusa:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commits b248e92 to 0959a86", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2329153199", "pull_request_review_id": 3194984842, "id": 2329153199, "node_id": "PRRC_kwDOFdFn9s6K1A6v", "diff_hunk": "@@ -50,50 +54,78 @@ type IstioCSR struct {\n \t// spec is the specification of the desired behavior of the IstioCSR.\n \t// +kubebuilder:validation:Required\n \t// +required\n-\tSpec IstioCSRSpec `json:\"spec,omitempty\"`\n+\tSpec IstioCSRSpec `json:\"spec\"`\n \n \t// status is the most recently observed status of the IstioCSR.\n+\t// +kubebuilder:validation:Optional\n+\t// +optional\n \tStatus IstioCSRStatus `json:\"status,omitempty\"`\n }\n \n // IstioCSRSpec is the specification of the desired behavior of the IstioCSR.\n type IstioCSRSpec struct {\n-\t// istioCSRConfig is for configuring the istio-csr agent behavior.\n+\t// istioCSRConfig configures the istio-csr agent's behavior.\n \t// +kubebuilder:validation:Required\n \t// +required\n-\tIstioCSRConfig *IstioCSRConfig `json:\"istioCSRConfig,omitempty\"`\n+\tIstioCSRConfig IstioCSRConfig `json:\"istioCSRConfig\"`\n \n-\t// controllerConfig is for configuring the controller for setting up\n-\t// defaults to enable istio-csr agent.\n+\t// controllerConfig configures the controller for setting up defaults to\n+\t// enable the istio-csr agent.\n+\t// +kubebuilder:validation:Optional\n+\t// +optional\n \tControllerConfig *ControllerConfig `json:\"controllerConfig,omitempty\"`", "path": "api/operator/v1alpha1/istiocsr_types.go", "commit_id": "a40c704566b3e362e58f8c13e68430628e5c14b4", "original_commit_id": "bfc1e236115c8e32031b2dc57d9f527be9a69997", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\ud83d\udca1 Verification agent_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Non-pointer IstioCSRConfig: check upgrade/backward-compat and defaulting.**\n\nSwitching to a value type plus \u201cRequired\u201d can reject pre-existing CRs that relied on omission. Confirm: stored objects from earlier operators won\u2019t be blocked on update.\n\nRun:\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Look for defaulting code paths that assumed nil pointers\nrg -nP --type=go -C2 'default.*IstioCSRConfig|if\\s+.*IstioCSRConfig\\s*==\\s*nil' api pkg\n\n# Check CR samples/manifests ensure istioCSRConfig is always present\nrg -nP -n 'istioCSRConfig' -g 'config/**' -g 'samples/**'\n```\n\nLength of output: 589\n\n---\n\n\n\n</details>\n\n**Add defaulting or migration for IstioCSRConfig**  \nSwitching IstioCSRConfig to a non-pointer with `+required` enforces `.spec.istioCSRConfig` on every update; no defaulting logic or CRD default was found. Provide a mutating webhook or CRD schema default (or document a migration) to populate this field for existing CRs and preserve upgrade compatibility.\n\n<!-- fingerprinting:phantom:medusa:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commits b248e92 to 0959a86", "created_at": "2025-09-08T05:13:45Z", "updated_at": "2025-09-30T12:56:47Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2329153199", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2329153199"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2329153199"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2329153199/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 66, "original_start_line": 68, "start_side": "RIGHT", "line": 73, "original_line": 73, "side": "RIGHT", "author_association": "NONE", "original_position": 82, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 310, "file_path": "api/operator/v1alpha1/istiocsr_types.go", "line_start": 256, "line_end": null, "diff_context": "", "comment_body": "_\ud83d\udee0\ufe0f Refactor suggestion_\n\n**Enforce key-size/algorithm compatibility at the CRD level.**\n\nRight now any enumerated size is allowed with any algorithm. Add a cross-field XValidation so ECDSA only allows 256/384 and RSA only allows 2048/4096/8192. Keep \u201c0\u201d permissible at create for defaulting if desired.\n\n```diff\n // +kubebuilder:validation:Enum:=256;384;2048;4096;8192\n // +kubebuilder:default:=2048\n // +kubebuilder:validation:XValidation:rule=\"oldSelf == 0 || self == oldSelf\",message=\"privateKeySize is immutable once set\"\n+// +kubebuilder:validation:XValidation:rule=\"(self.privateKeyAlgorithm == '' || self.privateKeyAlgorithm == 'RSA') ? (self.privateKeySize in [0,2048,4096,8192]) : (self.privateKeySize in [0,256,384])\",message=\"privateKeySize must match privateKeyAlgorithm\"\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n \t// privateKeySize is the key size for the istio-csr and istiod certificates. Allowed values when privateKeyAlgorithm\n \t// is RSA are 2048, 4096, 8192; and for ECDSA, they are 256, 384. This field is immutable once set.\n \t// +kubebuilder:validation:Enum:=256;384;2048;4096;8192\n \t// +kubebuilder:default:=2048\n \t// +kubebuilder:validation:XValidation:rule=\"oldSelf == 0 || self == oldSelf\",message=\"privateKeySize is immutable once set\"\n\t// +kubebuilder:validation:XValidation:rule=\"(self.privateKeyAlgorithm == '' || self.privateKeyAlgorithm == 'RSA') ? (self.privateKeySize in [0,2048,4096,8192]) : (self.privateKeySize in [0,256,384])\",message=\"privateKeySize must match privateKeyAlgorithm\"\n \t// +kubebuilder:validation:Optional\n \t// +optional\n \tPrivateKeySize int32 `json:\"privateKeySize,omitempty\"`\n\n \t// privateKeyAlgorithm is the algorithm to use when generating private keys. Allowed values are RSA, and ECDSA.\n \t// This field is immutable once set.\n \t// +kubebuilder:default:=\"RSA\"\n \t// +kubebuilder:validation:Enum:=\"RSA\";\"ECDSA\"\n \t// +kubebuilder:validation:XValidation:rule=\"oldSelf == '' || self == oldSelf\",message=\"privateKeyAlgorithm is immutable once set\"\n \t// +kubebuilder:validation:Optional\n \t// +optional\n \tPrivateKeyAlgorithm string `json:\"privateKeyAlgorithm,omitempty\"`\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<!-- fingerprinting:phantom:medusa:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit 9a5cf37", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2329153202", "pull_request_review_id": 3194984842, "id": 2329153202, "node_id": "PRRC_kwDOFdFn9s6K1A6y", "diff_hunk": "@@ -120,86 +152,107 @@ type IstioCSRConfig struct {\n \tAffinity *corev1.Affinity `json:\"affinity,omitempty\"`\n \n \t// tolerations is for setting the pod tolerations.\n+\t// tolerations can have a maximum of 10 entries.\n \t// ref: https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/\n+\t// +listType=atomic\n+\t// +kubebuilder:validation:MinItems:=0\n+\t// +kubebuilder:validation:MaxItems:=10\n \t// +kubebuilder:validation:Optional\n \t// +optional\n-\t// +listType=atomic\n \tTolerations []corev1.Toleration `json:\"tolerations,omitempty\"`\n \n \t// nodeSelector is for defining the scheduling criteria using node labels.\n+\t// nodeSelector can have a maximum of 10 entries.\n \t// ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/\n+\t// +mapType=atomic\n+\t// +kubebuilder:validation:MinProperties:=0\n+\t// +kubebuilder:validation:MaxProperties:=10\n \t// +kubebuilder:validation:Optional\n \t// +optional\n-\t// +mapType=atomic\n \tNodeSelector map[string]string `json:\"nodeSelector,omitempty\"`\n }\n \n // CertManagerConfig is for configuring cert-manager specifics.\n // +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.issuerRef) && !has(self.issuerRef) || has(oldSelf.issuerRef) && has(self.issuerRef)\",message=\"issuerRef may only be configured during creation\"\n type CertManagerConfig struct {\n-\t// issuerRef contains details to the referenced object used for\n-\t// obtaining the certificates. When issuerRef.Kind is Issuer, it must exist in the\n-\t// .spec.istioCSRConfig.istio.namespace.\n+\t// issuerRef contains details of the referenced object used for obtaining certificates. When\n+\t// `issuerRef.Kind` is `Issuer`, it must exist in the `.spec.istioCSRConfig.istio.namespace`.\n+\t// This field is immutable once set.\n \t// +kubebuilder:validation:XValidation:rule=\"self == oldSelf\",message=\"issuerRef is immutable once set\"\n \t// +kubebuilder:validation:XValidation:rule=\"self.kind.lowerAscii() == 'issuer' || self.kind.lowerAscii() == 'clusterissuer'\",message=\"kind must be either 'Issuer' or 'ClusterIssuer'\"\n \t// +kubebuilder:validation:XValidation:rule=\"self.group.lowerAscii() == 'cert-manager.io'\",message=\"group must be 'cert-manager.io'\"\n \t// +kubebuilder:validation:Required\n \t// +required\n-\tIssuerRef certmanagerv1.ObjectReference `json:\"issuerRef,omitempty\"`\n+\tIssuerRef certmanagerv1.ObjectReference `json:\"issuerRef\"`\n+\n+\t// istioCACertificate when provided, the operator will use the CA certificate from the specified ConfigMap. If empty, the operator will\n+\t// automatically extract the CA certificate from the Secret containing the istiod certificate obtained from cert-manager.\n+\t// +kubebuilder:validation:Optional\n+\t// +optional\n+\tIstioCACertificate *ConfigMapReference `json:\"istioCACertificate,omitempty\"`\n }\n \n // IstiodTLSConfig is for configuring istiod certificate specifics.\n-// +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.signatureAlgorithm) && !has(self.signatureAlgorithm) || has(oldSelf.signatureAlgorithm) && has(self.signatureAlgorithm)\",message=\"signatureAlgorithm may only be configured during creation\"\n+// +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.privateKeyAlgorithm) && !has(self.privateKeyAlgorithm) || has(oldSelf.privateKeyAlgorithm) && has(self.privateKeyAlgorithm)\",message=\"privateKeyAlgorithm may only be configured during creation\"\n // +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.privateKeySize) && !has(self.privateKeySize) || has(oldSelf.privateKeySize) && has(self.privateKeySize)\",message=\"privateKeySize may only be configured during creation\"\n type IstiodTLSConfig struct {\n-\t// commonName is the common name to be set in the certificate.cert-manager.io\n-\t// created for istiod. CommonName will be of the form `istiod.<istio_namespace>.svc`\n-\t// when not set.\n+\t// commonName is the common name to be set in the cert-manager.io Certificate created for istiod.\n+\t// The commonName will be of the form istiod.<istio_namespace>.svc when not set.\n+\t// The commonName must not exceed 64 characters.\n+\t// +kubebuilder:validation:MinLength:=0\n+\t// +kubebuilder:validation:MaxLength:=64\n+\t// +kubebuilder:example:=\"istiod.istio-system.svc\"\n \t// +kubebuilder:validation:Optional\n \t// +optional\n \tCommonName string `json:\"commonName,omitempty\"`\n \n-\t// trustDomain is the istio cluster's trust domain, which will also be used for deriving\n-\t// spiffe URI.\n+\t// trustDomain is the Istio cluster's trust domain, which will also be used for deriving\n+\t// the SPIFFE URI. trustDomain must not exceed 63 characters.\n+\t// +kubebuilder:validation:MinLength:=1\n+\t// +kubebuilder:validation:MaxLength:=63\n \t// +kubebuilder:validation:Required\n \t// +required\n-\tTrustDomain string `json:\"trustDomain,omitempty\"`\n+\tTrustDomain string `json:\"trustDomain\"`\n \n \t// certificateDNSNames contains the additional DNS names to be added to the istiod certificate SAN.\n+\t// This field can have a maximum of 25 entries.\n+\t// +kubebuilder:validation:MinItems:=0\n+\t// +kubebuilder:validation:MaxItems:=25\n \t// +listType=set\n \t// +kubebuilder:validation:Optional\n \t// +optional\n \tCertificateDNSNames []string `json:\"certificateDNSNames,omitempty\"`\n \n-\t// certificateDuration is the istio-csr and the istiod certificates validity period.\n+\t// certificateDuration is the validity period for the istio-csr and istiod certificates.\n \t// +kubebuilder:default:=\"1h\"\n \t// +kubebuilder:validation:Optional\n \t// +optional\n \tCertificateDuration *metav1.Duration `json:\"certificateDuration,omitempty\"`\n \n-\t// certificateRenewBefore is the ahead time to renew the istio-csr and the istiod certificates\n+\t// certificateRenewBefore is the time before expiry to renew the istio-csr and istiod certificates.\n \t// before expiry.\n \t// +kubebuilder:default:=\"30m\"\n \t// +kubebuilder:validation:Optional\n \t// +optional\n \tCertificateRenewBefore *metav1.Duration `json:\"certificateRenewBefore,omitempty\"`\n \n-\t// privateKeySize is the istio-csr and the istiod certificate's key size. When the SignatureAlgorithm\n-\t// is RSA, must be >= 2048 and for ECDSA, can only be 256 or 384, corresponding to P-256 and P-384 respectively.\n+\t// privateKeySize is the key size for the istio-csr and istiod certificates. Allowed values when privateKeyAlgorithm\n+\t// is RSA are 2048, 4096, 8192; and for ECDSA, they are 256, 384. This field is immutable once set.\n+\t// +kubebuilder:validation:Enum:=256;384;2048;4096;8192\n \t// +kubebuilder:default:=2048\n \t// +kubebuilder:validation:XValidation:rule=\"oldSelf == 0 || self == oldSelf\",message=\"privateKeySize is immutable once set\"\n \t// +kubebuilder:validation:Optional\n \t// +optional\n-\tPrivateKeySize int `json:\"privateKeySize,omitempty\"`\n+\tPrivateKeySize int32 `json:\"privateKeySize,omitempty\"`\n \n-\t// signatureAlgorithm is the signature algorithm to use when generating\n-\t// private keys. At present only RSA and ECDSA are supported.\n+\t// privateKeyAlgorithm is the algorithm to use when generating private keys. Allowed values are RSA, and ECDSA.\n+\t// This field is immutable once set.\n \t// +kubebuilder:default:=\"RSA\"\n \t// +kubebuilder:validation:Enum:=\"RSA\";\"ECDSA\"\n-\t// +kubebuilder:validation:XValidation:rule=\"oldSelf == '' || self == oldSelf\",message=\"signatureAlgorithm is immutable once set\"\n+\t// +kubebuilder:validation:XValidation:rule=\"oldSelf == '' || self == oldSelf\",message=\"privateKeyAlgorithm is immutable once set\"\n \t// +kubebuilder:validation:Optional\n \t// +optional\n-\tSignatureAlgorithm string `json:\"signatureAlgorithm,omitempty\"`\n+\tPrivateKeyAlgorithm string `json:\"privateKeyAlgorithm,omitempty\"`\n ", "path": "api/operator/v1alpha1/istiocsr_types.go", "commit_id": "a40c704566b3e362e58f8c13e68430628e5c14b4", "original_commit_id": "bfc1e236115c8e32031b2dc57d9f527be9a69997", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\ud83d\udee0\ufe0f Refactor suggestion_\n\n**Enforce key-size/algorithm compatibility at the CRD level.**\n\nRight now any enumerated size is allowed with any algorithm. Add a cross-field XValidation so ECDSA only allows 256/384 and RSA only allows 2048/4096/8192. Keep \u201c0\u201d permissible at create for defaulting if desired.\n\n```diff\n // +kubebuilder:validation:Enum:=256;384;2048;4096;8192\n // +kubebuilder:default:=2048\n // +kubebuilder:validation:XValidation:rule=\"oldSelf == 0 || self == oldSelf\",message=\"privateKeySize is immutable once set\"\n+// +kubebuilder:validation:XValidation:rule=\"(self.privateKeyAlgorithm == '' || self.privateKeyAlgorithm == 'RSA') ? (self.privateKeySize in [0,2048,4096,8192]) : (self.privateKeySize in [0,256,384])\",message=\"privateKeySize must match privateKeyAlgorithm\"\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n \t// privateKeySize is the key size for the istio-csr and istiod certificates. Allowed values when privateKeyAlgorithm\n \t// is RSA are 2048, 4096, 8192; and for ECDSA, they are 256, 384. This field is immutable once set.\n \t// +kubebuilder:validation:Enum:=256;384;2048;4096;8192\n \t// +kubebuilder:default:=2048\n \t// +kubebuilder:validation:XValidation:rule=\"oldSelf == 0 || self == oldSelf\",message=\"privateKeySize is immutable once set\"\n\t// +kubebuilder:validation:XValidation:rule=\"(self.privateKeyAlgorithm == '' || self.privateKeyAlgorithm == 'RSA') ? (self.privateKeySize in [0,2048,4096,8192]) : (self.privateKeySize in [0,256,384])\",message=\"privateKeySize must match privateKeyAlgorithm\"\n \t// +kubebuilder:validation:Optional\n \t// +optional\n \tPrivateKeySize int32 `json:\"privateKeySize,omitempty\"`\n\n \t// privateKeyAlgorithm is the algorithm to use when generating private keys. Allowed values are RSA, and ECDSA.\n \t// This field is immutable once set.\n \t// +kubebuilder:default:=\"RSA\"\n \t// +kubebuilder:validation:Enum:=\"RSA\";\"ECDSA\"\n \t// +kubebuilder:validation:XValidation:rule=\"oldSelf == '' || self == oldSelf\",message=\"privateKeyAlgorithm is immutable once set\"\n \t// +kubebuilder:validation:Optional\n \t// +optional\n \tPrivateKeyAlgorithm string `json:\"privateKeyAlgorithm,omitempty\"`\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<!-- fingerprinting:phantom:medusa:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit 9a5cf37", "created_at": "2025-09-08T05:13:45Z", "updated_at": "2025-09-24T18:57:46Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2329153202", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2329153202"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2329153202"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2329153202/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 239, "start_side": "RIGHT", "line": null, "original_line": 256, "side": "RIGHT", "author_association": "NONE", "original_position": 281, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 310, "file_path": "config/crd/bases/operator.openshift.io_istiocsrs.yaml", "line_start": 86, "line_end": null, "diff_context": "", "comment_body": "_\ud83d\udee0\ufe0f Refactor suggestion_\n\n**Make cleanupOnDeletion a boolean and fix immutability rule (CEL create guard).**\n\nUsing string \"true\"/\"false\" is awkward for users and increases error risk. Also, `rule: self == oldSelf` can fail on create where `oldSelf` is null. Switch to boolean and guard for create.\n\n\n\n```diff\n-              cleanupOnDeletion:\n-                default: \"false\"\n+              cleanupOnDeletion:\n+                default: false\n                 description: |-\n-                  cleanupOnDeletion indicates that the operator should remove all resources\n+                  cleanupOnDeletion indicates that the operator should remove all resources\n                   created for the istio-csr agent installation, including the cert-manager `Certificate`\n                   resource created for obtaining a certificate for istiod using the configured issuer.\n                   This field is immutable once set.\n-                enum:\n-                - \"true\"\n-                - \"false\"\n-                type: string\n+                type: boolean\n                 x-kubernetes-validations:\n-                - message: cleanupOnDeletion is immutable once set\n-                  rule: self == oldSelf\n+                - message: cleanupOnDeletion is immutable once set\n+                  rule: oldSelf == null || self == oldSelf\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n              cleanupOnDeletion:\n                default: false\n                description: |-\n                  cleanupOnDeletion indicates that the operator should remove all resources\n                  created for the istio-csr agent installation, including the cert-manager `Certificate`\n                  resource created for obtaining a certificate for istiod using the configured issuer.\n                  This field is immutable once set.\n                type: boolean\n                x-kubernetes-validations:\n                - message: cleanupOnDeletion is immutable once set\n                  rule: oldSelf == null || self == oldSelf\n              controllerConfig:\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn config/crd/bases/operator.openshift.io_istiocsrs.yaml around lines 72-86,\nchange cleanupOnDeletion from a string enum to a boolean with default: false\n(remove the \"true\"/\"false\" enum and type: string), and update the CEL\nimmutability validation to guard creation by using a rule such as: oldSelf ==\nnull || self == oldSelf with an appropriate message (e.g., \"cleanupOnDeletion is\nimmutable once set\"); this makes the field a proper boolean and prevents the\nimmutability check from failing on resource create.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:triton:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2329153205", "pull_request_review_id": 3194984842, "id": 2329153205, "node_id": "PRRC_kwDOFdFn9s6K1A61", "diff_hunk": "@@ -53,22 +69,38 @@ spec:\n             description: spec is the specification of the desired behavior of the\n               IstioCSR.\n             properties:\n+              cleanupOnDeletion:\n+                default: \"false\"\n+                description: |-\n+                  cleanupOnDeletion indicates that the operator should remove all resources\n+                  created for the istio-csr agent installation, including the cert-manager `Certificate`\n+                  resource created for obtaining a certificate for istiod using the configured issuer.\n+                  This field is immutable once set.\n+                enum:\n+                - \"true\"\n+                - \"false\"\n+                type: string\n+                x-kubernetes-validations:\n+                - message: cleanupOnDeletion is immutable once set\n+                  rule: self == oldSelf\n               controllerConfig:", "path": "config/crd/bases/operator.openshift.io_istiocsrs.yaml", "commit_id": "a40c704566b3e362e58f8c13e68430628e5c14b4", "original_commit_id": "bfc1e236115c8e32031b2dc57d9f527be9a69997", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\ud83d\udee0\ufe0f Refactor suggestion_\n\n**Make cleanupOnDeletion a boolean and fix immutability rule (CEL create guard).**\n\nUsing string \"true\"/\"false\" is awkward for users and increases error risk. Also, `rule: self == oldSelf` can fail on create where `oldSelf` is null. Switch to boolean and guard for create.\n\n\n\n```diff\n-              cleanupOnDeletion:\n-                default: \"false\"\n+              cleanupOnDeletion:\n+                default: false\n                 description: |-\n-                  cleanupOnDeletion indicates that the operator should remove all resources\n+                  cleanupOnDeletion indicates that the operator should remove all resources\n                   created for the istio-csr agent installation, including the cert-manager `Certificate`\n                   resource created for obtaining a certificate for istiod using the configured issuer.\n                   This field is immutable once set.\n-                enum:\n-                - \"true\"\n-                - \"false\"\n-                type: string\n+                type: boolean\n                 x-kubernetes-validations:\n-                - message: cleanupOnDeletion is immutable once set\n-                  rule: self == oldSelf\n+                - message: cleanupOnDeletion is immutable once set\n+                  rule: oldSelf == null || self == oldSelf\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n              cleanupOnDeletion:\n                default: false\n                description: |-\n                  cleanupOnDeletion indicates that the operator should remove all resources\n                  created for the istio-csr agent installation, including the cert-manager `Certificate`\n                  resource created for obtaining a certificate for istiod using the configured issuer.\n                  This field is immutable once set.\n                type: boolean\n                x-kubernetes-validations:\n                - message: cleanupOnDeletion is immutable once set\n                  rule: oldSelf == null || self == oldSelf\n              controllerConfig:\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn config/crd/bases/operator.openshift.io_istiocsrs.yaml around lines 72-86,\nchange cleanupOnDeletion from a string enum to a boolean with default: false\n(remove the \"true\"/\"false\" enum and type: string), and update the CEL\nimmutability validation to guard creation by using a rule such as: oldSelf ==\nnull || self == oldSelf with an appropriate message (e.g., \"cleanupOnDeletion is\nimmutable once set\"); this makes the field a proper boolean and prevents the\nimmutability check from failing on resource create.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:triton:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "created_at": "2025-09-08T05:13:46Z", "updated_at": "2025-09-08T05:13:47Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2329153205", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2329153205"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2329153205"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2329153205/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 72, "start_side": "RIGHT", "line": null, "original_line": 86, "side": "RIGHT", "author_association": "NONE", "original_position": 76, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 310, "file_path": "config/crd/bases/operator.openshift.io_istiocsrs.yaml", "line_start": 1228, "line_end": 1228, "diff_context": "", "comment_body": "_\ud83d\udee0\ufe0f Refactor suggestion_\n\n**Enforce privateKeyAlgorithm/privateKeySize compatibility via CEL.**\n\nCurrently any enum size is allowed regardless of algorithm. Add a cross-field rule to prevent invalid pairs.\n\n\n\n```diff\n                     x-kubernetes-validations:\n                     - message: privateKeyAlgorithm may only be configured during creation\n                       rule: '!has(oldSelf.privateKeyAlgorithm) && !has(self.privateKeyAlgorithm)\n                         || has(oldSelf.privateKeyAlgorithm) && has(self.privateKeyAlgorithm)'\n                     - message: privateKeySize may only be configured during creation\n                       rule: '!has(oldSelf.privateKeySize) && !has(self.privateKeySize)\n                         || has(oldSelf.privateKeySize) && has(self.privateKeySize)'\n+                    - message: privateKeySize must match privateKeyAlgorithm (RSA: 2048/4096/8192, ECDSA: 256/384)\n+                      rule: (self.privateKeyAlgorithm == 'RSA' && [2048, 4096, 8192].exists(x, x == self.privateKeySize)) ||\n+                            (self.privateKeyAlgorithm == 'ECDSA' && [256, 384].exists(x, x == self.privateKeySize))\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n                    x-kubernetes-validations:\n                    - message: privateKeyAlgorithm may only be configured during creation\n                      rule: '!has(oldSelf.privateKeyAlgorithm) && !has(self.privateKeyAlgorithm)\n                        || has(oldSelf.privateKeyAlgorithm) && has(self.privateKeyAlgorithm)'\n                    - message: privateKeySize may only be configured during creation\n                      rule: '!has(oldSelf.privateKeySize) && !has(self.privateKeySize)\n                        || has(oldSelf.privateKeySize) && has(self.privateKeySize)'\n                    - message: privateKeySize must match privateKeyAlgorithm (RSA: 2048/4096/8192, ECDSA: 256/384)\n                      rule: (self.privateKeyAlgorithm == 'RSA' && [2048, 4096, 8192].exists(x, x == self.privateKeySize)) ||\n                            (self.privateKeyAlgorithm == 'ECDSA' && [256, 384].exists(x, x == self.privateKeySize))\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<!-- fingerprinting:phantom:triton:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit 9a5cf37", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2329153209", "pull_request_review_id": 3194984842, "id": 2329153209, "node_id": "PRRC_kwDOFdFn9s6K1A65", "diff_hunk": "@@ -1062,85 +1126,114 @@ spec:\n                     required:\n                     - namespace\n                     type: object\n+                  istioDataPlaneNamespaceSelector:\n+                    description: |-\n+                      Istio-csr creates a ConfigMap named `istio-ca-root-cert` containing the root CA certificate, which the Istio data\n+                      plane uses to verify server certificates. Its default behavior is to create and monitor ConfigMaps in all namespaces.\n+                      The istioDataPlaneNamespaceSelector restricts the namespaces where the ConfigMap is created by using label selectors,\n+                      such as maistra.io/member-of=istio-system. This selector is also attached to all desired namespaces that are part of\n+                      the data plane. istioDataPlaneNamespaceSelector must not exceed 4096 characters.\n+                    example: maistra.io/member-of=istio-system\n+                    maxLength: 4096\n+                    minLength: 0\n+                    type: string\n                   istiodTLSConfig:\n                     description: istiodTLSConfig is for configuring istiod certificate\n                       specifics.\n                     properties:\n                       certificateDNSNames:\n-                        description: certificateDNSNames contains the additional DNS\n-                          names to be added to the istiod certificate SAN.\n+                        description: |-\n+                          certificateDNSNames contains the additional DNS names to be added to the istiod certificate SAN.\n+                          This field can have a maximum of 25 entries.\n                         items:\n                           type: string\n+                        maxItems: 25\n+                        minItems: 0\n                         type: array\n                         x-kubernetes-list-type: set\n                       certificateDuration:\n                         default: 1h\n-                        description: certificateDuration is the istio-csr and the\n-                          istiod certificates validity period.\n+                        description: certificateDuration is the validity period for\n+                          the istio-csr and istiod certificates.\n                         type: string\n                       certificateRenewBefore:\n                         default: 30m\n                         description: |-\n-                          certificateRenewBefore is the ahead time to renew the istio-csr and the istiod certificates\n+                          certificateRenewBefore is the time before expiry to renew the istio-csr and istiod certificates.\n                           before expiry.\n                         type: string\n                       commonName:\n                         description: |-\n-                          commonName is the common name to be set in the certificate.cert-manager.io\n-                          created for istiod. CommonName will be of the form `istiod.<istio_namespace>.svc`\n-                          when not set.\n+                          commonName is the common name to be set in the cert-manager.io Certificate created for istiod.\n+                          The commonName will be of the form istiod.<istio_namespace>.svc when not set.\n+                          The commonName must not exceed 64 characters.\n+                        example: istiod.istio-system.svc\n+                        maxLength: 64\n+                        minLength: 0\n                         type: string\n                       maxCertificateDuration:\n                         default: 1h\n                         description: |-\n                           MaxCertificateDuration is the maximum validity duration that can be\n                           requested for a certificate.\n                         type: string\n-                      privateKeySize:\n-                        default: 2048\n-                        description: |-\n-                          privateKeySize is the istio-csr and the istiod certificate's key size. When the SignatureAlgorithm\n-                          is RSA, must be >= 2048 and for ECDSA, can only be 256 or 384, corresponding to P-256 and P-384 respectively.\n-                        type: integer\n-                        x-kubernetes-validations:\n-                        - message: privateKeySize is immutable once set\n-                          rule: oldSelf == 0 || self == oldSelf\n-                      signatureAlgorithm:\n+                      privateKeyAlgorithm:\n                         default: RSA\n                         description: |-\n-                          signatureAlgorithm is the signature algorithm to use when generating\n-                          private keys. At present only RSA and ECDSA are supported.\n+                          privateKeyAlgorithm is the algorithm to use when generating private keys. Allowed values are RSA, and ECDSA.\n+                          This field is immutable once set.\n                         enum:\n                         - RSA\n                         - ECDSA\n                         type: string\n                         x-kubernetes-validations:\n-                        - message: signatureAlgorithm is immutable once set\n+                        - message: privateKeyAlgorithm is immutable once set\n                           rule: oldSelf == '' || self == oldSelf\n+                      privateKeySize:\n+                        default: 2048\n+                        description: |-\n+                          privateKeySize is the key size for the istio-csr and istiod certificates. Allowed values when privateKeyAlgorithm\n+                          is RSA are 2048, 4096, 8192; and for ECDSA, they are 256, 384. This field is immutable once set.\n+                        enum:\n+                        - 256\n+                        - 384\n+                        - 2048\n+                        - 4096\n+                        - 8192\n+                        format: int32\n+                        type: integer\n+                        x-kubernetes-validations:\n+                        - message: privateKeySize is immutable once set\n+                          rule: oldSelf == 0 || self == oldSelf\n                       trustDomain:\n                         description: |-\n-                          trustDomain is the istio cluster's trust domain, which will also be used for deriving\n-                          spiffe URI.\n+                          trustDomain is the Istio cluster's trust domain, which will also be used for deriving\n+                          the SPIFFE URI. trustDomain must not exceed 63 characters.\n+                        maxLength: 63\n+                        minLength: 1\n                         type: string\n                     required:\n                     - trustDomain\n                     type: object\n                     x-kubernetes-validations:\n-                    - message: signatureAlgorithm may only be configured during creation\n-                      rule: '!has(oldSelf.signatureAlgorithm) && !has(self.signatureAlgorithm)\n-                        || has(oldSelf.signatureAlgorithm) && has(self.signatureAlgorithm)'\n+                    - message: privateKeyAlgorithm may only be configured during creation\n+                      rule: '!has(oldSelf.privateKeyAlgorithm) && !has(self.privateKeyAlgorithm)\n+                        || has(oldSelf.privateKeyAlgorithm) && has(self.privateKeyAlgorithm)'\n                     - message: privateKeySize may only be configured during creation\n                       rule: '!has(oldSelf.privateKeySize) && !has(self.privateKeySize)\n                         || has(oldSelf.privateKeySize) && has(self.privateKeySize)'", "path": "config/crd/bases/operator.openshift.io_istiocsrs.yaml", "commit_id": "0959a86dc23d32087be1748ef22fe819d4b21c75", "original_commit_id": "bfc1e236115c8e32031b2dc57d9f527be9a69997", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\ud83d\udee0\ufe0f Refactor suggestion_\n\n**Enforce privateKeyAlgorithm/privateKeySize compatibility via CEL.**\n\nCurrently any enum size is allowed regardless of algorithm. Add a cross-field rule to prevent invalid pairs.\n\n\n\n```diff\n                     x-kubernetes-validations:\n                     - message: privateKeyAlgorithm may only be configured during creation\n                       rule: '!has(oldSelf.privateKeyAlgorithm) && !has(self.privateKeyAlgorithm)\n                         || has(oldSelf.privateKeyAlgorithm) && has(self.privateKeyAlgorithm)'\n                     - message: privateKeySize may only be configured during creation\n                       rule: '!has(oldSelf.privateKeySize) && !has(self.privateKeySize)\n                         || has(oldSelf.privateKeySize) && has(self.privateKeySize)'\n+                    - message: privateKeySize must match privateKeyAlgorithm (RSA: 2048/4096/8192, ECDSA: 256/384)\n+                      rule: (self.privateKeyAlgorithm == 'RSA' && [2048, 4096, 8192].exists(x, x == self.privateKeySize)) ||\n+                            (self.privateKeyAlgorithm == 'ECDSA' && [256, 384].exists(x, x == self.privateKeySize))\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n                    x-kubernetes-validations:\n                    - message: privateKeyAlgorithm may only be configured during creation\n                      rule: '!has(oldSelf.privateKeyAlgorithm) && !has(self.privateKeyAlgorithm)\n                        || has(oldSelf.privateKeyAlgorithm) && has(self.privateKeyAlgorithm)'\n                    - message: privateKeySize may only be configured during creation\n                      rule: '!has(oldSelf.privateKeySize) && !has(self.privateKeySize)\n                        || has(oldSelf.privateKeySize) && has(self.privateKeySize)'\n                    - message: privateKeySize must match privateKeyAlgorithm (RSA: 2048/4096/8192, ECDSA: 256/384)\n                      rule: (self.privateKeyAlgorithm == 'RSA' && [2048, 4096, 8192].exists(x, x == self.privateKeySize)) ||\n                            (self.privateKeyAlgorithm == 'ECDSA' && [256, 384].exists(x, x == self.privateKeySize))\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<!-- fingerprinting:phantom:triton:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit 9a5cf37", "created_at": "2025-09-08T05:13:46Z", "updated_at": "2025-09-24T18:57:52Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2329153209", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2329153209"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2329153209"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2329153209/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 1222, "original_start_line": 1218, "start_side": "RIGHT", "line": 1228, "original_line": 1228, "side": "RIGHT", "author_association": "NONE", "original_position": 305, "position": 320, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 310, "file_path": "api/operator/v1alpha1/istiocsr_types.go", "line_start": 88, "line_end": null, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_\n\n**cleanupOnDeletion validation likely blocks CREATE; fix XValidation gating (or switch to bool).**\n\nWith default \"false\" and rule `self == oldSelf`, create requests can fail. Gate on oldSelf, or better, use a boolean.\n\n```diff\n- // +kubebuilder:validation:XValidation:rule=\"self == oldSelf\",message=\"cleanupOnDeletion is immutable once set\"\n+ // +kubebuilder:validation:XValidation:rule=\"oldSelf == '' || self == oldSelf\",message=\"cleanupOnDeletion is immutable once set\"\n```\nOptional (cleaner API):\n```diff\n- // +kubebuilder:validation:Enum:=\"true\";\"false\"\n- // +kubebuilder:default:=\"false\"\n- CleanupOnDeletion string `json:\"cleanupOnDeletion,omitempty\"`\n+ // +kubebuilder:default:=false\n+ // +kubebuilder:validation:Optional\n+ CleanupOnDeletion *bool `json:\"cleanupOnDeletion,omitempty\"`\n+ // +kubebuilder:validation:XValidation:rule=\"!has(oldSelf) || self == oldSelf\",message=\"cleanupOnDeletion is immutable once set\"\n```\n\n\n> Committable suggestion skipped: line range outside the PR's diff.\n\n<!-- fingerprinting:phantom:medusa:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2329346107", "pull_request_review_id": 3195246054, "id": 2329346107, "node_id": "PRRC_kwDOFdFn9s6K1wA7", "diff_hunk": "@@ -50,50 +54,78 @@ type IstioCSR struct {\n \t// spec is the specification of the desired behavior of the IstioCSR.\n \t// +kubebuilder:validation:Required\n \t// +required\n-\tSpec IstioCSRSpec `json:\"spec,omitempty\"`\n+\tSpec IstioCSRSpec `json:\"spec\"`\n \n \t// status is the most recently observed status of the IstioCSR.\n+\t// +kubebuilder:validation:Optional\n+\t// +optional\n \tStatus IstioCSRStatus `json:\"status,omitempty\"`\n }\n \n // IstioCSRSpec is the specification of the desired behavior of the IstioCSR.\n type IstioCSRSpec struct {\n-\t// istioCSRConfig is for configuring the istio-csr agent behavior.\n+\t// istioCSRConfig configures the istio-csr agent's behavior.\n \t// +kubebuilder:validation:Required\n \t// +required\n-\tIstioCSRConfig *IstioCSRConfig `json:\"istioCSRConfig,omitempty\"`\n+\tIstioCSRConfig IstioCSRConfig `json:\"istioCSRConfig\"`\n \n-\t// controllerConfig is for configuring the controller for setting up\n-\t// defaults to enable istio-csr agent.\n+\t// controllerConfig configures the controller for setting up defaults to\n+\t// enable the istio-csr agent.\n+\t// +kubebuilder:validation:Optional\n+\t// +optional\n \tControllerConfig *ControllerConfig `json:\"controllerConfig,omitempty\"`\n+\n+\t// cleanupOnDeletion indicates that the operator should remove all resources\n+\t// created for the istio-csr agent installation, including the cert-manager `Certificate`\n+\t// resource created for obtaining a certificate for istiod using the configured issuer.\n+\t// This field is immutable once set.\n+\t// +kubebuilder:validation:XValidation:rule=\"self == oldSelf\",message=\"cleanupOnDeletion is immutable once set\"\n+\t// +kubebuilder:validation:Enum:=\"true\";\"false\"\n+\t// +kubebuilder:default:=\"false\"\n+\t// +kubebuilder:validation:Optional\n+\t// +optional\n+\tCleanupOnDeletion string `json:\"cleanupOnDeletion,omitempty\"`\n }", "path": "api/operator/v1alpha1/istiocsr_types.go", "commit_id": "a40c704566b3e362e58f8c13e68430628e5c14b4", "original_commit_id": "a40c704566b3e362e58f8c13e68430628e5c14b4", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_\n\n**cleanupOnDeletion validation likely blocks CREATE; fix XValidation gating (or switch to bool).**\n\nWith default \"false\" and rule `self == oldSelf`, create requests can fail. Gate on oldSelf, or better, use a boolean.\n\n```diff\n- // +kubebuilder:validation:XValidation:rule=\"self == oldSelf\",message=\"cleanupOnDeletion is immutable once set\"\n+ // +kubebuilder:validation:XValidation:rule=\"oldSelf == '' || self == oldSelf\",message=\"cleanupOnDeletion is immutable once set\"\n```\nOptional (cleaner API):\n```diff\n- // +kubebuilder:validation:Enum:=\"true\";\"false\"\n- // +kubebuilder:default:=\"false\"\n- CleanupOnDeletion string `json:\"cleanupOnDeletion,omitempty\"`\n+ // +kubebuilder:default:=false\n+ // +kubebuilder:validation:Optional\n+ CleanupOnDeletion *bool `json:\"cleanupOnDeletion,omitempty\"`\n+ // +kubebuilder:validation:XValidation:rule=\"!has(oldSelf) || self == oldSelf\",message=\"cleanupOnDeletion is immutable once set\"\n```\n\n\n> Committable suggestion skipped: line range outside the PR's diff.\n\n<!-- fingerprinting:phantom:medusa:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "created_at": "2025-09-08T07:13:34Z", "updated_at": "2025-09-08T07:13:35Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2329346107", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2329346107"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2329346107"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2329346107/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 78, "start_side": "RIGHT", "line": null, "original_line": 88, "side": "RIGHT", "author_association": "NONE", "original_position": 94, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 310, "file_path": "bundle/manifests/operator.openshift.io_istiocsrs.yaml", "line_start": 1228, "line_end": 1228, "diff_context": "", "comment_body": "_\ud83d\udee0\ufe0f Refactor suggestion_\n\n**Bundle: enforce privateKeyAlgorithm/privateKeySize compatibility via CEL.**\n\n\n```diff\n                     x-kubernetes-validations:\n                       - message: privateKeyAlgorithm may only be configured during creation\n                         rule: '!has(oldSelf.privateKeyAlgorithm) && !has(self.privateKeyAlgorithm)\n                           || has(oldSelf.privateKeyAlgorithm) && has(self.privateKeyAlgorithm)'\n                       - message: privateKeySize may only be configured during creation\n                         rule: '!has(oldSelf.privateKeySize) && !has(self.privateKeySize)\n                           || has(oldSelf.privateKeySize) && has(self.privateKeySize)'\n+                      - message: privateKeySize must match privateKeyAlgorithm (RSA: 2048/4096/8192, ECDSA: 256/384)\n+                        rule: (self.privateKeyAlgorithm == 'RSA' && [2048, 4096, 8192].exists(x, x == self.privateKeySize)) ||\n+                              (self.privateKeyAlgorithm == 'ECDSA' && [256, 384].exists(x, x == self.privateKeySize))\n```\n\n\n> Committable suggestion skipped: line range outside the PR's diff.\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn bundle/manifests/operator.openshift.io_istiocsrs.yaml around lines 1219-1224,\nthe CEL rules currently only enforce that privateKeyAlgorithm and privateKeySize\nare creation-only; add compatibility checks so the pair is validated together:\nwhen privateKeyAlgorithm is present, privateKeySize must be one of the allowed\nsizes for that algorithm (e.g., for \"RSA\" sizes include 2048,4096; for \"ECDSA\"\nsizes include 256,384,521, etc.), and conversely when privateKeySize is present\nthe algorithm must be compatible. Update the CEL rule expressions to include\nthese conditional membership checks (use CEL logical implication/in and has() to\ncheck combinations) and adjust the corresponding message strings to reflect\nincompatibility vs creation-only errors.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:poseidon:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit 9a5cf37", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2329346113", "pull_request_review_id": 3195246054, "id": 2329346113, "node_id": "PRRC_kwDOFdFn9s6K1wBB", "diff_hunk": "@@ -1062,85 +1126,114 @@ spec:\n                     required:\n                     - namespace\n                     type: object\n+                  istioDataPlaneNamespaceSelector:\n+                    description: |-\n+                      Istio-csr creates a ConfigMap named `istio-ca-root-cert` containing the root CA certificate, which the Istio data\n+                      plane uses to verify server certificates. Its default behavior is to create and monitor ConfigMaps in all namespaces.\n+                      The istioDataPlaneNamespaceSelector restricts the namespaces where the ConfigMap is created by using label selectors,\n+                      such as maistra.io/member-of=istio-system. This selector is also attached to all desired namespaces that are part of\n+                      the data plane. istioDataPlaneNamespaceSelector must not exceed 4096 characters.\n+                    example: maistra.io/member-of=istio-system\n+                    maxLength: 4096\n+                    minLength: 0\n+                    type: string\n                   istiodTLSConfig:\n                     description: istiodTLSConfig is for configuring istiod certificate\n                       specifics.\n                     properties:\n                       certificateDNSNames:\n-                        description: certificateDNSNames contains the additional DNS\n-                          names to be added to the istiod certificate SAN.\n+                        description: |-\n+                          certificateDNSNames contains the additional DNS names to be added to the istiod certificate SAN.\n+                          This field can have a maximum of 25 entries.\n                         items:\n                           type: string\n+                        maxItems: 25\n+                        minItems: 0\n                         type: array\n                         x-kubernetes-list-type: set\n                       certificateDuration:\n                         default: 1h\n-                        description: certificateDuration is the istio-csr and the\n-                          istiod certificates validity period.\n+                        description: certificateDuration is the validity period for\n+                          the istio-csr and istiod certificates.\n                         type: string\n                       certificateRenewBefore:\n                         default: 30m\n                         description: |-\n-                          certificateRenewBefore is the ahead time to renew the istio-csr and the istiod certificates\n+                          certificateRenewBefore is the time before expiry to renew the istio-csr and istiod certificates.\n                           before expiry.\n                         type: string\n                       commonName:\n                         description: |-\n-                          commonName is the common name to be set in the certificate.cert-manager.io\n-                          created for istiod. CommonName will be of the form `istiod.<istio_namespace>.svc`\n-                          when not set.\n+                          commonName is the common name to be set in the cert-manager.io Certificate created for istiod.\n+                          The commonName will be of the form istiod.<istio_namespace>.svc when not set.\n+                          The commonName must not exceed 64 characters.\n+                        example: istiod.istio-system.svc\n+                        maxLength: 64\n+                        minLength: 0\n                         type: string\n                       maxCertificateDuration:\n                         default: 1h\n                         description: |-\n                           MaxCertificateDuration is the maximum validity duration that can be\n                           requested for a certificate.\n                         type: string\n-                      privateKeySize:\n-                        default: 2048\n-                        description: |-\n-                          privateKeySize is the istio-csr and the istiod certificate's key size. When the SignatureAlgorithm\n-                          is RSA, must be >= 2048 and for ECDSA, can only be 256 or 384, corresponding to P-256 and P-384 respectively.\n-                        type: integer\n-                        x-kubernetes-validations:\n-                        - message: privateKeySize is immutable once set\n-                          rule: oldSelf == 0 || self == oldSelf\n-                      signatureAlgorithm:\n+                      privateKeyAlgorithm:\n                         default: RSA\n                         description: |-\n-                          signatureAlgorithm is the signature algorithm to use when generating\n-                          private keys. At present only RSA and ECDSA are supported.\n+                          privateKeyAlgorithm is the algorithm to use when generating private keys. Allowed values are RSA, and ECDSA.\n+                          This field is immutable once set.\n                         enum:\n                         - RSA\n                         - ECDSA\n                         type: string\n                         x-kubernetes-validations:\n-                        - message: signatureAlgorithm is immutable once set\n+                        - message: privateKeyAlgorithm is immutable once set\n                           rule: oldSelf == '' || self == oldSelf\n+                      privateKeySize:\n+                        default: 2048\n+                        description: |-\n+                          privateKeySize is the key size for the istio-csr and istiod certificates. Allowed values when privateKeyAlgorithm\n+                          is RSA are 2048, 4096, 8192; and for ECDSA, they are 256, 384. This field is immutable once set.\n+                        enum:\n+                        - 256\n+                        - 384\n+                        - 2048\n+                        - 4096\n+                        - 8192\n+                        format: int32\n+                        type: integer\n+                        x-kubernetes-validations:\n+                        - message: privateKeySize is immutable once set\n+                          rule: oldSelf == 0 || self == oldSelf\n                       trustDomain:\n                         description: |-\n-                          trustDomain is the istio cluster's trust domain, which will also be used for deriving\n-                          spiffe URI.\n+                          trustDomain is the Istio cluster's trust domain, which will also be used for deriving\n+                          the SPIFFE URI. trustDomain must not exceed 63 characters.\n+                        maxLength: 63\n+                        minLength: 1\n                         type: string\n                     required:\n                     - trustDomain\n                     type: object\n                     x-kubernetes-validations:\n-                    - message: signatureAlgorithm may only be configured during creation\n-                      rule: '!has(oldSelf.signatureAlgorithm) && !has(self.signatureAlgorithm)\n-                        || has(oldSelf.signatureAlgorithm) && has(self.signatureAlgorithm)'\n+                    - message: privateKeyAlgorithm may only be configured during creation\n+                      rule: '!has(oldSelf.privateKeyAlgorithm) && !has(self.privateKeyAlgorithm)\n+                        || has(oldSelf.privateKeyAlgorithm) && has(self.privateKeyAlgorithm)'\n                     - message: privateKeySize may only be configured during creation\n                       rule: '!has(oldSelf.privateKeySize) && !has(self.privateKeySize)\n                         || has(oldSelf.privateKeySize) && has(self.privateKeySize)'", "path": "bundle/manifests/operator.openshift.io_istiocsrs.yaml", "commit_id": "0959a86dc23d32087be1748ef22fe819d4b21c75", "original_commit_id": "a40c704566b3e362e58f8c13e68430628e5c14b4", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\ud83d\udee0\ufe0f Refactor suggestion_\n\n**Bundle: enforce privateKeyAlgorithm/privateKeySize compatibility via CEL.**\n\n\n```diff\n                     x-kubernetes-validations:\n                       - message: privateKeyAlgorithm may only be configured during creation\n                         rule: '!has(oldSelf.privateKeyAlgorithm) && !has(self.privateKeyAlgorithm)\n                           || has(oldSelf.privateKeyAlgorithm) && has(self.privateKeyAlgorithm)'\n                       - message: privateKeySize may only be configured during creation\n                         rule: '!has(oldSelf.privateKeySize) && !has(self.privateKeySize)\n                           || has(oldSelf.privateKeySize) && has(self.privateKeySize)'\n+                      - message: privateKeySize must match privateKeyAlgorithm (RSA: 2048/4096/8192, ECDSA: 256/384)\n+                        rule: (self.privateKeyAlgorithm == 'RSA' && [2048, 4096, 8192].exists(x, x == self.privateKeySize)) ||\n+                              (self.privateKeyAlgorithm == 'ECDSA' && [256, 384].exists(x, x == self.privateKeySize))\n```\n\n\n> Committable suggestion skipped: line range outside the PR's diff.\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn bundle/manifests/operator.openshift.io_istiocsrs.yaml around lines 1219-1224,\nthe CEL rules currently only enforce that privateKeyAlgorithm and privateKeySize\nare creation-only; add compatibility checks so the pair is validated together:\nwhen privateKeyAlgorithm is present, privateKeySize must be one of the allowed\nsizes for that algorithm (e.g., for \"RSA\" sizes include 2048,4096; for \"ECDSA\"\nsizes include 256,384,521, etc.), and conversely when privateKeySize is present\nthe algorithm must be compatible. Update the CEL rule expressions to include\nthese conditional membership checks (use CEL logical implication/in and has() to\ncheck combinations) and adjust the corresponding message strings to reflect\nincompatibility vs creation-only errors.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:poseidon:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit 9a5cf37", "created_at": "2025-09-08T07:13:34Z", "updated_at": "2025-09-24T18:57:54Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2329346113", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2329346113"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2329346113"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2329346113/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 1223, "original_start_line": 1219, "start_side": "RIGHT", "line": 1228, "original_line": 1228, "side": "RIGHT", "author_association": "NONE", "original_position": 305, "position": 320, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 310, "file_path": "api/operator/v1alpha1/meta.go", "line_start": 31, "line_end": null, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_\n\n**Fix typo in PurgeExceptCertificates comment**\n\nLine 30 contains a typo: \"indicated\" should be \"indicates\" to maintain consistency with the other enum comments.\n\n```diff\n-// PurgeExceptCertificates indicated to purge all the created resources except the Certificate resource.\n+// PurgeExceptCertificates indicates to purge all the created resources except the Certificate resource.\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n\t// PurgeExceptCertificates indicates to purge all the created resources except the Certificate resource.\n\tPurgeExceptCertificates PurgePolicy = \"PurgeExceptCertificates\"\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn api/operator/v1alpha1/meta.go around lines 30 to 31, the comment for\nPurgeExceptCertificates uses \"indicated\" which is a typo; change the word\n\"indicated\" to \"indicates\" so the comment reads \"PurgeExceptCertificates\nindicates to purge all the created resources except the Certificate resource.\"\nto match the tense and style of the other enum comments.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:medusa:armadillo -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit 9a5cf37", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2374713637", "pull_request_review_id": 3261420555, "id": 2374713637, "node_id": "PRRC_kwDOFdFn9s6Ni0El", "diff_hunk": "@@ -0,0 +1,68 @@\n+package v1alpha1\n+\n+import metav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n+\n+// Mode indicates the operational state of the optional features.\n+type Mode string\n+\n+const (\n+\t// Enabled indicates the optional configuration is enabled.\n+\tEnabled Mode = \"Enabled\"\n+\n+\t// Disabled indicates the optional configuration is disabled.\n+\tDisabled Mode = \"Disabled\"\n+\n+\t// DisabledAndCleanup indicates the optional configuration is disabled and\n+\t// created resources are automatically removed.\n+\tDisabledAndCleanup Mode = \"DisabledAndCleanup\"\n+)\n+\n+// PurgePolicy defines the policy for purging default resources.\n+type PurgePolicy string\n+\n+const (\n+\t// PurgeAll indicates to purge all the created resources.\n+\tPurgeAll PurgePolicy = \"PurgeAll\"\n+\n+\t// PurgeNone indicates to purge none of the created resources.\n+\tPurgeNone PurgePolicy = \"PurgeNone\"\n+\n+\t// PurgeExceptCertificates indicated to purge all the created resources except the Certificate resource.\n+\tPurgeExceptCertificates PurgePolicy = \"PurgeExceptCertificates\"", "path": "api/operator/v1alpha1/meta.go", "commit_id": "e662d026368dc3a9f2da5a4748353cb0eafa7664", "original_commit_id": "e662d026368dc3a9f2da5a4748353cb0eafa7664", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_\n\n**Fix typo in PurgeExceptCertificates comment**\n\nLine 30 contains a typo: \"indicated\" should be \"indicates\" to maintain consistency with the other enum comments.\n\n```diff\n-// PurgeExceptCertificates indicated to purge all the created resources except the Certificate resource.\n+// PurgeExceptCertificates indicates to purge all the created resources except the Certificate resource.\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n\t// PurgeExceptCertificates indicates to purge all the created resources except the Certificate resource.\n\tPurgeExceptCertificates PurgePolicy = \"PurgeExceptCertificates\"\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn api/operator/v1alpha1/meta.go around lines 30 to 31, the comment for\nPurgeExceptCertificates uses \"indicated\" which is a typo; change the word\n\"indicated\" to \"indicates\" so the comment reads \"PurgeExceptCertificates\nindicates to purge all the created resources except the Certificate resource.\"\nto match the tense and style of the other enum comments.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:medusa:armadillo -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit 9a5cf37", "created_at": "2025-09-24T07:18:07Z", "updated_at": "2025-09-24T18:57:58Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2374713637", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2374713637"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2374713637"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2374713637/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 30, "start_side": "RIGHT", "line": null, "original_line": 31, "side": "RIGHT", "author_association": "NONE", "original_position": 31, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 310, "file_path": "bundle/manifests/operator.openshift.io_istiocsrs.yaml", "line_start": 1082, "line_end": 1082, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_\n\n**Allow empty namespace for istioCACertificate as described; relax validation.**\n\nEmpty is documented as valid but schema disallows it. Make it optional and validate only when set.\n\n\n\n```diff\n                           namespace:\n                             description: namespace in which the ConfigMap exists.\n                               If empty, ConfigMap will be looked up in IstioCSR created\n                               namespace.\n                           maxLength: 63\n-                          minLength: 1\n+                          minLength: 0\n                           type: string\n                           x-kubernetes-validations:\n-                          - message: namespace must consist of only lowercase alphanumeric\n-                              characters and hyphens, and must start with an alphabetic\n-                              character and end with an alphanumeric character.\n-                            rule: '!format.dns1123Label().validate(self).hasValue()'\n+                          - message: namespace must consist of only lowercase alphanumeric characters and hyphens, and must start with an alphabetic character and end with an alphanumeric character (when set).\n+                            rule: size(self) == 0 || !format.dns1123Label().validate(self).hasValue()\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n                            description: namespace in which the ConfigMap exists.\n                              If empty, ConfigMap will be looked up in IstioCSR created\n                              namespace.\n                            maxLength: 63\n                            minLength: 0\n                            type: string\n                            x-kubernetes-validations:\n                            - message: namespace must consist of only lowercase alphanumeric characters and hyphens, and must start with an alphabetic character and end with an alphanumeric character (when set).\n                              rule: 'size(self) == 0 || !format.dns1123Label().validate(self).hasValue()'\n                        required:\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn bundle/manifests/operator.openshift.io_istiocsrs.yaml around lines 1071 to\n1082, the schema marks the namespace as required (minLength: 1) and applies a\nstrict dns1123Label validation that prevents an empty value even though the docs\nsay empty is allowed; make the namespace optional by allowing empty values\n(remove or set minLength to 0 and/or not mark it required) and change the\nx-kubernetes-validations rule so it only runs when a value is present (i.e.,\nshort-circuit/allow empty string, validate with dns1123Label only when self is\nnon-empty).\n```\n\n</details>\n\n<!-- fingerprinting:phantom:triton:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit 9a5cf37", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2374713653", "pull_request_review_id": 3261420555, "id": 2374713653, "node_id": "PRRC_kwDOFdFn9s6Ni0E1", "diff_hunk": "@@ -1028,6 +1043,46 @@ spec:\n                             == 'clusterissuer'\n                         - message: group must be 'cert-manager.io'\n                           rule: self.group.lowerAscii() == 'cert-manager.io'\n+                      istioCACertificate:\n+                        description: |-\n+                          istioCACertificate when provided, the operator will use the CA certificate from the specified ConfigMap.\n+                          If empty, the operator will automatically extract the CA certificate from the Secret containing the istiod certificate obtained from cert-manager.\n+                        properties:\n+                          key:\n+                            description: key name holding the required data.\n+                            maxLength: 253\n+                            minLength: 1\n+                            pattern: ^[-._a-zA-Z0-9]+$\n+                            type: string\n+                          name:\n+                            description: name of the ConfigMap.\n+                            maxLength: 253\n+                            minLength: 1\n+                            type: string\n+                            x-kubernetes-validations:\n+                            - message: name must consist of lowercase alphanumeric\n+                                characters, hyphens ('-'), and periods ('.'). Each\n+                                block, separated by periods, must start and end with\n+                                an alphanumeric character. Hyphens are not allowed\n+                                at the start or end of a block, and consecutive periods\n+                                are not permitted.\n+                              rule: '!format.dns1123Subdomain().validate(self).hasValue()'\n+                          namespace:\n+                            description: namespace in which the ConfigMap exists.\n+                              If empty, ConfigMap will be looked up in IstioCSR created\n+                              namespace.\n+                            maxLength: 63\n+                            minLength: 1\n+                            type: string\n+                            x-kubernetes-validations:\n+                            - message: namespace must consist of only lowercase alphanumeric\n+                                characters and hyphens, and must start with an alphabetic\n+                                character and end with an alphanumeric character.\n+                              rule: '!format.dns1123Label().validate(self).hasValue()'\n+                        required:", "path": "bundle/manifests/operator.openshift.io_istiocsrs.yaml", "commit_id": "0959a86dc23d32087be1748ef22fe819d4b21c75", "original_commit_id": "e662d026368dc3a9f2da5a4748353cb0eafa7664", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_\n\n**Allow empty namespace for istioCACertificate as described; relax validation.**\n\nEmpty is documented as valid but schema disallows it. Make it optional and validate only when set.\n\n\n\n```diff\n                           namespace:\n                             description: namespace in which the ConfigMap exists.\n                               If empty, ConfigMap will be looked up in IstioCSR created\n                               namespace.\n                           maxLength: 63\n-                          minLength: 1\n+                          minLength: 0\n                           type: string\n                           x-kubernetes-validations:\n-                          - message: namespace must consist of only lowercase alphanumeric\n-                              characters and hyphens, and must start with an alphabetic\n-                              character and end with an alphanumeric character.\n-                            rule: '!format.dns1123Label().validate(self).hasValue()'\n+                          - message: namespace must consist of only lowercase alphanumeric characters and hyphens, and must start with an alphabetic character and end with an alphanumeric character (when set).\n+                            rule: size(self) == 0 || !format.dns1123Label().validate(self).hasValue()\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n                            description: namespace in which the ConfigMap exists.\n                              If empty, ConfigMap will be looked up in IstioCSR created\n                              namespace.\n                            maxLength: 63\n                            minLength: 0\n                            type: string\n                            x-kubernetes-validations:\n                            - message: namespace must consist of only lowercase alphanumeric characters and hyphens, and must start with an alphabetic character and end with an alphanumeric character (when set).\n                              rule: 'size(self) == 0 || !format.dns1123Label().validate(self).hasValue()'\n                        required:\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn bundle/manifests/operator.openshift.io_istiocsrs.yaml around lines 1071 to\n1082, the schema marks the namespace as required (minLength: 1) and applies a\nstrict dns1123Label validation that prevents an empty value even though the docs\nsay empty is allowed; make the namespace optional by allowing empty values\n(remove or set minLength to 0 and/or not mark it required) and change the\nx-kubernetes-validations rule so it only runs when a value is present (i.e.,\nshort-circuit/allow empty string, validate with dns1123Label only when self is\nnon-empty).\n```\n\n</details>\n\n<!-- fingerprinting:phantom:triton:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit 9a5cf37", "created_at": "2025-09-24T07:18:07Z", "updated_at": "2025-09-24T18:57:56Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2374713653", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2374713653"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2374713653"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2374713653/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 1071, "original_start_line": 1071, "start_side": "RIGHT", "line": 1082, "original_line": 1082, "side": "RIGHT", "author_association": "NONE", "original_position": 139, "position": 139, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 310, "file_path": "bundle/manifests/operator.openshift.io_istiocsrs.yaml", "line_start": 1102, "line_end": 1102, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_\n\n**Fix doc/constraint mismatch for istio.namespace max length.**\n\nText says 253; schema is 63. Align description to 63.\n\n\n\n```diff\n-                          namespace of the Istio control plane.\n-                          This field can have a maximum of 253 characters.\n+                          namespace of the Istio control plane.\n+                          This field can have a maximum of 63 characters.\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n                        description: |-\n                          namespace of the Istio control plane.\n                          This field can have a maximum of 63 characters.\n                        maxLength: 63\n                        minLength: 1\n                        type: string\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn bundle/manifests/operator.openshift.io_istiocsrs.yaml around lines 1097 to\n1102, the description for istio.namespace incorrectly states \"maximum of 253\ncharacters\" while the schema maxLength is 63; update the description text to\nstate \"This field can have a maximum of 63 characters.\" so the human-readable\ndoc matches the schema constraint.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:triton:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit 9a5cf37", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2374713660", "pull_request_review_id": 3261420555, "id": 2374713660, "node_id": "PRRC_kwDOFdFn9s6Ni0E8", "diff_hunk": "@@ -1039,108 +1094,151 @@ spec:\n                     description: istio is for configuring the istio specifics.\n                     properties:\n                       namespace:\n-                        description: namespace of the istio control-plane.\n+                        description: |-\n+                          namespace of the Istio control plane.\n+                          This field can have a maximum of 253 characters.\n+                        maxLength: 63\n+                        minLength: 1\n                         type: string", "path": "bundle/manifests/operator.openshift.io_istiocsrs.yaml", "commit_id": "0959a86dc23d32087be1748ef22fe819d4b21c75", "original_commit_id": "e662d026368dc3a9f2da5a4748353cb0eafa7664", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_\n\n**Fix doc/constraint mismatch for istio.namespace max length.**\n\nText says 253; schema is 63. Align description to 63.\n\n\n\n```diff\n-                          namespace of the Istio control plane.\n-                          This field can have a maximum of 253 characters.\n+                          namespace of the Istio control plane.\n+                          This field can have a maximum of 63 characters.\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n                        description: |-\n                          namespace of the Istio control plane.\n                          This field can have a maximum of 63 characters.\n                        maxLength: 63\n                        minLength: 1\n                        type: string\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn bundle/manifests/operator.openshift.io_istiocsrs.yaml around lines 1097 to\n1102, the description for istio.namespace incorrectly states \"maximum of 253\ncharacters\" while the schema maxLength is 63; update the description text to\nstate \"This field can have a maximum of 63 characters.\" so the human-readable\ndoc matches the schema constraint.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:triton:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit 9a5cf37", "created_at": "2025-09-24T07:18:07Z", "updated_at": "2025-09-24T18:58:02Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2374713660", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2374713660"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2374713660"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2374713660/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 1097, "original_start_line": 1097, "start_side": "RIGHT", "line": 1102, "original_line": 1102, "side": "RIGHT", "author_association": "NONE", "original_position": 156, "position": 156, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 310, "file_path": "config/crd/bases/operator.openshift.io_istiocsrs.yaml", "line_start": 1082, "line_end": 1082, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_\n\n**Allow empty namespace for istioCACertificate as described; relax validation.**\n\nDescription says empty is allowed, but `minLength: 1` + strict validation forbids it.\n\n\n\n```diff\n                           namespace:\n                             description: namespace in which the ConfigMap exists.\n                               If empty, ConfigMap will be looked up in IstioCSR created\n                               namespace.\n                           maxLength: 63\n-                          minLength: 1\n+                          minLength: 0\n                           type: string\n                           x-kubernetes-validations:\n-                          - message: namespace must consist of only lowercase alphanumeric\n-                              characters and hyphens, and must start with an alphabetic\n-                              character and end with an alphanumeric character.\n-                            rule: '!format.dns1123Label().validate(self).hasValue()'\n+                          - message: namespace must consist of only lowercase alphanumeric characters and hyphens, and must start with an alphabetic character and end with an alphanumeric character (when set).\n+                            rule: size(self) == 0 || !format.dns1123Label().validate(self).hasValue()\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n                            description: namespace in which the ConfigMap exists.\n                              If empty, ConfigMap will be looked up in IstioCSR created\n                              namespace.\n                            maxLength: 63\n                            minLength: 0\n                            type: string\n                            x-kubernetes-validations:\n                            - message: namespace must consist of only lowercase alphanumeric characters and hyphens, and must start with an alphabetic character and end with an alphanumeric character (when set).\n                              rule: size(self) == 0 || !format.dns1123Label().validate(self).hasValue()\n                        required:\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn config/crd/bases/operator.openshift.io_istiocsrs.yaml around lines 1071-1082,\nthe schema claims an empty namespace is allowed but currently enforces\nminLength: 1 and a dns1123Label validation that prevents empty values; update\nthe schema to allow empty namespaces by changing minLength to 0 (or removing\nminLength) and relax the x-kubernetes-validations rule so it only applies the\ndns1123Label check when the value is non-empty (for example, add a short-circuit\nthat accepts empty string, otherwise validate with dns1123Label).\n```\n\n</details>\n\n<!-- fingerprinting:phantom:triton:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit 9a5cf37", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2374713665", "pull_request_review_id": 3261420555, "id": 2374713665, "node_id": "PRRC_kwDOFdFn9s6Ni0FB", "diff_hunk": "@@ -1028,6 +1043,46 @@ spec:\n                             == 'clusterissuer'\n                         - message: group must be 'cert-manager.io'\n                           rule: self.group.lowerAscii() == 'cert-manager.io'\n+                      istioCACertificate:\n+                        description: |-\n+                          istioCACertificate when provided, the operator will use the CA certificate from the specified ConfigMap.\n+                          If empty, the operator will automatically extract the CA certificate from the Secret containing the istiod certificate obtained from cert-manager.\n+                        properties:\n+                          key:\n+                            description: key name holding the required data.\n+                            maxLength: 253\n+                            minLength: 1\n+                            pattern: ^[-._a-zA-Z0-9]+$\n+                            type: string\n+                          name:\n+                            description: name of the ConfigMap.\n+                            maxLength: 253\n+                            minLength: 1\n+                            type: string\n+                            x-kubernetes-validations:\n+                            - message: name must consist of lowercase alphanumeric\n+                                characters, hyphens ('-'), and periods ('.'). Each\n+                                block, separated by periods, must start and end with\n+                                an alphanumeric character. Hyphens are not allowed\n+                                at the start or end of a block, and consecutive periods\n+                                are not permitted.\n+                              rule: '!format.dns1123Subdomain().validate(self).hasValue()'\n+                          namespace:\n+                            description: namespace in which the ConfigMap exists.\n+                              If empty, ConfigMap will be looked up in IstioCSR created\n+                              namespace.\n+                            maxLength: 63\n+                            minLength: 1\n+                            type: string\n+                            x-kubernetes-validations:\n+                            - message: namespace must consist of only lowercase alphanumeric\n+                                characters and hyphens, and must start with an alphabetic\n+                                character and end with an alphanumeric character.\n+                              rule: '!format.dns1123Label().validate(self).hasValue()'\n+                        required:", "path": "config/crd/bases/operator.openshift.io_istiocsrs.yaml", "commit_id": "0959a86dc23d32087be1748ef22fe819d4b21c75", "original_commit_id": "e662d026368dc3a9f2da5a4748353cb0eafa7664", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_\n\n**Allow empty namespace for istioCACertificate as described; relax validation.**\n\nDescription says empty is allowed, but `minLength: 1` + strict validation forbids it.\n\n\n\n```diff\n                           namespace:\n                             description: namespace in which the ConfigMap exists.\n                               If empty, ConfigMap will be looked up in IstioCSR created\n                               namespace.\n                           maxLength: 63\n-                          minLength: 1\n+                          minLength: 0\n                           type: string\n                           x-kubernetes-validations:\n-                          - message: namespace must consist of only lowercase alphanumeric\n-                              characters and hyphens, and must start with an alphabetic\n-                              character and end with an alphanumeric character.\n-                            rule: '!format.dns1123Label().validate(self).hasValue()'\n+                          - message: namespace must consist of only lowercase alphanumeric characters and hyphens, and must start with an alphabetic character and end with an alphanumeric character (when set).\n+                            rule: size(self) == 0 || !format.dns1123Label().validate(self).hasValue()\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n                            description: namespace in which the ConfigMap exists.\n                              If empty, ConfigMap will be looked up in IstioCSR created\n                              namespace.\n                            maxLength: 63\n                            minLength: 0\n                            type: string\n                            x-kubernetes-validations:\n                            - message: namespace must consist of only lowercase alphanumeric characters and hyphens, and must start with an alphabetic character and end with an alphanumeric character (when set).\n                              rule: size(self) == 0 || !format.dns1123Label().validate(self).hasValue()\n                        required:\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn config/crd/bases/operator.openshift.io_istiocsrs.yaml around lines 1071-1082,\nthe schema claims an empty namespace is allowed but currently enforces\nminLength: 1 and a dns1123Label validation that prevents empty values; update\nthe schema to allow empty namespaces by changing minLength to 0 (or removing\nminLength) and relax the x-kubernetes-validations rule so it only applies the\ndns1123Label check when the value is non-empty (for example, add a short-circuit\nthat accepts empty string, otherwise validate with dns1123Label).\n```\n\n</details>\n\n<!-- fingerprinting:phantom:triton:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit 9a5cf37", "created_at": "2025-09-24T07:18:08Z", "updated_at": "2025-09-24T18:58:06Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2374713665", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2374713665"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2374713665"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2374713665/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 1071, "original_start_line": 1071, "start_side": "RIGHT", "line": 1082, "original_line": 1082, "side": "RIGHT", "author_association": "NONE", "original_position": 139, "position": 139, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 310, "file_path": "config/crd/bases/operator.openshift.io_istiocsrs.yaml", "line_start": 1102, "line_end": 1102, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_\n\n**Fix doc/constraint mismatch for istio.namespace max length.**\n\nDescription claims 253 chars; schema enforces 63 (correct for namespaces). Align the text.\n\n\n\n```diff\n-                          namespace of the Istio control plane.\n-                          This field can have a maximum of 253 characters.\n+                          namespace of the Istio control plane.\n+                          This field can have a maximum of 63 characters.\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n                        description: |-\n                          namespace of the Istio control plane.\n                          This field can have a maximum of 63 characters.\n                        maxLength: 63\n                        minLength: 1\n                        type: string\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn config/crd/bases/operator.openshift.io_istiocsrs.yaml around lines 1097 to\n1102, the description states a 253-character maximum but the schema sets\nmaxLength: 63 (the correct Kubernetes namespace limit); update the description\ntext to state a maximum of 63 characters so it matches the schema (e.g., replace\n\"253\" with \"63\") and ensure the wording still indicates the field can have a\nmaximum of 63 characters.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:triton:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit 9a5cf37", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2374713670", "pull_request_review_id": 3261420555, "id": 2374713670, "node_id": "PRRC_kwDOFdFn9s6Ni0FG", "diff_hunk": "@@ -1039,108 +1094,151 @@ spec:\n                     description: istio is for configuring the istio specifics.\n                     properties:\n                       namespace:\n-                        description: namespace of the istio control-plane.\n+                        description: |-\n+                          namespace of the Istio control plane.\n+                          This field can have a maximum of 253 characters.\n+                        maxLength: 63\n+                        minLength: 1\n                         type: string", "path": "config/crd/bases/operator.openshift.io_istiocsrs.yaml", "commit_id": "0959a86dc23d32087be1748ef22fe819d4b21c75", "original_commit_id": "e662d026368dc3a9f2da5a4748353cb0eafa7664", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_\n\n**Fix doc/constraint mismatch for istio.namespace max length.**\n\nDescription claims 253 chars; schema enforces 63 (correct for namespaces). Align the text.\n\n\n\n```diff\n-                          namespace of the Istio control plane.\n-                          This field can have a maximum of 253 characters.\n+                          namespace of the Istio control plane.\n+                          This field can have a maximum of 63 characters.\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n                        description: |-\n                          namespace of the Istio control plane.\n                          This field can have a maximum of 63 characters.\n                        maxLength: 63\n                        minLength: 1\n                        type: string\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn config/crd/bases/operator.openshift.io_istiocsrs.yaml around lines 1097 to\n1102, the description states a 253-character maximum but the schema sets\nmaxLength: 63 (the correct Kubernetes namespace limit); update the description\ntext to state a maximum of 63 characters so it matches the schema (e.g., replace\n\"253\" with \"63\") and ensure the wording still indicates the field can have a\nmaximum of 63 characters.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:triton:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit 9a5cf37", "created_at": "2025-09-24T07:18:08Z", "updated_at": "2025-09-24T18:58:04Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2374713670", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2374713670"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2374713670"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2374713670/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 1097, "original_start_line": 1097, "start_side": "RIGHT", "line": 1102, "original_line": 1102, "side": "RIGHT", "author_association": "NONE", "original_position": 156, "position": 156, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 310, "file_path": "api/operator/v1alpha1/istiocsr_types.go", "line_start": 169, "line_end": 169, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_\n\n**Broken CEL rule for issuerRef presence; and immutability rule needs create gating**\n\nThe presence rule disallows setting issuerRef on CREATE (it requires absence), conflicting with Required. Also, the field-level immutability rule lacks create gating and can fail on CREATE.\n\n\n\nApply:\n\n```diff\n-// +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.issuerRef) && !has(self.issuerRef) || has(oldSelf.issuerRef) && has(self.issuerRef)\",message=\"issuerRef may only be configured during creation\"\n+// (presence gating removed; rely on Required + immutability)\n\n // issuerRef contains details of the referenced object used for obtaining certificates.\n // When `issuerRef.Kind` is `Issuer`, it must exist in the `.spec.istioCSRConfig.istio.namespace`.\n // This field is immutable once set.\n-// +kubebuilder:validation:XValidation:rule=\"self == oldSelf\",message=\"issuerRef is immutable once set\"\n+// +kubebuilder:validation:XValidation:rule=\"!has(oldSelf) || self == oldSelf\",message=\"issuerRef is immutable once set\"\n // +kubebuilder:validation:XValidation:rule=\"self.kind.lowerAscii() == 'issuer' || self.kind.lowerAscii() == 'clusterissuer'\",message=\"kind must be either 'Issuer' or 'ClusterIssuer'\"\n // +kubebuilder:validation:XValidation:rule=\"self.group.lowerAscii() == 'cert-manager.io'\",message=\"group must be 'cert-manager.io'\"\n // +kubebuilder:validation:Required\n // +required\n-IssuerRef certmanagerv1.ObjectReference `json:\"issuerRef\"`\n+IssuerRef certmanagermetav1.ObjectReference `json:\"issuerRef\"`\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n// (presence gating removed; rely on Required + immutability)\ntype CertManagerConfig struct {\n    // issuerRef contains details of the referenced object used for obtaining certificates.\n    // When `issuerRef.Kind` is `Issuer`, it must exist in the `.spec.istioCSRConfig.istio.namespace`.\n    // This field is immutable once set.\n    // +kubebuilder:validation:XValidation:rule=\"!has(oldSelf) || self == oldSelf\",message=\"issuerRef is immutable once set\"\n    // +kubebuilder:validation:XValidation:rule=\"self.kind.lowerAscii() == 'issuer' || self.kind.lowerAscii() == 'clusterissuer'\",message=\"kind must be either 'Issuer' or 'ClusterIssuer'\"\n    // +kubebuilder:validation:XValidation:rule=\"self.group.lowerAscii() == 'cert-manager.io'\",message=\"group must be 'cert-manager.io'\"\n    // +kubebuilder:validation:Required\n    // +required\n    IssuerRef certmanagermetav1.ObjectReference `json:\"issuerRef\"`\n}\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn api/operator/v1alpha1/istiocsr_types.go around lines 159 to 169, remove the\nconflicting top-level XValidation that forbids issuerRef on create and instead\ngate immutability to updates: delete the presence rule and change the\nimmutability XValidation to only apply when oldSelf.issuerRef exists (e.g.,\nrule=\"!has(oldSelf.issuerRef) || self == oldSelf\"), leaving the Required and\nkind/group validation intact so issuerRef can be provided on CREATE but cannot\nbe changed on UPDATE.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:medusa:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commits b248e92 to 0959a86", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2376791441", "pull_request_review_id": 3264298892, "id": 2376791441, "node_id": "PRRC_kwDOFdFn9s6NqvWR", "diff_hunk": "@@ -120,89 +135,113 @@ type IstioCSRConfig struct {\n \tAffinity *corev1.Affinity `json:\"affinity,omitempty\"`\n \n \t// tolerations is for setting the pod tolerations.\n+\t// This field can have a maximum of 50 entries.\n \t// ref: https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/\n+\t// +listType=atomic\n+\t// +kubebuilder:validation:MinItems:=0\n+\t// +kubebuilder:validation:MaxItems:=50\n \t// +kubebuilder:validation:Optional\n \t// +optional\n-\t// +listType=atomic\n \tTolerations []corev1.Toleration `json:\"tolerations,omitempty\"`\n \n \t// nodeSelector is for defining the scheduling criteria using node labels.\n+\t// This field can have a maximum of 50 entries.\n \t// ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/\n+\t// +mapType=atomic\n+\t// +kubebuilder:validation:MinProperties:=0\n+\t// +kubebuilder:validation:MaxProperties:=50\n \t// +kubebuilder:validation:Optional\n \t// +optional\n-\t// +mapType=atomic\n \tNodeSelector map[string]string `json:\"nodeSelector,omitempty\"`\n }\n \n // CertManagerConfig is for configuring cert-manager specifics.\n // +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.issuerRef) && !has(self.issuerRef) || has(oldSelf.issuerRef) && has(self.issuerRef)\",message=\"issuerRef may only be configured during creation\"\n type CertManagerConfig struct {\n-\t// issuerRef contains details to the referenced object used for\n-\t// obtaining the certificates. When issuerRef.Kind is Issuer, it must exist in the\n-\t// .spec.istioCSRConfig.istio.namespace.\n+\t// issuerRef contains details of the referenced object used for obtaining certificates.\n+\t// When `issuerRef.Kind` is `Issuer`, it must exist in the `.spec.istioCSRConfig.istio.namespace`.\n+\t// This field is immutable once set.\n \t// +kubebuilder:validation:XValidation:rule=\"self == oldSelf\",message=\"issuerRef is immutable once set\"\n \t// +kubebuilder:validation:XValidation:rule=\"self.kind.lowerAscii() == 'issuer' || self.kind.lowerAscii() == 'clusterissuer'\",message=\"kind must be either 'Issuer' or 'ClusterIssuer'\"\n \t// +kubebuilder:validation:XValidation:rule=\"self.group.lowerAscii() == 'cert-manager.io'\",message=\"group must be 'cert-manager.io'\"\n \t// +kubebuilder:validation:Required\n \t// +required\n-\tIssuerRef certmanagerv1.ObjectReference `json:\"issuerRef,omitempty\"`\n+\tIssuerRef certmanagerv1.ObjectReference `json:\"issuerRef\"`", "path": "api/operator/v1alpha1/istiocsr_types.go", "commit_id": "0959a86dc23d32087be1748ef22fe819d4b21c75", "original_commit_id": "9a5cf372d62427dac30ddefdc77091bd21509a22", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_\n\n**Broken CEL rule for issuerRef presence; and immutability rule needs create gating**\n\nThe presence rule disallows setting issuerRef on CREATE (it requires absence), conflicting with Required. Also, the field-level immutability rule lacks create gating and can fail on CREATE.\n\n\n\nApply:\n\n```diff\n-// +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.issuerRef) && !has(self.issuerRef) || has(oldSelf.issuerRef) && has(self.issuerRef)\",message=\"issuerRef may only be configured during creation\"\n+// (presence gating removed; rely on Required + immutability)\n\n // issuerRef contains details of the referenced object used for obtaining certificates.\n // When `issuerRef.Kind` is `Issuer`, it must exist in the `.spec.istioCSRConfig.istio.namespace`.\n // This field is immutable once set.\n-// +kubebuilder:validation:XValidation:rule=\"self == oldSelf\",message=\"issuerRef is immutable once set\"\n+// +kubebuilder:validation:XValidation:rule=\"!has(oldSelf) || self == oldSelf\",message=\"issuerRef is immutable once set\"\n // +kubebuilder:validation:XValidation:rule=\"self.kind.lowerAscii() == 'issuer' || self.kind.lowerAscii() == 'clusterissuer'\",message=\"kind must be either 'Issuer' or 'ClusterIssuer'\"\n // +kubebuilder:validation:XValidation:rule=\"self.group.lowerAscii() == 'cert-manager.io'\",message=\"group must be 'cert-manager.io'\"\n // +kubebuilder:validation:Required\n // +required\n-IssuerRef certmanagerv1.ObjectReference `json:\"issuerRef\"`\n+IssuerRef certmanagermetav1.ObjectReference `json:\"issuerRef\"`\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n// (presence gating removed; rely on Required + immutability)\ntype CertManagerConfig struct {\n    // issuerRef contains details of the referenced object used for obtaining certificates.\n    // When `issuerRef.Kind` is `Issuer`, it must exist in the `.spec.istioCSRConfig.istio.namespace`.\n    // This field is immutable once set.\n    // +kubebuilder:validation:XValidation:rule=\"!has(oldSelf) || self == oldSelf\",message=\"issuerRef is immutable once set\"\n    // +kubebuilder:validation:XValidation:rule=\"self.kind.lowerAscii() == 'issuer' || self.kind.lowerAscii() == 'clusterissuer'\",message=\"kind must be either 'Issuer' or 'ClusterIssuer'\"\n    // +kubebuilder:validation:XValidation:rule=\"self.group.lowerAscii() == 'cert-manager.io'\",message=\"group must be 'cert-manager.io'\"\n    // +kubebuilder:validation:Required\n    // +required\n    IssuerRef certmanagermetav1.ObjectReference `json:\"issuerRef\"`\n}\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn api/operator/v1alpha1/istiocsr_types.go around lines 159 to 169, remove the\nconflicting top-level XValidation that forbids issuerRef on create and instead\ngate immutability to updates: delete the presence rule and change the\nimmutability XValidation to only apply when oldSelf.issuerRef exists (e.g.,\nrule=\"!has(oldSelf.issuerRef) || self == oldSelf\"), leaving the Required and\nkind/group validation intact so issuerRef can be provided on CREATE but cannot\nbe changed on UPDATE.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:medusa:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commits b248e92 to 0959a86", "created_at": "2025-09-24T19:07:30Z", "updated_at": "2025-09-30T12:56:58Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2376791441", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2376791441"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2376791441"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2376791441/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 138, "original_start_line": 138, "start_side": "LEFT", "line": 169, "original_line": 169, "side": "RIGHT", "author_association": "NONE", "original_position": 182, "position": 182, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 310, "file_path": "api/operator/v1alpha1/istiocsr_types.go", "line_start": 183, "line_end": 183, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_\n\n**CEL rules block CREATE; fix create-time gating and allow omission pre-defaulting**\n\nThese rules currently require absence of fields at CREATE (inverted intent) and can fail when defaults aren\u2019t materialized pre-validation.\n\n\n\nUse only immutability on the fields, and make the size/algorithm compatibility conditional on presence:\n\n```diff\n-// +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.privateKeyAlgorithm) && !has(self.privateKeyAlgorithm) || has(oldSelf.privateKeyAlgorithm) && has(self.privateKeyAlgorithm)\",message=\"privateKeyAlgorithm may only be configured during creation\"\n-// +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.privateKeySize) && !has(self.privateKeySize) || has(oldSelf.privateKeySize) && has(self.privateKeySize)\",message=\"privateKeySize may only be configured during creation\"\n-// +kubebuilder:validation:XValidation:rule=\"(!has(self.privateKeyAlgorithm) || self.privateKeyAlgorithm == 'RSA') ? (self.privateKeySize in [2048,4096,8192]) : (self.privateKeySize in [256,384])\",message=\"privateKeySize must match with configured privateKeyAlgorithm\"\n+// +kubebuilder:validation:XValidation:rule=\"!has(self.privateKeySize) || ((!has(self.privateKeyAlgorithm) || self.privateKeyAlgorithm == 'RSA') ? (self.privateKeySize in [2048,4096,8192]) : (self.privateKeySize in [256,384]))\",message=\"privateKeySize must match with configured privateKeyAlgorithm\"\n```\n\nNote: You already have per-field immutability:\n- privateKeySize: oldSelf == 0 || self == oldSelf\n- privateKeyAlgorithm: oldSelf == '' || self == oldSelf\nThis is sufficient; remove the \u201cmay only be configured during creation\u201d rules.\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n// +kubebuilder:validation:XValidation:rule=\"!has(self.privateKeySize) || ((!has(self.privateKeyAlgorithm) || self.privateKeyAlgorithm == 'RSA') ? (self.privateKeySize in [2048,4096,8192]) : (self.privateKeySize in [256,384]))\",message=\"privateKeySize must match with configured privateKeyAlgorithm\"\ntype IstiodTLSConfig struct {\n\t// commonName is the common name to be set in the cert-manager.io Certificate created for istiod.\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<!-- fingerprinting:phantom:medusa:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commits b248e92 to 0959a86", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2376791448", "pull_request_review_id": 3264298892, "id": 2376791448, "node_id": "PRRC_kwDOFdFn9s6NqvWY", "diff_hunk": "@@ -120,89 +135,113 @@ type IstioCSRConfig struct {\n \tAffinity *corev1.Affinity `json:\"affinity,omitempty\"`\n \n \t// tolerations is for setting the pod tolerations.\n+\t// This field can have a maximum of 50 entries.\n \t// ref: https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/\n+\t// +listType=atomic\n+\t// +kubebuilder:validation:MinItems:=0\n+\t// +kubebuilder:validation:MaxItems:=50\n \t// +kubebuilder:validation:Optional\n \t// +optional\n-\t// +listType=atomic\n \tTolerations []corev1.Toleration `json:\"tolerations,omitempty\"`\n \n \t// nodeSelector is for defining the scheduling criteria using node labels.\n+\t// This field can have a maximum of 50 entries.\n \t// ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/\n+\t// +mapType=atomic\n+\t// +kubebuilder:validation:MinProperties:=0\n+\t// +kubebuilder:validation:MaxProperties:=50\n \t// +kubebuilder:validation:Optional\n \t// +optional\n-\t// +mapType=atomic\n \tNodeSelector map[string]string `json:\"nodeSelector,omitempty\"`\n }\n \n // CertManagerConfig is for configuring cert-manager specifics.\n // +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.issuerRef) && !has(self.issuerRef) || has(oldSelf.issuerRef) && has(self.issuerRef)\",message=\"issuerRef may only be configured during creation\"\n type CertManagerConfig struct {\n-\t// issuerRef contains details to the referenced object used for\n-\t// obtaining the certificates. When issuerRef.Kind is Issuer, it must exist in the\n-\t// .spec.istioCSRConfig.istio.namespace.\n+\t// issuerRef contains details of the referenced object used for obtaining certificates.\n+\t// When `issuerRef.Kind` is `Issuer`, it must exist in the `.spec.istioCSRConfig.istio.namespace`.\n+\t// This field is immutable once set.\n \t// +kubebuilder:validation:XValidation:rule=\"self == oldSelf\",message=\"issuerRef is immutable once set\"\n \t// +kubebuilder:validation:XValidation:rule=\"self.kind.lowerAscii() == 'issuer' || self.kind.lowerAscii() == 'clusterissuer'\",message=\"kind must be either 'Issuer' or 'ClusterIssuer'\"\n \t// +kubebuilder:validation:XValidation:rule=\"self.group.lowerAscii() == 'cert-manager.io'\",message=\"group must be 'cert-manager.io'\"\n \t// +kubebuilder:validation:Required\n \t// +required\n-\tIssuerRef certmanagerv1.ObjectReference `json:\"issuerRef,omitempty\"`\n+\tIssuerRef certmanagerv1.ObjectReference `json:\"issuerRef\"`\n+\n+\t// istioCACertificate when provided, the operator will use the CA certificate from the specified ConfigMap.\n+\t// If empty, the operator will automatically extract the CA certificate from the Secret containing the istiod certificate obtained from cert-manager.\n+\t// +kubebuilder:validation:Optional\n+\t// +optional\n+\tIstioCACertificate *ConfigMapReference `json:\"istioCACertificate,omitempty\"`\n }\n \n // IstiodTLSConfig is for configuring istiod certificate specifics.\n-// +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.signatureAlgorithm) && !has(self.signatureAlgorithm) || has(oldSelf.signatureAlgorithm) && has(self.signatureAlgorithm)\",message=\"signatureAlgorithm may only be configured during creation\"\n+// +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.privateKeyAlgorithm) && !has(self.privateKeyAlgorithm) || has(oldSelf.privateKeyAlgorithm) && has(self.privateKeyAlgorithm)\",message=\"privateKeyAlgorithm may only be configured during creation\"\n // +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.privateKeySize) && !has(self.privateKeySize) || has(oldSelf.privateKeySize) && has(self.privateKeySize)\",message=\"privateKeySize may only be configured during creation\"\n+// +kubebuilder:validation:XValidation:rule=\"(!has(self.privateKeyAlgorithm) || self.privateKeyAlgorithm == 'RSA') ? (self.privateKeySize in [2048,4096,8192]) : (self.privateKeySize in [256,384])\",message=\"privateKeySize must match with configured privateKeyAlgorithm\"\n type IstiodTLSConfig struct {\n-\t// commonName is the common name to be set in the certificate.cert-manager.io\n-\t// created for istiod. CommonName will be of the form `istiod.<istio_namespace>.svc`\n-\t// when not set.\n+\t// commonName is the common name to be set in the cert-manager.io Certificate created for istiod.", "path": "api/operator/v1alpha1/istiocsr_types.go", "commit_id": "0959a86dc23d32087be1748ef22fe819d4b21c75", "original_commit_id": "9a5cf372d62427dac30ddefdc77091bd21509a22", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_\n\n**CEL rules block CREATE; fix create-time gating and allow omission pre-defaulting**\n\nThese rules currently require absence of fields at CREATE (inverted intent) and can fail when defaults aren\u2019t materialized pre-validation.\n\n\n\nUse only immutability on the fields, and make the size/algorithm compatibility conditional on presence:\n\n```diff\n-// +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.privateKeyAlgorithm) && !has(self.privateKeyAlgorithm) || has(oldSelf.privateKeyAlgorithm) && has(self.privateKeyAlgorithm)\",message=\"privateKeyAlgorithm may only be configured during creation\"\n-// +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.privateKeySize) && !has(self.privateKeySize) || has(oldSelf.privateKeySize) && has(self.privateKeySize)\",message=\"privateKeySize may only be configured during creation\"\n-// +kubebuilder:validation:XValidation:rule=\"(!has(self.privateKeyAlgorithm) || self.privateKeyAlgorithm == 'RSA') ? (self.privateKeySize in [2048,4096,8192]) : (self.privateKeySize in [256,384])\",message=\"privateKeySize must match with configured privateKeyAlgorithm\"\n+// +kubebuilder:validation:XValidation:rule=\"!has(self.privateKeySize) || ((!has(self.privateKeyAlgorithm) || self.privateKeyAlgorithm == 'RSA') ? (self.privateKeySize in [2048,4096,8192]) : (self.privateKeySize in [256,384]))\",message=\"privateKeySize must match with configured privateKeyAlgorithm\"\n```\n\nNote: You already have per-field immutability:\n- privateKeySize: oldSelf == 0 || self == oldSelf\n- privateKeyAlgorithm: oldSelf == '' || self == oldSelf\nThis is sufficient; remove the \u201cmay only be configured during creation\u201d rules.\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n// +kubebuilder:validation:XValidation:rule=\"!has(self.privateKeySize) || ((!has(self.privateKeyAlgorithm) || self.privateKeyAlgorithm == 'RSA') ? (self.privateKeySize in [2048,4096,8192]) : (self.privateKeySize in [256,384]))\",message=\"privateKeySize must match with configured privateKeyAlgorithm\"\ntype IstiodTLSConfig struct {\n\t// commonName is the common name to be set in the cert-manager.io Certificate created for istiod.\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<!-- fingerprinting:phantom:medusa:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commits b248e92 to 0959a86", "created_at": "2025-09-24T19:07:30Z", "updated_at": "2025-09-30T12:57:01Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2376791448", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2376791448"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2376791448"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2376791448/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 179, "original_start_line": 179, "start_side": "RIGHT", "line": 183, "original_line": 183, "side": "RIGHT", "author_association": "NONE", "original_position": 200, "position": 200, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 310, "file_path": "bundle/manifests/operator.openshift.io_istiocsrs.yaml", "line_start": 1233, "line_end": 1233, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n**Bundle CRD: PrivateKey presence rules block CREATE**\n\nRemove creation-only presence rules; keep compatibility validation.\n\nApply this diff:\n\n```diff\n-                    - message: privateKeyAlgorithm may only be configured during creation\n-                      rule: '!has(oldSelf.privateKeyAlgorithm) && !has(self.privateKeyAlgorithm)\n-                        || has(oldSelf.privateKeyAlgorithm) && has(self.privateKeyAlgorithm)'\n-                    - message: privateKeySize may only be configured during creation\n-                      rule: '!has(oldSelf.privateKeySize) && !has(self.privateKeySize)\n-                        || has(oldSelf.privateKeySize) && has(self.privateKeySize)'\n                     - message: privateKeySize must match with configured privateKeyAlgorithm\n                       rule: '(!has(self.privateKeyAlgorithm) || self.privateKeyAlgorithm\n                         == ''RSA'') ? (self.privateKeySize in [2048,4096,8192]) :\n                         (self.privateKeySize in [256,384])'\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n                    - message: privateKeySize must match with configured privateKeyAlgorithm\n                      rule: '(!has(self.privateKeyAlgorithm) || self.privateKeyAlgorithm\n                        == ''RSA'') ? (self.privateKeySize in [2048,4096,8192]) :\n                        (self.privateKeySize in [256,384])'\n                  logFormat:\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn bundle/manifests/operator.openshift.io_istiocsrs.yaml around lines 1223 to\n1233, remove the creation-only presence validation rules that prevent\nconfiguring privateKeyAlgorithm and privateKeySize on CREATE (the two rules with\nmessages \"privateKeyAlgorithm may only be configured during creation\" and\n\"privateKeySize may only be configured during creation\"); keep the compatibility\nvalidation that enforces privateKeySize matches privateKeyAlgorithm (the rule\nchecking RSA vs non\u2011RSA sizes). Update the rules list to only include the\ncompatibility rule so creation is not blocked while still validating\nalgorithm/size combinations.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:poseidon:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commits b248e92 to 0959a86", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2382246777", "pull_request_review_id": 3272002685, "id": 2382246777, "node_id": "PRRC_kwDOFdFn9s6N_jN5", "diff_hunk": "@@ -1039,108 +1094,154 @@ spec:\n                     description: istio is for configuring the istio specifics.\n                     properties:\n                       namespace:\n-                        description: namespace of the istio control-plane.\n+                        description: |-\n+                          namespace of the Istio control plane.\n+                          This field can have a maximum of 63 characters.\n+                        maxLength: 63\n+                        minLength: 1\n                         type: string\n                         x-kubernetes-validations:\n                         - message: namespace is immutable once set\n                           rule: self == oldSelf\n+                        - message: namespace must consist of only lowercase alphanumeric\n+                            characters and hyphens, and must start with an alphabetic\n+                            character and end with an alphanumeric character.\n+                          rule: '!format.dns1123Label().validate(self).hasValue()'\n                       revisions:\n                         default:\n                         - default\n                         description: |-\n-                          revisions are the istio revisions that are currently installed in the cluster.\n-                          Changing this field will modify the DNS names that will be requested for\n-                          the istiod certificate.\n+                          revisions are the Istio revisions that are currently installed in the cluster.\n+                          Changing this field will modify the DNS names that will be requested for the istiod certificate.\n+                          This field can have a maximum of 25 entries.\n                         items:\n+                          maxLength: 63\n+                          minLength: 1\n                           type: string\n-                        maxItems: 10\n+                        maxItems: 25\n+                        minItems: 0\n                         type: array\n                         x-kubernetes-list-type: set\n-                        x-kubernetes-validations:\n-                        - message: revisions is immutable once set\n-                          rule: self.all(x, x in oldSelf) && oldSelf.all(x, x in self)\n                     required:\n                     - namespace\n                     type: object\n+                  istioDataPlaneNamespaceSelector:\n+                    description: |-\n+                      Istio-csr creates a ConfigMap named `istio-ca-root-cert` containing the root CA certificate, which the Istio data plane uses to verify server certificates. Its default behavior is to create and monitor ConfigMaps in all namespaces.\n+                      The istioDataPlaneNamespaceSelector restricts the namespaces where the ConfigMap is created by using label selectors, such as maistra.io/member-of=istio-system. This selector is also attached to all desired namespaces that are part of the data plane.\n+                      This field can have a maximum of 4096 characters.\n+                    example: maistra.io/member-of=istio-system\n+                    maxLength: 4096\n+                    minLength: 0\n+                    type: string\n                   istiodTLSConfig:\n                     description: istiodTLSConfig is for configuring istiod certificate\n                       specifics.\n                     properties:\n                       certificateDNSNames:\n-                        description: certificateDNSNames contains the additional DNS\n-                          names to be added to the istiod certificate SAN.\n+                        description: |-\n+                          certificateDNSNames contains the additional DNS names to be added to the istiod certificate SAN.\n+                          This field can have a maximum of 25 entries.\n                         items:\n+                          maxLength: 253\n+                          minLength: 1\n                           type: string\n+                        maxItems: 25\n+                        minItems: 0\n                         type: array\n                         x-kubernetes-list-type: set\n                       certificateDuration:\n                         default: 1h\n-                        description: certificateDuration is the istio-csr and the\n-                          istiod certificates validity period.\n+                        description: certificateDuration is the validity period for\n+                          the istio-csr and istiod certificates.\n                         type: string\n                       certificateRenewBefore:\n                         default: 30m\n-                        description: |-\n-                          certificateRenewBefore is the ahead time to renew the istio-csr and the istiod certificates\n-                          before expiry.\n+                        description: certificateRenewBefore is the time before expiry\n+                          to renew the istio-csr and istiod certificates.\n                         type: string\n                       commonName:\n                         description: |-\n-                          commonName is the common name to be set in the certificate.cert-manager.io\n-                          created for istiod. CommonName will be of the form `istiod.<istio_namespace>.svc`\n-                          when not set.\n+                          commonName is the common name to be set in the cert-manager.io Certificate created for istiod.\n+                          The commonName will be of the form istiod.<istio_namespace>.svc when not set.\n+                          This field can have a maximum of 64 characters.\n+                        example: istiod.istio-system.svc\n+                        maxLength: 64\n+                        minLength: 0\n                         type: string\n                       maxCertificateDuration:\n                         default: 1h\n-                        description: |-\n-                          MaxCertificateDuration is the maximum validity duration that can be\n-                          requested for a certificate.\n+                        description: MaxCertificateDuration is the maximum validity\n+                          duration that can be requested for a certificate.\n                         type: string\n-                      privateKeySize:\n-                        default: 2048\n-                        description: |-\n-                          privateKeySize is the istio-csr and the istiod certificate's key size. When the SignatureAlgorithm\n-                          is RSA, must be >= 2048 and for ECDSA, can only be 256 or 384, corresponding to P-256 and P-384 respectively.\n-                        type: integer\n-                        x-kubernetes-validations:\n-                        - message: privateKeySize is immutable once set\n-                          rule: oldSelf == 0 || self == oldSelf\n-                      signatureAlgorithm:\n+                      privateKeyAlgorithm:\n                         default: RSA\n                         description: |-\n-                          signatureAlgorithm is the signature algorithm to use when generating\n-                          private keys. At present only RSA and ECDSA are supported.\n+                          privateKeyAlgorithm is the algorithm to use when generating private keys. Allowed values are RSA, and ECDSA.\n+                          This field is immutable once set.\n                         enum:\n                         - RSA\n                         - ECDSA\n                         type: string\n                         x-kubernetes-validations:\n-                        - message: signatureAlgorithm is immutable once set\n+                        - message: privateKeyAlgorithm is immutable once set\n                           rule: oldSelf == '' || self == oldSelf\n+                      privateKeySize:\n+                        default: 2048\n+                        description: |-\n+                          privateKeySize is the key size for the istio-csr and istiod certificates. Allowed values when privateKeyAlgorithm is RSA are 2048, 4096, 8192; and for ECDSA, they are 256, 384.\n+                          This field is immutable once set.\n+                        enum:\n+                        - 256\n+                        - 384\n+                        - 2048\n+                        - 4096\n+                        - 8192\n+                        format: int32\n+                        type: integer\n+                        x-kubernetes-validations:\n+                        - message: privateKeySize is immutable once set\n+                          rule: oldSelf == 0 || self == oldSelf\n                       trustDomain:\n                         description: |-\n-                          trustDomain is the istio cluster's trust domain, which will also be used for deriving\n-                          spiffe URI.\n+                          trustDomain is the Istio cluster's trust domain, which will also be used for deriving the SPIFFE URI.\n+                          This field can have a maximum of 63 characters.\n+                        maxLength: 63\n+                        minLength: 1\n                         type: string\n+                        x-kubernetes-validations:\n+                        - message: trustDomain must consist of lowercase alphanumeric\n+                            characters, hyphens ('-'), and periods ('.'). Each block,\n+                            separated by periods, must start and end with an alphanumeric\n+                            character. Hyphens are not allowed at the start or end\n+                            of a block, and consecutive periods are not permitted.\n+                          rule: '!format.dns1123Subdomain().validate(self).hasValue()'\n                     required:\n                     - trustDomain\n                     type: object\n                     x-kubernetes-validations:\n-                    - message: signatureAlgorithm may only be configured during creation\n-                      rule: '!has(oldSelf.signatureAlgorithm) && !has(self.signatureAlgorithm)\n-                        || has(oldSelf.signatureAlgorithm) && has(self.signatureAlgorithm)'\n+                    - message: privateKeyAlgorithm may only be configured during creation\n+                      rule: '!has(oldSelf.privateKeyAlgorithm) && !has(self.privateKeyAlgorithm)\n+                        || has(oldSelf.privateKeyAlgorithm) && has(self.privateKeyAlgorithm)'\n                     - message: privateKeySize may only be configured during creation\n                       rule: '!has(oldSelf.privateKeySize) && !has(self.privateKeySize)\n                         || has(oldSelf.privateKeySize) && has(self.privateKeySize)'\n+                    - message: privateKeySize must match with configured privateKeyAlgorithm\n+                      rule: '(!has(self.privateKeyAlgorithm) || self.privateKeyAlgorithm\n+                        == ''RSA'') ? (self.privateKeySize in [2048,4096,8192]) :\n+                        (self.privateKeySize in [256,384])'\n                   logFormat:", "path": "bundle/manifests/operator.openshift.io_istiocsrs.yaml", "commit_id": "0959a86dc23d32087be1748ef22fe819d4b21c75", "original_commit_id": "4151ddc0bc92f237b72b0c666d5a0880100642b9", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n**Bundle CRD: PrivateKey presence rules block CREATE**\n\nRemove creation-only presence rules; keep compatibility validation.\n\nApply this diff:\n\n```diff\n-                    - message: privateKeyAlgorithm may only be configured during creation\n-                      rule: '!has(oldSelf.privateKeyAlgorithm) && !has(self.privateKeyAlgorithm)\n-                        || has(oldSelf.privateKeyAlgorithm) && has(self.privateKeyAlgorithm)'\n-                    - message: privateKeySize may only be configured during creation\n-                      rule: '!has(oldSelf.privateKeySize) && !has(self.privateKeySize)\n-                        || has(oldSelf.privateKeySize) && has(self.privateKeySize)'\n                     - message: privateKeySize must match with configured privateKeyAlgorithm\n                       rule: '(!has(self.privateKeyAlgorithm) || self.privateKeyAlgorithm\n                         == ''RSA'') ? (self.privateKeySize in [2048,4096,8192]) :\n                         (self.privateKeySize in [256,384])'\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n                    - message: privateKeySize must match with configured privateKeyAlgorithm\n                      rule: '(!has(self.privateKeyAlgorithm) || self.privateKeyAlgorithm\n                        == ''RSA'') ? (self.privateKeySize in [2048,4096,8192]) :\n                        (self.privateKeySize in [256,384])'\n                  logFormat:\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn bundle/manifests/operator.openshift.io_istiocsrs.yaml around lines 1223 to\n1233, remove the creation-only presence validation rules that prevent\nconfiguring privateKeyAlgorithm and privateKeySize on CREATE (the two rules with\nmessages \"privateKeyAlgorithm may only be configured during creation\" and\n\"privateKeySize may only be configured during creation\"); keep the compatibility\nvalidation that enforces privateKeySize matches privateKeyAlgorithm (the rule\nchecking RSA vs non\u2011RSA sizes). Update the rules list to only include the\ncompatibility rule so creation is not blocked while still validating\nalgorithm/size combinations.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:poseidon:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commits b248e92 to 0959a86", "created_at": "2025-09-26T12:20:55Z", "updated_at": "2025-09-30T12:57:09Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2382246777", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2382246777"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2382246777"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2382246777/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 1223, "original_start_line": 1223, "start_side": "RIGHT", "line": 1233, "original_line": 1233, "side": "RIGHT", "author_association": "NONE", "original_position": 325, "position": 325, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 310, "file_path": "config/crd/bases/operator.openshift.io_istiocsrs.yaml", "line_start": 1233, "line_end": 1233, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n**PrivateKey presence rules block CREATE due to defaults**\n\nCreation-time gating fails when defaults set values. Remove the two presence rules; keep the compatibility rule.\n\nApply this diff:\n\n```diff\n-                    - message: privateKeyAlgorithm may only be configured during creation\n-                      rule: '!has(oldSelf.privateKeyAlgorithm) && !has(self.privateKeyAlgorithm)\n-                        || has(oldSelf.privateKeyAlgorithm) && has(self.privateKeyAlgorithm)'\n-                    - message: privateKeySize may only be configured during creation\n-                      rule: '!has(oldSelf.privateKeySize) && !has(self.privateKeySize)\n-                        || has(oldSelf.privateKeySize) && has(self.privateKeySize)'\n                     - message: privateKeySize must match with configured privateKeyAlgorithm\n                       rule: '(!has(self.privateKeyAlgorithm) || self.privateKeyAlgorithm\n                         == ''RSA'') ? (self.privateKeySize in [2048,4096,8192]) :\n                         (self.privateKeySize in [256,384])'\n```\n\nRegenerate the CRD after adjusting Go annotations.\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n                    - message: privateKeySize must match with configured privateKeyAlgorithm\n                      rule: '(!has(self.privateKeyAlgorithm) || self.privateKeyAlgorithm\n                        == ''RSA'') ? (self.privateKeySize in [2048,4096,8192]) :\n                        (self.privateKeySize in [256,384])'\n                  logFormat:\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn config/crd/bases/operator.openshift.io_istiocsrs.yaml around lines 1223-1233\nthe two presence rules that gate creation when defaults are applied must be\nremoved: delete the rules/messages for \"privateKeyAlgorithm may only be\nconfigured during creation\" and \"privateKeySize may only be configured during\ncreation\" and keep only the compatibility rule that enforces size vs algorithm.\nThen update the Go API annotations (remove or adjust kubebuilder default tags or\nuse pointers/omitempty so fields aren't serialized with defaults) so the CRD\ngeneration won't inject defaults causing has() to be true, and finally\nregenerate the CRD YAML.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:poseidon:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2382246783", "pull_request_review_id": 3272002685, "id": 2382246783, "node_id": "PRRC_kwDOFdFn9s6N_jN_", "diff_hunk": "@@ -1039,108 +1094,154 @@ spec:\n                     description: istio is for configuring the istio specifics.\n                     properties:\n                       namespace:\n-                        description: namespace of the istio control-plane.\n+                        description: |-\n+                          namespace of the Istio control plane.\n+                          This field can have a maximum of 63 characters.\n+                        maxLength: 63\n+                        minLength: 1\n                         type: string\n                         x-kubernetes-validations:\n                         - message: namespace is immutable once set\n                           rule: self == oldSelf\n+                        - message: namespace must consist of only lowercase alphanumeric\n+                            characters and hyphens, and must start with an alphabetic\n+                            character and end with an alphanumeric character.\n+                          rule: '!format.dns1123Label().validate(self).hasValue()'\n                       revisions:\n                         default:\n                         - default\n                         description: |-\n-                          revisions are the istio revisions that are currently installed in the cluster.\n-                          Changing this field will modify the DNS names that will be requested for\n-                          the istiod certificate.\n+                          revisions are the Istio revisions that are currently installed in the cluster.\n+                          Changing this field will modify the DNS names that will be requested for the istiod certificate.\n+                          This field can have a maximum of 25 entries.\n                         items:\n+                          maxLength: 63\n+                          minLength: 1\n                           type: string\n-                        maxItems: 10\n+                        maxItems: 25\n+                        minItems: 0\n                         type: array\n                         x-kubernetes-list-type: set\n-                        x-kubernetes-validations:\n-                        - message: revisions is immutable once set\n-                          rule: self.all(x, x in oldSelf) && oldSelf.all(x, x in self)\n                     required:\n                     - namespace\n                     type: object\n+                  istioDataPlaneNamespaceSelector:\n+                    description: |-\n+                      Istio-csr creates a ConfigMap named `istio-ca-root-cert` containing the root CA certificate, which the Istio data plane uses to verify server certificates. Its default behavior is to create and monitor ConfigMaps in all namespaces.\n+                      The istioDataPlaneNamespaceSelector restricts the namespaces where the ConfigMap is created by using label selectors, such as maistra.io/member-of=istio-system. This selector is also attached to all desired namespaces that are part of the data plane.\n+                      This field can have a maximum of 4096 characters.\n+                    example: maistra.io/member-of=istio-system\n+                    maxLength: 4096\n+                    minLength: 0\n+                    type: string\n                   istiodTLSConfig:\n                     description: istiodTLSConfig is for configuring istiod certificate\n                       specifics.\n                     properties:\n                       certificateDNSNames:\n-                        description: certificateDNSNames contains the additional DNS\n-                          names to be added to the istiod certificate SAN.\n+                        description: |-\n+                          certificateDNSNames contains the additional DNS names to be added to the istiod certificate SAN.\n+                          This field can have a maximum of 25 entries.\n                         items:\n+                          maxLength: 253\n+                          minLength: 1\n                           type: string\n+                        maxItems: 25\n+                        minItems: 0\n                         type: array\n                         x-kubernetes-list-type: set\n                       certificateDuration:\n                         default: 1h\n-                        description: certificateDuration is the istio-csr and the\n-                          istiod certificates validity period.\n+                        description: certificateDuration is the validity period for\n+                          the istio-csr and istiod certificates.\n                         type: string\n                       certificateRenewBefore:\n                         default: 30m\n-                        description: |-\n-                          certificateRenewBefore is the ahead time to renew the istio-csr and the istiod certificates\n-                          before expiry.\n+                        description: certificateRenewBefore is the time before expiry\n+                          to renew the istio-csr and istiod certificates.\n                         type: string\n                       commonName:\n                         description: |-\n-                          commonName is the common name to be set in the certificate.cert-manager.io\n-                          created for istiod. CommonName will be of the form `istiod.<istio_namespace>.svc`\n-                          when not set.\n+                          commonName is the common name to be set in the cert-manager.io Certificate created for istiod.\n+                          The commonName will be of the form istiod.<istio_namespace>.svc when not set.\n+                          This field can have a maximum of 64 characters.\n+                        example: istiod.istio-system.svc\n+                        maxLength: 64\n+                        minLength: 0\n                         type: string\n                       maxCertificateDuration:\n                         default: 1h\n-                        description: |-\n-                          MaxCertificateDuration is the maximum validity duration that can be\n-                          requested for a certificate.\n+                        description: MaxCertificateDuration is the maximum validity\n+                          duration that can be requested for a certificate.\n                         type: string\n-                      privateKeySize:\n-                        default: 2048\n-                        description: |-\n-                          privateKeySize is the istio-csr and the istiod certificate's key size. When the SignatureAlgorithm\n-                          is RSA, must be >= 2048 and for ECDSA, can only be 256 or 384, corresponding to P-256 and P-384 respectively.\n-                        type: integer\n-                        x-kubernetes-validations:\n-                        - message: privateKeySize is immutable once set\n-                          rule: oldSelf == 0 || self == oldSelf\n-                      signatureAlgorithm:\n+                      privateKeyAlgorithm:\n                         default: RSA\n                         description: |-\n-                          signatureAlgorithm is the signature algorithm to use when generating\n-                          private keys. At present only RSA and ECDSA are supported.\n+                          privateKeyAlgorithm is the algorithm to use when generating private keys. Allowed values are RSA, and ECDSA.\n+                          This field is immutable once set.\n                         enum:\n                         - RSA\n                         - ECDSA\n                         type: string\n                         x-kubernetes-validations:\n-                        - message: signatureAlgorithm is immutable once set\n+                        - message: privateKeyAlgorithm is immutable once set\n                           rule: oldSelf == '' || self == oldSelf\n+                      privateKeySize:\n+                        default: 2048\n+                        description: |-\n+                          privateKeySize is the key size for the istio-csr and istiod certificates. Allowed values when privateKeyAlgorithm is RSA are 2048, 4096, 8192; and for ECDSA, they are 256, 384.\n+                          This field is immutable once set.\n+                        enum:\n+                        - 256\n+                        - 384\n+                        - 2048\n+                        - 4096\n+                        - 8192\n+                        format: int32\n+                        type: integer\n+                        x-kubernetes-validations:\n+                        - message: privateKeySize is immutable once set\n+                          rule: oldSelf == 0 || self == oldSelf\n                       trustDomain:\n                         description: |-\n-                          trustDomain is the istio cluster's trust domain, which will also be used for deriving\n-                          spiffe URI.\n+                          trustDomain is the Istio cluster's trust domain, which will also be used for deriving the SPIFFE URI.\n+                          This field can have a maximum of 63 characters.\n+                        maxLength: 63\n+                        minLength: 1\n                         type: string\n+                        x-kubernetes-validations:\n+                        - message: trustDomain must consist of lowercase alphanumeric\n+                            characters, hyphens ('-'), and periods ('.'). Each block,\n+                            separated by periods, must start and end with an alphanumeric\n+                            character. Hyphens are not allowed at the start or end\n+                            of a block, and consecutive periods are not permitted.\n+                          rule: '!format.dns1123Subdomain().validate(self).hasValue()'\n                     required:\n                     - trustDomain\n                     type: object\n                     x-kubernetes-validations:\n-                    - message: signatureAlgorithm may only be configured during creation\n-                      rule: '!has(oldSelf.signatureAlgorithm) && !has(self.signatureAlgorithm)\n-                        || has(oldSelf.signatureAlgorithm) && has(self.signatureAlgorithm)'\n+                    - message: privateKeyAlgorithm may only be configured during creation\n+                      rule: '!has(oldSelf.privateKeyAlgorithm) && !has(self.privateKeyAlgorithm)\n+                        || has(oldSelf.privateKeyAlgorithm) && has(self.privateKeyAlgorithm)'\n                     - message: privateKeySize may only be configured during creation\n                       rule: '!has(oldSelf.privateKeySize) && !has(self.privateKeySize)\n                         || has(oldSelf.privateKeySize) && has(self.privateKeySize)'\n+                    - message: privateKeySize must match with configured privateKeyAlgorithm\n+                      rule: '(!has(self.privateKeyAlgorithm) || self.privateKeyAlgorithm\n+                        == ''RSA'') ? (self.privateKeySize in [2048,4096,8192]) :\n+                        (self.privateKeySize in [256,384])'\n                   logFormat:", "path": "config/crd/bases/operator.openshift.io_istiocsrs.yaml", "commit_id": "0959a86dc23d32087be1748ef22fe819d4b21c75", "original_commit_id": "4151ddc0bc92f237b72b0c666d5a0880100642b9", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n**PrivateKey presence rules block CREATE due to defaults**\n\nCreation-time gating fails when defaults set values. Remove the two presence rules; keep the compatibility rule.\n\nApply this diff:\n\n```diff\n-                    - message: privateKeyAlgorithm may only be configured during creation\n-                      rule: '!has(oldSelf.privateKeyAlgorithm) && !has(self.privateKeyAlgorithm)\n-                        || has(oldSelf.privateKeyAlgorithm) && has(self.privateKeyAlgorithm)'\n-                    - message: privateKeySize may only be configured during creation\n-                      rule: '!has(oldSelf.privateKeySize) && !has(self.privateKeySize)\n-                        || has(oldSelf.privateKeySize) && has(self.privateKeySize)'\n                     - message: privateKeySize must match with configured privateKeyAlgorithm\n                       rule: '(!has(self.privateKeyAlgorithm) || self.privateKeyAlgorithm\n                         == ''RSA'') ? (self.privateKeySize in [2048,4096,8192]) :\n                         (self.privateKeySize in [256,384])'\n```\n\nRegenerate the CRD after adjusting Go annotations.\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n                    - message: privateKeySize must match with configured privateKeyAlgorithm\n                      rule: '(!has(self.privateKeyAlgorithm) || self.privateKeyAlgorithm\n                        == ''RSA'') ? (self.privateKeySize in [2048,4096,8192]) :\n                        (self.privateKeySize in [256,384])'\n                  logFormat:\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn config/crd/bases/operator.openshift.io_istiocsrs.yaml around lines 1223-1233\nthe two presence rules that gate creation when defaults are applied must be\nremoved: delete the rules/messages for \"privateKeyAlgorithm may only be\nconfigured during creation\" and \"privateKeySize may only be configured during\ncreation\" and keep only the compatibility rule that enforces size vs algorithm.\nThen update the Go API annotations (remove or adjust kubebuilder default tags or\nuse pointers/omitempty so fields aren't serialized with defaults) so the CRD\ngeneration won't inject defaults causing has() to be true, and finally\nregenerate the CRD YAML.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:poseidon:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "created_at": "2025-09-26T12:20:55Z", "updated_at": "2025-09-26T12:20:56Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2382246783", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2382246783"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2382246783"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2382246783/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 1223, "original_start_line": 1223, "start_side": "RIGHT", "line": 1233, "original_line": 1233, "side": "RIGHT", "author_association": "NONE", "original_position": 325, "position": 325, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 310, "file_path": "api/operator/v1alpha1/istiocsr_types.go", "line_start": 74, "line_end": 74, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Non-pointer IstioCSRConfig: verify defaulting/migration for upgrade path.**\n\nMaking IstioCSRConfig a required value type (line 68) is correct for new CRs, but existing CRs that omitted this field will fail validation on update. Ensure a mutating webhook or migration path populates this field for stored objects.\n\n\n\n\nRun the following script to check for defaulting logic:\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Description: Search for defaulting logic for IstioCSRConfig.\n\n# Search for defaulting functions or webhook handlers\nrg -nP --type=go -C3 'Default.*IstioCSR|SetDefaults.*IstioCSR|mutate.*istiocsr' pkg cmd\n```\n\nLength of output: 1063\n\n---\n\n\n\n</details>\n\n**Default IstioCSRConfig in webhook or migration to avoid upgrade failures.**\n\nIstioCSRConfig in IstioCSRSpec is now mandatory (non-pointer, no `omitempty`); CRs created before this change without that field will be rejected on update. Implement a mutating webhook (e.g. `SetDefaults_IstioCSR`) or a migration path to backfill `IstioCSRConfig` for stored objects.\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2391373012", "pull_request_review_id": 3284662675, "id": 2391373012, "node_id": "PRRC_kwDOFdFn9s6OiXTU", "diff_hunk": "@@ -50,61 +52,74 @@ type IstioCSR struct {\n \t// spec is the specification of the desired behavior of the IstioCSR.\n \t// +kubebuilder:validation:Required\n \t// +required\n-\tSpec IstioCSRSpec `json:\"spec,omitempty\"`\n+\tSpec IstioCSRSpec `json:\"spec\"`\n \n \t// status is the most recently observed status of the IstioCSR.\n+\t// +kubebuilder:validation:Optional\n+\t// +optional\n \tStatus IstioCSRStatus `json:\"status,omitempty\"`\n }\n \n // IstioCSRSpec is the specification of the desired behavior of the IstioCSR.\n type IstioCSRSpec struct {\n-\t// istioCSRConfig is for configuring the istio-csr agent behavior.\n+\t// istioCSRConfig configures the istio-csr agent's behavior.\n \t// +kubebuilder:validation:Required\n \t// +required\n-\tIstioCSRConfig *IstioCSRConfig `json:\"istioCSRConfig,omitempty\"`\n+\tIstioCSRConfig IstioCSRConfig `json:\"istioCSRConfig\"`\n \n-\t// controllerConfig is for configuring the controller for setting up\n-\t// defaults to enable istio-csr agent.\n+\t// controllerConfig configures the controller for setting up defaults to enable the istio-csr agent.\n+\t// +kubebuilder:validation:Optional\n+\t// +optional\n \tControllerConfig *ControllerConfig `json:\"controllerConfig,omitempty\"`\n }", "path": "api/operator/v1alpha1/istiocsr_types.go", "commit_id": "0959a86dc23d32087be1748ef22fe819d4b21c75", "original_commit_id": "0959a86dc23d32087be1748ef22fe819d4b21c75", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Non-pointer IstioCSRConfig: verify defaulting/migration for upgrade path.**\n\nMaking IstioCSRConfig a required value type (line 68) is correct for new CRs, but existing CRs that omitted this field will fail validation on update. Ensure a mutating webhook or migration path populates this field for stored objects.\n\n\n\n\nRun the following script to check for defaulting logic:\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Description: Search for defaulting logic for IstioCSRConfig.\n\n# Search for defaulting functions or webhook handlers\nrg -nP --type=go -C3 'Default.*IstioCSR|SetDefaults.*IstioCSR|mutate.*istiocsr' pkg cmd\n```\n\nLength of output: 1063\n\n---\n\n\n\n</details>\n\n**Default IstioCSRConfig in webhook or migration to avoid upgrade failures.**\n\nIstioCSRConfig in IstioCSRSpec is now mandatory (non-pointer, no `omitempty`); CRs created before this change without that field will be rejected on update. Implement a mutating webhook (e.g. `SetDefaults_IstioCSR`) or a migration path to backfill `IstioCSRConfig` for stored objects.\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "created_at": "2025-09-30T13:04:24Z", "updated_at": "2025-09-30T13:04:25Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2391373012", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2391373012"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2391373012"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2391373012/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 64, "original_start_line": 64, "start_side": "RIGHT", "line": 74, "original_line": 74, "side": "RIGHT", "author_association": "NONE", "original_position": 79, "position": 79, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 310, "file_path": "config/crd/bases/operator.openshift.io_istiocsrs.yaml", "line_start": 1232, "line_end": 1232, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Verify privateKeyAlgorithm and privateKeySize validation logic.**\n\nThe rename from `signatureAlgorithm` to `privateKeyAlgorithm` is correct, and the addition of `privateKeySize` (int32) with algorithm-specific validation is good. However, the CEL validation rules need verification:\n\n1. Lines 1223-1228: The presence rules check if fields exist on both old and new objects, which may fail on CREATE when defaults are applied\n2. Line 1229-1232: The compatibility rule correctly validates size matches algorithm\n\n\n\nRun the following to verify the immutability validation doesn't block creation:\n\n\n\n**Note**: Past review comments indicate the presence rules may block CREATE. Verify that defaults don't cause `has(self.privateKeyAlgorithm)` to be true during creation.\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Description: Check if default values in Go types might cause has() to return true on create\n\n# Search for default tags on privateKeyAlgorithm and privateKeySize in Go API\nrg -nP -A2 -B2 'PrivateKeyAlgorithm|PrivateKeySize' api/operator/v1alpha1/istiocsr_types.go\n\n# Check if kubebuilder default annotations are present\nrg -nP 'kubebuilder:default' api/operator/v1alpha1/istiocsr_types.go\n```\n\nLength of output: 846\n\n---\n\n\n\n</details>\n\n**Fix immutability CEL rules to allow CREATE**  \n- Current presence checks (`!has(oldSelf.privateKeyAlgorithm) && !has(self.privateKeyAlgorithm)`) fail on CREATE because defaults (`\"RSA\"`, 2048) make `has(self.*)` true.  \n- Replace with explicit empty\u2010value checks, e.g.:  \n  ```yaml\n  rule: oldSelf.privateKeyAlgorithm == '' || self.privateKeyAlgorithm == oldSelf.privateKeyAlgorithm\n  ```  \n  and  \n  ```yaml\n  rule: oldSelf.privateKeySize == 0 || self.privateKeySize == oldSelf.privateKeySize\n  ```  \n  to permit initial defaults while preserving immutability on UPDATE.\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn config/crd/bases/operator.openshift.io_istiocsrs.yaml around lines 1177-1232\nthe CEL immutability rules use has(...) presence checks which incorrectly fail\non CREATE because defaults make has(self.*) true; update those rules to explicit\nempty-value checks so creation with defaults is allowed while preserving\nimmutability on UPDATE: replace the privateKeyAlgorithm rule with a check\nequivalent to oldSelf.privateKeyAlgorithm == '' || self.privateKeyAlgorithm ==\noldSelf.privateKeyAlgorithm, and replace the privateKeySize rule with\noldSelf.privateKeySize == 0 || self.privateKeySize == oldSelf.privateKeySize,\nand ensure the per-field x-kubernetes-validations (oldSelf == '' || self ==\noldSelf and oldSelf == 0 || self == oldSelf) are consistent with these\nexplicit-empty checks.\n```\n\n</details>\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2391373020", "pull_request_review_id": 3284662675, "id": 2391373020, "node_id": "PRRC_kwDOFdFn9s6OiXTc", "diff_hunk": "@@ -1039,108 +1094,154 @@ spec:\n                     description: istio is for configuring the istio specifics.\n                     properties:\n                       namespace:\n-                        description: namespace of the istio control-plane.\n+                        description: |-\n+                          namespace of the Istio control plane.\n+                          This field can have a maximum of 63 characters.\n+                        maxLength: 63\n+                        minLength: 1\n                         type: string\n                         x-kubernetes-validations:\n                         - message: namespace is immutable once set\n                           rule: self == oldSelf\n+                        - message: namespace must consist of only lowercase alphanumeric\n+                            characters and hyphens, and must start with an alphabetic\n+                            character and end with an alphanumeric character.\n+                          rule: '!format.dns1123Label().validate(self).hasValue()'\n                       revisions:\n                         default:\n                         - default\n                         description: |-\n-                          revisions are the istio revisions that are currently installed in the cluster.\n-                          Changing this field will modify the DNS names that will be requested for\n-                          the istiod certificate.\n+                          revisions are the Istio revisions that are currently installed in the cluster.\n+                          Changing this field will modify the DNS names that will be requested for the istiod certificate.\n+                          This field can have a maximum of 25 entries.\n                         items:\n+                          maxLength: 63\n+                          minLength: 1\n                           type: string\n-                        maxItems: 10\n+                        maxItems: 25\n+                        minItems: 0\n                         type: array\n                         x-kubernetes-list-type: set\n-                        x-kubernetes-validations:\n-                        - message: revisions is immutable once set\n-                          rule: self.all(x, x in oldSelf) && oldSelf.all(x, x in self)\n                     required:\n                     - namespace\n                     type: object\n+                  istioDataPlaneNamespaceSelector:\n+                    description: |-\n+                      Istio-csr creates a ConfigMap named `istio-ca-root-cert` containing the root CA certificate, which the Istio data plane uses to verify server certificates. Its default behavior is to create and monitor ConfigMaps in all namespaces.\n+                      The istioDataPlaneNamespaceSelector restricts the namespaces where the ConfigMap is created by using label selectors, such as maistra.io/member-of=istio-system. This selector is also attached to all desired namespaces that are part of the data plane.\n+                      This field can have a maximum of 4096 characters.\n+                    example: maistra.io/member-of=istio-system\n+                    maxLength: 4096\n+                    minLength: 0\n+                    type: string\n                   istiodTLSConfig:\n                     description: istiodTLSConfig is for configuring istiod certificate\n                       specifics.\n                     properties:\n                       certificateDNSNames:\n-                        description: certificateDNSNames contains the additional DNS\n-                          names to be added to the istiod certificate SAN.\n+                        description: |-\n+                          certificateDNSNames contains the additional DNS names to be added to the istiod certificate SAN.\n+                          This field can have a maximum of 25 entries.\n                         items:\n+                          maxLength: 253\n+                          minLength: 1\n                           type: string\n+                        maxItems: 25\n+                        minItems: 0\n                         type: array\n                         x-kubernetes-list-type: set\n                       certificateDuration:\n                         default: 1h\n-                        description: certificateDuration is the istio-csr and the\n-                          istiod certificates validity period.\n+                        description: certificateDuration is the validity period for\n+                          the istio-csr and istiod certificates.\n                         type: string\n                       certificateRenewBefore:\n                         default: 30m\n-                        description: |-\n-                          certificateRenewBefore is the ahead time to renew the istio-csr and the istiod certificates\n-                          before expiry.\n+                        description: certificateRenewBefore is the time before expiry\n+                          to renew the istio-csr and istiod certificates.\n                         type: string\n                       commonName:\n                         description: |-\n-                          commonName is the common name to be set in the certificate.cert-manager.io\n-                          created for istiod. CommonName will be of the form `istiod.<istio_namespace>.svc`\n-                          when not set.\n+                          commonName is the common name to be set in the cert-manager.io Certificate created for istiod.\n+                          The commonName will be of the form istiod.<istio_namespace>.svc when not set.\n+                          This field can have a maximum of 64 characters.\n+                        example: istiod.istio-system.svc\n+                        maxLength: 64\n+                        minLength: 0\n                         type: string\n                       maxCertificateDuration:\n                         default: 1h\n-                        description: |-\n-                          MaxCertificateDuration is the maximum validity duration that can be\n-                          requested for a certificate.\n+                        description: MaxCertificateDuration is the maximum validity\n+                          duration that can be requested for a certificate.\n                         type: string\n-                      privateKeySize:\n-                        default: 2048\n-                        description: |-\n-                          privateKeySize is the istio-csr and the istiod certificate's key size. When the SignatureAlgorithm\n-                          is RSA, must be >= 2048 and for ECDSA, can only be 256 or 384, corresponding to P-256 and P-384 respectively.\n-                        type: integer\n-                        x-kubernetes-validations:\n-                        - message: privateKeySize is immutable once set\n-                          rule: oldSelf == 0 || self == oldSelf\n-                      signatureAlgorithm:\n+                      privateKeyAlgorithm:\n                         default: RSA\n                         description: |-\n-                          signatureAlgorithm is the signature algorithm to use when generating\n-                          private keys. At present only RSA and ECDSA are supported.\n+                          privateKeyAlgorithm is the algorithm to use when generating private keys. Allowed values are RSA, and ECDSA.\n+                          This field is immutable once set.\n                         enum:\n                         - RSA\n                         - ECDSA\n                         type: string\n                         x-kubernetes-validations:\n-                        - message: signatureAlgorithm is immutable once set\n+                        - message: privateKeyAlgorithm is immutable once set\n                           rule: oldSelf == '' || self == oldSelf\n+                      privateKeySize:\n+                        default: 2048\n+                        description: |-\n+                          privateKeySize is the key size for the istio-csr and istiod certificates. Allowed values when privateKeyAlgorithm is RSA are 2048, 4096, 8192; and for ECDSA, they are 256, 384.\n+                          This field is immutable once set.\n+                        enum:\n+                        - 256\n+                        - 384\n+                        - 2048\n+                        - 4096\n+                        - 8192\n+                        format: int32\n+                        type: integer\n+                        x-kubernetes-validations:\n+                        - message: privateKeySize is immutable once set\n+                          rule: oldSelf == 0 || self == oldSelf\n                       trustDomain:\n                         description: |-\n-                          trustDomain is the istio cluster's trust domain, which will also be used for deriving\n-                          spiffe URI.\n+                          trustDomain is the Istio cluster's trust domain, which will also be used for deriving the SPIFFE URI.\n+                          This field can have a maximum of 63 characters.\n+                        maxLength: 63\n+                        minLength: 1\n                         type: string\n+                        x-kubernetes-validations:\n+                        - message: trustDomain must consist of lowercase alphanumeric\n+                            characters, hyphens ('-'), and periods ('.'). Each block,\n+                            separated by periods, must start and end with an alphanumeric\n+                            character. Hyphens are not allowed at the start or end\n+                            of a block, and consecutive periods are not permitted.\n+                          rule: '!format.dns1123Subdomain().validate(self).hasValue()'\n                     required:\n                     - trustDomain\n                     type: object\n                     x-kubernetes-validations:\n-                    - message: signatureAlgorithm may only be configured during creation\n-                      rule: '!has(oldSelf.signatureAlgorithm) && !has(self.signatureAlgorithm)\n-                        || has(oldSelf.signatureAlgorithm) && has(self.signatureAlgorithm)'\n+                    - message: privateKeyAlgorithm may only be configured during creation\n+                      rule: '!has(oldSelf.privateKeyAlgorithm) && !has(self.privateKeyAlgorithm)\n+                        || has(oldSelf.privateKeyAlgorithm) && has(self.privateKeyAlgorithm)'\n                     - message: privateKeySize may only be configured during creation\n                       rule: '!has(oldSelf.privateKeySize) && !has(self.privateKeySize)\n                         || has(oldSelf.privateKeySize) && has(self.privateKeySize)'\n+                    - message: privateKeySize must match with configured privateKeyAlgorithm\n+                      rule: '(!has(self.privateKeyAlgorithm) || self.privateKeyAlgorithm\n+                        == ''RSA'') ? (self.privateKeySize in [2048,4096,8192]) :\n+                        (self.privateKeySize in [256,384])'", "path": "config/crd/bases/operator.openshift.io_istiocsrs.yaml", "commit_id": "0959a86dc23d32087be1748ef22fe819d4b21c75", "original_commit_id": "0959a86dc23d32087be1748ef22fe819d4b21c75", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Verify privateKeyAlgorithm and privateKeySize validation logic.**\n\nThe rename from `signatureAlgorithm` to `privateKeyAlgorithm` is correct, and the addition of `privateKeySize` (int32) with algorithm-specific validation is good. However, the CEL validation rules need verification:\n\n1. Lines 1223-1228: The presence rules check if fields exist on both old and new objects, which may fail on CREATE when defaults are applied\n2. Line 1229-1232: The compatibility rule correctly validates size matches algorithm\n\n\n\nRun the following to verify the immutability validation doesn't block creation:\n\n\n\n**Note**: Past review comments indicate the presence rules may block CREATE. Verify that defaults don't cause `has(self.privateKeyAlgorithm)` to be true during creation.\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Description: Check if default values in Go types might cause has() to return true on create\n\n# Search for default tags on privateKeyAlgorithm and privateKeySize in Go API\nrg -nP -A2 -B2 'PrivateKeyAlgorithm|PrivateKeySize' api/operator/v1alpha1/istiocsr_types.go\n\n# Check if kubebuilder default annotations are present\nrg -nP 'kubebuilder:default' api/operator/v1alpha1/istiocsr_types.go\n```\n\nLength of output: 846\n\n---\n\n\n\n</details>\n\n**Fix immutability CEL rules to allow CREATE**  \n- Current presence checks (`!has(oldSelf.privateKeyAlgorithm) && !has(self.privateKeyAlgorithm)`) fail on CREATE because defaults (`\"RSA\"`, 2048) make `has(self.*)` true.  \n- Replace with explicit empty\u2010value checks, e.g.:  \n  ```yaml\n  rule: oldSelf.privateKeyAlgorithm == '' || self.privateKeyAlgorithm == oldSelf.privateKeyAlgorithm\n  ```  \n  and  \n  ```yaml\n  rule: oldSelf.privateKeySize == 0 || self.privateKeySize == oldSelf.privateKeySize\n  ```  \n  to permit initial defaults while preserving immutability on UPDATE.\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn config/crd/bases/operator.openshift.io_istiocsrs.yaml around lines 1177-1232\nthe CEL immutability rules use has(...) presence checks which incorrectly fail\non CREATE because defaults make has(self.*) true; update those rules to explicit\nempty-value checks so creation with defaults is allowed while preserving\nimmutability on UPDATE: replace the privateKeyAlgorithm rule with a check\nequivalent to oldSelf.privateKeyAlgorithm == '' || self.privateKeyAlgorithm ==\noldSelf.privateKeyAlgorithm, and replace the privateKeySize rule with\noldSelf.privateKeySize == 0 || self.privateKeySize == oldSelf.privateKeySize,\nand ensure the per-field x-kubernetes-validations (oldSelf == '' || self ==\noldSelf and oldSelf == 0 || self == oldSelf) are consistent with these\nexplicit-empty checks.\n```\n\n</details>\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "created_at": "2025-09-30T13:04:24Z", "updated_at": "2025-09-30T13:04:25Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2391373020", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2391373020"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/310#discussion_r2391373020"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/310"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2391373020/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 1177, "original_start_line": 1177, "start_side": "RIGHT", "line": 1232, "original_line": 1232, "side": "RIGHT", "author_association": "NONE", "original_position": 324, "position": 324, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 183, "file_path": "bundle/manifests/cert-manager-operator.clusterserviceversion.yaml", "line_start": 222, "line_end": 222, "diff_context": "", "comment_body": "Would it block users on version 1.13.0 wanting to upgrade to 1.14.0?", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1615503755", "pull_request_review_id": 2080035246, "id": 1615503755, "node_id": "PRRC_kwDOFdFn9s5gSqGL", "diff_hunk": "@@ -219,7 +219,7 @@ metadata:\n     features.operators.openshift.io/token-auth-aws: \"true\"\n     features.operators.openshift.io/token-auth-azure: \"true\"\n     features.operators.openshift.io/token-auth-gcp: \"true\"\n-    olm.skipRange: '>=1.13.0 <1.14.0'\n+    olm.skipRange: '>=1.13.1 <1.14.0'", "path": "bundle/manifests/cert-manager-operator.clusterserviceversion.yaml", "commit_id": "6d91e5b0d94ff8a0df87170e7b1daf46d6e2a628", "original_commit_id": "c19a8953b39c3ee451bc45c49dc472e956dfcb71", "user": {"login": "TrilokGeer", "id": 92382639, "node_id": "U_kgDOBYGlrw", "avatar_url": "https://avatars.githubusercontent.com/u/92382639?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TrilokGeer", "html_url": "https://github.com/TrilokGeer", "followers_url": "https://api.github.com/users/TrilokGeer/followers", "following_url": "https://api.github.com/users/TrilokGeer/following{/other_user}", "gists_url": "https://api.github.com/users/TrilokGeer/gists{/gist_id}", "starred_url": "https://api.github.com/users/TrilokGeer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TrilokGeer/subscriptions", "organizations_url": "https://api.github.com/users/TrilokGeer/orgs", "repos_url": "https://api.github.com/users/TrilokGeer/repos", "events_url": "https://api.github.com/users/TrilokGeer/events{/privacy}", "received_events_url": "https://api.github.com/users/TrilokGeer/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "Would it block users on version 1.13.0 wanting to upgrade to 1.14.0?", "created_at": "2024-05-27T05:49:48Z", "updated_at": "2024-05-27T05:49:54Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/183#discussion_r1615503755", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/183", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1615503755"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/183#discussion_r1615503755"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/183"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1615503755/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 222, "original_line": 222, "side": "RIGHT", "author_association": "MEMBER", "original_position": 5, "position": 5, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 183, "file_path": "bundle/manifests/cert-manager-operator.clusterserviceversion.yaml", "line_start": 222, "line_end": 222, "diff_context": "", "comment_body": "Users will have to upgrade to 1.13.1 before they can upgrade to 1.14.0 (this is in accordance with upgrade paths we've rolled out in the past) i.e. 1.13.0 -> 1.13.1 -> 1.14.0. For users installing the operator with Automatic approval mode, this will be done automatically seamlessly.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1615555257", "pull_request_review_id": 2080117605, "id": 1615555257, "node_id": "PRRC_kwDOFdFn9s5gS2q5", "diff_hunk": "@@ -219,7 +219,7 @@ metadata:\n     features.operators.openshift.io/token-auth-aws: \"true\"\n     features.operators.openshift.io/token-auth-azure: \"true\"\n     features.operators.openshift.io/token-auth-gcp: \"true\"\n-    olm.skipRange: '>=1.13.0 <1.14.0'\n+    olm.skipRange: '>=1.13.1 <1.14.0'", "path": "bundle/manifests/cert-manager-operator.clusterserviceversion.yaml", "commit_id": "6d91e5b0d94ff8a0df87170e7b1daf46d6e2a628", "original_commit_id": "c19a8953b39c3ee451bc45c49dc472e956dfcb71", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "Users will have to upgrade to 1.13.1 before they can upgrade to 1.14.0 (this is in accordance with upgrade paths we've rolled out in the past) i.e. 1.13.0 -> 1.13.1 -> 1.14.0. For users installing the operator with Automatic approval mode, this will be done automatically seamlessly.", "created_at": "2024-05-27T06:51:16Z", "updated_at": "2024-05-27T06:51:16Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/183#discussion_r1615555257", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/183", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1615555257"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/183#discussion_r1615555257"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/183"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1615555257/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 222, "original_line": 222, "side": "RIGHT", "in_reply_to_id": 1615503755, "author_association": "MEMBER", "original_position": 5, "position": 5, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 312, "file_path": "api/operator/v1alpha1/istiocsr_types.go", "line_start": 173, "line_end": null, "diff_context": "", "comment_body": "_\ud83d\udee0\ufe0f Refactor suggestion_\n\n**Tighten validation for ConfigMapReference fields**\n\nPresence doesn\u2019t forbid empty strings. Recommend minimum length for Name and Key, and clarify Key refers to .data (not binaryData).\n\n\n```diff\n type ConfigMapReference struct {\n   // name of the ConfigMap.\n   // +kubebuilder:validation:Required\n+  // +kubebuilder:validation:MinLength=1\n   // +required\n   Name string `json:\"name\"`\n\n   // namespace in which the ConfigMap exists. If empty, ConfigMap will be looked up in the IstioCSR namespace.\n   // +kubebuilder:validation:Optional\n   // +optional\n   Namespace string `json:\"namespace,omitempty\"`\n\n-  // key name holding the required data.\n+  // key in the ConfigMap's data map holding the PEM-encoded CA certificate.\n   // +kubebuilder:validation:Required\n+  // +kubebuilder:validation:MinLength=1\n   // +required\n   Key string `json:\"key\"`\n }\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n// ConfigMapReference holds the details of a configmap.\ntype ConfigMapReference struct {\n\t// name of the ConfigMap.\n\t// +kubebuilder:validation:Required\n\t// +kubebuilder:validation:MinLength=1\n\t// +required\n\tName string `json:\"name\"`\n\n\t// namespace in which the ConfigMap exists. If empty, ConfigMap will be looked up in the IstioCSR namespace.\n\t// +kubebuilder:validation:Optional\n\t// +optional\n\tNamespace string `json:\"namespace,omitempty\"`\n\n\t// key in the ConfigMap's data map holding the PEM-encoded CA certificate.\n\t// +kubebuilder:validation:Required\n\t// +kubebuilder:validation:MinLength=1\n\t// +required\n\tKey string `json:\"key\"`\n}\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn api/operator/v1alpha1/istiocsr_types.go around lines 157 to 173, the\nConfigMapReference struct allows empty strings for required fields; add\nvalidation and clarify the Key semantics. Add\n+kubebuilder:validation:MinLength=1 to the Name and Key fields (and keep\n+required) so empty strings are rejected, and update the Key comment to\nexplicitly state it refers to the ConfigMap's .data map (not .binaryData). Leave\nNamespace as optional but, if you want non-empty when present, consider adding\n+kubebuilder:validation:MinLength=1 to it as well.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:medusa:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2338647171", "pull_request_review_id": 3208908188, "id": 2338647171, "node_id": "PRRC_kwDOFdFn9s6LZOyD", "diff_hunk": "@@ -146,6 +146,30 @@ type CertManagerConfig struct {\n \t// +kubebuilder:validation:Required\n \t// +required\n \tIssuerRef certmanagerv1.ObjectReference `json:\"issuerRef,omitempty\"`\n+\n+\t// istioCACertificate when provided, the operator will use the CA certificate from the specified ConfigMap. If empty, the operator will\n+\t// automatically extract the CA certificate from the Secret containing the istiod certificate obtained from cert-manager.\n+\t// +kubebuilder:validation:Optional\n+\t// +optional\n+\tIstioCACertificate *ConfigMapReference `json:\"istioCACertificate,omitempty\"`\n+}\n+\n+// ConfigMapReference holds the details of a configmap.\n+type ConfigMapReference struct {\n+\t// name of the ConfigMap.\n+\t// +kubebuilder:validation:Required\n+\t// +required\n+\tName string `json:\"name\"`\n+\n+\t// namespace in which the ConfigMap exists. If empty, ConfigMap will be looked up in the IstioCSR namespace.\n+\t// +kubebuilder:validation:Optional\n+\t// +optional\n+\tNamespace string `json:\"namespace,omitempty\"`\n+\n+\t// key name holding the required data.\n+\t// +kubebuilder:validation:Required\n+\t// +required\n+\tKey string `json:\"key\"`\n }", "path": "api/operator/v1alpha1/istiocsr_types.go", "commit_id": "d16684911f9a0ac0d68b245cfb9126a32c64dbe4", "original_commit_id": "dff9e116c309ff12304a24a77babe550d4ec4689", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\ud83d\udee0\ufe0f Refactor suggestion_\n\n**Tighten validation for ConfigMapReference fields**\n\nPresence doesn\u2019t forbid empty strings. Recommend minimum length for Name and Key, and clarify Key refers to .data (not binaryData).\n\n\n```diff\n type ConfigMapReference struct {\n   // name of the ConfigMap.\n   // +kubebuilder:validation:Required\n+  // +kubebuilder:validation:MinLength=1\n   // +required\n   Name string `json:\"name\"`\n\n   // namespace in which the ConfigMap exists. If empty, ConfigMap will be looked up in the IstioCSR namespace.\n   // +kubebuilder:validation:Optional\n   // +optional\n   Namespace string `json:\"namespace,omitempty\"`\n\n-  // key name holding the required data.\n+  // key in the ConfigMap's data map holding the PEM-encoded CA certificate.\n   // +kubebuilder:validation:Required\n+  // +kubebuilder:validation:MinLength=1\n   // +required\n   Key string `json:\"key\"`\n }\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n// ConfigMapReference holds the details of a configmap.\ntype ConfigMapReference struct {\n\t// name of the ConfigMap.\n\t// +kubebuilder:validation:Required\n\t// +kubebuilder:validation:MinLength=1\n\t// +required\n\tName string `json:\"name\"`\n\n\t// namespace in which the ConfigMap exists. If empty, ConfigMap will be looked up in the IstioCSR namespace.\n\t// +kubebuilder:validation:Optional\n\t// +optional\n\tNamespace string `json:\"namespace,omitempty\"`\n\n\t// key in the ConfigMap's data map holding the PEM-encoded CA certificate.\n\t// +kubebuilder:validation:Required\n\t// +kubebuilder:validation:MinLength=1\n\t// +required\n\tKey string `json:\"key\"`\n}\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn api/operator/v1alpha1/istiocsr_types.go around lines 157 to 173, the\nConfigMapReference struct allows empty strings for required fields; add\nvalidation and clarify the Key semantics. Add\n+kubebuilder:validation:MinLength=1 to the Name and Key fields (and keep\n+required) so empty strings are rejected, and update the Key comment to\nexplicitly state it refers to the ConfigMap's .data map (not .binaryData). Leave\nNamespace as optional but, if you want non-empty when present, consider adding\n+kubebuilder:validation:MinLength=1 to it as well.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:medusa:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "created_at": "2025-09-11T05:36:06Z", "updated_at": "2025-09-11T05:36:07Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/312#discussion_r2338647171", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/312", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2338647171"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/312#discussion_r2338647171"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/312"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2338647171/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 157, "start_side": "RIGHT", "line": null, "original_line": 173, "side": "RIGHT", "author_association": "NONE", "original_position": 28, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 312, "file_path": "pkg/controller/istiocsr/test_utils.go", "line_start": 9, "line_end": 9, "diff_context": "", "comment_body": "_\ud83d\udee0\ufe0f Refactor suggestion_\n\n**Add missing import for big.Int generation**\n\nUpcoming fix requires math/big for certificate serial numbers.\n\n\n```diff\n import (\n   \"context\"\n   \"crypto/rand\"\n   \"crypto/rsa\"\n   \"crypto/x509\"\n   \"crypto/x509/pkix\"\n   \"encoding/pem\"\n+  \"math/big\"\n   \"fmt\"\n   \"testing\"\n   \"time\"\n )\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\nimport (\n\t\"context\"\n\t\"crypto/rand\"\n\t\"crypto/rsa\"\n\t\"crypto/x509\"\n\t\"crypto/x509/pkix\"\n\t\"encoding/pem\"\n\t\"math/big\"\n\t\"fmt\"\n\t\"testing\"\n\t\"time\"\n)\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn pkg/controller/istiocsr/test_utils.go around lines 5 to 9, the import block\nis missing the math/big package needed for generating certificate serial\nnumbers; add \"math/big\" to the import list (alongside crypto/rand, crypto/rsa,\ncrypto/x509, crypto/x509/pkix, encoding/pem) so subsequent code that constructs\nbig.Int serial numbers compiles cleanly.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:medusa:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2338647183", "pull_request_review_id": 3208908188, "id": 2338647183, "node_id": "PRRC_kwDOFdFn9s6LZOyP", "diff_hunk": "@@ -2,6 +2,11 @@ package istiocsr\n \n import (\n \t\"context\"\n+\t\"crypto/rand\"\n+\t\"crypto/rsa\"\n+\t\"crypto/x509\"\n+\t\"crypto/x509/pkix\"\n+\t\"encoding/pem\"", "path": "pkg/controller/istiocsr/test_utils.go", "commit_id": "ddf7e7b557fb6a1404848448be11b8b1cff9d55b", "original_commit_id": "dff9e116c309ff12304a24a77babe550d4ec4689", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\ud83d\udee0\ufe0f Refactor suggestion_\n\n**Add missing import for big.Int generation**\n\nUpcoming fix requires math/big for certificate serial numbers.\n\n\n```diff\n import (\n   \"context\"\n   \"crypto/rand\"\n   \"crypto/rsa\"\n   \"crypto/x509\"\n   \"crypto/x509/pkix\"\n   \"encoding/pem\"\n+  \"math/big\"\n   \"fmt\"\n   \"testing\"\n   \"time\"\n )\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\nimport (\n\t\"context\"\n\t\"crypto/rand\"\n\t\"crypto/rsa\"\n\t\"crypto/x509\"\n\t\"crypto/x509/pkix\"\n\t\"encoding/pem\"\n\t\"math/big\"\n\t\"fmt\"\n\t\"testing\"\n\t\"time\"\n)\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn pkg/controller/istiocsr/test_utils.go around lines 5 to 9, the import block\nis missing the math/big package needed for generating certificate serial\nnumbers; add \"math/big\" to the import list (alongside crypto/rand, crypto/rsa,\ncrypto/x509, crypto/x509/pkix, encoding/pem) so subsequent code that constructs\nbig.Int serial numbers compiles cleanly.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:medusa:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "created_at": "2025-09-11T05:36:07Z", "updated_at": "2025-09-11T05:36:08Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/312#discussion_r2338647183", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/312", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2338647183"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/312#discussion_r2338647183"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/312"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2338647183/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 5, "original_start_line": 5, "start_side": "RIGHT", "line": 9, "original_line": 9, "side": "RIGHT", "author_association": "NONE", "original_position": 8, "position": 8, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 312, "file_path": "api/operator/v1alpha1/istiocsr_types.go", "line_start": 158, "line_end": null, "diff_context": "", "comment_body": "I will update the API as per the EP conclusion: https://github.com/openshift/enhancements/pull/1837", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2374588935", "pull_request_review_id": 3261242744, "id": 2374588935, "node_id": "PRRC_kwDOFdFn9s6NiVoH", "diff_hunk": "@@ -146,6 +146,30 @@ type CertManagerConfig struct {\n \t// +kubebuilder:validation:Required\n \t// +required\n \tIssuerRef certmanagerv1.ObjectReference `json:\"issuerRef,omitempty\"`\n+\n+\t// istioCACertificate when provided, the operator will use the CA certificate from the specified ConfigMap. If empty, the operator will\n+\t// automatically extract the CA certificate from the Secret containing the istiod certificate obtained from cert-manager.\n+\t// +kubebuilder:validation:Optional\n+\t// +optional\n+\tIstioCACertificate *ConfigMapReference `json:\"istioCACertificate,omitempty\"`\n+}\n+\n+// ConfigMapReference holds the details of a configmap.\n+type ConfigMapReference struct {", "path": "api/operator/v1alpha1/istiocsr_types.go", "commit_id": "d16684911f9a0ac0d68b245cfb9126a32c64dbe4", "original_commit_id": "d16684911f9a0ac0d68b245cfb9126a32c64dbe4", "user": {"login": "chiragkyal", "id": 43825954, "node_id": "MDQ6VXNlcjQzODI1OTU0", "avatar_url": "https://avatars.githubusercontent.com/u/43825954?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chiragkyal", "html_url": "https://github.com/chiragkyal", "followers_url": "https://api.github.com/users/chiragkyal/followers", "following_url": "https://api.github.com/users/chiragkyal/following{/other_user}", "gists_url": "https://api.github.com/users/chiragkyal/gists{/gist_id}", "starred_url": "https://api.github.com/users/chiragkyal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chiragkyal/subscriptions", "organizations_url": "https://api.github.com/users/chiragkyal/orgs", "repos_url": "https://api.github.com/users/chiragkyal/repos", "events_url": "https://api.github.com/users/chiragkyal/events{/privacy}", "received_events_url": "https://api.github.com/users/chiragkyal/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "I will update the API as per the EP conclusion: https://github.com/openshift/enhancements/pull/1837", "created_at": "2025-09-24T06:35:48Z", "updated_at": "2025-09-24T06:35:48Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/312#discussion_r2374588935", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/312", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2374588935"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/312#discussion_r2374588935"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/312"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2374588935/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 158, "side": "RIGHT", "author_association": "MEMBER", "original_position": 13, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 312, "file_path": "pkg/controller/istiocsr/deployments.go", "line_start": 318, "line_end": null, "diff_context": "", "comment_body": "This should be done before validations, so that validation failure fix will trigger a reconciliation.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2400926027", "pull_request_review_id": 3297562090, "id": 2400926027, "node_id": "PRRC_kwDOFdFn9s6PGzlL", "diff_hunk": "@@ -262,6 +264,75 @@ func (r *Reconciler) assertIssuerRefExists(istiocsr *v1alpha1.IstioCSR) error {\n }\n \n func (r *Reconciler) updateVolumes(deployment *appsv1.Deployment, istiocsr *v1alpha1.IstioCSR, resourceLabels map[string]string) error {\n+\t// Use user-configured CA certificate if provided\n+\tif istiocsr.Spec.IstioCSRConfig.CertManager.IstioCACertificate != nil {\n+\t\tif err := r.handleUserProvidedCA(deployment, istiocsr, resourceLabels); err != nil {\n+\t\t\treturn FromError(err, \"failed to validate and mount CA certificate ConfigMap\")\n+\t\t}\n+\t\treturn nil\n+\t}\n+\n+\t// Fall back to issuer-based CA certificate if CA certificate is not configured\n+\t// Handle issuer-based CA configuration\n+\tif err := r.handleIssuerBasedCA(deployment, istiocsr, resourceLabels); err != nil {\n+\t\treturn err\n+\t}\n+\n+\treturn nil\n+}\n+\n+func (r *Reconciler) handleUserProvidedCA(deployment *appsv1.Deployment, istiocsr *v1alpha1.IstioCSR, resourceLabels map[string]string) error {\n+\tcaCertConfig := istiocsr.Spec.IstioCSRConfig.CertManager.IstioCACertificate\n+\tif caCertConfig == nil {\n+\t\treturn NewIrrecoverableError(fmt.Errorf(\"CA certificate configuration is nil\"), \"CA certificate validation failed\")\n+\t}\n+\n+\t// Determine the namespace - use specified namespace or default to IstioCSR namespace\n+\tnamespace := caCertConfig.Namespace\n+\tif namespace == \"\" {\n+\t\tnamespace = istiocsr.GetNamespace()\n+\t}\n+\n+\t// Validate that the source ConfigMap exists and contains the specified key\n+\tsourceConfigMapKey := types.NamespacedName{\n+\t\tName:      caCertConfig.Name,\n+\t\tNamespace: namespace,\n+\t}\n+\n+\tsourceConfigMap := &corev1.ConfigMap{}\n+\tif err := r.Get(r.ctx, sourceConfigMapKey, sourceConfigMap); err != nil {\n+\t\treturn NewIrrecoverableError(err, \"failed to fetch CA certificate ConfigMap %s/%s\", sourceConfigMapKey.Namespace, sourceConfigMapKey.Name)\n+\t}\n+\n+\t// Validate that the specified key exists in the ConfigMap\n+\tif _, exists := sourceConfigMap.Data[caCertConfig.Key]; !exists {\n+\t\treturn NewIrrecoverableError(fmt.Errorf(\"key %q not found in ConfigMap %s/%s\", caCertConfig.Key, sourceConfigMapKey.Namespace, sourceConfigMapKey.Name), \"CA certificate ConfigMap %s/%s does not contain required key %q\", sourceConfigMapKey.Namespace, sourceConfigMapKey.Name, caCertConfig.Key)\n+\t}\n+\n+\t// Validate that the key contains PEM-formatted content\n+\tpemData := sourceConfigMap.Data[caCertConfig.Key]\n+\tif err := r.validatePEMData(pemData); err != nil {\n+\t\treturn NewIrrecoverableError(err, \"invalid PEM data in CA certificate ConfigMap %s/%s key %q\", sourceConfigMapKey.Namespace, sourceConfigMapKey.Name, caCertConfig.Key)\n+\t}\n+\n+\t// Add watch label to the source ConfigMap for tracking", "path": "pkg/controller/istiocsr/deployments.go", "commit_id": "83d83dc45a8cb17b139b22dac9208fe01eab0798", "original_commit_id": "d16684911f9a0ac0d68b245cfb9126a32c64dbe4", "user": {"login": "bharath-b-rh", "id": 92782575, "node_id": "U_kgDOBYe_7w", "avatar_url": "https://avatars.githubusercontent.com/u/92782575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bharath-b-rh", "html_url": "https://github.com/bharath-b-rh", "followers_url": "https://api.github.com/users/bharath-b-rh/followers", "following_url": "https://api.github.com/users/bharath-b-rh/following{/other_user}", "gists_url": "https://api.github.com/users/bharath-b-rh/gists{/gist_id}", "starred_url": "https://api.github.com/users/bharath-b-rh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bharath-b-rh/subscriptions", "organizations_url": "https://api.github.com/users/bharath-b-rh/orgs", "repos_url": "https://api.github.com/users/bharath-b-rh/repos", "events_url": "https://api.github.com/users/bharath-b-rh/events{/privacy}", "received_events_url": "https://api.github.com/users/bharath-b-rh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "This should be done before validations, so that validation failure fix will trigger a reconciliation.", "created_at": "2025-10-03T06:23:29Z", "updated_at": "2025-10-03T06:38:49Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/312#discussion_r2400926027", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/312", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2400926027"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/312#discussion_r2400926027"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/312"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2400926027/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 318, "side": "RIGHT", "author_association": "MEMBER", "original_position": 73, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 312, "file_path": "test/e2e/testdata/istio/istiocsr_with_ca_certificate_template.yaml", "line_start": 18, "line_end": 18, "diff_context": "", "comment_body": "@bharath-b-rh Thanks for confirming! I'll update the suggestion to include quoted values for better safety and readability:\n\n```yaml\n      istioCACertificate:\n        name: \"{{ .ConfigMapName }}\"\n{{- if .CustomNamespace }}\n        namespace: \"{{ .CustomNamespace }}\"\n{{- end }}\n        key: \"{{ .ConfigMapKey }}\"\n```\n\nThis ensures:\n1. The conditional is on separate lines (fixing the YAML syntax error)\n2. All template values are quoted for consistency and safety\n3. Proper indentation is maintained\n\n---\n\n<!-- This is an auto-generated comment: tweet message by coderabbit.ai -->\n\nIf you found this review helpful, would you consider giving us a shout-out on [X](https://twitter.com/intent/tweet?related=CodeRabbitAI&text=YAML%20fix%3A%20move%20the%20Helm%20template%20conditional%20onto%20its%20own%20lines%20so%20keys%20are%20valid%20(fixes%20yamllint%20error)%20and%20quote%20values%20for%20safety.%20Smart%2C%20small%20change%20%E2%80%94%20try%20%40coderabbitai%20%F0%9F%94%A7%E2%9C%85&url=https%3A%2F%2Fgithub.com%2Fopenshift%2Fcert-manager-operator%2Fpull%2F312%23discussion_r2348695335)?\n\nThank you for using CodeRabbit!\n\n<!-- end of auto-generated comment: tweet message by coderabbit.ai -->\n\n\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2400953284", "pull_request_review_id": 3297630136, "id": 2400953284, "node_id": "PRRC_kwDOFdFn9s6PG6PE", "diff_hunk": "@@ -0,0 +1,20 @@\n+apiVersion: operator.openshift.io/v1alpha1\n+kind: IstioCSR\n+metadata:\n+  name: default\n+  namespace: istio-system\n+spec:\n+  istioCSRConfig:\n+    certManager:\n+      issuerRef:\n+        name: istio-ca\n+        kind: Issuer\n+        group: cert-manager.io\n+      istioCACertificate:\n+        name: {{.ConfigMapName}}{{- if .CustomNamespace}}\n+        namespace: {{.CustomNamespace}}{{- end}}\n+        key: {{.ConfigMapKey}}", "path": "test/e2e/testdata/istio/istiocsr_with_ca_certificate_template.yaml", "commit_id": "ddf7e7b557fb6a1404848448be11b8b1cff9d55b", "original_commit_id": "6820b96fa81716a4097b6f2129f64c5e0d2c12c6", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "@bharath-b-rh Thanks for confirming! I'll update the suggestion to include quoted values for better safety and readability:\n\n```yaml\n      istioCACertificate:\n        name: \"{{ .ConfigMapName }}\"\n{{- if .CustomNamespace }}\n        namespace: \"{{ .CustomNamespace }}\"\n{{- end }}\n        key: \"{{ .ConfigMapKey }}\"\n```\n\nThis ensures:\n1. The conditional is on separate lines (fixing the YAML syntax error)\n2. All template values are quoted for consistency and safety\n3. Proper indentation is maintained\n\n---\n\n<!-- This is an auto-generated comment: tweet message by coderabbit.ai -->\n\nIf you found this review helpful, would you consider giving us a shout-out on [X](https://twitter.com/intent/tweet?related=CodeRabbitAI&text=YAML%20fix%3A%20move%20the%20Helm%20template%20conditional%20onto%20its%20own%20lines%20so%20keys%20are%20valid%20(fixes%20yamllint%20error)%20and%20quote%20values%20for%20safety.%20Smart%2C%20small%20change%20%E2%80%94%20try%20%40coderabbitai%20%F0%9F%94%A7%E2%9C%85&url=https%3A%2F%2Fgithub.com%2Fopenshift%2Fcert-manager-operator%2Fpull%2F312%23discussion_r2348695335)?\n\nThank you for using CodeRabbit!\n\n<!-- end of auto-generated comment: tweet message by coderabbit.ai -->\n\n\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "created_at": "2025-10-03T06:41:26Z", "updated_at": "2025-10-03T06:41:26Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/312#discussion_r2400953284", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/312", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2400953284"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/312#discussion_r2400953284"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/312"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2400953284/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 13, "original_start_line": 13, "start_side": "RIGHT", "line": 18, "original_line": 18, "side": "RIGHT", "in_reply_to_id": 2348695335, "author_association": "NONE", "original_position": 16, "position": 18, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 312, "file_path": "pkg/controller/istiocsr/deployments.go", "line_start": 525, "line_end": null, "diff_context": "", "comment_body": "> nit: I don't think we need to check the key usage, which will be verified by the cert-manager. \r\n\r\nTrue, however I think early validation provides much better UX than runtime failures. And the validation is lightweight and doesn't impact performance and also it's consistent with the other CA validations in this function. So if there are no major concerns, we can keep it as is. \r\n\r\n", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2413615230", "pull_request_review_id": 3314475313, "id": 2413615230, "node_id": "PRRC_kwDOFdFn9s6P3Nh-", "diff_hunk": "@@ -401,25 +479,64 @@ func (r *Reconciler) createCAConfigMap(istiocsr *v1alpha1.IstioCSR, issuerConfig\n \t} else {\n \t\tr.log.V(4).Info(\"configmap resource already exists and is in expected state\", \"name\", configmapKey)\n \t}\n+\n \tif !exist {\n \t\tif err := r.Create(r.ctx, desired); err != nil {\n \t\t\treturn fmt.Errorf(\"failed to create %s configmap resource: %w\", configmapKey, err)\n \t\t}\n \t\tr.eventRecorder.Eventf(istiocsr, corev1.EventTypeNormal, \"Reconciled\", \"configmap resource %s created\", configmapKey)\n \t}\n+\n+\treturn nil\n+}\n+\n+func (r *Reconciler) validatePEMData(pemData string) error {\n+\tif pemData == \"\" {\n+\t\treturn fmt.Errorf(\"PEM data is empty\")\n+\t}\n+\n+\t// Parse the first certificate from PEM data\n+\tblock, _ := pem.Decode([]byte(pemData))\n+\tif block == nil {\n+\t\treturn fmt.Errorf(\"no valid PEM data found\")\n+\t}\n+\n+\tif block.Type != \"CERTIFICATE\" {\n+\t\treturn fmt.Errorf(\"PEM block is not a certificate, found: %s\", block.Type)\n+\t}\n+\n+\tcert, err := x509.ParseCertificate(block.Bytes)\n+\tif err != nil {\n+\t\treturn fmt.Errorf(\"failed to parse certificate: %w\", err)\n+\t}\n+\n+\tif !cert.IsCA {\n+\t\treturn fmt.Errorf(\"certificate is not a CA certificate\")\n+\t}\n+\n+\tif !cert.BasicConstraintsValid {\n+\t\treturn fmt.Errorf(\"certificate does not have valid Basic Constraints extension\")\n+\t}\n+\n+\t// Check Key Usage for certificate signing\n+\tif cert.KeyUsage&x509.KeyUsageCertSign == 0 {\n+\t\treturn fmt.Errorf(\"certificate does not have Certificate Sign key usage\")\n+\t}\n+", "path": "pkg/controller/istiocsr/deployments.go", "commit_id": "83d83dc45a8cb17b139b22dac9208fe01eab0798", "original_commit_id": "d16684911f9a0ac0d68b245cfb9126a32c64dbe4", "user": {"login": "chiragkyal", "id": 43825954, "node_id": "MDQ6VXNlcjQzODI1OTU0", "avatar_url": "https://avatars.githubusercontent.com/u/43825954?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chiragkyal", "html_url": "https://github.com/chiragkyal", "followers_url": "https://api.github.com/users/chiragkyal/followers", "following_url": "https://api.github.com/users/chiragkyal/following{/other_user}", "gists_url": "https://api.github.com/users/chiragkyal/gists{/gist_id}", "starred_url": "https://api.github.com/users/chiragkyal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chiragkyal/subscriptions", "organizations_url": "https://api.github.com/users/chiragkyal/orgs", "repos_url": "https://api.github.com/users/chiragkyal/repos", "events_url": "https://api.github.com/users/chiragkyal/events{/privacy}", "received_events_url": "https://api.github.com/users/chiragkyal/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "> nit: I don't think we need to check the key usage, which will be verified by the cert-manager. \r\n\r\nTrue, however I think early validation provides much better UX than runtime failures. And the validation is lightweight and doesn't impact performance and also it's consistent with the other CA validations in this function. So if there are no major concerns, we can keep it as is. \r\n\r\n", "created_at": "2025-10-08T11:57:59Z", "updated_at": "2025-10-08T11:57:59Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/312#discussion_r2413615230", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/312", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2413615230"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/312#discussion_r2413615230"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/312"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2413615230/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 513, "start_side": "RIGHT", "line": null, "original_line": 525, "side": "RIGHT", "in_reply_to_id": 2400948982, "author_association": "MEMBER", "original_position": 208, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 312, "file_path": "pkg/controller/istiocsr/deployments.go", "line_start": 323, "line_end": null, "diff_context": "", "comment_body": "Added a detailed reasoning about this design choice. ", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2413740374", "pull_request_review_id": 3314651578, "id": 2413740374, "node_id": "PRRC_kwDOFdFn9s6P3sFW", "diff_hunk": "@@ -262,6 +264,75 @@ func (r *Reconciler) assertIssuerRefExists(istiocsr *v1alpha1.IstioCSR) error {\n }\n \n func (r *Reconciler) updateVolumes(deployment *appsv1.Deployment, istiocsr *v1alpha1.IstioCSR, resourceLabels map[string]string) error {\n+\t// Use user-configured CA certificate if provided\n+\tif istiocsr.Spec.IstioCSRConfig.CertManager.IstioCACertificate != nil {\n+\t\tif err := r.handleUserProvidedCA(deployment, istiocsr, resourceLabels); err != nil {\n+\t\t\treturn FromError(err, \"failed to validate and mount CA certificate ConfigMap\")\n+\t\t}\n+\t\treturn nil\n+\t}\n+\n+\t// Fall back to issuer-based CA certificate if CA certificate is not configured\n+\t// Handle issuer-based CA configuration\n+\tif err := r.handleIssuerBasedCA(deployment, istiocsr, resourceLabels); err != nil {\n+\t\treturn err\n+\t}\n+\n+\treturn nil\n+}\n+\n+func (r *Reconciler) handleUserProvidedCA(deployment *appsv1.Deployment, istiocsr *v1alpha1.IstioCSR, resourceLabels map[string]string) error {\n+\tcaCertConfig := istiocsr.Spec.IstioCSRConfig.CertManager.IstioCACertificate\n+\tif caCertConfig == nil {\n+\t\treturn NewIrrecoverableError(fmt.Errorf(\"CA certificate configuration is nil\"), \"CA certificate validation failed\")\n+\t}\n+\n+\t// Determine the namespace - use specified namespace or default to IstioCSR namespace\n+\tnamespace := caCertConfig.Namespace\n+\tif namespace == \"\" {\n+\t\tnamespace = istiocsr.GetNamespace()\n+\t}\n+\n+\t// Validate that the source ConfigMap exists and contains the specified key\n+\tsourceConfigMapKey := types.NamespacedName{\n+\t\tName:      caCertConfig.Name,\n+\t\tNamespace: namespace,\n+\t}\n+\n+\tsourceConfigMap := &corev1.ConfigMap{}\n+\tif err := r.Get(r.ctx, sourceConfigMapKey, sourceConfigMap); err != nil {\n+\t\treturn NewIrrecoverableError(err, \"failed to fetch CA certificate ConfigMap %s/%s\", sourceConfigMapKey.Namespace, sourceConfigMapKey.Name)\n+\t}\n+\n+\t// Validate that the specified key exists in the ConfigMap\n+\tif _, exists := sourceConfigMap.Data[caCertConfig.Key]; !exists {\n+\t\treturn NewIrrecoverableError(fmt.Errorf(\"key %q not found in ConfigMap %s/%s\", caCertConfig.Key, sourceConfigMapKey.Namespace, sourceConfigMapKey.Name), \"CA certificate ConfigMap %s/%s does not contain required key %q\", sourceConfigMapKey.Namespace, sourceConfigMapKey.Name, caCertConfig.Key)\n+\t}\n+\n+\t// Validate that the key contains PEM-formatted content\n+\tpemData := sourceConfigMap.Data[caCertConfig.Key]\n+\tif err := r.validatePEMData(pemData); err != nil {\n+\t\treturn NewIrrecoverableError(err, \"invalid PEM data in CA certificate ConfigMap %s/%s key %q\", sourceConfigMapKey.Namespace, sourceConfigMapKey.Name, caCertConfig.Key)\n+\t}\n+\n+\t// Add watch label to the source ConfigMap for tracking\n+\tif err := r.updateWatchLabel(sourceConfigMap, istiocsr); err != nil {\n+\t\treturn FromClientError(err, \"failed to update watch label on CA certificate ConfigMap %s/%s\", sourceConfigMapKey.Namespace, sourceConfigMapKey.Name)\n+\t}\n+\n+\t// Create a copy of the ConfigMap in the IstioCSR namespace", "path": "pkg/controller/istiocsr/deployments.go", "commit_id": "83d83dc45a8cb17b139b22dac9208fe01eab0798", "original_commit_id": "d16684911f9a0ac0d68b245cfb9126a32c64dbe4", "user": {"login": "chiragkyal", "id": 43825954, "node_id": "MDQ6VXNlcjQzODI1OTU0", "avatar_url": "https://avatars.githubusercontent.com/u/43825954?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chiragkyal", "html_url": "https://github.com/chiragkyal", "followers_url": "https://api.github.com/users/chiragkyal/followers", "following_url": "https://api.github.com/users/chiragkyal/following{/other_user}", "gists_url": "https://api.github.com/users/chiragkyal/gists{/gist_id}", "starred_url": "https://api.github.com/users/chiragkyal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chiragkyal/subscriptions", "organizations_url": "https://api.github.com/users/chiragkyal/orgs", "repos_url": "https://api.github.com/users/chiragkyal/repos", "events_url": "https://api.github.com/users/chiragkyal/events{/privacy}", "received_events_url": "https://api.github.com/users/chiragkyal/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "Added a detailed reasoning about this design choice. ", "created_at": "2025-10-08T12:45:45Z", "updated_at": "2025-10-08T12:45:45Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/312#discussion_r2413740374", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/312", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2413740374"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/312#discussion_r2413740374"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/312"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2413740374/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 323, "side": "RIGHT", "in_reply_to_id": 2400965713, "author_association": "MEMBER", "original_position": 78, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 312, "file_path": "pkg/controller/istiocsr/deployments_test.go", "line_start": 519, "line_end": 519, "diff_context": "", "comment_body": "<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n\ud83c\udfc1 Script executed:\n```\n#!/bin/bash\n# Search for the error message that contains \"failed to update\" and \"resource with watch label\"\nrg -n -C5 'failed to update.*resource with watch label' pkg/controller/istiocsr/deployments.go\n```\n\nLength of output: 443\n\n---\n\n\n\n</details>\n\n@chiragkyal You're absolutely right! Looking at the error message construction in `deployments.go` line 584:\n\n```go\nreturn fmt.Errorf(\"failed to update %s resource with watch label: %w\", obj.GetName(), err)\n```\n\nWhen `obj.GetName()` returns an empty string, the format string produces:\n- `\"failed to update \"` (with trailing space)\n- `\"\"` (empty name)\n- `\" resource with watch label: ...\"` (with leading space)\n\nThis results in the double space: `\"failed to update  resource with watch label: ...\"`\n\nThe test expectation accurately reflects the actual error message format when the object name is empty, so the double space is correct and intentional. Thank you for the clarification!\n\n---\n\n<details>\n<summary>\ud83e\uddec Code Graph Analysis Results</summary>\n\n[File: pkg/controller/istiocsr/fakes/fake_ctrl_client.go, lines: 12-135]\n```\nFakeCtrlClient struct {\n\tCreateStub        func(context.Context, client.Object, ...client.CreateOption) error\n\tcreateMutex       sync.RWMutex\n\tcreateArgsForCall []struct {\n\t\targ1 context.Context\n\t\targ2 client.Object\n\t\targ3 []client.CreateOption\n\t}\n\tcreateReturns struct {\n\t\tresult1 error\n\t}\n\tcreateReturnsOnCall map[int]struct {\n\t\tresult1 error\n\t}\n\tDeleteStub        func(context.Context, client.Object, ...client.DeleteOption) error\n\tdeleteMutex       sync.RWMutex\n\tdeleteArgsForCall []struct {\n\t\targ1 context.Context\n\t\targ2 client.Object\n\t\targ3 []client.DeleteOption\n\t}\n\tdeleteReturns struct {\n\t\tresult1 error\n\t}\n\tdeleteReturnsOnCall map[int]struct {\n\t\tresult1 error\n\t}\n\tExistsStub        func(context.Context, types.NamespacedName, client.Object) (bool, error)\n\texistsMutex       sync.RWMutex\n\texistsArgsForCall []struct {\n\t\targ1 context.Context\n\t\targ2 types.NamespacedName\n\t\targ3 client.Object\n\t}\n\texistsReturns struct {\n\t\tresult1 bool\n\t\tresult2 error\n\t}\n\texistsReturnsOnCall map[int]struct {\n\t\tresult1 bool\n\t\tresult2 error\n\t}\n\tGetStub        func(context.Context, types.NamespacedName, client.Object) error\n\tgetMutex       sync.RWMutex\n\tgetArgsForCall []struct {\n\t\targ1 context.Context\n\t\targ2 types.NamespacedName\n\t\targ3 client.Object\n\t}\n\tgetReturns struct {\n\t\tresult1 error\n\t}\n\tgetReturnsOnCall map[int]struct {\n\t\tresult1 error\n\t}\n\tListStub        func(context.Context, client.ObjectList, ...client.ListOption) error\n\tlistMutex       sync.RWMutex\n\tlistArgsForCall []struct {\n\t\targ1 context.Context\n\t\targ2 client.ObjectList\n\t\targ3 []client.ListOption\n\t}\n\tlistReturns struct {\n\t\tresult1 error\n\t}\n\tlistReturnsOnCall map[int]struct {\n\t\tresult1 error\n\t}\n\tPatchStub        func(context.Context, client.Object, client.Patch, ...client.PatchOption) error\n\tpatchMutex       sync.RWMutex\n\tpatchArgsForCall []struct {\n\t\targ1 context.Context\n\t\targ2 client.Object\n\t\targ3 client.Patch\n\t\targ4 []client.PatchOption\n\t}\n\tpatchReturns struct {\n\t\tresult1 error\n\t}\n\tpatchReturnsOnCall map[int]struct {\n\t\tresult1 error\n\t}\n\tStatusUpdateStub        func(context.Context, client.Object, ...client.SubResourceUpdateOption) error\n\tstatusUpdateMutex       sync.RWMutex\n\tstatusUpdateArgsForCall []struct {\n\t\targ1 context.Context\n\t\targ2 client.Object\n\t\targ3 []client.SubResourceUpdateOption\n\t}\n\tstatusUpdateReturns struct {\n\t\tresult1 error\n\t}\n\tstatusUpdateReturnsOnCall map[int]struct {\n\t\tresult1 error\n\t}\n\tUpdateStub        func(context.Context, client.Object, ...client.UpdateOption) error\n\tupdateMutex       sync.RWMutex\n\tupdateArgsForCall []struct {\n\t\targ1 context.Context\n\t\targ2 client.Object\n\t\targ3 []client.UpdateOption\n\t}\n\tupdateReturns struct {\n\t\tresult1 error\n\t}\n\tupdateReturnsOnCall map[int]struct {\n\t\tresult1 error\n\t}\n\tUpdateWithRetryStub        func(context.Context, client.Object, ...client.UpdateOption) error\n\tupdateWithRetryMutex       sync.RWMutex\n\tupdateWithRetryArgsForCall []struct {\n\t\targ1 context.Context\n\t\targ2 client.Object\n\t\targ3 []client.UpdateOption\n\t}\n\tupdateWithRetryReturns struct {\n\t\tresult1 error\n\t}\n\tupdateWithRetryReturnsOnCall map[int]struct {\n\t\tresult1 error\n\t}\n\tinvocations      map[string][][]interface{}\n\tinvocationsMutex sync.RWMutex\n}\n```\n\n[File: api/operator/v1alpha1/istiocsr_types.go, lines: 45-61]\n```\nIstioCSR struct {\n\tmetav1.TypeMeta `json:\",inline\"`\n\n\t// metadata is the standard object's metadata.\n\t// More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata\n\tmetav1.ObjectMeta `json:\"metadata,omitempty\"`\n\n\t// spec is the specification of the desired behavior of the IstioCSR.\n\t// +kubebuilder:validation:Required\n\t// +required\n\tSpec IstioCSRSpec `json:\"spec\"`\n\n\t// status is the most recently observed status of the IstioCSR.\n\t// +kubebuilder:validation:Optional\n\t// +optional\n\tStatus IstioCSRStatus `json:\"status,omitempty\"`\n}\n```\n\n[File: api/operator/v1alpha1/istiocsr_types.go, lines: 77-156]\n```\nIstioCSRConfig struct {\n\t// logLevel supports a value range as per [Kubernetes logging guidelines](https://github.com/kubernetes/community/blob/master/contributors/devel/sig-instrumentation/logging.md#what-method-to-use).\n\t// +kubebuilder:default:=1\n\t// +kubebuilder:validation:Minimum:=1\n\t// +kubebuilder:validation:Maximum:=5\n\t// +kubebuilder:validation:Optional\n\t// +optional\n\tLogLevel int32 `json:\"logLevel,omitempty\"`\n\n\t// logFormat specifies the output format for istio-csr agent logging.\n\t// Supported log formats are text and json.\n\t// +kubebuilder:validation:Enum:=\"text\";\"json\"\n\t// +kubebuilder:default:=\"text\"\n\t// +kubebuilder:validation:Optional\n\t// +optional\n\tLogFormat string `json:\"logFormat,omitempty\"`\n\n\t// Istio-csr creates a ConfigMap named `istio-ca-root-cert` containing the root CA certificate, which the Istio data plane uses to verify server certificates. Its default behavior is to create and monitor ConfigMaps in all namespaces.\n\t// The istioDataPlaneNamespaceSelector restricts the namespaces where the ConfigMap is created by using label selectors, such as maistra.io/member-of=istio-system. This selector is also attached to all desired namespaces that are part of the data plane.\n\t// This field can have a maximum of 4096 characters.\n\t// +kubebuilder:example:=\"maistra.io/member-of=istio-system\"\n\t// +kubebuilder:validation:MinLength:=0\n\t// +kubebuilder:validation:MaxLength:=4096\n\t// +kubebuilder:validation:Optional\n\t// +optional\n\tIstioDataPlaneNamespaceSelector string `json:\"istioDataPlaneNamespaceSelector,omitempty\"`\n\n\t// certManager is for configuring cert-manager specifics.\n\t// +kubebuilder:validation:Required\n\t// +required\n\tCertManager CertManagerConfig `json:\"certManager\"`\n\n\t// istiodTLSConfig is for configuring istiod certificate specifics.\n\t// +kubebuilder:validation:Required\n\t// +required\n\tIstiodTLSConfig IstiodTLSConfig `json:\"istiodTLSConfig\"`\n\n\t// server is for configuring the server endpoint used by istio for obtaining the certificates.\n\t// +kubebuilder:validation:Optional\n\t// +optional\n\tServer *ServerConfig `json:\"server,omitempty\"`\n\n\t// istio is for configuring the istio specifics.\n\t// +kubebuilder:validation:Required\n\t// +required\n\tIstio IstioConfig `json:\"istio\"`\n\n\t// resources is for defining the resource requirements.\n\t// Cannot be updated.\n\t// ref: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n\t// +kubebuilder:validation:Optional\n\t// +optional\n\tResources corev1.ResourceRequirements `json:\"resources,omitempty\"`\n\n\t// affinity is for setting scheduling affinity rules.\n\t// ref: https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/\n\t// +kubebuilder:validation:Optional\n\t// +optional\n\tAffinity *corev1.Affinity `json:\"affinity,omitempty\"`\n\n\t// tolerations is for setting the pod tolerations.\n\t// This field can have a maximum of 50 entries.\n\t// ref: https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/\n\t// +listType=atomic\n\t// +kubebuilder:validation:MinItems:=0\n\t// +kubebuilder:validation:MaxItems:=50\n\t// +kubebuilder:validation:Optional\n\t// +optional\n\tTolerations []corev1.Toleration `json:\"tolerations,omitempty\"`\n\n\t// nodeSelector is for defining the scheduling criteria using node labels.\n\t// This field can have a maximum of 50 entries.\n\t// ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/\n\t// +mapType=atomic\n\t// +kubebuilder:validation:MinProperties:=0\n\t// +kubebuilder:validation:MaxProperties:=50\n\t// +kubebuilder:validation:Optional\n\t// +optional\n\tNodeSelector map[string]string `json:\"nodeSelector,omitempty\"`\n}\n```\n\n[File: api/operator/v1alpha1/istiocsr_types.go, lines: 252-270]\n```\nServerConfig struct {\n\t// clusterID is the Istio cluster ID used to verify incoming CSRs.\n\t// This field can have a maximum of 253 characters.\n\t// +kubebuilder:default:=\"Kubernetes\"\n\t// +kubebuilder:validation:MinLength:=0\n\t// +kubebuilder:validation:MaxLength:=253\n\t// +kubebuilder:validation:Optional\n\t// +optional\n\tClusterID string `json:\"clusterID,omitempty\"`\n\n\t// port to serve the istio-csr gRPC service.\n\t// +kubebuilder:default:=443\n\t// +kubebuilder:validation:Minimum:=1\n\t// +kubebuilder:validation:Maximum:=65535\n\t// +kubebuilder:validation:XValidation:rule=\"oldSelf == 0 || self == oldSelf\",message=\"port is immutable once set\"\n\t// +kubebuilder:validation:Optional\n\t// +optional\n\tPort int32 `json:\"port,omitempty\"`\n}\n```\n\n</details>\n\n\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2413745527", "pull_request_review_id": 3314658525, "id": 2413745527, "node_id": "PRRC_kwDOFdFn9s6P3tV3", "diff_hunk": "@@ -447,7 +447,7 @@ func TestCreateOrApplyDeployments(t *testing.T) {\n \t\t\t\t\treturn nil\n \t\t\t\t})\n \t\t\t},\n-\t\t\twantErr: `failed to generate deployment resource for creation in istiocsr-test-ns: failed to update volume istiocsr-test-ns/istiocsr-test-resource: failed to create CA ConfigMap: failed to update  secret with custom watch label: no access`,\n+\t\t\twantErr: `failed to generate deployment resource for creation in istiocsr-test-ns: failed to update volume istiocsr-test-ns/istiocsr-test-resource: failed to create CA ConfigMap: failed to update  resource with watch label: no access`,", "path": "pkg/controller/istiocsr/deployments_test.go", "commit_id": "ddf7e7b557fb6a1404848448be11b8b1cff9d55b", "original_commit_id": "83d83dc45a8cb17b139b22dac9208fe01eab0798", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n\ud83c\udfc1 Script executed:\n```\n#!/bin/bash\n# Search for the error message that contains \"failed to update\" and \"resource with watch label\"\nrg -n -C5 'failed to update.*resource with watch label' pkg/controller/istiocsr/deployments.go\n```\n\nLength of output: 443\n\n---\n\n\n\n</details>\n\n@chiragkyal You're absolutely right! Looking at the error message construction in `deployments.go` line 584:\n\n```go\nreturn fmt.Errorf(\"failed to update %s resource with watch label: %w\", obj.GetName(), err)\n```\n\nWhen `obj.GetName()` returns an empty string, the format string produces:\n- `\"failed to update \"` (with trailing space)\n- `\"\"` (empty name)\n- `\" resource with watch label: ...\"` (with leading space)\n\nThis results in the double space: `\"failed to update  resource with watch label: ...\"`\n\nThe test expectation accurately reflects the actual error message format when the object name is empty, so the double space is correct and intentional. Thank you for the clarification!\n\n---\n\n<details>\n<summary>\ud83e\uddec Code Graph Analysis Results</summary>\n\n[File: pkg/controller/istiocsr/fakes/fake_ctrl_client.go, lines: 12-135]\n```\nFakeCtrlClient struct {\n\tCreateStub        func(context.Context, client.Object, ...client.CreateOption) error\n\tcreateMutex       sync.RWMutex\n\tcreateArgsForCall []struct {\n\t\targ1 context.Context\n\t\targ2 client.Object\n\t\targ3 []client.CreateOption\n\t}\n\tcreateReturns struct {\n\t\tresult1 error\n\t}\n\tcreateReturnsOnCall map[int]struct {\n\t\tresult1 error\n\t}\n\tDeleteStub        func(context.Context, client.Object, ...client.DeleteOption) error\n\tdeleteMutex       sync.RWMutex\n\tdeleteArgsForCall []struct {\n\t\targ1 context.Context\n\t\targ2 client.Object\n\t\targ3 []client.DeleteOption\n\t}\n\tdeleteReturns struct {\n\t\tresult1 error\n\t}\n\tdeleteReturnsOnCall map[int]struct {\n\t\tresult1 error\n\t}\n\tExistsStub        func(context.Context, types.NamespacedName, client.Object) (bool, error)\n\texistsMutex       sync.RWMutex\n\texistsArgsForCall []struct {\n\t\targ1 context.Context\n\t\targ2 types.NamespacedName\n\t\targ3 client.Object\n\t}\n\texistsReturns struct {\n\t\tresult1 bool\n\t\tresult2 error\n\t}\n\texistsReturnsOnCall map[int]struct {\n\t\tresult1 bool\n\t\tresult2 error\n\t}\n\tGetStub        func(context.Context, types.NamespacedName, client.Object) error\n\tgetMutex       sync.RWMutex\n\tgetArgsForCall []struct {\n\t\targ1 context.Context\n\t\targ2 types.NamespacedName\n\t\targ3 client.Object\n\t}\n\tgetReturns struct {\n\t\tresult1 error\n\t}\n\tgetReturnsOnCall map[int]struct {\n\t\tresult1 error\n\t}\n\tListStub        func(context.Context, client.ObjectList, ...client.ListOption) error\n\tlistMutex       sync.RWMutex\n\tlistArgsForCall []struct {\n\t\targ1 context.Context\n\t\targ2 client.ObjectList\n\t\targ3 []client.ListOption\n\t}\n\tlistReturns struct {\n\t\tresult1 error\n\t}\n\tlistReturnsOnCall map[int]struct {\n\t\tresult1 error\n\t}\n\tPatchStub        func(context.Context, client.Object, client.Patch, ...client.PatchOption) error\n\tpatchMutex       sync.RWMutex\n\tpatchArgsForCall []struct {\n\t\targ1 context.Context\n\t\targ2 client.Object\n\t\targ3 client.Patch\n\t\targ4 []client.PatchOption\n\t}\n\tpatchReturns struct {\n\t\tresult1 error\n\t}\n\tpatchReturnsOnCall map[int]struct {\n\t\tresult1 error\n\t}\n\tStatusUpdateStub        func(context.Context, client.Object, ...client.SubResourceUpdateOption) error\n\tstatusUpdateMutex       sync.RWMutex\n\tstatusUpdateArgsForCall []struct {\n\t\targ1 context.Context\n\t\targ2 client.Object\n\t\targ3 []client.SubResourceUpdateOption\n\t}\n\tstatusUpdateReturns struct {\n\t\tresult1 error\n\t}\n\tstatusUpdateReturnsOnCall map[int]struct {\n\t\tresult1 error\n\t}\n\tUpdateStub        func(context.Context, client.Object, ...client.UpdateOption) error\n\tupdateMutex       sync.RWMutex\n\tupdateArgsForCall []struct {\n\t\targ1 context.Context\n\t\targ2 client.Object\n\t\targ3 []client.UpdateOption\n\t}\n\tupdateReturns struct {\n\t\tresult1 error\n\t}\n\tupdateReturnsOnCall map[int]struct {\n\t\tresult1 error\n\t}\n\tUpdateWithRetryStub        func(context.Context, client.Object, ...client.UpdateOption) error\n\tupdateWithRetryMutex       sync.RWMutex\n\tupdateWithRetryArgsForCall []struct {\n\t\targ1 context.Context\n\t\targ2 client.Object\n\t\targ3 []client.UpdateOption\n\t}\n\tupdateWithRetryReturns struct {\n\t\tresult1 error\n\t}\n\tupdateWithRetryReturnsOnCall map[int]struct {\n\t\tresult1 error\n\t}\n\tinvocations      map[string][][]interface{}\n\tinvocationsMutex sync.RWMutex\n}\n```\n\n[File: api/operator/v1alpha1/istiocsr_types.go, lines: 45-61]\n```\nIstioCSR struct {\n\tmetav1.TypeMeta `json:\",inline\"`\n\n\t// metadata is the standard object's metadata.\n\t// More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata\n\tmetav1.ObjectMeta `json:\"metadata,omitempty\"`\n\n\t// spec is the specification of the desired behavior of the IstioCSR.\n\t// +kubebuilder:validation:Required\n\t// +required\n\tSpec IstioCSRSpec `json:\"spec\"`\n\n\t// status is the most recently observed status of the IstioCSR.\n\t// +kubebuilder:validation:Optional\n\t// +optional\n\tStatus IstioCSRStatus `json:\"status,omitempty\"`\n}\n```\n\n[File: api/operator/v1alpha1/istiocsr_types.go, lines: 77-156]\n```\nIstioCSRConfig struct {\n\t// logLevel supports a value range as per [Kubernetes logging guidelines](https://github.com/kubernetes/community/blob/master/contributors/devel/sig-instrumentation/logging.md#what-method-to-use).\n\t// +kubebuilder:default:=1\n\t// +kubebuilder:validation:Minimum:=1\n\t// +kubebuilder:validation:Maximum:=5\n\t// +kubebuilder:validation:Optional\n\t// +optional\n\tLogLevel int32 `json:\"logLevel,omitempty\"`\n\n\t// logFormat specifies the output format for istio-csr agent logging.\n\t// Supported log formats are text and json.\n\t// +kubebuilder:validation:Enum:=\"text\";\"json\"\n\t// +kubebuilder:default:=\"text\"\n\t// +kubebuilder:validation:Optional\n\t// +optional\n\tLogFormat string `json:\"logFormat,omitempty\"`\n\n\t// Istio-csr creates a ConfigMap named `istio-ca-root-cert` containing the root CA certificate, which the Istio data plane uses to verify server certificates. Its default behavior is to create and monitor ConfigMaps in all namespaces.\n\t// The istioDataPlaneNamespaceSelector restricts the namespaces where the ConfigMap is created by using label selectors, such as maistra.io/member-of=istio-system. This selector is also attached to all desired namespaces that are part of the data plane.\n\t// This field can have a maximum of 4096 characters.\n\t// +kubebuilder:example:=\"maistra.io/member-of=istio-system\"\n\t// +kubebuilder:validation:MinLength:=0\n\t// +kubebuilder:validation:MaxLength:=4096\n\t// +kubebuilder:validation:Optional\n\t// +optional\n\tIstioDataPlaneNamespaceSelector string `json:\"istioDataPlaneNamespaceSelector,omitempty\"`\n\n\t// certManager is for configuring cert-manager specifics.\n\t// +kubebuilder:validation:Required\n\t// +required\n\tCertManager CertManagerConfig `json:\"certManager\"`\n\n\t// istiodTLSConfig is for configuring istiod certificate specifics.\n\t// +kubebuilder:validation:Required\n\t// +required\n\tIstiodTLSConfig IstiodTLSConfig `json:\"istiodTLSConfig\"`\n\n\t// server is for configuring the server endpoint used by istio for obtaining the certificates.\n\t// +kubebuilder:validation:Optional\n\t// +optional\n\tServer *ServerConfig `json:\"server,omitempty\"`\n\n\t// istio is for configuring the istio specifics.\n\t// +kubebuilder:validation:Required\n\t// +required\n\tIstio IstioConfig `json:\"istio\"`\n\n\t// resources is for defining the resource requirements.\n\t// Cannot be updated.\n\t// ref: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n\t// +kubebuilder:validation:Optional\n\t// +optional\n\tResources corev1.ResourceRequirements `json:\"resources,omitempty\"`\n\n\t// affinity is for setting scheduling affinity rules.\n\t// ref: https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/\n\t// +kubebuilder:validation:Optional\n\t// +optional\n\tAffinity *corev1.Affinity `json:\"affinity,omitempty\"`\n\n\t// tolerations is for setting the pod tolerations.\n\t// This field can have a maximum of 50 entries.\n\t// ref: https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/\n\t// +listType=atomic\n\t// +kubebuilder:validation:MinItems:=0\n\t// +kubebuilder:validation:MaxItems:=50\n\t// +kubebuilder:validation:Optional\n\t// +optional\n\tTolerations []corev1.Toleration `json:\"tolerations,omitempty\"`\n\n\t// nodeSelector is for defining the scheduling criteria using node labels.\n\t// This field can have a maximum of 50 entries.\n\t// ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/\n\t// +mapType=atomic\n\t// +kubebuilder:validation:MinProperties:=0\n\t// +kubebuilder:validation:MaxProperties:=50\n\t// +kubebuilder:validation:Optional\n\t// +optional\n\tNodeSelector map[string]string `json:\"nodeSelector,omitempty\"`\n}\n```\n\n[File: api/operator/v1alpha1/istiocsr_types.go, lines: 252-270]\n```\nServerConfig struct {\n\t// clusterID is the Istio cluster ID used to verify incoming CSRs.\n\t// This field can have a maximum of 253 characters.\n\t// +kubebuilder:default:=\"Kubernetes\"\n\t// +kubebuilder:validation:MinLength:=0\n\t// +kubebuilder:validation:MaxLength:=253\n\t// +kubebuilder:validation:Optional\n\t// +optional\n\tClusterID string `json:\"clusterID,omitempty\"`\n\n\t// port to serve the istio-csr gRPC service.\n\t// +kubebuilder:default:=443\n\t// +kubebuilder:validation:Minimum:=1\n\t// +kubebuilder:validation:Maximum:=65535\n\t// +kubebuilder:validation:XValidation:rule=\"oldSelf == 0 || self == oldSelf\",message=\"port is immutable once set\"\n\t// +kubebuilder:validation:Optional\n\t// +optional\n\tPort int32 `json:\"port,omitempty\"`\n}\n```\n\n</details>\n\n\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "created_at": "2025-10-08T12:47:40Z", "updated_at": "2025-10-08T12:47:40Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/312#discussion_r2413745527", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/312", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2413745527"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/312#discussion_r2413745527"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/312"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2413745527/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 519, "original_line": 519, "side": "RIGHT", "in_reply_to_id": 2413010246, "author_association": "NONE", "original_position": 5, "position": 138, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 320, "file_path": "bindata/networkpolicies/cert-manager-allow-egress-to-api-server-networkpolicy.yaml", "line_start": 17, "line_end": 17, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udfe0 Major_\n\n**Overly permissive egress rule.**\n\nThe egress rule allows traffic to TCP port 6443 to any destination. This is broader than necessary and could allow communication to unintended targets beyond the Kubernetes API server.\n\nConsider restricting the destination using one of these approaches:\n- Use CIDR blocks to limit to the API server IP range\n- Use service/pod selectors if the API server is accessible via those mechanisms\n- Document if the broad rule is intentional due to infrastructure constraints\n\n\n\nExample of a more restrictive egress rule using CIDR:\n\n```yaml\negress:\n- to:\n  - ipBlock:\n      cidr: 10.0.0.0/8  # Adjust to your API server CIDR\n  ports:\n  - protocol: TCP\n    port: 6443\n```\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn\nbindata/cert-manager-deployment/networkpolicies/cert-manager-api-server-egress-networkpolicy.yaml\naround lines 14-17, the egress rule currently allows TCP:6443 to any destination\nwhich is too permissive; restrict the destination by adding a to: section (for\nexample an ipBlock with the API server CIDR or a namespace/podSelector that\ntargets the API server service endpoints) or, if you truly need broad access,\nadd a clear comment documenting the infrastructure justification; modify the\negress stanza to include the chosen ipBlock or selector and keep the port 6443\nentry as-is.\n```\n\n</details>\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2410395470", "pull_request_review_id": 3309793011, "id": 2410395470, "node_id": "PRRC_kwDOFdFn9s6Pq7dO", "diff_hunk": "@@ -0,0 +1,17 @@\n+apiVersion: networking.k8s.io/v1\n+kind: NetworkPolicy\n+metadata:\n+  name: cert-manager-api-server-egress\n+  namespace: cert-manager\n+  labels:\n+    cert-manager.operator.openshift.io/owned-by: cert-manager\n+spec:\n+  podSelector:\n+    matchLabels:\n+      app.kubernetes.io/name: cert-manager\n+  policyTypes:\n+  - Egress\n+  egress:\n+  - ports:\n+    - protocol: TCP\n+      port: 6443", "path": "bindata/networkpolicies/cert-manager-allow-egress-to-api-server-networkpolicy.yaml", "commit_id": "167c0ed38cf01bfe1b1dffd042ee70794a546beb", "original_commit_id": "9f6cd4178a2c1ed48e80c28d5e3dd6fd946702e7", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udfe0 Major_\n\n**Overly permissive egress rule.**\n\nThe egress rule allows traffic to TCP port 6443 to any destination. This is broader than necessary and could allow communication to unintended targets beyond the Kubernetes API server.\n\nConsider restricting the destination using one of these approaches:\n- Use CIDR blocks to limit to the API server IP range\n- Use service/pod selectors if the API server is accessible via those mechanisms\n- Document if the broad rule is intentional due to infrastructure constraints\n\n\n\nExample of a more restrictive egress rule using CIDR:\n\n```yaml\negress:\n- to:\n  - ipBlock:\n      cidr: 10.0.0.0/8  # Adjust to your API server CIDR\n  ports:\n  - protocol: TCP\n    port: 6443\n```\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn\nbindata/cert-manager-deployment/networkpolicies/cert-manager-api-server-egress-networkpolicy.yaml\naround lines 14-17, the egress rule currently allows TCP:6443 to any destination\nwhich is too permissive; restrict the destination by adding a to: section (for\nexample an ipBlock with the API server CIDR or a namespace/podSelector that\ntargets the API server service endpoints) or, if you truly need broad access,\nadd a clear comment documenting the infrastructure justification; modify the\negress stanza to include the chosen ipBlock or selector and keep the port 6443\nentry as-is.\n```\n\n</details>\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "created_at": "2025-10-07T12:03:45Z", "updated_at": "2025-10-07T12:03:47Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2410395470", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2410395470"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2410395470"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2410395470/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 14, "original_start_line": 14, "start_side": "RIGHT", "line": 17, "original_line": 17, "side": "RIGHT", "author_association": "NONE", "original_position": 17, "position": 17, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 320, "file_path": "bindata/networkpolicies/cert-manager-deny-all-networkpolicy.yaml", "line_start": 14, "line_end": 14, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Verify the podSelector label matches cert-manager deployments.**\n\nThe deny-all NetworkPolicy structure is correct. However, ensure that the podSelector label `app.kubernetes.io/name: cert-manager` matches the actual labels used by cert-manager pods deployed by this operator.\n\n\n\n\nRun the following script to verify the label selector:\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Description: Verify that cert-manager deployments use the label app.kubernetes.io/name: cert-manager\n\n# Search for deployment manifests and check labels\nfd -e yaml -e yml . bindata/cert-manager-deployment | xargs rg -l \"kind: Deployment\" | xargs rg -A 20 \"kind: Deployment\" | rg -B 5 -A 5 \"app.kubernetes.io/name\"\n```\n\nLength of output: 6218\n\n---\n\n\n\n</details>\n\n**Extend podSelector to include all cert-manager pods**  \nThe current selector (`app.kubernetes.io/name=cert-manager`) matches only controller pods. To cover cainjector and webhook as well, use `app.kubernetes.io/instance: cert-manager` (or an OR selector) instead.\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn\nbindata/cert-manager-deployment/networkpolicies/cert-manager-deny-all-networkpolicy.yaml\naround lines 1 to 14, the podSelector currently targets only controller pods via\napp.kubernetes.io/name: cert-manager; change the selector to include all\ncert-manager pods by using app.kubernetes.io/instance: cert-manager (or replace\nmatchLabels with a matchExpressions OR that matches both\napp.kubernetes.io/name=cert-manager and app.kubernetes.io/instance=cert-manager)\nso cainjector and webhook are covered by the policy.\n```\n\n</details>\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit 9759f81", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2410395478", "pull_request_review_id": 3309793011, "id": 2410395478, "node_id": "PRRC_kwDOFdFn9s6Pq7dW", "diff_hunk": "@@ -0,0 +1,14 @@\n+apiVersion: networking.k8s.io/v1\n+kind: NetworkPolicy\n+metadata:\n+  name: cert-manager-deny-all\n+  namespace: cert-manager\n+  labels:\n+    cert-manager.operator.openshift.io/owned-by: cert-manager\n+spec:\n+  podSelector:\n+    matchLabels:\n+      app.kubernetes.io/name: cert-manager\n+  policyTypes:\n+  - Ingress\n+  - Egress", "path": "bindata/networkpolicies/cert-manager-deny-all-networkpolicy.yaml", "commit_id": "167c0ed38cf01bfe1b1dffd042ee70794a546beb", "original_commit_id": "9f6cd4178a2c1ed48e80c28d5e3dd6fd946702e7", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Verify the podSelector label matches cert-manager deployments.**\n\nThe deny-all NetworkPolicy structure is correct. However, ensure that the podSelector label `app.kubernetes.io/name: cert-manager` matches the actual labels used by cert-manager pods deployed by this operator.\n\n\n\n\nRun the following script to verify the label selector:\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Description: Verify that cert-manager deployments use the label app.kubernetes.io/name: cert-manager\n\n# Search for deployment manifests and check labels\nfd -e yaml -e yml . bindata/cert-manager-deployment | xargs rg -l \"kind: Deployment\" | xargs rg -A 20 \"kind: Deployment\" | rg -B 5 -A 5 \"app.kubernetes.io/name\"\n```\n\nLength of output: 6218\n\n---\n\n\n\n</details>\n\n**Extend podSelector to include all cert-manager pods**  \nThe current selector (`app.kubernetes.io/name=cert-manager`) matches only controller pods. To cover cainjector and webhook as well, use `app.kubernetes.io/instance: cert-manager` (or an OR selector) instead.\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn\nbindata/cert-manager-deployment/networkpolicies/cert-manager-deny-all-networkpolicy.yaml\naround lines 1 to 14, the podSelector currently targets only controller pods via\napp.kubernetes.io/name: cert-manager; change the selector to include all\ncert-manager pods by using app.kubernetes.io/instance: cert-manager (or replace\nmatchLabels with a matchExpressions OR that matches both\napp.kubernetes.io/name=cert-manager and app.kubernetes.io/instance=cert-manager)\nso cainjector and webhook are covered by the policy.\n```\n\n</details>\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit 9759f81", "created_at": "2025-10-07T12:03:45Z", "updated_at": "2025-10-13T06:28:01Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2410395478", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2410395478"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2410395478"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2410395478/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 1, "original_start_line": 1, "start_side": "RIGHT", "line": 14, "original_line": 14, "side": "RIGHT", "author_association": "NONE", "original_position": 14, "position": 14, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 320, "file_path": "pkg/controller/deployment/cert_manager_networkpolicy.go", "line_start": 228, "line_end": 228, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n**Unblock IstioCSR user policies**\n\nThe API + CRD expose `IstioCSR` as a valid `componentName`, yet `validateComponentName` rejects it and `getPodSelectorForComponent` falls back to the generic selector. Any CR using the documented IstioCSR value will hit the validation error and never reconcile. Please add explicit support for `IstioCSR` in both the validation switch and the selector mapping (reusing the label used by the istio-csr operands, e.g. `app: istio-csr`).\n\n```diff\n func (c *CertManagerNetworkPolicyUserDefinedController) validateComponentName(componentName v1alpha1.ComponentName) error {\n \tswitch componentName {\n-\tcase v1alpha1.CAInjector, v1alpha1.CoreController, v1alpha1.Webhook:\n+\tcase v1alpha1.CAInjector, v1alpha1.CoreController, v1alpha1.Webhook, v1alpha1.IstioCSRComponent:\n \t\treturn nil\n \tdefault:\n \t\treturn fmt.Errorf(\"unsupported component name: %s\", componentName)\n \t}\n }\n@@\n \tswitch component {\n \tcase v1alpha1.CAInjector:\n \t\treturn metav1.LabelSelector{\n \t\t\tMatchLabels: map[string]string{\n \t\t\t\t\"app\": \"cainjector\",\n \t\t\t},\n \t\t}\n \tcase v1alpha1.CoreController:\n \t\treturn metav1.LabelSelector{\n \t\t\tMatchLabels: map[string]string{\n \t\t\t\t\"app\": \"cert-manager\",\n \t\t\t},\n \t\t}\n \tcase v1alpha1.Webhook:\n \t\treturn metav1.LabelSelector{\n \t\t\tMatchLabels: map[string]string{\n \t\t\t\t\"app\": \"webhook\",\n \t\t\t},\n \t\t}\n+\tcase v1alpha1.IstioCSRComponent:\n+\t\treturn metav1.LabelSelector{\n+\t\t\tMatchLabels: map[string]string{\n+\t\t\t\t\"app\": \"istio-csr\",\n+\t\t\t},\n+\t\t}\n \tdefault:\n \t\treturn metav1.LabelSelector{\n \t\t\tMatchLabels: map[string]string{\n \t\t\t\t\"app.kubernetes.io/name\": \"cert-manager\",\n \t\t\t},\n \t\t}\n \t}\n }\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\nfunc (c *CertManagerNetworkPolicyUserDefinedController) validateComponentName(componentName v1alpha1.ComponentName) error {\n\tswitch componentName {\n\tcase v1alpha1.CAInjector, v1alpha1.CoreController, v1alpha1.Webhook, v1alpha1.IstioCSRComponent:\n\t\treturn nil\n\tdefault:\n\t\treturn fmt.Errorf(\"unsupported component name: %s\", componentName)\n\t}\n}\n\nfunc (c *CertManagerNetworkPolicyUserDefinedController) getPodSelectorForComponent(component v1alpha1.ComponentName) metav1.LabelSelector {\n\tswitch component {\n\tcase v1alpha1.CAInjector:\n\t\treturn metav1.LabelSelector{\n\t\t\tMatchLabels: map[string]string{\n\t\t\t\t\"app\": \"cainjector\",\n\t\t\t},\n\t\t}\n\tcase v1alpha1.CoreController:\n\t\treturn metav1.LabelSelector{\n\t\t\tMatchLabels: map[string]string{\n\t\t\t\t\"app\": \"cert-manager\",\n\t\t\t},\n\t\t}\n\tcase v1alpha1.Webhook:\n\t\treturn metav1.LabelSelector{\n\t\t\tMatchLabels: map[string]string{\n\t\t\t\t\"app\": \"webhook\",\n\t\t\t},\n\t\t}\n\tcase v1alpha1.IstioCSRComponent:\n\t\treturn metav1.LabelSelector{\n\t\t\tMatchLabels: map[string]string{\n\t\t\t\t\"app\": \"istio-csr\",\n\t\t\t},\n\t\t}\n\tdefault:\n\t\treturn metav1.LabelSelector{\n\t\t\tMatchLabels: map[string]string{\n\t\t\t\t\"app.kubernetes.io/name\": \"cert-manager\",\n\t\t\t},\n\t\t}\n\t}\n}\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn pkg/controller/deployment/cert_manager_networkpolicy.go around lines 144 to\n229, the functions validateComponentName and getPodSelectorForComponent do not\ninclude the v1alpha1.IstioCSR case so CRs using componentName IstioCSR are\nrejected or get the generic selector; add an explicit case for v1alpha1.IstioCSR\nin the validateComponentName switch (return nil) and add a corresponding case in\ngetPodSelectorForComponent that returns a LabelSelector with MatchLabels\n{\"app\":\"istio-csr\"} so IstioCSR user policies validate and select the correct\npods.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:medusa:sabertoothed -->\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2410395486", "pull_request_review_id": 3309793011, "id": 2410395486, "node_id": "PRRC_kwDOFdFn9s6Pq7de", "diff_hunk": "@@ -0,0 +1,257 @@\n+package deployment\n+\n+import (\n+\t\"context\"\n+\t\"fmt\"\n+\n+\tnetworkingv1 \"k8s.io/api/networking/v1\"\n+\t\"k8s.io/apimachinery/pkg/api/errors\"\n+\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n+\t\"k8s.io/client-go/kubernetes\"\n+\n+\t\"github.com/openshift/library-go/pkg/controller/factory\"\n+\t\"github.com/openshift/library-go/pkg/operator/events\"\n+\t\"github.com/openshift/library-go/pkg/operator/resource/resourceapply\"\n+\t\"github.com/openshift/library-go/pkg/operator/staticresourcecontroller\"\n+\t\"github.com/openshift/library-go/pkg/operator/v1helpers\"\n+\n+\t\"github.com/openshift/cert-manager-operator/api/operator/v1alpha1\"\n+\t\"github.com/openshift/cert-manager-operator/pkg/operator/assets\"\n+\tcertmanoperatorinformers \"github.com/openshift/cert-manager-operator/pkg/operator/informers/externalversions\"\n+)\n+\n+const (\n+\tcertManagerNetworkPolicyStaticResourcesControllerName = operatorName + \"-networkpolicy-static-resources-\"\n+\tcertManagerNetworkPolicyUserDefinedControllerName     = operatorName + \"-networkpolicy-user-defined\"\n+\tcertManagerNamespace                                  = \"cert-manager\"\n+\tnetworkPolicyOwnerLabel                               = \"cert-manager.operator.openshift.io/owned-by\"\n+)\n+\n+var (\n+\t// Static network policy asset files for default policies\n+\tcertManagerNetworkPolicyAssetFiles = []string{\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-deny-all-networkpolicy.yaml\",\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-api-server-egress-networkpolicy.yaml\",\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-metrics-ingress-networkpolicy.yaml\",\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-webhook-ingress-networkpolicy.yaml\",\n+\t}\n+)\n+\n+// ============================================================================\n+// STATIC RESOURCE CONTROLLER - for default network policies from YAML files\n+// ============================================================================\n+\n+func NewCertManagerNetworkPolicyStaticResourcesController(operatorClient v1helpers.OperatorClient,\n+\tkubeClientContainer *resourceapply.ClientHolder,\n+\tkubeInformersForNamespaces v1helpers.KubeInformersForNamespaces,\n+\tcertManagerOperatorInformers certmanoperatorinformers.SharedInformerFactory,\n+\teventsRecorder events.Recorder) factory.Controller {\n+\n+\t// Create conditional function to check if network policies should be applied\n+\tshouldApplyNetworkPolicies := func() bool {\n+\t\tcertManager, err := certManagerOperatorInformers.Operator().V1alpha1().CertManagers().Lister().Get(\"cluster\")\n+\t\tif err != nil {\n+\t\t\treturn false\n+\t\t}\n+\t\treturn certManager.Spec.DefaultNetworkPolicy == \"true\"\n+\t}\n+\n+\treturn staticresourcecontroller.NewStaticResourceController(\n+\t\tcertManagerNetworkPolicyStaticResourcesControllerName,\n+\t\tassets.Asset,\n+\t\t[]string{}, // empty files, we'll add them conditionally\n+\t\tkubeClientContainer,\n+\t\toperatorClient,\n+\t\teventsRecorder,\n+\t).WithConditionalResources(\n+\t\tassets.Asset,\n+\t\tcertManagerNetworkPolicyAssetFiles,\n+\t\tshouldApplyNetworkPolicies,\n+\t\tnil, // Since immutable, we never delete\n+\t).AddKubeInformers(kubeInformersForNamespaces).AddInformer(\n+\t\tcertManagerOperatorInformers.Operator().V1alpha1().CertManagers().Informer(),\n+\t)\n+}\n+\n+// ============================================================================\n+// USER-DEFINED CONTROLLER - for user-configured network policies from API\n+// ============================================================================\n+\n+// CertManagerNetworkPolicyUserDefinedController manages user-defined NetworkPolicy resources\n+type CertManagerNetworkPolicyUserDefinedController struct {\n+\toperatorClient               v1helpers.OperatorClient\n+\tcertManagerOperatorInformers certmanoperatorinformers.SharedInformerFactory\n+\tkubeClient                   kubernetes.Interface\n+\teventRecorder                events.Recorder\n+}\n+\n+func NewCertManagerNetworkPolicyUserDefinedController(\n+\toperatorClient v1helpers.OperatorClient,\n+\tcertManagerOperatorInformers certmanoperatorinformers.SharedInformerFactory,\n+\tkubeClient kubernetes.Interface,\n+\teventRecorder events.Recorder,\n+) factory.Controller {\n+\tc := &CertManagerNetworkPolicyUserDefinedController{\n+\t\toperatorClient:               operatorClient,\n+\t\tcertManagerOperatorInformers: certManagerOperatorInformers,\n+\t\tkubeClient:                   kubeClient,\n+\t\teventRecorder:                eventRecorder.WithComponentSuffix(\"cert-manager-networkpolicy-user-defined\"),\n+\t}\n+\n+\treturn factory.New().\n+\t\tWithInformers(\n+\t\t\toperatorClient.Informer(),\n+\t\t\tcertManagerOperatorInformers.Operator().V1alpha1().CertManagers().Informer(),\n+\t\t).\n+\t\tWithSync(c.sync).\n+\t\tToController(certManagerNetworkPolicyUserDefinedControllerName, c.eventRecorder)\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) sync(ctx context.Context, syncCtx factory.SyncContext) error {\n+\t// Get the current CertManager configuration\n+\tcertManager, err := c.certManagerOperatorInformers.Operator().V1alpha1().CertManagers().Lister().Get(\"cluster\")\n+\tif err != nil {\n+\t\tif errors.IsNotFound(err) {\n+\t\t\t// No CertManager found, nothing to do\n+\t\t\treturn nil\n+\t\t}\n+\t\treturn fmt.Errorf(\"failed to get CertManager: %w\", err)\n+\t}\n+\n+\t// Check if network policies are enabled\n+\tif certManager.Spec.DefaultNetworkPolicy != \"true\" {\n+\t\t// Network policies not enabled, nothing to do\n+\t\t// Note: Since fields are immutable, no cleanup needed\n+\t\treturn nil\n+\t}\n+\n+\t// Validate user-defined network policy configuration\n+\tif err := c.validateNetworkPolicyConfig(certManager); err != nil {\n+\t\tc.eventRecorder.Warningf(\"NetworkPolicyValidationFailed\", \"Network policy configuration validation failed: %v\", err)\n+\t\treturn fmt.Errorf(\"network policy configuration validation failed: %w\", err)\n+\t}\n+\n+\t// Apply user-defined network policies\n+\tif err := c.reconcileUserNetworkPolicies(ctx, certManager); err != nil {\n+\t\tc.eventRecorder.Warningf(\"UserNetworkPolicyReconcileFailed\", \"Failed to reconcile user network policies: %v\", err)\n+\t\treturn fmt.Errorf(\"failed to reconcile user network policies: %w\", err)\n+\t}\n+\n+\tc.eventRecorder.Event(\"UserNetworkPolicyReconcileSuccess\", \"Successfully reconciled user-defined network policies\")\n+\treturn nil\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) validateNetworkPolicyConfig(certManager *v1alpha1.CertManager) error {\n+\t// Validate each user-defined network policy\n+\tfor i, policy := range certManager.Spec.NetworkPolicies {\n+\t\tif policy.Name == \"\" {\n+\t\t\treturn fmt.Errorf(\"network policy at index %d: name cannot be empty\", i)\n+\t\t}\n+\t\tif len(policy.Egress) == 0 {\n+\t\t\treturn fmt.Errorf(\"network policy at index %d: egress rules cannot be empty when network policies are enabled\", i)\n+\t\t}\n+\t\tif err := c.validateComponentName(policy.ComponentName); err != nil {\n+\t\t\treturn fmt.Errorf(\"network policy at index %d: invalid component name: %w\", i, err)\n+\t\t}\n+\t}\n+\treturn nil\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) validateComponentName(componentName v1alpha1.ComponentName) error {\n+\tswitch componentName {\n+\tcase v1alpha1.CAInjector, v1alpha1.CoreController, v1alpha1.Webhook:\n+\t\treturn nil\n+\tdefault:\n+\t\treturn fmt.Errorf(\"unsupported component name: %s\", componentName)\n+\t}\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) reconcileUserNetworkPolicies(ctx context.Context, certManager *v1alpha1.CertManager) error {\n+\t// Apply each user-defined network policy\n+\tfor _, userPolicy := range certManager.Spec.NetworkPolicies {\n+\t\tpolicy := c.createUserNetworkPolicy(userPolicy)\n+\t\tif err := c.createOrUpdateNetworkPolicy(ctx, policy); err != nil {\n+\t\t\treturn fmt.Errorf(\"failed to create/update user network policy %s: %w\", policy.Name, err)\n+\t\t}\n+\t}\n+\n+\treturn nil\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) createUserNetworkPolicy(userPolicy v1alpha1.NetworkPolicy) *networkingv1.NetworkPolicy {\n+\tpodSelector := c.getPodSelectorForComponent(userPolicy.ComponentName)\n+\n+\treturn &networkingv1.NetworkPolicy{\n+\t\tObjectMeta: metav1.ObjectMeta{\n+\t\t\tName:      fmt.Sprintf(\"cert-manager-user-%s\", userPolicy.Name),\n+\t\t\tNamespace: certManagerNamespace,\n+\t\t\tLabels: map[string]string{\n+\t\t\t\tnetworkPolicyOwnerLabel: \"cert-manager\",\n+\t\t\t},\n+\t\t},\n+\t\tSpec: networkingv1.NetworkPolicySpec{\n+\t\t\tPodSelector: podSelector,\n+\t\t\tPolicyTypes: []networkingv1.PolicyType{\n+\t\t\t\tnetworkingv1.PolicyTypeEgress,\n+\t\t\t},\n+\t\t\tEgress: userPolicy.Egress,\n+\t\t},\n+\t}\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) getPodSelectorForComponent(component v1alpha1.ComponentName) metav1.LabelSelector {\n+\tswitch component {\n+\tcase v1alpha1.CAInjector:\n+\t\treturn metav1.LabelSelector{\n+\t\t\tMatchLabels: map[string]string{\n+\t\t\t\t\"app\": \"cainjector\",\n+\t\t\t},\n+\t\t}\n+\tcase v1alpha1.CoreController:\n+\t\treturn metav1.LabelSelector{\n+\t\t\tMatchLabels: map[string]string{\n+\t\t\t\t\"app\": \"cert-manager\",\n+\t\t\t},\n+\t\t}\n+\tcase v1alpha1.Webhook:\n+\t\treturn metav1.LabelSelector{\n+\t\t\tMatchLabels: map[string]string{\n+\t\t\t\t\"app\": \"webhook\",\n+\t\t\t},\n+\t\t}\n+\tdefault:\n+\t\treturn metav1.LabelSelector{\n+\t\t\tMatchLabels: map[string]string{\n+\t\t\t\t\"app.kubernetes.io/name\": \"cert-manager\",\n+\t\t\t},\n+\t\t}\n+\t}\n+}", "path": "pkg/controller/deployment/cert_manager_networkpolicy.go", "commit_id": "167c0ed38cf01bfe1b1dffd042ee70794a546beb", "original_commit_id": "9f6cd4178a2c1ed48e80c28d5e3dd6fd946702e7", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n**Unblock IstioCSR user policies**\n\nThe API + CRD expose `IstioCSR` as a valid `componentName`, yet `validateComponentName` rejects it and `getPodSelectorForComponent` falls back to the generic selector. Any CR using the documented IstioCSR value will hit the validation error and never reconcile. Please add explicit support for `IstioCSR` in both the validation switch and the selector mapping (reusing the label used by the istio-csr operands, e.g. `app: istio-csr`).\n\n```diff\n func (c *CertManagerNetworkPolicyUserDefinedController) validateComponentName(componentName v1alpha1.ComponentName) error {\n \tswitch componentName {\n-\tcase v1alpha1.CAInjector, v1alpha1.CoreController, v1alpha1.Webhook:\n+\tcase v1alpha1.CAInjector, v1alpha1.CoreController, v1alpha1.Webhook, v1alpha1.IstioCSRComponent:\n \t\treturn nil\n \tdefault:\n \t\treturn fmt.Errorf(\"unsupported component name: %s\", componentName)\n \t}\n }\n@@\n \tswitch component {\n \tcase v1alpha1.CAInjector:\n \t\treturn metav1.LabelSelector{\n \t\t\tMatchLabels: map[string]string{\n \t\t\t\t\"app\": \"cainjector\",\n \t\t\t},\n \t\t}\n \tcase v1alpha1.CoreController:\n \t\treturn metav1.LabelSelector{\n \t\t\tMatchLabels: map[string]string{\n \t\t\t\t\"app\": \"cert-manager\",\n \t\t\t},\n \t\t}\n \tcase v1alpha1.Webhook:\n \t\treturn metav1.LabelSelector{\n \t\t\tMatchLabels: map[string]string{\n \t\t\t\t\"app\": \"webhook\",\n \t\t\t},\n \t\t}\n+\tcase v1alpha1.IstioCSRComponent:\n+\t\treturn metav1.LabelSelector{\n+\t\t\tMatchLabels: map[string]string{\n+\t\t\t\t\"app\": \"istio-csr\",\n+\t\t\t},\n+\t\t}\n \tdefault:\n \t\treturn metav1.LabelSelector{\n \t\t\tMatchLabels: map[string]string{\n \t\t\t\t\"app.kubernetes.io/name\": \"cert-manager\",\n \t\t\t},\n \t\t}\n \t}\n }\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\nfunc (c *CertManagerNetworkPolicyUserDefinedController) validateComponentName(componentName v1alpha1.ComponentName) error {\n\tswitch componentName {\n\tcase v1alpha1.CAInjector, v1alpha1.CoreController, v1alpha1.Webhook, v1alpha1.IstioCSRComponent:\n\t\treturn nil\n\tdefault:\n\t\treturn fmt.Errorf(\"unsupported component name: %s\", componentName)\n\t}\n}\n\nfunc (c *CertManagerNetworkPolicyUserDefinedController) getPodSelectorForComponent(component v1alpha1.ComponentName) metav1.LabelSelector {\n\tswitch component {\n\tcase v1alpha1.CAInjector:\n\t\treturn metav1.LabelSelector{\n\t\t\tMatchLabels: map[string]string{\n\t\t\t\t\"app\": \"cainjector\",\n\t\t\t},\n\t\t}\n\tcase v1alpha1.CoreController:\n\t\treturn metav1.LabelSelector{\n\t\t\tMatchLabels: map[string]string{\n\t\t\t\t\"app\": \"cert-manager\",\n\t\t\t},\n\t\t}\n\tcase v1alpha1.Webhook:\n\t\treturn metav1.LabelSelector{\n\t\t\tMatchLabels: map[string]string{\n\t\t\t\t\"app\": \"webhook\",\n\t\t\t},\n\t\t}\n\tcase v1alpha1.IstioCSRComponent:\n\t\treturn metav1.LabelSelector{\n\t\t\tMatchLabels: map[string]string{\n\t\t\t\t\"app\": \"istio-csr\",\n\t\t\t},\n\t\t}\n\tdefault:\n\t\treturn metav1.LabelSelector{\n\t\t\tMatchLabels: map[string]string{\n\t\t\t\t\"app.kubernetes.io/name\": \"cert-manager\",\n\t\t\t},\n\t\t}\n\t}\n}\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn pkg/controller/deployment/cert_manager_networkpolicy.go around lines 144 to\n229, the functions validateComponentName and getPodSelectorForComponent do not\ninclude the v1alpha1.IstioCSR case so CRs using componentName IstioCSR are\nrejected or get the generic selector; add an explicit case for v1alpha1.IstioCSR\nin the validateComponentName switch (return nil) and add a corresponding case in\ngetPodSelectorForComponent that returns a LabelSelector with MatchLabels\n{\"app\":\"istio-csr\"} so IstioCSR user policies validate and select the correct\npods.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:medusa:sabertoothed -->\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "created_at": "2025-10-07T12:03:45Z", "updated_at": "2025-10-09T10:39:27Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2410395486", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2410395486"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2410395486"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2410395486/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 145, "original_start_line": 144, "start_side": "RIGHT", "line": 228, "original_line": 228, "side": "RIGHT", "author_association": "NONE", "original_position": 229, "position": 228, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 320, "file_path": "pkg/operator/assets/bindata.go", "line_start": 1913, "line_end": null, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udfe0 Major_\n\n**Fix namespaceSelector for monitoring; current label key likely wrong**\n\nNamespaces generally don\u2019t have a label named \"name\". Use kubernetes.io/metadata.name=openshift-monitoring (widely used on OCP) to ensure scraping works.\n\n\nPlease update the source YAML at bindata/cert-manager-deployment/networkpolicies/cert-manager-metrics-ingress-networkpolicy.yaml and regenerate bindata. For illustration (generated file change shown):\n\n```diff\n-    - namespaceSelector:\n-        matchLabels:\n-          name: openshift-monitoring\n+    - namespaceSelector:\n+        matchLabels:\n+          kubernetes.io/metadata.name: openshift-monitoring\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n    - namespaceSelector:\n        matchLabels:\n          kubernetes.io/metadata.name: openshift-monitoring\n    ports:\n    - protocol: TCP\n      port: 9402\n`)\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn pkg/operator/assets/bindata.go around lines 1907 to 1913 the\nnamespaceSelector uses matchLabels: name: openshift-monitoring which is\nincorrect; update the source YAML at\nbindata/cert-manager-deployment/networkpolicies/cert-manager-metrics-ingress-networkpolicy.yaml\nto use namespaceSelector.matchLabels.kubernetes.io/metadata.name:\nopenshift-monitoring (or equivalently use namespaceSelector.matchExpressions\nagainst metadata.name) and then regenerate the bindata output so the change is\nreflected in this generated file.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:medusa:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit eb88d8a", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2410395510", "pull_request_review_id": 3309793011, "id": 2410395510, "node_id": "PRRC_kwDOFdFn9s6Pq7d2", "diff_hunk": "@@ -1816,6 +1824,143 @@ func certManagerDeploymentControllerCertManagerViewCrYaml() (*asset, error) {\n \treturn a, nil\n }\n \n+var _certManagerDeploymentNetworkpoliciesCertManagerApiServerEgressNetworkpolicyYaml = []byte(`apiVersion: networking.k8s.io/v1\n+kind: NetworkPolicy\n+metadata:\n+  name: cert-manager-api-server-egress\n+  namespace: cert-manager\n+  labels:\n+    cert-manager.operator.openshift.io/owned-by: cert-manager\n+spec:\n+  podSelector:\n+    matchLabels:\n+      app.kubernetes.io/name: cert-manager\n+  policyTypes:\n+  - Egress\n+  egress:\n+  - ports:\n+    - protocol: TCP\n+      port: 6443\n+`)\n+\n+func certManagerDeploymentNetworkpoliciesCertManagerApiServerEgressNetworkpolicyYamlBytes() ([]byte, error) {\n+\treturn _certManagerDeploymentNetworkpoliciesCertManagerApiServerEgressNetworkpolicyYaml, nil\n+}\n+\n+func certManagerDeploymentNetworkpoliciesCertManagerApiServerEgressNetworkpolicyYaml() (*asset, error) {\n+\tbytes, err := certManagerDeploymentNetworkpoliciesCertManagerApiServerEgressNetworkpolicyYamlBytes()\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\tinfo := bindataFileInfo{name: \"cert-manager-deployment/networkpolicies/cert-manager-api-server-egress-networkpolicy.yaml\", size: 0, mode: os.FileMode(0), modTime: time.Unix(0, 0)}\n+\ta := &asset{bytes: bytes, info: info}\n+\treturn a, nil\n+}\n+\n+var _certManagerDeploymentNetworkpoliciesCertManagerDenyAllNetworkpolicyYaml = []byte(`apiVersion: networking.k8s.io/v1\n+kind: NetworkPolicy\n+metadata:\n+  name: cert-manager-deny-all\n+  namespace: cert-manager\n+  labels:\n+    cert-manager.operator.openshift.io/owned-by: cert-manager\n+spec:\n+  podSelector:\n+    matchLabels:\n+      app.kubernetes.io/name: cert-manager\n+  policyTypes:\n+  - Ingress\n+  - Egress\n+`)\n+\n+func certManagerDeploymentNetworkpoliciesCertManagerDenyAllNetworkpolicyYamlBytes() ([]byte, error) {\n+\treturn _certManagerDeploymentNetworkpoliciesCertManagerDenyAllNetworkpolicyYaml, nil\n+}\n+\n+func certManagerDeploymentNetworkpoliciesCertManagerDenyAllNetworkpolicyYaml() (*asset, error) {\n+\tbytes, err := certManagerDeploymentNetworkpoliciesCertManagerDenyAllNetworkpolicyYamlBytes()\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\tinfo := bindataFileInfo{name: \"cert-manager-deployment/networkpolicies/cert-manager-deny-all-networkpolicy.yaml\", size: 0, mode: os.FileMode(0), modTime: time.Unix(0, 0)}\n+\ta := &asset{bytes: bytes, info: info}\n+\treturn a, nil\n+}\n+\n+var _certManagerDeploymentNetworkpoliciesCertManagerMetricsIngressNetworkpolicyYaml = []byte(`apiVersion: networking.k8s.io/v1\n+kind: NetworkPolicy\n+metadata:\n+  name: cert-manager-metrics-ingress\n+  namespace: cert-manager\n+  labels:\n+    cert-manager.operator.openshift.io/owned-by: cert-manager\n+spec:\n+  podSelector:\n+    matchLabels:\n+      app.kubernetes.io/name: cert-manager\n+  policyTypes:\n+  - Ingress\n+  ingress:\n+  - from:\n+    - namespaceSelector:\n+        matchLabels:\n+          name: openshift-monitoring\n+    ports:\n+    - protocol: TCP\n+      port: 9402\n+`)", "path": "pkg/operator/assets/bindata.go", "commit_id": "f0b78fb582828650adf3ba3e621f41c20c6e535f", "original_commit_id": "9f6cd4178a2c1ed48e80c28d5e3dd6fd946702e7", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udfe0 Major_\n\n**Fix namespaceSelector for monitoring; current label key likely wrong**\n\nNamespaces generally don\u2019t have a label named \"name\". Use kubernetes.io/metadata.name=openshift-monitoring (widely used on OCP) to ensure scraping works.\n\n\nPlease update the source YAML at bindata/cert-manager-deployment/networkpolicies/cert-manager-metrics-ingress-networkpolicy.yaml and regenerate bindata. For illustration (generated file change shown):\n\n```diff\n-    - namespaceSelector:\n-        matchLabels:\n-          name: openshift-monitoring\n+    - namespaceSelector:\n+        matchLabels:\n+          kubernetes.io/metadata.name: openshift-monitoring\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n    - namespaceSelector:\n        matchLabels:\n          kubernetes.io/metadata.name: openshift-monitoring\n    ports:\n    - protocol: TCP\n      port: 9402\n`)\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn pkg/operator/assets/bindata.go around lines 1907 to 1913 the\nnamespaceSelector uses matchLabels: name: openshift-monitoring which is\nincorrect; update the source YAML at\nbindata/cert-manager-deployment/networkpolicies/cert-manager-metrics-ingress-networkpolicy.yaml\nto use namespaceSelector.matchLabels.kubernetes.io/metadata.name:\nopenshift-monitoring (or equivalently use namespaceSelector.matchExpressions\nagainst metadata.name) and then regenerate the bindata output so the change is\nreflected in this generated file.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:medusa:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit eb88d8a", "created_at": "2025-10-07T12:03:46Z", "updated_at": "2025-10-07T12:04:38Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2410395510", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2410395510"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2410395510"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2410395510/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 1907, "start_side": "RIGHT", "line": null, "original_line": 1913, "side": "RIGHT", "author_association": "NONE", "original_position": 112, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 320, "file_path": "pkg/operator/assets/bindata.go", "line_start": 3028, "line_end": 3028, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udfe0 Major_\n\n**Apply the same monitoring namespace label fix for istio-csr metrics**\n\nUse kubernetes.io/metadata.name: openshift-monitoring to reliably match the monitoring namespace.\n\n\nChange source YAML at bindata/istio-csr/istio-csr-metrics-ingress-networkpolicy.yaml and regenerate:\n\n```diff\n-    - namespaceSelector:\n-        matchLabels:\n-          name: openshift-monitoring\n+    - namespaceSelector:\n+        matchLabels:\n+          kubernetes.io/metadata.name: openshift-monitoring\n```\n\n\n> Committable suggestion skipped: line range outside the PR's diff.\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn pkg/operator/assets/bindata.go around lines 2926 to 2931, the embedded YAML\nfor istio-csr metrics uses the wrong namespace label; update the source YAML at\nbindata/istio-csr/istio-csr-metrics-ingress-networkpolicy.yaml to set the\nnamespace selector label to kubernetes.io/metadata.name: openshift-monitoring\n(replacing any other label key/value), then regenerate the bindata output so\nthis change is reflected in pkg/operator/assets/bindata.go.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:medusa:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit eb88d8a", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2410395516", "pull_request_review_id": 3309793011, "id": 2410395516, "node_id": "PRRC_kwDOFdFn9s6Pq7d8", "diff_hunk": "@@ -2667,6 +2812,139 @@ func istioCsrCertManagerIstioCsrServiceaccountYaml() (*asset, error) {\n \treturn a, nil\n }\n \n+var _istioCsrIstioCsrApiServerEgressNetworkpolicyYaml = []byte(`apiVersion: networking.k8s.io/v1\n+kind: NetworkPolicy\n+metadata:\n+  name: istio-csr-api-server-egress\n+  labels:\n+    cert-manager.operator.openshift.io/owned-by: istio-csr\n+spec:\n+  podSelector:\n+    matchLabels:\n+      app: cert-manager-istio-csr\n+  policyTypes:\n+  - Egress\n+  egress:\n+  - ports:\n+    - protocol: TCP\n+      port: 6443\n+`)\n+\n+func istioCsrIstioCsrApiServerEgressNetworkpolicyYamlBytes() ([]byte, error) {\n+\treturn _istioCsrIstioCsrApiServerEgressNetworkpolicyYaml, nil\n+}\n+\n+func istioCsrIstioCsrApiServerEgressNetworkpolicyYaml() (*asset, error) {\n+\tbytes, err := istioCsrIstioCsrApiServerEgressNetworkpolicyYamlBytes()\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\tinfo := bindataFileInfo{name: \"istio-csr/istio-csr-api-server-egress-networkpolicy.yaml\", size: 0, mode: os.FileMode(0), modTime: time.Unix(0, 0)}\n+\ta := &asset{bytes: bytes, info: info}\n+\treturn a, nil\n+}\n+\n+var _istioCsrIstioCsrDenyAllNetworkpolicyYaml = []byte(`apiVersion: networking.k8s.io/v1\n+kind: NetworkPolicy\n+metadata:\n+  name: istio-csr-deny-all\n+  labels:\n+    cert-manager.operator.openshift.io/owned-by: istio-csr\n+spec:\n+  podSelector:\n+    matchLabels:\n+      app: cert-manager-istio-csr\n+  policyTypes:\n+  - Ingress\n+  - Egress\n+`)\n+\n+func istioCsrIstioCsrDenyAllNetworkpolicyYamlBytes() ([]byte, error) {\n+\treturn _istioCsrIstioCsrDenyAllNetworkpolicyYaml, nil\n+}\n+\n+func istioCsrIstioCsrDenyAllNetworkpolicyYaml() (*asset, error) {\n+\tbytes, err := istioCsrIstioCsrDenyAllNetworkpolicyYamlBytes()\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\tinfo := bindataFileInfo{name: \"istio-csr/istio-csr-deny-all-networkpolicy.yaml\", size: 0, mode: os.FileMode(0), modTime: time.Unix(0, 0)}\n+\ta := &asset{bytes: bytes, info: info}\n+\treturn a, nil\n+}\n+\n+var _istioCsrIstioCsrGrpcIngressNetworkpolicyYaml = []byte(`apiVersion: networking.k8s.io/v1\n+kind: NetworkPolicy\n+metadata:\n+  name: istio-csr-grpc-ingress\n+  labels:\n+    cert-manager.operator.openshift.io/owned-by: istio-csr\n+spec:\n+  podSelector:\n+    matchLabels:\n+      app: cert-manager-istio-csr\n+  policyTypes:\n+  - Ingress\n+  ingress:\n+  - ports:\n+    - protocol: TCP\n+      port: 6443\n+`)\n+\n+func istioCsrIstioCsrGrpcIngressNetworkpolicyYamlBytes() ([]byte, error) {\n+\treturn _istioCsrIstioCsrGrpcIngressNetworkpolicyYaml, nil\n+}\n+\n+func istioCsrIstioCsrGrpcIngressNetworkpolicyYaml() (*asset, error) {\n+\tbytes, err := istioCsrIstioCsrGrpcIngressNetworkpolicyYamlBytes()\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\tinfo := bindataFileInfo{name: \"istio-csr/istio-csr-grpc-ingress-networkpolicy.yaml\", size: 0, mode: os.FileMode(0), modTime: time.Unix(0, 0)}\n+\ta := &asset{bytes: bytes, info: info}\n+\treturn a, nil\n+}\n+\n+var _istioCsrIstioCsrMetricsIngressNetworkpolicyYaml = []byte(`apiVersion: networking.k8s.io/v1\n+kind: NetworkPolicy\n+metadata:\n+  name: istio-csr-metrics-ingress\n+  labels:\n+    cert-manager.operator.openshift.io/owned-by: istio-csr\n+spec:\n+  podSelector:\n+    matchLabels:\n+      app: cert-manager-istio-csr\n+  policyTypes:\n+  - Ingress\n+  ingress:\n+  - from:\n+    - namespaceSelector:\n+        matchLabels:\n+          name: openshift-monitoring\n+    ports:\n+    - protocol: TCP\n+      port: 9402\n+`)", "path": "pkg/operator/assets/bindata.go", "commit_id": "167c0ed38cf01bfe1b1dffd042ee70794a546beb", "original_commit_id": "9f6cd4178a2c1ed48e80c28d5e3dd6fd946702e7", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udfe0 Major_\n\n**Apply the same monitoring namespace label fix for istio-csr metrics**\n\nUse kubernetes.io/metadata.name: openshift-monitoring to reliably match the monitoring namespace.\n\n\nChange source YAML at bindata/istio-csr/istio-csr-metrics-ingress-networkpolicy.yaml and regenerate:\n\n```diff\n-    - namespaceSelector:\n-        matchLabels:\n-          name: openshift-monitoring\n+    - namespaceSelector:\n+        matchLabels:\n+          kubernetes.io/metadata.name: openshift-monitoring\n```\n\n\n> Committable suggestion skipped: line range outside the PR's diff.\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn pkg/operator/assets/bindata.go around lines 2926 to 2931, the embedded YAML\nfor istio-csr metrics uses the wrong namespace label; update the source YAML at\nbindata/istio-csr/istio-csr-metrics-ingress-networkpolicy.yaml to set the\nnamespace selector label to kubernetes.io/metadata.name: openshift-monitoring\n(replacing any other label key/value), then regenerate the bindata output so\nthis change is reflected in pkg/operator/assets/bindata.go.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:medusa:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit eb88d8a", "created_at": "2025-10-07T12:03:46Z", "updated_at": "2025-10-07T12:04:37Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2410395516", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2410395516"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2410395516"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2410395516/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 3023, "original_start_line": 2926, "start_side": "RIGHT", "line": 3028, "original_line": 3028, "side": "RIGHT", "author_association": "NONE", "original_position": 286, "position": 286, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 320, "file_path": "config/crd/bases/operator.openshift.io_certmanagers.yaml", "line_start": 811, "line_end": 811, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udfe0 Major_\n\n**Relax networkPolicies immutability before DefaultNetworkPolicy is enabled**\n\nThe CEL rule `!has(oldSelf) || size(oldSelf) == 0 || size(self) >= size(oldSelf)` blocks any attempt to shrink `networkPolicies` once it holds entries, even while `defaultNetworkPolicy` remains `\"false\"`. That contradicts the doc block (\u201cimmutable once DefaultNetworkPolicy is set to 'true'\u201d) and prevents users from fixing mistakes or removing placeholder policies before they actually flip the flag.\n\nPlease move this constraint to a spec-level validation (or otherwise gate it) so it only applies when `defaultNetworkPolicy == \"true\"`. For example:\n\n```yaml\nx-kubernetes-validations:\n- message: networkPolicies can only be reduced when defaultNetworkPolicy is not true\n  rule: \"self.defaultNetworkPolicy != 'true' || size(self.networkPolicies) >= size(oldSelf.networkPolicies)\"\n```\n\nWith this adjustment, edits remain flexible until the default policy is enabled, while still locking down the list afterwards.\n\n<!-- fingerprinting:phantom:medusa:sabertoothed -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2410415328", "pull_request_review_id": 3309822433, "id": 2410415328, "node_id": "PRRC_kwDOFdFn9s6PrATg", "diff_hunk": "@@ -536,6 +555,251 @@ spec:\n                   should manage the component\n                 pattern: ^(Managed|Unmanaged|Force|Removed)$\n                 type: string\n+              networkPolicies:\n+                description: |-\n+                  NetworkPolicies specifies the egress network policy configuration to be applied to cert-manager\n+                  pods/operands when DefaultNetworkPolicy is \"true\". By default, enabling network policies\n+                  creates a deny-all policy that blocks all outgoing traffic from cert-manager components.\n+                  Ingress rules are automatically handled by the operator based on the current running ports.\n+                  Use this field to provide the necessary egress policy rules that allow required outbound traffic\n+                  for cert-manager to function properly (e.g., API server communication, external issuer access, etc.).\n+\n+                  Each NetworkPolicy in this slice will be created as a separate Kubernetes NetworkPolicy\n+                  resource. Multiple policies can be defined to organize egress rules logically (e.g., separate\n+                  policies for different types of outbound traffic or different security zones).\n+\n+                  This field is only effective when DefaultNetworkPolicy is set to \"true\".\n+                  If DefaultNetworkPolicy is \"true\" but this field is not provided, cert-manager\n+                  components will be isolated with deny-all egress policies.\n+\n+                  This field is immutable once DefaultNetworkPolicy is set to \"true\" for security reasons.\n+                items:\n+                  description: |-\n+                    NetworkPolicy represents a custom network policy configuration for operator-managed components.\n+                    It includes a name for identification and the network policy rules to be enforced.\n+                  properties:\n+                    componentName:\n+                      description: ComponentName represents the different cert-manager\n+                        components that can have network policies applied.\n+                      enum:\n+                      - CAInjector\n+                      - CoreController\n+                      - Webhook\n+                      - IstioCSR\n+                      type: string\n+                    egress:\n+                      description: |-\n+                        egress is a list of egress rules to be applied to the selected pods. Outgoing traffic\n+                        is allowed if there are no NetworkPolicies selecting the pod (and cluster policy\n+                        otherwise allows the traffic), OR if the traffic matches at least one egress rule\n+                        across all of the NetworkPolicy objects whose podSelector matches the pod. If\n+                        this field is empty then this NetworkPolicy limits all outgoing traffic (and serves\n+                        solely to ensure that the pods it selects are isolated by default).\n+                        The operator will automatically handle ingress rules based on the current running ports.\n+                      items:\n+                        description: |-\n+                          NetworkPolicyEgressRule describes a particular set of traffic that is allowed out of pods\n+                          matched by a NetworkPolicySpec's podSelector. The traffic must match both ports and to.\n+                          This type is beta-level in 1.8\n+                        properties:\n+                          ports:\n+                            description: |-\n+                              ports is a list of destination ports for outgoing traffic.\n+                              Each item in this list is combined using a logical OR. If this field is\n+                              empty or missing, this rule matches all ports (traffic not restricted by port).\n+                              If this field is present and contains at least one item, then this rule allows\n+                              traffic only if the traffic matches at least one port in the list.\n+                            items:\n+                              description: NetworkPolicyPort describes a port to allow\n+                                traffic on\n+                              properties:\n+                                endPort:\n+                                  description: |-\n+                                    endPort indicates that the range of ports from port to endPort if set, inclusive,\n+                                    should be allowed by the policy. This field cannot be defined if the port field\n+                                    is not defined or if the port field is defined as a named (string) port.\n+                                    The endPort must be equal or greater than port.\n+                                  format: int32\n+                                  type: integer\n+                                port:\n+                                  anyOf:\n+                                  - type: integer\n+                                  - type: string\n+                                  description: |-\n+                                    port represents the port on the given protocol. This can either be a numerical or named\n+                                    port on a pod. If this field is not provided, this matches all port names and\n+                                    numbers.\n+                                    If present, only traffic on the specified protocol AND port will be matched.\n+                                  x-kubernetes-int-or-string: true\n+                                protocol:\n+                                  default: TCP\n+                                  description: |-\n+                                    protocol represents the protocol (TCP, UDP, or SCTP) which traffic must match.\n+                                    If not specified, this field defaults to TCP.\n+                                  type: string\n+                              type: object\n+                            type: array\n+                            x-kubernetes-list-type: atomic\n+                          to:\n+                            description: |-\n+                              to is a list of destinations for outgoing traffic of pods selected for this rule.\n+                              Items in this list are combined using a logical OR operation. If this field is\n+                              empty or missing, this rule matches all destinations (traffic not restricted by\n+                              destination). If this field is present and contains at least one item, this rule\n+                              allows traffic only if the traffic matches at least one item in the to list.\n+                            items:\n+                              description: |-\n+                                NetworkPolicyPeer describes a peer to allow traffic to/from. Only certain combinations of\n+                                fields are allowed\n+                              properties:\n+                                ipBlock:\n+                                  description: |-\n+                                    ipBlock defines policy on a particular IPBlock. If this field is set then\n+                                    neither of the other fields can be.\n+                                  properties:\n+                                    cidr:\n+                                      description: |-\n+                                        cidr is a string representing the IPBlock\n+                                        Valid examples are \"192.168.1.0/24\" or \"2001:db8::/64\"\n+                                      type: string\n+                                    except:\n+                                      description: |-\n+                                        except is a slice of CIDRs that should not be included within an IPBlock\n+                                        Valid examples are \"192.168.1.0/24\" or \"2001:db8::/64\"\n+                                        Except values will be rejected if they are outside the cidr range\n+                                      items:\n+                                        type: string\n+                                      type: array\n+                                      x-kubernetes-list-type: atomic\n+                                  required:\n+                                  - cidr\n+                                  type: object\n+                                namespaceSelector:\n+                                  description: |-\n+                                    namespaceSelector selects namespaces using cluster-scoped labels. This field follows\n+                                    standard label selector semantics; if present but empty, it selects all namespaces.\n+\n+                                    If podSelector is also set, then the NetworkPolicyPeer as a whole selects\n+                                    the pods matching podSelector in the namespaces selected by namespaceSelector.\n+                                    Otherwise it selects all pods in the namespaces selected by namespaceSelector.\n+                                  properties:\n+                                    matchExpressions:\n+                                      description: matchExpressions is a list of label\n+                                        selector requirements. The requirements are\n+                                        ANDed.\n+                                      items:\n+                                        description: |-\n+                                          A label selector requirement is a selector that contains values, a key, and an operator that\n+                                          relates the key and values.\n+                                        properties:\n+                                          key:\n+                                            description: key is the label key that\n+                                              the selector applies to.\n+                                            type: string\n+                                          operator:\n+                                            description: |-\n+                                              operator represents a key's relationship to a set of values.\n+                                              Valid operators are In, NotIn, Exists and DoesNotExist.\n+                                            type: string\n+                                          values:\n+                                            description: |-\n+                                              values is an array of string values. If the operator is In or NotIn,\n+                                              the values array must be non-empty. If the operator is Exists or DoesNotExist,\n+                                              the values array must be empty. This array is replaced during a strategic\n+                                              merge patch.\n+                                            items:\n+                                              type: string\n+                                            type: array\n+                                            x-kubernetes-list-type: atomic\n+                                        required:\n+                                        - key\n+                                        - operator\n+                                        type: object\n+                                      type: array\n+                                      x-kubernetes-list-type: atomic\n+                                    matchLabels:\n+                                      additionalProperties:\n+                                        type: string\n+                                      description: |-\n+                                        matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels\n+                                        map is equivalent to an element of matchExpressions, whose key field is \"key\", the\n+                                        operator is \"In\", and the values array contains only \"value\". The requirements are ANDed.\n+                                      type: object\n+                                  type: object\n+                                  x-kubernetes-map-type: atomic\n+                                podSelector:\n+                                  description: |-\n+                                    podSelector is a label selector which selects pods. This field follows standard label\n+                                    selector semantics; if present but empty, it selects all pods.\n+\n+                                    If namespaceSelector is also set, then the NetworkPolicyPeer as a whole selects\n+                                    the pods matching podSelector in the Namespaces selected by NamespaceSelector.\n+                                    Otherwise it selects the pods matching podSelector in the policy's own namespace.\n+                                  properties:\n+                                    matchExpressions:\n+                                      description: matchExpressions is a list of label\n+                                        selector requirements. The requirements are\n+                                        ANDed.\n+                                      items:\n+                                        description: |-\n+                                          A label selector requirement is a selector that contains values, a key, and an operator that\n+                                          relates the key and values.\n+                                        properties:\n+                                          key:\n+                                            description: key is the label key that\n+                                              the selector applies to.\n+                                            type: string\n+                                          operator:\n+                                            description: |-\n+                                              operator represents a key's relationship to a set of values.\n+                                              Valid operators are In, NotIn, Exists and DoesNotExist.\n+                                            type: string\n+                                          values:\n+                                            description: |-\n+                                              values is an array of string values. If the operator is In or NotIn,\n+                                              the values array must be non-empty. If the operator is Exists or DoesNotExist,\n+                                              the values array must be empty. This array is replaced during a strategic\n+                                              merge patch.\n+                                            items:\n+                                              type: string\n+                                            type: array\n+                                            x-kubernetes-list-type: atomic\n+                                        required:\n+                                        - key\n+                                        - operator\n+                                        type: object\n+                                      type: array\n+                                      x-kubernetes-list-type: atomic\n+                                    matchLabels:\n+                                      additionalProperties:\n+                                        type: string\n+                                      description: |-\n+                                        matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels\n+                                        map is equivalent to an element of matchExpressions, whose key field is \"key\", the\n+                                        operator is \"In\", and the values array contains only \"value\". The requirements are ANDed.\n+                                      type: object\n+                                  type: object\n+                                  x-kubernetes-map-type: atomic\n+                              type: object\n+                            type: array\n+                            x-kubernetes-list-type: atomic\n+                        type: object\n+                      type: array\n+                      x-kubernetes-list-type: atomic\n+                    name:\n+                      description: |-\n+                        Name is a unique identifier for this network policy configuration.\n+                        This name will be used as part of the generated NetworkPolicy resource name.\n+                      type: string\n+                  required:\n+                  - componentName\n+                  - name\n+                  type: object\n+                type: array\n+                x-kubernetes-validations:\n+                - message: networkPolicies can only be extended, not reduced, once\n+                    defaultNetworkPolicy is enabled\n+                  rule: '!has(oldSelf) || size(oldSelf) == 0 || size(self) >= size(oldSelf)'\n               observedConfig:", "path": "config/crd/bases/operator.openshift.io_certmanagers.yaml", "commit_id": "eb88d8aabe810523a4dafeda023bb474de53b5ac", "original_commit_id": "eb88d8aabe810523a4dafeda023bb474de53b5ac", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udfe0 Major_\n\n**Relax networkPolicies immutability before DefaultNetworkPolicy is enabled**\n\nThe CEL rule `!has(oldSelf) || size(oldSelf) == 0 || size(self) >= size(oldSelf)` blocks any attempt to shrink `networkPolicies` once it holds entries, even while `defaultNetworkPolicy` remains `\"false\"`. That contradicts the doc block (\u201cimmutable once DefaultNetworkPolicy is set to 'true'\u201d) and prevents users from fixing mistakes or removing placeholder policies before they actually flip the flag.\n\nPlease move this constraint to a spec-level validation (or otherwise gate it) so it only applies when `defaultNetworkPolicy == \"true\"`. For example:\n\n```yaml\nx-kubernetes-validations:\n- message: networkPolicies can only be reduced when defaultNetworkPolicy is not true\n  rule: \"self.defaultNetworkPolicy != 'true' || size(self.networkPolicies) >= size(oldSelf.networkPolicies)\"\n```\n\nWith this adjustment, edits remain flexible until the default policy is enabled, while still locking down the list afterwards.\n\n<!-- fingerprinting:phantom:medusa:sabertoothed -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "created_at": "2025-10-07T12:11:38Z", "updated_at": "2025-10-07T12:11:40Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2410415328", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2410415328"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2410415328"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2410415328/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 560, "original_start_line": 559, "start_side": "RIGHT", "line": 811, "original_line": 811, "side": "RIGHT", "author_association": "NONE", "original_position": 275, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 320, "file_path": "pkg/controller/deployment/cert_manager_networkpolicy.go", "line_start": 199, "line_end": 199, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udfe0 Major_\n\n**Set owner reference for lifecycle management.**\n\nThe NetworkPolicy objects created here lack an owner reference to the CertManager CR. Without it:\n- Policies won't be garbage collected when the CertManager CR is deleted\n- Ownership is unclear during troubleshooting\n- Orphaned resources accumulate in the cluster\n\n\nAdd an owner reference in the ObjectMeta:\n\n```diff\n func (c *CertManagerNetworkPolicyUserDefinedController) createUserNetworkPolicy(userPolicy v1alpha1.NetworkPolicy) *networkingv1.NetworkPolicy {\n \tpodSelector := c.getPodSelectorForComponent(userPolicy.ComponentName)\n+\t// Note: You'll need to pass the CertManager CR to this function to set the owner reference\n \n \treturn &networkingv1.NetworkPolicy{\n \t\tObjectMeta: metav1.ObjectMeta{\n \t\t\tName:      fmt.Sprintf(\"cert-manager-user-%s\", userPolicy.Name),\n \t\t\tNamespace: certManagerNamespace,\n \t\t\tLabels: map[string]string{\n \t\t\t\tnetworkPolicyOwnerLabel: \"cert-manager\",\n \t\t\t},\n+\t\t\tOwnerReferences: []metav1.OwnerReference{\n+\t\t\t\t{\n+\t\t\t\t\tAPIVersion: \"operator.openshift.io/v1alpha1\",\n+\t\t\t\t\tKind:       \"CertManager\",\n+\t\t\t\t\tName:       certManager.Name,\n+\t\t\t\t\tUID:        certManager.UID,\n+\t\t\t\t},\n+\t\t\t},\n \t\t},\n \t\tSpec: networkingv1.NetworkPolicySpec{\n \t\t\tPodSelector: podSelector,\n \t\t\tPolicyTypes: []networkingv1.PolicyType{\n \t\t\t\tnetworkingv1.PolicyTypeEgress,\n \t\t\t},\n \t\t\tEgress: userPolicy.Egress,\n \t\t},\n \t}\n }\n```\n\n\n> Committable suggestion skipped: line range outside the PR's diff.\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2410415343", "pull_request_review_id": 3309822433, "id": 2410415343, "node_id": "PRRC_kwDOFdFn9s6PrATv", "diff_hunk": "@@ -0,0 +1,257 @@\n+package deployment\n+\n+import (\n+\t\"context\"\n+\t\"fmt\"\n+\n+\tnetworkingv1 \"k8s.io/api/networking/v1\"\n+\t\"k8s.io/apimachinery/pkg/api/errors\"\n+\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n+\t\"k8s.io/client-go/kubernetes\"\n+\n+\t\"github.com/openshift/library-go/pkg/controller/factory\"\n+\t\"github.com/openshift/library-go/pkg/operator/events\"\n+\t\"github.com/openshift/library-go/pkg/operator/resource/resourceapply\"\n+\t\"github.com/openshift/library-go/pkg/operator/staticresourcecontroller\"\n+\t\"github.com/openshift/library-go/pkg/operator/v1helpers\"\n+\n+\t\"github.com/openshift/cert-manager-operator/api/operator/v1alpha1\"\n+\t\"github.com/openshift/cert-manager-operator/pkg/operator/assets\"\n+\tcertmanoperatorinformers \"github.com/openshift/cert-manager-operator/pkg/operator/informers/externalversions\"\n+)\n+\n+const (\n+\tcertManagerNetworkPolicyStaticResourcesControllerName = operatorName + \"-networkpolicy-static-resources-\"\n+\tcertManagerNetworkPolicyUserDefinedControllerName     = operatorName + \"-networkpolicy-user-defined\"\n+\tcertManagerNamespace                                  = \"cert-manager\"\n+\tnetworkPolicyOwnerLabel                               = \"cert-manager.operator.openshift.io/owned-by\"\n+)\n+\n+var (\n+\t// Static network policy asset files for default policies\n+\tcertManagerNetworkPolicyAssetFiles = []string{\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-deny-all-networkpolicy.yaml\",\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-api-server-egress-networkpolicy.yaml\",\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-metrics-ingress-networkpolicy.yaml\",\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-webhook-ingress-networkpolicy.yaml\",\n+\t}\n+)\n+\n+// ============================================================================\n+// STATIC RESOURCE CONTROLLER - for default network policies from YAML files\n+// ============================================================================\n+\n+func NewCertManagerNetworkPolicyStaticResourcesController(operatorClient v1helpers.OperatorClient,\n+\tkubeClientContainer *resourceapply.ClientHolder,\n+\tkubeInformersForNamespaces v1helpers.KubeInformersForNamespaces,\n+\tcertManagerOperatorInformers certmanoperatorinformers.SharedInformerFactory,\n+\teventsRecorder events.Recorder) factory.Controller {\n+\n+\t// Create conditional function to check if network policies should be applied\n+\tshouldApplyNetworkPolicies := func() bool {\n+\t\tcertManager, err := certManagerOperatorInformers.Operator().V1alpha1().CertManagers().Lister().Get(\"cluster\")\n+\t\tif err != nil {\n+\t\t\treturn false\n+\t\t}\n+\t\treturn certManager.Spec.DefaultNetworkPolicy == \"true\"\n+\t}\n+\n+\treturn staticresourcecontroller.NewStaticResourceController(\n+\t\tcertManagerNetworkPolicyStaticResourcesControllerName,\n+\t\tassets.Asset,\n+\t\t[]string{}, // empty files, we'll add them conditionally\n+\t\tkubeClientContainer,\n+\t\toperatorClient,\n+\t\teventsRecorder,\n+\t).WithConditionalResources(\n+\t\tassets.Asset,\n+\t\tcertManagerNetworkPolicyAssetFiles,\n+\t\tshouldApplyNetworkPolicies,\n+\t\tnil, // Since immutable, we never delete\n+\t).AddKubeInformers(kubeInformersForNamespaces).AddInformer(\n+\t\tcertManagerOperatorInformers.Operator().V1alpha1().CertManagers().Informer(),\n+\t)\n+}\n+\n+// ============================================================================\n+// USER-DEFINED CONTROLLER - for user-configured network policies from API\n+// ============================================================================\n+\n+// CertManagerNetworkPolicyUserDefinedController manages user-defined NetworkPolicy resources\n+type CertManagerNetworkPolicyUserDefinedController struct {\n+\toperatorClient               v1helpers.OperatorClient\n+\tcertManagerOperatorInformers certmanoperatorinformers.SharedInformerFactory\n+\tkubeClient                   kubernetes.Interface\n+\teventRecorder                events.Recorder\n+}\n+\n+func NewCertManagerNetworkPolicyUserDefinedController(\n+\toperatorClient v1helpers.OperatorClient,\n+\tcertManagerOperatorInformers certmanoperatorinformers.SharedInformerFactory,\n+\tkubeClient kubernetes.Interface,\n+\teventRecorder events.Recorder,\n+) factory.Controller {\n+\tc := &CertManagerNetworkPolicyUserDefinedController{\n+\t\toperatorClient:               operatorClient,\n+\t\tcertManagerOperatorInformers: certManagerOperatorInformers,\n+\t\tkubeClient:                   kubeClient,\n+\t\teventRecorder:                eventRecorder.WithComponentSuffix(\"cert-manager-networkpolicy-user-defined\"),\n+\t}\n+\n+\treturn factory.New().\n+\t\tWithInformers(\n+\t\t\toperatorClient.Informer(),\n+\t\t\tcertManagerOperatorInformers.Operator().V1alpha1().CertManagers().Informer(),\n+\t\t).\n+\t\tWithSync(c.sync).\n+\t\tToController(certManagerNetworkPolicyUserDefinedControllerName, c.eventRecorder)\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) sync(ctx context.Context, syncCtx factory.SyncContext) error {\n+\t// Get the current CertManager configuration\n+\tcertManager, err := c.certManagerOperatorInformers.Operator().V1alpha1().CertManagers().Lister().Get(\"cluster\")\n+\tif err != nil {\n+\t\tif errors.IsNotFound(err) {\n+\t\t\t// No CertManager found, nothing to do\n+\t\t\treturn nil\n+\t\t}\n+\t\treturn fmt.Errorf(\"failed to get CertManager: %w\", err)\n+\t}\n+\n+\t// Check if network policies are enabled\n+\tif certManager.Spec.DefaultNetworkPolicy != \"true\" {\n+\t\t// Network policies not enabled, nothing to do\n+\t\t// Note: Since fields are immutable, no cleanup needed\n+\t\treturn nil\n+\t}\n+\n+\t// Validate user-defined network policy configuration\n+\tif err := c.validateNetworkPolicyConfig(certManager); err != nil {\n+\t\tc.eventRecorder.Warningf(\"NetworkPolicyValidationFailed\", \"Network policy configuration validation failed: %v\", err)\n+\t\treturn fmt.Errorf(\"network policy configuration validation failed: %w\", err)\n+\t}\n+\n+\t// Apply user-defined network policies\n+\tif err := c.reconcileUserNetworkPolicies(ctx, certManager); err != nil {\n+\t\tc.eventRecorder.Warningf(\"UserNetworkPolicyReconcileFailed\", \"Failed to reconcile user network policies: %v\", err)\n+\t\treturn fmt.Errorf(\"failed to reconcile user network policies: %w\", err)\n+\t}\n+\n+\tc.eventRecorder.Event(\"UserNetworkPolicyReconcileSuccess\", \"Successfully reconciled user-defined network policies\")\n+\treturn nil\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) validateNetworkPolicyConfig(certManager *v1alpha1.CertManager) error {\n+\t// Validate each user-defined network policy\n+\tfor i, policy := range certManager.Spec.NetworkPolicies {\n+\t\tif policy.Name == \"\" {\n+\t\t\treturn fmt.Errorf(\"network policy at index %d: name cannot be empty\", i)\n+\t\t}\n+\t\tif len(policy.Egress) == 0 {\n+\t\t\treturn fmt.Errorf(\"network policy at index %d: egress rules cannot be empty when network policies are enabled\", i)\n+\t\t}\n+\t\tif err := c.validateComponentName(policy.ComponentName); err != nil {\n+\t\t\treturn fmt.Errorf(\"network policy at index %d: invalid component name: %w\", i, err)\n+\t\t}\n+\t}\n+\treturn nil\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) validateComponentName(componentName v1alpha1.ComponentName) error {\n+\tswitch componentName {\n+\tcase v1alpha1.CAInjector, v1alpha1.CoreController, v1alpha1.Webhook:\n+\t\treturn nil\n+\tdefault:\n+\t\treturn fmt.Errorf(\"unsupported component name: %s\", componentName)\n+\t}\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) reconcileUserNetworkPolicies(ctx context.Context, certManager *v1alpha1.CertManager) error {\n+\t// Apply each user-defined network policy\n+\tfor _, userPolicy := range certManager.Spec.NetworkPolicies {\n+\t\tpolicy := c.createUserNetworkPolicy(userPolicy)\n+\t\tif err := c.createOrUpdateNetworkPolicy(ctx, policy); err != nil {\n+\t\t\treturn fmt.Errorf(\"failed to create/update user network policy %s: %w\", policy.Name, err)\n+\t\t}\n+\t}\n+\n+\treturn nil\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) createUserNetworkPolicy(userPolicy v1alpha1.NetworkPolicy) *networkingv1.NetworkPolicy {\n+\tpodSelector := c.getPodSelectorForComponent(userPolicy.ComponentName)\n+\n+\treturn &networkingv1.NetworkPolicy{\n+\t\tObjectMeta: metav1.ObjectMeta{\n+\t\t\tName:      fmt.Sprintf(\"cert-manager-user-%s\", userPolicy.Name),\n+\t\t\tNamespace: certManagerNamespace,\n+\t\t\tLabels: map[string]string{\n+\t\t\t\tnetworkPolicyOwnerLabel: \"cert-manager\",\n+\t\t\t},\n+\t\t},\n+\t\tSpec: networkingv1.NetworkPolicySpec{\n+\t\t\tPodSelector: podSelector,\n+\t\t\tPolicyTypes: []networkingv1.PolicyType{\n+\t\t\t\tnetworkingv1.PolicyTypeEgress,\n+\t\t\t},\n+\t\t\tEgress: userPolicy.Egress,\n+\t\t},\n+\t}\n+}", "path": "pkg/controller/deployment/cert_manager_networkpolicy.go", "commit_id": "167c0ed38cf01bfe1b1dffd042ee70794a546beb", "original_commit_id": "eb88d8aabe810523a4dafeda023bb474de53b5ac", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udfe0 Major_\n\n**Set owner reference for lifecycle management.**\n\nThe NetworkPolicy objects created here lack an owner reference to the CertManager CR. Without it:\n- Policies won't be garbage collected when the CertManager CR is deleted\n- Ownership is unclear during troubleshooting\n- Orphaned resources accumulate in the cluster\n\n\nAdd an owner reference in the ObjectMeta:\n\n```diff\n func (c *CertManagerNetworkPolicyUserDefinedController) createUserNetworkPolicy(userPolicy v1alpha1.NetworkPolicy) *networkingv1.NetworkPolicy {\n \tpodSelector := c.getPodSelectorForComponent(userPolicy.ComponentName)\n+\t// Note: You'll need to pass the CertManager CR to this function to set the owner reference\n \n \treturn &networkingv1.NetworkPolicy{\n \t\tObjectMeta: metav1.ObjectMeta{\n \t\t\tName:      fmt.Sprintf(\"cert-manager-user-%s\", userPolicy.Name),\n \t\t\tNamespace: certManagerNamespace,\n \t\t\tLabels: map[string]string{\n \t\t\t\tnetworkPolicyOwnerLabel: \"cert-manager\",\n \t\t\t},\n+\t\t\tOwnerReferences: []metav1.OwnerReference{\n+\t\t\t\t{\n+\t\t\t\t\tAPIVersion: \"operator.openshift.io/v1alpha1\",\n+\t\t\t\t\tKind:       \"CertManager\",\n+\t\t\t\t\tName:       certManager.Name,\n+\t\t\t\t\tUID:        certManager.UID,\n+\t\t\t\t},\n+\t\t\t},\n \t\t},\n \t\tSpec: networkingv1.NetworkPolicySpec{\n \t\t\tPodSelector: podSelector,\n \t\t\tPolicyTypes: []networkingv1.PolicyType{\n \t\t\t\tnetworkingv1.PolicyTypeEgress,\n \t\t\t},\n \t\t\tEgress: userPolicy.Egress,\n \t\t},\n \t}\n }\n```\n\n\n> Committable suggestion skipped: line range outside the PR's diff.\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "created_at": "2025-10-07T12:11:39Z", "updated_at": "2025-10-09T10:44:13Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2410415343", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2410415343"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2410415343"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2410415343/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 180, "original_start_line": 181, "start_side": "RIGHT", "line": 199, "original_line": 199, "side": "RIGHT", "author_association": "NONE", "original_position": 200, "position": 199, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 320, "file_path": "api/operator/v1alpha1/certmanager_types.go", "line_start": 241, "line_end": 241, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Verify ComponentName enum completeness.**\n\nThe enum includes `CAInjector`, `CoreController`, `Webhook`, and `IstioCSRComponent`. Confirm that:\n1. These match all cert-manager components that the operator manages\n2. The operator creates default network policies for all these components when `DefaultNetworkPolicy` is enabled\n3. IstioCSR is actually deployed by this operator (or planned for future support)\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Verify which components the operator actually deploys\n\necho \"=== Searching for component deployment logic ===\"\nrg -n \"(cainjector|controller|webhook|istio-csr)\" --type go -g 'pkg/controller/**/*.go' -i -C2\n\necho -e \"\\n=== Checking bindata assets for these components ===\"\nfd -e yaml . bindata/ | xargs -I {} bash -c 'if rg -l \"(cainjector|controller|webhook|istio-csr)\" {} -i > /dev/null; then echo \"{}\"; fi'\n\necho -e \"\\n=== Checking if IstioCSR component exists in assets ===\"\nrg -n \"istio-csr|istiocsr\" --type yaml bindata/\n```\n\nLength of output: 178593\n\n---\n\n\n\n</details>\n\n**Align ComponentName enum with implemented CertManager components**  \ncertmanager_types.go declares IstioCSRComponent but CertManagerSpec and its network-policy controllers only support CAInjector, CoreController, and Webhook; remove IstioCSRComponent or extend validateComponentName, getPodSelectorForComponent, and static network-policy assets to handle it.\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit 9759f81", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2413424656", "pull_request_review_id": 3314209388, "id": 2413424656, "node_id": "PRRC_kwDOFdFn9s6P2fAQ", "diff_hunk": "@@ -181,6 +218,50 @@ type CertManagerList struct {\n \tItems []CertManager `json:\"items\"`\n }\n \n+// ComponentName represents the different cert-manager components that can have network policies applied.\n+type ComponentName string\n+\n+const (\n+\t// CAInjector represents the cert-manager CA injector component\n+\tCAInjector ComponentName = \"CAInjector\"\n+\n+\t// CoreController represents the cert-manager core controller component\n+\tCoreController ComponentName = \"CoreController\"\n+\n+\t// Webhook represents the cert-manager webhook component\n+\tWebhook ComponentName = \"Webhook\"\n+\n+\t// IstioCSRComponent represents the cert-manager Istio CSR component\n+\tIstioCSRComponent ComponentName = \"IstioCSR\"\n+)", "path": "api/operator/v1alpha1/certmanager_types.go", "commit_id": "167c0ed38cf01bfe1b1dffd042ee70794a546beb", "original_commit_id": "4b635b00dad11a605c8fc63f3fcab220486a92bc", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Verify ComponentName enum completeness.**\n\nThe enum includes `CAInjector`, `CoreController`, `Webhook`, and `IstioCSRComponent`. Confirm that:\n1. These match all cert-manager components that the operator manages\n2. The operator creates default network policies for all these components when `DefaultNetworkPolicy` is enabled\n3. IstioCSR is actually deployed by this operator (or planned for future support)\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Verify which components the operator actually deploys\n\necho \"=== Searching for component deployment logic ===\"\nrg -n \"(cainjector|controller|webhook|istio-csr)\" --type go -g 'pkg/controller/**/*.go' -i -C2\n\necho -e \"\\n=== Checking bindata assets for these components ===\"\nfd -e yaml . bindata/ | xargs -I {} bash -c 'if rg -l \"(cainjector|controller|webhook|istio-csr)\" {} -i > /dev/null; then echo \"{}\"; fi'\n\necho -e \"\\n=== Checking if IstioCSR component exists in assets ===\"\nrg -n \"istio-csr|istiocsr\" --type yaml bindata/\n```\n\nLength of output: 178593\n\n---\n\n\n\n</details>\n\n**Align ComponentName enum with implemented CertManager components**  \ncertmanager_types.go declares IstioCSRComponent but CertManagerSpec and its network-policy controllers only support CAInjector, CoreController, and Webhook; remove IstioCSRComponent or extend validateComponentName, getPodSelectorForComponent, and static network-policy assets to handle it.\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit 9759f81", "created_at": "2025-10-08T10:40:58Z", "updated_at": "2025-10-13T06:28:10Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2413424656", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2413424656"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2413424656"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2413424656/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 232, "original_start_line": 224, "start_side": "RIGHT", "line": 241, "original_line": 241, "side": "RIGHT", "author_association": "NONE", "original_position": 70, "position": 75, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 320, "file_path": "api/operator/v1alpha1/certmanager_types.go", "line_start": 270, "line_end": 270, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Verify NetworkPolicy struct validation and usage.**\n\nThe struct correctly reuses `networkingv1.NetworkPolicyEgressRule` for the `Egress` field. However, verify:\n\n1. **Ingress handling**: The documentation (line 259) states \"The operator will automatically handle ingress rules based on the current running ports.\" Confirm this is implemented correctly.\n\n2. **podSelector generation**: Since the `NetworkPolicy` struct doesn't include a `podSelector` field, the operator must generate it based on `ComponentName`. Verify this logic exists.\n\n3. **Naming conflicts**: The `Name` field is used \"as part of the generated NetworkPolicy resource name\" (line 242). Ensure the operator prevents naming collisions between user-defined and default policies.\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Verify operator's NetworkPolicy generation logic\n\necho \"=== Searching for NetworkPolicy resource creation ===\"\nast-grep --pattern $'func $_($$_) {\n  $$$\n  networkPolicy := $$$networkingv1.NetworkPolicy$$$\n  $$$\n}'\n\necho -e \"\\n=== Searching for podSelector generation ===\"\nrg -n \"podSelector|PodSelector\" --type go -g 'pkg/controller/**/*.go' -C3\n\necho -e \"\\n=== Searching for ingress rule generation ===\"\nrg -n \"(ingress|Ingress).*[Rr]ule\" --type go -g 'pkg/controller/**/*networkpolicy*.go' -C3\n```\n\nLength of output: 4155\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Inspect default network policy generation in deployment controller\necho \"=== Default Policy Controller Functions ===\"\nrg -n \"CertManagerNetworkPolicy.*DefaultController\" -g 'pkg/controller/deployment/cert_manager_networkpolicy.go' -C2\n\necho -e \"\\n=== Functions generating default network policies ===\"\nrg -n \"createDefault\" -g 'pkg/controller/deployment/cert_manager_networkpolicy.go' -C5\n```\n\nLength of output: 98\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\necho \"=== Inspect createUserNetworkPolicy resource naming and policy types ===\"\nsed -n '170,230p' pkg/controller/deployment/cert_manager_networkpolicy.go | sed -n 's/^/    /'\n\necho -e \"\\n=== Check istioCSR networkpolicies ingress/egress settings ===\"\nsed -n '1,200p' pkg/controller/istiocsr/networkpolicies.go | rg -n \"PolicyType|Ingress|Egress|Rule\" -C2\n```\n\nLength of output: 1554\n\n---\n\n\n\n</details>\n\n**Implement default ingress in user-defined NetworkPolicy and enforce unique naming**\n\n- pkg/controller/deployment/cert_manager_networkpolicy.go:createUserNetworkPolicy currently sets only Egress; extend Spec.PolicyTypes to include Ingress and generate default ingress rules (or update the doc to match behavior).\n- In the same function, ensure ObjectMeta.Name combines ComponentName and userPolicy.Name in a deterministic, collision-safe pattern (e.g. `<component>-<name>`).\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2413424664", "pull_request_review_id": 3314209388, "id": 2413424664, "node_id": "PRRC_kwDOFdFn9s6P2fAY", "diff_hunk": "@@ -181,6 +218,50 @@ type CertManagerList struct {\n \tItems []CertManager `json:\"items\"`\n }\n \n+// ComponentName represents the different cert-manager components that can have network policies applied.\n+type ComponentName string\n+\n+const (\n+\t// CAInjector represents the cert-manager CA injector component\n+\tCAInjector ComponentName = \"CAInjector\"\n+\n+\t// CoreController represents the cert-manager core controller component\n+\tCoreController ComponentName = \"CoreController\"\n+\n+\t// Webhook represents the cert-manager webhook component\n+\tWebhook ComponentName = \"Webhook\"\n+\n+\t// IstioCSRComponent represents the cert-manager Istio CSR component\n+\tIstioCSRComponent ComponentName = \"IstioCSR\"\n+)\n+\n+// NetworkPolicy represents a custom network policy configuration for operator-managed components.\n+// It includes a name for identification and the network policy rules to be enforced.\n+type NetworkPolicy struct {\n+\t// Name is a unique identifier for this network policy configuration.\n+\t// This name will be used as part of the generated NetworkPolicy resource name.\n+\t// +kubebuilder:validation:Required\n+\t// +required\n+\tName string `json:\"name\"`\n+\n+\t// ComponentName represents the different cert-manager components that can have network policies applied.\n+\t// +kubebuilder:validation:Enum=CAInjector;CoreController;Webhook;IstioCSR\n+\t// +kubebuilder:validation:Required\n+\t// +required\n+\tComponentName ComponentName `json:\"componentName\"`\n+\n+\t// egress is a list of egress rules to be applied to the selected pods. Outgoing traffic\n+\t// is allowed if there are no NetworkPolicies selecting the pod (and cluster policy\n+\t// otherwise allows the traffic), OR if the traffic matches at least one egress rule\n+\t// across all of the NetworkPolicy objects whose podSelector matches the pod. If\n+\t// this field is empty then this NetworkPolicy limits all outgoing traffic (and serves\n+\t// solely to ensure that the pods it selects are isolated by default).\n+\t// The operator will automatically handle ingress rules based on the current running ports.\n+\t// +optional\n+\t// +listType=atomic\n+\tEgress []networkingv1.NetworkPolicyEgressRule `json:\"egress,omitempty\" protobuf:\"bytes,3,rep,name=egress\"`\n+}", "path": "api/operator/v1alpha1/certmanager_types.go", "commit_id": "167c0ed38cf01bfe1b1dffd042ee70794a546beb", "original_commit_id": "4b635b00dad11a605c8fc63f3fcab220486a92bc", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Verify NetworkPolicy struct validation and usage.**\n\nThe struct correctly reuses `networkingv1.NetworkPolicyEgressRule` for the `Egress` field. However, verify:\n\n1. **Ingress handling**: The documentation (line 259) states \"The operator will automatically handle ingress rules based on the current running ports.\" Confirm this is implemented correctly.\n\n2. **podSelector generation**: Since the `NetworkPolicy` struct doesn't include a `podSelector` field, the operator must generate it based on `ComponentName`. Verify this logic exists.\n\n3. **Naming conflicts**: The `Name` field is used \"as part of the generated NetworkPolicy resource name\" (line 242). Ensure the operator prevents naming collisions between user-defined and default policies.\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Verify operator's NetworkPolicy generation logic\n\necho \"=== Searching for NetworkPolicy resource creation ===\"\nast-grep --pattern $'func $_($$_) {\n  $$$\n  networkPolicy := $$$networkingv1.NetworkPolicy$$$\n  $$$\n}'\n\necho -e \"\\n=== Searching for podSelector generation ===\"\nrg -n \"podSelector|PodSelector\" --type go -g 'pkg/controller/**/*.go' -C3\n\necho -e \"\\n=== Searching for ingress rule generation ===\"\nrg -n \"(ingress|Ingress).*[Rr]ule\" --type go -g 'pkg/controller/**/*networkpolicy*.go' -C3\n```\n\nLength of output: 4155\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Inspect default network policy generation in deployment controller\necho \"=== Default Policy Controller Functions ===\"\nrg -n \"CertManagerNetworkPolicy.*DefaultController\" -g 'pkg/controller/deployment/cert_manager_networkpolicy.go' -C2\n\necho -e \"\\n=== Functions generating default network policies ===\"\nrg -n \"createDefault\" -g 'pkg/controller/deployment/cert_manager_networkpolicy.go' -C5\n```\n\nLength of output: 98\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\necho \"=== Inspect createUserNetworkPolicy resource naming and policy types ===\"\nsed -n '170,230p' pkg/controller/deployment/cert_manager_networkpolicy.go | sed -n 's/^/    /'\n\necho -e \"\\n=== Check istioCSR networkpolicies ingress/egress settings ===\"\nsed -n '1,200p' pkg/controller/istiocsr/networkpolicies.go | rg -n \"PolicyType|Ingress|Egress|Rule\" -C2\n```\n\nLength of output: 1554\n\n---\n\n\n\n</details>\n\n**Implement default ingress in user-defined NetworkPolicy and enforce unique naming**\n\n- pkg/controller/deployment/cert_manager_networkpolicy.go:createUserNetworkPolicy currently sets only Egress; extend Spec.PolicyTypes to include Ingress and generate default ingress rules (or update the doc to match behavior).\n- In the same function, ensure ObjectMeta.Name combines ComponentName and userPolicy.Name in a deterministic, collision-safe pattern (e.g. `<component>-<name>`).\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "created_at": "2025-10-08T10:40:58Z", "updated_at": "2025-10-09T12:06:55Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2413424664", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2413424664"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2413424664"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2413424664/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 243, "original_start_line": 238, "start_side": "RIGHT", "line": 270, "original_line": 270, "side": "RIGHT", "author_association": "NONE", "original_position": 97, "position": 104, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 320, "file_path": "config/crd/bases/operator.openshift.io_certmanagers.yaml", "line_start": 534, "line_end": 534, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n**Critical: Missing immutability validation for defaultNetworkPolicy.**\n\nThe documentation (lines 527-529) states this field is immutable once set to \"true\" for security reasons, but there's no `x-kubernetes-validations` CEL rule to enforce this constraint. Without validation, users can disable network policies after enabling them, creating a security risk.\n\n\n\nAdd the immutability validation immediately after the `type: string` line:\n\n```diff\n                 type: string\n+                x-kubernetes-validations:\n+                - message: \"defaultNetworkPolicy is immutable once set to 'true'\"\n+                  rule: \"self != 'true' || !has(oldSelf) || oldSelf == 'true'\"\n```\n\nThis rule allows transitions to \"true\" but prevents disabling once enabled.\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn config/crd/bases/operator.openshift.io_certmanagers.yaml around lines\n519-534, add a CEL immutability validation immediately after the \"type: string\"\nline to enforce that once defaultNetworkPolicy has been set to \"true\" it cannot\nbe changed back; implement a rule that checks oldSelf.spec.defaultNetworkPolicy\nand, if it equals \"true\", requires the new spec.defaultNetworkPolicy to also\nequal \"true\", otherwise allow any value (also include a clear validation message\nexplaining the immutability).\n```\n\n</details>\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commits ee858c3 to 7423a53", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2413424668", "pull_request_review_id": 3314209388, "id": 2413424668, "node_id": "PRRC_kwDOFdFn9s6P2fAc", "diff_hunk": "@@ -516,6 +516,22 @@ spec:\n                         x-kubernetes-list-type: atomic\n                     type: object\n                 type: object\n+              defaultNetworkPolicy:\n+                description: |-\n+                  DefaultNetworkPolicy enables the default network policy for cert-manager components.\n+                  When set to \"true\", the operator will create default network policies to secure\n+                  communication between cert-manager controller, webhook, and cainjector components.\n+                  When set to \"false\" or empty, no default network policies are created.\n+                  Valid values are: \"true\", \"false\", or empty (default: false).\n+\n+                  This field is immutable once set to \"true\" for security reasons. Network policies\n+                  cannot be disabled once enabled to prevent accidental security degradation.\n+                  Users should carefully plan their network policy requirements before enabling this field.\n+                enum:\n+                - \"true\"\n+                - \"false\"\n+                - \"\"\n+                type: string", "path": "config/crd/bases/operator.openshift.io_certmanagers.yaml", "commit_id": "167c0ed38cf01bfe1b1dffd042ee70794a546beb", "original_commit_id": "4b635b00dad11a605c8fc63f3fcab220486a92bc", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n**Critical: Missing immutability validation for defaultNetworkPolicy.**\n\nThe documentation (lines 527-529) states this field is immutable once set to \"true\" for security reasons, but there's no `x-kubernetes-validations` CEL rule to enforce this constraint. Without validation, users can disable network policies after enabling them, creating a security risk.\n\n\n\nAdd the immutability validation immediately after the `type: string` line:\n\n```diff\n                 type: string\n+                x-kubernetes-validations:\n+                - message: \"defaultNetworkPolicy is immutable once set to 'true'\"\n+                  rule: \"self != 'true' || !has(oldSelf) || oldSelf == 'true'\"\n```\n\nThis rule allows transitions to \"true\" but prevents disabling once enabled.\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn config/crd/bases/operator.openshift.io_certmanagers.yaml around lines\n519-534, add a CEL immutability validation immediately after the \"type: string\"\nline to enforce that once defaultNetworkPolicy has been set to \"true\" it cannot\nbe changed back; implement a rule that checks oldSelf.spec.defaultNetworkPolicy\nand, if it equals \"true\", requires the new spec.defaultNetworkPolicy to also\nequal \"true\", otherwise allow any value (also include a clear validation message\nexplaining the immutability).\n```\n\n</details>\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commits ee858c3 to 7423a53", "created_at": "2025-10-08T10:40:58Z", "updated_at": "2025-10-09T09:40:13Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2413424668", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2413424668"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2413424668"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2413424668/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 519, "original_start_line": 519, "start_side": "RIGHT", "line": 534, "original_line": 534, "side": "RIGHT", "author_association": "NONE", "original_position": 19, "position": 19, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 320, "file_path": "config/crd/bases/operator.openshift.io_certmanagers.yaml", "line_start": 802, "line_end": 802, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Critical: Missing validation for networkPolicies and unresolved past feedback.**\n\nTwo issues require immediate attention:\n\n1. **Missing validation**: The documentation (line 572) states this field is immutable once DefaultNetworkPolicy is \"true\", but no `x-kubernetes-validations` rule enforces this constraint.\n\n2. **Unaddressed past review**: A previous review (see past_review_comments for lines 556-796) flagged a problematic CEL rule that was too restrictive, but no validation rule is visible in the current code. It's unclear whether the rule was removed, relocated, or never implemented.\n\n\n\n\nFirst, verify whether validations exist elsewhere in the CRD:\n\n\n\nThen add the proper spec-level validation to enforce both constraints correctly:\n\n```diff\n           spec:\n             description: CertManagerSpec defines the desired state of CertManager\n+            x-kubernetes-validations:\n+            - message: \"defaultNetworkPolicy is immutable once set to 'true'\"\n+              rule: \"!has(self.defaultNetworkPolicy) || self.defaultNetworkPolicy != 'true' || !has(oldSelf.defaultNetworkPolicy) || oldSelf.defaultNetworkPolicy == 'true'\"\n+            - message: \"networkPolicies is immutable (cannot shrink) once defaultNetworkPolicy is 'true'\"\n+              rule: \"!has(self.defaultNetworkPolicy) || self.defaultNetworkPolicy != 'true' || !has(oldSelf.networkPolicies) || size(self.networkPolicies) >= size(oldSelf.networkPolicies)\"\n             properties:\n```\n\nThis addresses the past review concern by only enforcing immutability when `defaultNetworkPolicy == \"true\"`.\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Check if x-kubernetes-validations exists for these fields elsewhere in the CRD\n\necho \"=== Searching for x-kubernetes-validations blocks in the CRD ===\"\nrg -n \"x-kubernetes-validations\" config/crd/bases/operator.openshift.io_certmanagers.yaml\n\necho -e \"\\n=== Checking if validations reference defaultNetworkPolicy or networkPolicies ===\"\nrg -nC5 \"x-kubernetes-validations\" config/crd/bases/operator.openshift.io_certmanagers.yaml | rg -i \"(defaultNetworkPolicy|networkPolicies)\"\n```\n\nLength of output: 194\n\n---\n\n\n\n</details>\n\n**Add immutability validations for `defaultNetworkPolicy` and `networkPolicies`**  \nInsert under `spec:` in `config/crd/bases/operator.openshift.io_certmanagers.yaml`:\n\n```diff\n spec:\n+  x-kubernetes-validations:\n+  - message: \"defaultNetworkPolicy is immutable once set to 'true'\"\n+    rule: \"!has(self.defaultNetworkPolicy) || self.defaultNetworkPolicy != 'true' || !has(oldSelf.defaultNetworkPolicy) || oldSelf.defaultNetworkPolicy == 'true'\"\n+  - message: \"networkPolicies is immutable (cannot shrink) once defaultNetworkPolicy is 'true'\"\n+    rule: \"!has(self.defaultNetworkPolicy) || self.defaultNetworkPolicy != 'true' || !has(oldSelf.networkPolicies) || size(self.networkPolicies) >= size(oldSelf.networkPolicies)\"\n properties:\n```\n\n\n> Committable suggestion skipped: line range outside the PR's diff.\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn config/crd/bases/operator.openshift.io_certmanagers.yaml around lines\n555-795, the CRD is missing immutability validation for\nspec.defaultNetworkPolicy and spec.networkPolicies; add validation entries under\nspec: that mark these fields as immutable (via x-kubernetes-immutability or\nappropriate OpenAPI validation/immutable annotation) so that once\nDefaultNetworkPolicy is set to \"true\" the defaultNetworkPolicy and\nnetworkPolicies fields cannot be changed, and ensure the schema marks\nnetworkPolicies as immutable when DefaultNetworkPolicy is true (or\ndocument/validate the conditional immutability) and update required/description\ncomments to reflect the immutability constraint.\n```\n\n</details>\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commits ee858c3 to 7423a53", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2413424672", "pull_request_review_id": 3314209388, "id": 2413424672, "node_id": "PRRC_kwDOFdFn9s6P2fAg", "diff_hunk": "@@ -536,6 +552,247 @@ spec:\n                   should manage the component\n                 pattern: ^(Managed|Unmanaged|Force|Removed)$\n                 type: string\n+              networkPolicies:\n+                description: |-\n+                  NetworkPolicies specifies the egress network policy configuration to be applied to cert-manager\n+                  pods/operands when DefaultNetworkPolicy is \"true\". By default, enabling network policies\n+                  creates a deny-all policy that blocks all outgoing traffic from cert-manager components.\n+                  Ingress rules are automatically handled by the operator based on the current running ports.\n+                  Use this field to provide the necessary egress policy rules that allow required outbound traffic\n+                  for cert-manager to function properly (e.g., API server communication, external issuer access, etc.).\n+\n+                  Each NetworkPolicy in this slice will be created as a separate Kubernetes NetworkPolicy\n+                  resource. Multiple policies can be defined to organize egress rules logically (e.g., separate\n+                  policies for different types of outbound traffic or different security zones).\n+\n+                  This field is only effective when DefaultNetworkPolicy is set to \"true\".\n+                  If DefaultNetworkPolicy is \"true\" but this field is not provided, cert-manager\n+                  components will be isolated with deny-all egress policies.\n+\n+                  This field is immutable once DefaultNetworkPolicy is set to \"true\" for security reasons.\n+                items:\n+                  description: |-\n+                    NetworkPolicy represents a custom network policy configuration for operator-managed components.\n+                    It includes a name for identification and the network policy rules to be enforced.\n+                  properties:\n+                    componentName:\n+                      description: ComponentName represents the different cert-manager\n+                        components that can have network policies applied.\n+                      enum:\n+                      - CAInjector\n+                      - CoreController\n+                      - Webhook\n+                      - IstioCSR\n+                      type: string\n+                    egress:\n+                      description: |-\n+                        egress is a list of egress rules to be applied to the selected pods. Outgoing traffic\n+                        is allowed if there are no NetworkPolicies selecting the pod (and cluster policy\n+                        otherwise allows the traffic), OR if the traffic matches at least one egress rule\n+                        across all of the NetworkPolicy objects whose podSelector matches the pod. If\n+                        this field is empty then this NetworkPolicy limits all outgoing traffic (and serves\n+                        solely to ensure that the pods it selects are isolated by default).\n+                        The operator will automatically handle ingress rules based on the current running ports.\n+                      items:\n+                        description: |-\n+                          NetworkPolicyEgressRule describes a particular set of traffic that is allowed out of pods\n+                          matched by a NetworkPolicySpec's podSelector. The traffic must match both ports and to.\n+                          This type is beta-level in 1.8\n+                        properties:\n+                          ports:\n+                            description: |-\n+                              ports is a list of destination ports for outgoing traffic.\n+                              Each item in this list is combined using a logical OR. If this field is\n+                              empty or missing, this rule matches all ports (traffic not restricted by port).\n+                              If this field is present and contains at least one item, then this rule allows\n+                              traffic only if the traffic matches at least one port in the list.\n+                            items:\n+                              description: NetworkPolicyPort describes a port to allow\n+                                traffic on\n+                              properties:\n+                                endPort:\n+                                  description: |-\n+                                    endPort indicates that the range of ports from port to endPort if set, inclusive,\n+                                    should be allowed by the policy. This field cannot be defined if the port field\n+                                    is not defined or if the port field is defined as a named (string) port.\n+                                    The endPort must be equal or greater than port.\n+                                  format: int32\n+                                  type: integer\n+                                port:\n+                                  anyOf:\n+                                  - type: integer\n+                                  - type: string\n+                                  description: |-\n+                                    port represents the port on the given protocol. This can either be a numerical or named\n+                                    port on a pod. If this field is not provided, this matches all port names and\n+                                    numbers.\n+                                    If present, only traffic on the specified protocol AND port will be matched.\n+                                  x-kubernetes-int-or-string: true\n+                                protocol:\n+                                  default: TCP\n+                                  description: |-\n+                                    protocol represents the protocol (TCP, UDP, or SCTP) which traffic must match.\n+                                    If not specified, this field defaults to TCP.\n+                                  type: string\n+                              type: object\n+                            type: array\n+                            x-kubernetes-list-type: atomic\n+                          to:\n+                            description: |-\n+                              to is a list of destinations for outgoing traffic of pods selected for this rule.\n+                              Items in this list are combined using a logical OR operation. If this field is\n+                              empty or missing, this rule matches all destinations (traffic not restricted by\n+                              destination). If this field is present and contains at least one item, this rule\n+                              allows traffic only if the traffic matches at least one item in the to list.\n+                            items:\n+                              description: |-\n+                                NetworkPolicyPeer describes a peer to allow traffic to/from. Only certain combinations of\n+                                fields are allowed\n+                              properties:\n+                                ipBlock:\n+                                  description: |-\n+                                    ipBlock defines policy on a particular IPBlock. If this field is set then\n+                                    neither of the other fields can be.\n+                                  properties:\n+                                    cidr:\n+                                      description: |-\n+                                        cidr is a string representing the IPBlock\n+                                        Valid examples are \"192.168.1.0/24\" or \"2001:db8::/64\"\n+                                      type: string\n+                                    except:\n+                                      description: |-\n+                                        except is a slice of CIDRs that should not be included within an IPBlock\n+                                        Valid examples are \"192.168.1.0/24\" or \"2001:db8::/64\"\n+                                        Except values will be rejected if they are outside the cidr range\n+                                      items:\n+                                        type: string\n+                                      type: array\n+                                      x-kubernetes-list-type: atomic\n+                                  required:\n+                                  - cidr\n+                                  type: object\n+                                namespaceSelector:\n+                                  description: |-\n+                                    namespaceSelector selects namespaces using cluster-scoped labels. This field follows\n+                                    standard label selector semantics; if present but empty, it selects all namespaces.\n+\n+                                    If podSelector is also set, then the NetworkPolicyPeer as a whole selects\n+                                    the pods matching podSelector in the namespaces selected by namespaceSelector.\n+                                    Otherwise it selects all pods in the namespaces selected by namespaceSelector.\n+                                  properties:\n+                                    matchExpressions:\n+                                      description: matchExpressions is a list of label\n+                                        selector requirements. The requirements are\n+                                        ANDed.\n+                                      items:\n+                                        description: |-\n+                                          A label selector requirement is a selector that contains values, a key, and an operator that\n+                                          relates the key and values.\n+                                        properties:\n+                                          key:\n+                                            description: key is the label key that\n+                                              the selector applies to.\n+                                            type: string\n+                                          operator:\n+                                            description: |-\n+                                              operator represents a key's relationship to a set of values.\n+                                              Valid operators are In, NotIn, Exists and DoesNotExist.\n+                                            type: string\n+                                          values:\n+                                            description: |-\n+                                              values is an array of string values. If the operator is In or NotIn,\n+                                              the values array must be non-empty. If the operator is Exists or DoesNotExist,\n+                                              the values array must be empty. This array is replaced during a strategic\n+                                              merge patch.\n+                                            items:\n+                                              type: string\n+                                            type: array\n+                                            x-kubernetes-list-type: atomic\n+                                        required:\n+                                        - key\n+                                        - operator\n+                                        type: object\n+                                      type: array\n+                                      x-kubernetes-list-type: atomic\n+                                    matchLabels:\n+                                      additionalProperties:\n+                                        type: string\n+                                      description: |-\n+                                        matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels\n+                                        map is equivalent to an element of matchExpressions, whose key field is \"key\", the\n+                                        operator is \"In\", and the values array contains only \"value\". The requirements are ANDed.\n+                                      type: object\n+                                  type: object\n+                                  x-kubernetes-map-type: atomic\n+                                podSelector:\n+                                  description: |-\n+                                    podSelector is a label selector which selects pods. This field follows standard label\n+                                    selector semantics; if present but empty, it selects all pods.\n+\n+                                    If namespaceSelector is also set, then the NetworkPolicyPeer as a whole selects\n+                                    the pods matching podSelector in the Namespaces selected by NamespaceSelector.\n+                                    Otherwise it selects the pods matching podSelector in the policy's own namespace.\n+                                  properties:\n+                                    matchExpressions:\n+                                      description: matchExpressions is a list of label\n+                                        selector requirements. The requirements are\n+                                        ANDed.\n+                                      items:\n+                                        description: |-\n+                                          A label selector requirement is a selector that contains values, a key, and an operator that\n+                                          relates the key and values.\n+                                        properties:\n+                                          key:\n+                                            description: key is the label key that\n+                                              the selector applies to.\n+                                            type: string\n+                                          operator:\n+                                            description: |-\n+                                              operator represents a key's relationship to a set of values.\n+                                              Valid operators are In, NotIn, Exists and DoesNotExist.\n+                                            type: string\n+                                          values:\n+                                            description: |-\n+                                              values is an array of string values. If the operator is In or NotIn,\n+                                              the values array must be non-empty. If the operator is Exists or DoesNotExist,\n+                                              the values array must be empty. This array is replaced during a strategic\n+                                              merge patch.\n+                                            items:\n+                                              type: string\n+                                            type: array\n+                                            x-kubernetes-list-type: atomic\n+                                        required:\n+                                        - key\n+                                        - operator\n+                                        type: object\n+                                      type: array\n+                                      x-kubernetes-list-type: atomic\n+                                    matchLabels:\n+                                      additionalProperties:\n+                                        type: string\n+                                      description: |-\n+                                        matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels\n+                                        map is equivalent to an element of matchExpressions, whose key field is \"key\", the\n+                                        operator is \"In\", and the values array contains only \"value\". The requirements are ANDed.\n+                                      type: object\n+                                  type: object\n+                                  x-kubernetes-map-type: atomic\n+                              type: object\n+                            type: array\n+                            x-kubernetes-list-type: atomic\n+                        type: object\n+                      type: array\n+                      x-kubernetes-list-type: atomic\n+                    name:\n+                      description: |-\n+                        Name is a unique identifier for this network policy configuration.\n+                        This name will be used as part of the generated NetworkPolicy resource name.\n+                      type: string\n+                  required:\n+                  - componentName\n+                  - name\n+                  type: object\n+                type: array", "path": "config/crd/bases/operator.openshift.io_certmanagers.yaml", "commit_id": "167c0ed38cf01bfe1b1dffd042ee70794a546beb", "original_commit_id": "4b635b00dad11a605c8fc63f3fcab220486a92bc", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Critical: Missing validation for networkPolicies and unresolved past feedback.**\n\nTwo issues require immediate attention:\n\n1. **Missing validation**: The documentation (line 572) states this field is immutable once DefaultNetworkPolicy is \"true\", but no `x-kubernetes-validations` rule enforces this constraint.\n\n2. **Unaddressed past review**: A previous review (see past_review_comments for lines 556-796) flagged a problematic CEL rule that was too restrictive, but no validation rule is visible in the current code. It's unclear whether the rule was removed, relocated, or never implemented.\n\n\n\n\nFirst, verify whether validations exist elsewhere in the CRD:\n\n\n\nThen add the proper spec-level validation to enforce both constraints correctly:\n\n```diff\n           spec:\n             description: CertManagerSpec defines the desired state of CertManager\n+            x-kubernetes-validations:\n+            - message: \"defaultNetworkPolicy is immutable once set to 'true'\"\n+              rule: \"!has(self.defaultNetworkPolicy) || self.defaultNetworkPolicy != 'true' || !has(oldSelf.defaultNetworkPolicy) || oldSelf.defaultNetworkPolicy == 'true'\"\n+            - message: \"networkPolicies is immutable (cannot shrink) once defaultNetworkPolicy is 'true'\"\n+              rule: \"!has(self.defaultNetworkPolicy) || self.defaultNetworkPolicy != 'true' || !has(oldSelf.networkPolicies) || size(self.networkPolicies) >= size(oldSelf.networkPolicies)\"\n             properties:\n```\n\nThis addresses the past review concern by only enforcing immutability when `defaultNetworkPolicy == \"true\"`.\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Check if x-kubernetes-validations exists for these fields elsewhere in the CRD\n\necho \"=== Searching for x-kubernetes-validations blocks in the CRD ===\"\nrg -n \"x-kubernetes-validations\" config/crd/bases/operator.openshift.io_certmanagers.yaml\n\necho -e \"\\n=== Checking if validations reference defaultNetworkPolicy or networkPolicies ===\"\nrg -nC5 \"x-kubernetes-validations\" config/crd/bases/operator.openshift.io_certmanagers.yaml | rg -i \"(defaultNetworkPolicy|networkPolicies)\"\n```\n\nLength of output: 194\n\n---\n\n\n\n</details>\n\n**Add immutability validations for `defaultNetworkPolicy` and `networkPolicies`**  \nInsert under `spec:` in `config/crd/bases/operator.openshift.io_certmanagers.yaml`:\n\n```diff\n spec:\n+  x-kubernetes-validations:\n+  - message: \"defaultNetworkPolicy is immutable once set to 'true'\"\n+    rule: \"!has(self.defaultNetworkPolicy) || self.defaultNetworkPolicy != 'true' || !has(oldSelf.defaultNetworkPolicy) || oldSelf.defaultNetworkPolicy == 'true'\"\n+  - message: \"networkPolicies is immutable (cannot shrink) once defaultNetworkPolicy is 'true'\"\n+    rule: \"!has(self.defaultNetworkPolicy) || self.defaultNetworkPolicy != 'true' || !has(oldSelf.networkPolicies) || size(self.networkPolicies) >= size(oldSelf.networkPolicies)\"\n properties:\n```\n\n\n> Committable suggestion skipped: line range outside the PR's diff.\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn config/crd/bases/operator.openshift.io_certmanagers.yaml around lines\n555-795, the CRD is missing immutability validation for\nspec.defaultNetworkPolicy and spec.networkPolicies; add validation entries under\nspec: that mark these fields as immutable (via x-kubernetes-immutability or\nappropriate OpenAPI validation/immutable annotation) so that once\nDefaultNetworkPolicy is set to \"true\" the defaultNetworkPolicy and\nnetworkPolicies fields cannot be changed, and ensure the schema marks\nnetworkPolicies as immutable when DefaultNetworkPolicy is true (or\ndocument/validate the conditional immutability) and update required/description\ncomments to reflect the immutability constraint.\n```\n\n</details>\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commits ee858c3 to 7423a53", "created_at": "2025-10-08T10:40:58Z", "updated_at": "2025-10-09T09:40:16Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2413424672", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2413424672"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2413424672"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2413424672/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 559, "original_start_line": 555, "start_side": "RIGHT", "line": 802, "original_line": 802, "side": "RIGHT", "author_association": "NONE", "original_position": 267, "position": 274, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 320, "file_path": "pkg/controller/istiocsr/controller.go", "line_start": 160, "line_end": null, "diff_context": "", "comment_body": "_\ud83d\udee0\ufe0f Refactor suggestion_ | _\ud83d\udfe0 Major_\n\n**Missing watch for NetworkPolicy events.**\n\nWe now cache `networkingv1.NetworkPolicy` objects, but `SetupWithManager` never watches them. Any drift to managed NetworkPolicies will go unnoticed, so the controller won\u2019t reconcile to restore the desired state. Please add a `.Watches(&networkingv1.NetworkPolicy{}, \u2026)` with the same predicates as the other managed resources.\n\n\n```diff\n@@\n-\t\tWatches(&rbacv1.RoleBinding{}, handler.EnqueueRequestsFromMapFunc(mapFunc), controllerManagedResourcePredicates).\n-\t\tWatches(&corev1.Service{}, handler.EnqueueRequestsFromMapFunc(mapFunc), controllerManagedResourcePredicates).\n-\t\tWatches(&corev1.ServiceAccount{}, handler.EnqueueRequestsFromMapFunc(mapFunc), controllerManagedResourcePredicates).\n+\t\tWatches(&rbacv1.RoleBinding{}, handler.EnqueueRequestsFromMapFunc(mapFunc), controllerManagedResourcePredicates).\n+\t\tWatches(&corev1.Service{}, handler.EnqueueRequestsFromMapFunc(mapFunc), controllerManagedResourcePredicates).\n+\t\tWatches(&corev1.ServiceAccount{}, handler.EnqueueRequestsFromMapFunc(mapFunc), controllerManagedResourcePredicates).\n+\t\tWatches(&networkingv1.NetworkPolicy{}, handler.EnqueueRequestsFromMapFunc(mapFunc), controllerManagedResourcePredicates).\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n        Watches(&rbacv1.RoleBinding{}, handler.EnqueueRequestsFromMapFunc(mapFunc), controllerManagedResourcePredicates).\n        Watches(&corev1.Service{}, handler.EnqueueRequestsFromMapFunc(mapFunc), controllerManagedResourcePredicates).\n        Watches(&corev1.ServiceAccount{}, handler.EnqueueRequestsFromMapFunc(mapFunc), controllerManagedResourcePredicates).\n        Watches(&networkingv1.NetworkPolicy{}, handler.EnqueueRequestsFromMapFunc(mapFunc), controllerManagedResourcePredicates).\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn pkg/controller/istiocsr/controller.go around lines 158-160, the controller\ncaches networkingv1.NetworkPolicy but does not watch NetworkPolicy events; add a\n.Watches(...) for &networkingv1.NetworkPolicy{} in SetupWithManager using the\nsame event handler and the identical predicate set used for the other managed\nresources so NetworkPolicy changes enqueue reconcile requests and the controller\ncan restore desired state.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:medusa:sabertoothed -->\n\n<!-- This is an auto-generated reply by CodeRabbit -->\n\n\u2705 Addressed in commit c0b55ed\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2416184515", "pull_request_review_id": 3318086368, "id": 2416184515, "node_id": "PRRC_kwDOFdFn9s6QBAzD", "diff_hunk": "@@ -150,6 +155,9 @@ func BuildCustomClient(mgr ctrl.Manager) (client.Client, error) {\n \tif _, err = customCache.GetInformer(context.Background(), &certmanagerv1.ClusterIssuer{}); err != nil {\n \t\treturn nil, err\n \t}\n+\tif _, err = customCache.GetInformer(context.Background(), &networkingv1.NetworkPolicy{}); err != nil {\n+\t\treturn nil, err\n+\t}", "path": "pkg/controller/istiocsr/controller.go", "commit_id": "20951072096f67f657574518aa5dd897382226d4", "original_commit_id": "7423a537d9664dd37808f8719c814afcbb743723", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\ud83d\udee0\ufe0f Refactor suggestion_ | _\ud83d\udfe0 Major_\n\n**Missing watch for NetworkPolicy events.**\n\nWe now cache `networkingv1.NetworkPolicy` objects, but `SetupWithManager` never watches them. Any drift to managed NetworkPolicies will go unnoticed, so the controller won\u2019t reconcile to restore the desired state. Please add a `.Watches(&networkingv1.NetworkPolicy{}, \u2026)` with the same predicates as the other managed resources.\n\n\n```diff\n@@\n-\t\tWatches(&rbacv1.RoleBinding{}, handler.EnqueueRequestsFromMapFunc(mapFunc), controllerManagedResourcePredicates).\n-\t\tWatches(&corev1.Service{}, handler.EnqueueRequestsFromMapFunc(mapFunc), controllerManagedResourcePredicates).\n-\t\tWatches(&corev1.ServiceAccount{}, handler.EnqueueRequestsFromMapFunc(mapFunc), controllerManagedResourcePredicates).\n+\t\tWatches(&rbacv1.RoleBinding{}, handler.EnqueueRequestsFromMapFunc(mapFunc), controllerManagedResourcePredicates).\n+\t\tWatches(&corev1.Service{}, handler.EnqueueRequestsFromMapFunc(mapFunc), controllerManagedResourcePredicates).\n+\t\tWatches(&corev1.ServiceAccount{}, handler.EnqueueRequestsFromMapFunc(mapFunc), controllerManagedResourcePredicates).\n+\t\tWatches(&networkingv1.NetworkPolicy{}, handler.EnqueueRequestsFromMapFunc(mapFunc), controllerManagedResourcePredicates).\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n        Watches(&rbacv1.RoleBinding{}, handler.EnqueueRequestsFromMapFunc(mapFunc), controllerManagedResourcePredicates).\n        Watches(&corev1.Service{}, handler.EnqueueRequestsFromMapFunc(mapFunc), controllerManagedResourcePredicates).\n        Watches(&corev1.ServiceAccount{}, handler.EnqueueRequestsFromMapFunc(mapFunc), controllerManagedResourcePredicates).\n        Watches(&networkingv1.NetworkPolicy{}, handler.EnqueueRequestsFromMapFunc(mapFunc), controllerManagedResourcePredicates).\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn pkg/controller/istiocsr/controller.go around lines 158-160, the controller\ncaches networkingv1.NetworkPolicy but does not watch NetworkPolicy events; add a\n.Watches(...) for &networkingv1.NetworkPolicy{} in SetupWithManager using the\nsame event handler and the identical predicate set used for the other managed\nresources so NetworkPolicy changes enqueue reconcile requests and the controller\ncan restore desired state.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:medusa:sabertoothed -->\n\n<!-- This is an auto-generated reply by CodeRabbit -->\n\n\u2705 Addressed in commit c0b55ed\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "created_at": "2025-10-09T09:44:25Z", "updated_at": "2025-10-09T11:11:59Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2416184515", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2416184515"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2416184515"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2416184515/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 158, "start_side": "RIGHT", "line": null, "original_line": 160, "side": "RIGHT", "author_association": "NONE", "original_position": 32, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 320, "file_path": "api/operator/v1alpha1/certmanager_types.go", "line_start": 106, "line_end": 106, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udfe0 Major_\n\n**Documentation and validation mismatch for NetworkPolicies immutability.**\n\nLine 95 states the field is \"immutable once DefaultNetworkPolicy is set to 'true'\", but the XValidation on line 98 only prevents shrinking the slice (`size(self) >= size(oldSelf)`). This allows:\n- Adding new entries (extension) \u2713\n- Modifying existing entries (e.g., changing Egress rules, ComponentName) \u2717\n\nIf the intent is to allow extension but prevent removal, update line 95 to say \"extensible (entries can be added but not removed or modified)\" instead of \"immutable\".\n\nIf true immutability is required, strengthen the validation to prevent modification of existing entries, not just prevent shrinking.\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\napi/operator/v1alpha1/certmanager_types.go lines 80-100: the comment claiming\nthe field is \"immutable once DefaultNetworkPolicy is set to 'true'\" conflicts\nwith the XValidation rule which only prevents shrinking the slice, allowing\nmodification of existing entries; either update the comment to state the field\nis \"extensible (entries can be added but not removed or modified)\" to reflect\nthe current validation, or strengthen the XValidation to forbid modifications to\nexisting elements (e.g., enforce that for all indices i < size(oldSelf), self[i]\n== oldSelf[i]) so the field is truly immutable once set \u2014 pick the intended\nbehavior and make the corresponding change (update the docstring if you want\nappend-only semantics, or tighten the validation rule to enforce full\nimmutability).\n```\n\n</details>\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit 4793b17", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2416274256", "pull_request_review_id": 3318212172, "id": 2416274256, "node_id": "PRRC_kwDOFdFn9s6QBWtQ", "diff_hunk": "@@ -59,6 +60,44 @@ type CertManagerSpec struct {\n \t// +kubebuilder:validation:Optional\n \t// +optional\n \tCAInjectorConfig *DeploymentConfig `json:\"cainjectorConfig,omitempty\"`\n+\n+\t// DefaultNetworkPolicy enables the default network policy for cert-manager components.\n+\t// When set to \"true\", the operator will create default network policies to secure\n+\t// communication between cert-manager controller, webhook, and cainjector components.\n+\t// When set to \"false\" or empty, no default network policies are created.\n+\t// Valid values are: \"true\", \"false\", or empty (default: false).\n+\t//\n+\t// This field is immutable once set to \"true\" for security reasons. Network policies\n+\t// cannot be disabled once enabled to prevent accidental security degradation.\n+\t// Users should carefully plan their network policy requirements before enabling this field.\n+\t//\n+\t// +kubebuilder:validation:Optional\n+\t// +kubebuilder:validation:Enum:=\"true\";\"false\";\"\"\n+\t// +kubebuilder:validation:XValidation:rule=\"oldSelf != 'true' || self == 'true'\",message=\"defaultNetworkPolicy cannot be changed from 'true' to 'false' once set\"\n+\t// +optional\n+\tDefaultNetworkPolicy string `json:\"defaultNetworkPolicy,omitempty\"`\n+\n+\t// NetworkPolicies specifies the egress network policy configuration to be applied to cert-manager\n+\t// pods/operands when DefaultNetworkPolicy is \"true\". By default, enabling network policies\n+\t// creates a deny-all policy that blocks all outgoing traffic from cert-manager components.\n+\t// Ingress rules are automatically handled by the operator based on the current running ports.\n+\t// Use this field to provide the necessary egress policy rules that allow required outbound traffic\n+\t// for cert-manager to function properly (e.g., API server communication, external issuer access, etc.).\n+\t//\n+\t// Each NetworkPolicy in this slice will be created as a separate Kubernetes NetworkPolicy\n+\t// resource. Multiple policies can be defined to organize egress rules logically (e.g., separate\n+\t// policies for different types of outbound traffic or different security zones).\n+\t//\n+\t// This field is only effective when DefaultNetworkPolicy is set to \"true\".\n+\t// If DefaultNetworkPolicy is \"true\" but this field is not provided, cert-manager\n+\t// components will be isolated with deny-all egress policies.\n+\t//\n+\t// This field is immutable once DefaultNetworkPolicy is set to \"true\" for security reasons.\n+\t//\n+\t// +kubebuilder:validation:Optional\n+\t// +kubebuilder:validation:XValidation:rule=\"size(oldSelf) == 0 || size(self) >= size(oldSelf)\",message=\"networkPolicies can only be extended, not reduced\"\n+\t// +optional\n+\tNetworkPolicies []NetworkPolicy `json:\"networkPolicies,omitempty\"`", "path": "api/operator/v1alpha1/certmanager_types.go", "commit_id": "167c0ed38cf01bfe1b1dffd042ee70794a546beb", "original_commit_id": "feef89bbe952c96fdf944f2004cbabd8d93c3c61", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udfe0 Major_\n\n**Documentation and validation mismatch for NetworkPolicies immutability.**\n\nLine 95 states the field is \"immutable once DefaultNetworkPolicy is set to 'true'\", but the XValidation on line 98 only prevents shrinking the slice (`size(self) >= size(oldSelf)`). This allows:\n- Adding new entries (extension) \u2713\n- Modifying existing entries (e.g., changing Egress rules, ComponentName) \u2717\n\nIf the intent is to allow extension but prevent removal, update line 95 to say \"extensible (entries can be added but not removed or modified)\" instead of \"immutable\".\n\nIf true immutability is required, strengthen the validation to prevent modification of existing entries, not just prevent shrinking.\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\napi/operator/v1alpha1/certmanager_types.go lines 80-100: the comment claiming\nthe field is \"immutable once DefaultNetworkPolicy is set to 'true'\" conflicts\nwith the XValidation rule which only prevents shrinking the slice, allowing\nmodification of existing entries; either update the comment to state the field\nis \"extensible (entries can be added but not removed or modified)\" to reflect\nthe current validation, or strengthen the XValidation to forbid modifications to\nexisting elements (e.g., enforce that for all indices i < size(oldSelf), self[i]\n== oldSelf[i]) so the field is truly immutable once set \u2014 pick the intended\nbehavior and make the corresponding change (update the docstring if you want\nappend-only semantics, or tighten the validation rule to enforce full\nimmutability).\n```\n\n</details>\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit 4793b17", "created_at": "2025-10-09T10:15:13Z", "updated_at": "2025-10-20T17:29:38Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2416274256", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2416274256"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2416274256"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2416274256/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 80, "original_start_line": 80, "start_side": "RIGHT", "line": 106, "original_line": 106, "side": "RIGHT", "author_association": "NONE", "original_position": 49, "position": 55, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 320, "file_path": "pkg/controller/istiocsr/controller.go", "line_start": 160, "line_end": null, "diff_context": "", "comment_body": "@PillaiManish Thank you for incorporating the suggestion! Adding the watch for `NetworkPolicy` events will ensure the controller can properly reconcile and restore the desired state of network policies when they drift or are modified externally. \ud83c\udf89\n\n---\n\n<!-- This is an auto-generated comment: tweet message by coderabbit.ai -->\n\nIf you found this review helpful, would you consider giving us a shout-out on [X](https://twitter.com/intent/tweet?related=CodeRabbitAI&text=Found%20missing%20Watch%20for%20networkingv1.NetworkPolicy%20in%20controller%E2%80%94added%20.Watches(%26networkingv1.NetworkPolicy%7B%7D%2C%20%E2%80%A6)%20to%20detect%20drift%20and%20reconcile%20state.%20Smart%20review%20by%20%40coderabbitai%20%E2%80%94%20try%20it!%20%F0%9F%94%8D%F0%9F%9A%80&url=https%3A%2F%2Fgithub.com%2Fopenshift%2Fcert-manager-operator%2Fpull%2F320%23discussion_r2416184515)?\n\nThank you for using CodeRabbit!\n\n<!-- end of auto-generated comment: tweet message by coderabbit.ai -->\n\n\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2416276823", "pull_request_review_id": 3318216193, "id": 2416276823, "node_id": "PRRC_kwDOFdFn9s6QBXVX", "diff_hunk": "@@ -150,6 +155,9 @@ func BuildCustomClient(mgr ctrl.Manager) (client.Client, error) {\n \tif _, err = customCache.GetInformer(context.Background(), &certmanagerv1.ClusterIssuer{}); err != nil {\n \t\treturn nil, err\n \t}\n+\tif _, err = customCache.GetInformer(context.Background(), &networkingv1.NetworkPolicy{}); err != nil {\n+\t\treturn nil, err\n+\t}", "path": "pkg/controller/istiocsr/controller.go", "commit_id": "20951072096f67f657574518aa5dd897382226d4", "original_commit_id": "7423a537d9664dd37808f8719c814afcbb743723", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "@PillaiManish Thank you for incorporating the suggestion! Adding the watch for `NetworkPolicy` events will ensure the controller can properly reconcile and restore the desired state of network policies when they drift or are modified externally. \ud83c\udf89\n\n---\n\n<!-- This is an auto-generated comment: tweet message by coderabbit.ai -->\n\nIf you found this review helpful, would you consider giving us a shout-out on [X](https://twitter.com/intent/tweet?related=CodeRabbitAI&text=Found%20missing%20Watch%20for%20networkingv1.NetworkPolicy%20in%20controller%E2%80%94added%20.Watches(%26networkingv1.NetworkPolicy%7B%7D%2C%20%E2%80%A6)%20to%20detect%20drift%20and%20reconcile%20state.%20Smart%20review%20by%20%40coderabbitai%20%E2%80%94%20try%20it!%20%F0%9F%94%8D%F0%9F%9A%80&url=https%3A%2F%2Fgithub.com%2Fopenshift%2Fcert-manager-operator%2Fpull%2F320%23discussion_r2416184515)?\n\nThank you for using CodeRabbit!\n\n<!-- end of auto-generated comment: tweet message by coderabbit.ai -->\n\n\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "created_at": "2025-10-09T10:16:06Z", "updated_at": "2025-10-09T10:16:06Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2416276823", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2416276823"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2416276823"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2416276823/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 158, "start_side": "RIGHT", "line": null, "original_line": 160, "side": "RIGHT", "in_reply_to_id": 2416184515, "author_association": "NONE", "original_position": 32, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 320, "file_path": "pkg/controller/deployment/cert_manager_networkpolicy.go", "line_start": 228, "line_end": 228, "diff_context": "", "comment_body": "We don't require IstioCSR here, since we would be creating defaultNetworkPolicy and we donm't want to extend API for IstioCSR", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2416344409", "pull_request_review_id": 3318320761, "id": 2416344409, "node_id": "PRRC_kwDOFdFn9s6QBn1Z", "diff_hunk": "@@ -0,0 +1,257 @@\n+package deployment\n+\n+import (\n+\t\"context\"\n+\t\"fmt\"\n+\n+\tnetworkingv1 \"k8s.io/api/networking/v1\"\n+\t\"k8s.io/apimachinery/pkg/api/errors\"\n+\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n+\t\"k8s.io/client-go/kubernetes\"\n+\n+\t\"github.com/openshift/library-go/pkg/controller/factory\"\n+\t\"github.com/openshift/library-go/pkg/operator/events\"\n+\t\"github.com/openshift/library-go/pkg/operator/resource/resourceapply\"\n+\t\"github.com/openshift/library-go/pkg/operator/staticresourcecontroller\"\n+\t\"github.com/openshift/library-go/pkg/operator/v1helpers\"\n+\n+\t\"github.com/openshift/cert-manager-operator/api/operator/v1alpha1\"\n+\t\"github.com/openshift/cert-manager-operator/pkg/operator/assets\"\n+\tcertmanoperatorinformers \"github.com/openshift/cert-manager-operator/pkg/operator/informers/externalversions\"\n+)\n+\n+const (\n+\tcertManagerNetworkPolicyStaticResourcesControllerName = operatorName + \"-networkpolicy-static-resources-\"\n+\tcertManagerNetworkPolicyUserDefinedControllerName     = operatorName + \"-networkpolicy-user-defined\"\n+\tcertManagerNamespace                                  = \"cert-manager\"\n+\tnetworkPolicyOwnerLabel                               = \"cert-manager.operator.openshift.io/owned-by\"\n+)\n+\n+var (\n+\t// Static network policy asset files for default policies\n+\tcertManagerNetworkPolicyAssetFiles = []string{\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-deny-all-networkpolicy.yaml\",\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-api-server-egress-networkpolicy.yaml\",\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-metrics-ingress-networkpolicy.yaml\",\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-webhook-ingress-networkpolicy.yaml\",\n+\t}\n+)\n+\n+// ============================================================================\n+// STATIC RESOURCE CONTROLLER - for default network policies from YAML files\n+// ============================================================================\n+\n+func NewCertManagerNetworkPolicyStaticResourcesController(operatorClient v1helpers.OperatorClient,\n+\tkubeClientContainer *resourceapply.ClientHolder,\n+\tkubeInformersForNamespaces v1helpers.KubeInformersForNamespaces,\n+\tcertManagerOperatorInformers certmanoperatorinformers.SharedInformerFactory,\n+\teventsRecorder events.Recorder) factory.Controller {\n+\n+\t// Create conditional function to check if network policies should be applied\n+\tshouldApplyNetworkPolicies := func() bool {\n+\t\tcertManager, err := certManagerOperatorInformers.Operator().V1alpha1().CertManagers().Lister().Get(\"cluster\")\n+\t\tif err != nil {\n+\t\t\treturn false\n+\t\t}\n+\t\treturn certManager.Spec.DefaultNetworkPolicy == \"true\"\n+\t}\n+\n+\treturn staticresourcecontroller.NewStaticResourceController(\n+\t\tcertManagerNetworkPolicyStaticResourcesControllerName,\n+\t\tassets.Asset,\n+\t\t[]string{}, // empty files, we'll add them conditionally\n+\t\tkubeClientContainer,\n+\t\toperatorClient,\n+\t\teventsRecorder,\n+\t).WithConditionalResources(\n+\t\tassets.Asset,\n+\t\tcertManagerNetworkPolicyAssetFiles,\n+\t\tshouldApplyNetworkPolicies,\n+\t\tnil, // Since immutable, we never delete\n+\t).AddKubeInformers(kubeInformersForNamespaces).AddInformer(\n+\t\tcertManagerOperatorInformers.Operator().V1alpha1().CertManagers().Informer(),\n+\t)\n+}\n+\n+// ============================================================================\n+// USER-DEFINED CONTROLLER - for user-configured network policies from API\n+// ============================================================================\n+\n+// CertManagerNetworkPolicyUserDefinedController manages user-defined NetworkPolicy resources\n+type CertManagerNetworkPolicyUserDefinedController struct {\n+\toperatorClient               v1helpers.OperatorClient\n+\tcertManagerOperatorInformers certmanoperatorinformers.SharedInformerFactory\n+\tkubeClient                   kubernetes.Interface\n+\teventRecorder                events.Recorder\n+}\n+\n+func NewCertManagerNetworkPolicyUserDefinedController(\n+\toperatorClient v1helpers.OperatorClient,\n+\tcertManagerOperatorInformers certmanoperatorinformers.SharedInformerFactory,\n+\tkubeClient kubernetes.Interface,\n+\teventRecorder events.Recorder,\n+) factory.Controller {\n+\tc := &CertManagerNetworkPolicyUserDefinedController{\n+\t\toperatorClient:               operatorClient,\n+\t\tcertManagerOperatorInformers: certManagerOperatorInformers,\n+\t\tkubeClient:                   kubeClient,\n+\t\teventRecorder:                eventRecorder.WithComponentSuffix(\"cert-manager-networkpolicy-user-defined\"),\n+\t}\n+\n+\treturn factory.New().\n+\t\tWithInformers(\n+\t\t\toperatorClient.Informer(),\n+\t\t\tcertManagerOperatorInformers.Operator().V1alpha1().CertManagers().Informer(),\n+\t\t).\n+\t\tWithSync(c.sync).\n+\t\tToController(certManagerNetworkPolicyUserDefinedControllerName, c.eventRecorder)\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) sync(ctx context.Context, syncCtx factory.SyncContext) error {\n+\t// Get the current CertManager configuration\n+\tcertManager, err := c.certManagerOperatorInformers.Operator().V1alpha1().CertManagers().Lister().Get(\"cluster\")\n+\tif err != nil {\n+\t\tif errors.IsNotFound(err) {\n+\t\t\t// No CertManager found, nothing to do\n+\t\t\treturn nil\n+\t\t}\n+\t\treturn fmt.Errorf(\"failed to get CertManager: %w\", err)\n+\t}\n+\n+\t// Check if network policies are enabled\n+\tif certManager.Spec.DefaultNetworkPolicy != \"true\" {\n+\t\t// Network policies not enabled, nothing to do\n+\t\t// Note: Since fields are immutable, no cleanup needed\n+\t\treturn nil\n+\t}\n+\n+\t// Validate user-defined network policy configuration\n+\tif err := c.validateNetworkPolicyConfig(certManager); err != nil {\n+\t\tc.eventRecorder.Warningf(\"NetworkPolicyValidationFailed\", \"Network policy configuration validation failed: %v\", err)\n+\t\treturn fmt.Errorf(\"network policy configuration validation failed: %w\", err)\n+\t}\n+\n+\t// Apply user-defined network policies\n+\tif err := c.reconcileUserNetworkPolicies(ctx, certManager); err != nil {\n+\t\tc.eventRecorder.Warningf(\"UserNetworkPolicyReconcileFailed\", \"Failed to reconcile user network policies: %v\", err)\n+\t\treturn fmt.Errorf(\"failed to reconcile user network policies: %w\", err)\n+\t}\n+\n+\tc.eventRecorder.Event(\"UserNetworkPolicyReconcileSuccess\", \"Successfully reconciled user-defined network policies\")\n+\treturn nil\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) validateNetworkPolicyConfig(certManager *v1alpha1.CertManager) error {\n+\t// Validate each user-defined network policy\n+\tfor i, policy := range certManager.Spec.NetworkPolicies {\n+\t\tif policy.Name == \"\" {\n+\t\t\treturn fmt.Errorf(\"network policy at index %d: name cannot be empty\", i)\n+\t\t}\n+\t\tif len(policy.Egress) == 0 {\n+\t\t\treturn fmt.Errorf(\"network policy at index %d: egress rules cannot be empty when network policies are enabled\", i)\n+\t\t}\n+\t\tif err := c.validateComponentName(policy.ComponentName); err != nil {\n+\t\t\treturn fmt.Errorf(\"network policy at index %d: invalid component name: %w\", i, err)\n+\t\t}\n+\t}\n+\treturn nil\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) validateComponentName(componentName v1alpha1.ComponentName) error {\n+\tswitch componentName {\n+\tcase v1alpha1.CAInjector, v1alpha1.CoreController, v1alpha1.Webhook:\n+\t\treturn nil\n+\tdefault:\n+\t\treturn fmt.Errorf(\"unsupported component name: %s\", componentName)\n+\t}\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) reconcileUserNetworkPolicies(ctx context.Context, certManager *v1alpha1.CertManager) error {\n+\t// Apply each user-defined network policy\n+\tfor _, userPolicy := range certManager.Spec.NetworkPolicies {\n+\t\tpolicy := c.createUserNetworkPolicy(userPolicy)\n+\t\tif err := c.createOrUpdateNetworkPolicy(ctx, policy); err != nil {\n+\t\t\treturn fmt.Errorf(\"failed to create/update user network policy %s: %w\", policy.Name, err)\n+\t\t}\n+\t}\n+\n+\treturn nil\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) createUserNetworkPolicy(userPolicy v1alpha1.NetworkPolicy) *networkingv1.NetworkPolicy {\n+\tpodSelector := c.getPodSelectorForComponent(userPolicy.ComponentName)\n+\n+\treturn &networkingv1.NetworkPolicy{\n+\t\tObjectMeta: metav1.ObjectMeta{\n+\t\t\tName:      fmt.Sprintf(\"cert-manager-user-%s\", userPolicy.Name),\n+\t\t\tNamespace: certManagerNamespace,\n+\t\t\tLabels: map[string]string{\n+\t\t\t\tnetworkPolicyOwnerLabel: \"cert-manager\",\n+\t\t\t},\n+\t\t},\n+\t\tSpec: networkingv1.NetworkPolicySpec{\n+\t\t\tPodSelector: podSelector,\n+\t\t\tPolicyTypes: []networkingv1.PolicyType{\n+\t\t\t\tnetworkingv1.PolicyTypeEgress,\n+\t\t\t},\n+\t\t\tEgress: userPolicy.Egress,\n+\t\t},\n+\t}\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) getPodSelectorForComponent(component v1alpha1.ComponentName) metav1.LabelSelector {\n+\tswitch component {\n+\tcase v1alpha1.CAInjector:\n+\t\treturn metav1.LabelSelector{\n+\t\t\tMatchLabels: map[string]string{\n+\t\t\t\t\"app\": \"cainjector\",\n+\t\t\t},\n+\t\t}\n+\tcase v1alpha1.CoreController:\n+\t\treturn metav1.LabelSelector{\n+\t\t\tMatchLabels: map[string]string{\n+\t\t\t\t\"app\": \"cert-manager\",\n+\t\t\t},\n+\t\t}\n+\tcase v1alpha1.Webhook:\n+\t\treturn metav1.LabelSelector{\n+\t\t\tMatchLabels: map[string]string{\n+\t\t\t\t\"app\": \"webhook\",\n+\t\t\t},\n+\t\t}\n+\tdefault:\n+\t\treturn metav1.LabelSelector{\n+\t\t\tMatchLabels: map[string]string{\n+\t\t\t\t\"app.kubernetes.io/name\": \"cert-manager\",\n+\t\t\t},\n+\t\t}\n+\t}\n+}", "path": "pkg/controller/deployment/cert_manager_networkpolicy.go", "commit_id": "167c0ed38cf01bfe1b1dffd042ee70794a546beb", "original_commit_id": "9f6cd4178a2c1ed48e80c28d5e3dd6fd946702e7", "user": {"login": "PillaiManish", "id": 54178440, "node_id": "MDQ6VXNlcjU0MTc4NDQw", "avatar_url": "https://avatars.githubusercontent.com/u/54178440?v=4", "gravatar_id": "", "url": "https://api.github.com/users/PillaiManish", "html_url": "https://github.com/PillaiManish", "followers_url": "https://api.github.com/users/PillaiManish/followers", "following_url": "https://api.github.com/users/PillaiManish/following{/other_user}", "gists_url": "https://api.github.com/users/PillaiManish/gists{/gist_id}", "starred_url": "https://api.github.com/users/PillaiManish/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/PillaiManish/subscriptions", "organizations_url": "https://api.github.com/users/PillaiManish/orgs", "repos_url": "https://api.github.com/users/PillaiManish/repos", "events_url": "https://api.github.com/users/PillaiManish/events{/privacy}", "received_events_url": "https://api.github.com/users/PillaiManish/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "We don't require IstioCSR here, since we would be creating defaultNetworkPolicy and we donm't want to extend API for IstioCSR", "created_at": "2025-10-09T10:39:12Z", "updated_at": "2025-10-09T10:39:12Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2416344409", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2416344409"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2416344409"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2416344409/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "start_line": 145, "original_start_line": 144, "start_side": "RIGHT", "line": 228, "original_line": 228, "side": "RIGHT", "in_reply_to_id": 2410395486, "author_association": "MEMBER", "original_position": 229, "position": 228, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 320, "file_path": "pkg/controller/deployment/cert_manager_networkpolicy.go", "line_start": 228, "line_end": 228, "diff_context": "", "comment_body": "<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n\ud83c\udfc1 Script executed:\n```\n#!/bin/bash\n# Check the CRD validation for componentName field in NetworkPolicy\ncat config/crd/bases/operator.openshift.io_certmanagers.yaml | grep -A 30 \"componentName:\" | head -40\n```\n\nLength of output: 2176\n\n---\n\n\n\n</details>\n\n@PillaiManish Thank you for the clarification. I understand that IstioCSR is handled separately and you don't want to support it in user-defined network policies.\n\nHowever, there's an inconsistency in the current implementation: the CRD enum validation in `config/crd/bases/operator.openshift.io_certmanagers.yaml` explicitly lists `IstioCSR` as a valid value for `componentName`:\n\n```yaml\ncomponentName:\n  enum:\n  - CAInjector\n  - CoreController\n  - Webhook\n  - IstioCSR\n  type: string\n```\n\nThis means users can create a CertManager CR with `componentName: IstioCSR` that will pass CRD validation, but it will fail at the controller level with a validation error. This creates a poor user experience.\n\nTo align the API with your design intent, you should remove `IstioCSR` from the CRD enum. You can do this by:\n\n1. Removing `IstioCSRComponent` from the `ComponentName` type in `api/operator/v1alpha1/certmanager_types.go`\n2. Running `make generate manifests` to regenerate the CRD\n\nThis will ensure the API contract (CRD) matches the controller validation logic.\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2416346747", "pull_request_review_id": 3318324084, "id": 2416346747, "node_id": "PRRC_kwDOFdFn9s6QBoZ7", "diff_hunk": "@@ -0,0 +1,257 @@\n+package deployment\n+\n+import (\n+\t\"context\"\n+\t\"fmt\"\n+\n+\tnetworkingv1 \"k8s.io/api/networking/v1\"\n+\t\"k8s.io/apimachinery/pkg/api/errors\"\n+\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n+\t\"k8s.io/client-go/kubernetes\"\n+\n+\t\"github.com/openshift/library-go/pkg/controller/factory\"\n+\t\"github.com/openshift/library-go/pkg/operator/events\"\n+\t\"github.com/openshift/library-go/pkg/operator/resource/resourceapply\"\n+\t\"github.com/openshift/library-go/pkg/operator/staticresourcecontroller\"\n+\t\"github.com/openshift/library-go/pkg/operator/v1helpers\"\n+\n+\t\"github.com/openshift/cert-manager-operator/api/operator/v1alpha1\"\n+\t\"github.com/openshift/cert-manager-operator/pkg/operator/assets\"\n+\tcertmanoperatorinformers \"github.com/openshift/cert-manager-operator/pkg/operator/informers/externalversions\"\n+)\n+\n+const (\n+\tcertManagerNetworkPolicyStaticResourcesControllerName = operatorName + \"-networkpolicy-static-resources-\"\n+\tcertManagerNetworkPolicyUserDefinedControllerName     = operatorName + \"-networkpolicy-user-defined\"\n+\tcertManagerNamespace                                  = \"cert-manager\"\n+\tnetworkPolicyOwnerLabel                               = \"cert-manager.operator.openshift.io/owned-by\"\n+)\n+\n+var (\n+\t// Static network policy asset files for default policies\n+\tcertManagerNetworkPolicyAssetFiles = []string{\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-deny-all-networkpolicy.yaml\",\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-api-server-egress-networkpolicy.yaml\",\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-metrics-ingress-networkpolicy.yaml\",\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-webhook-ingress-networkpolicy.yaml\",\n+\t}\n+)\n+\n+// ============================================================================\n+// STATIC RESOURCE CONTROLLER - for default network policies from YAML files\n+// ============================================================================\n+\n+func NewCertManagerNetworkPolicyStaticResourcesController(operatorClient v1helpers.OperatorClient,\n+\tkubeClientContainer *resourceapply.ClientHolder,\n+\tkubeInformersForNamespaces v1helpers.KubeInformersForNamespaces,\n+\tcertManagerOperatorInformers certmanoperatorinformers.SharedInformerFactory,\n+\teventsRecorder events.Recorder) factory.Controller {\n+\n+\t// Create conditional function to check if network policies should be applied\n+\tshouldApplyNetworkPolicies := func() bool {\n+\t\tcertManager, err := certManagerOperatorInformers.Operator().V1alpha1().CertManagers().Lister().Get(\"cluster\")\n+\t\tif err != nil {\n+\t\t\treturn false\n+\t\t}\n+\t\treturn certManager.Spec.DefaultNetworkPolicy == \"true\"\n+\t}\n+\n+\treturn staticresourcecontroller.NewStaticResourceController(\n+\t\tcertManagerNetworkPolicyStaticResourcesControllerName,\n+\t\tassets.Asset,\n+\t\t[]string{}, // empty files, we'll add them conditionally\n+\t\tkubeClientContainer,\n+\t\toperatorClient,\n+\t\teventsRecorder,\n+\t).WithConditionalResources(\n+\t\tassets.Asset,\n+\t\tcertManagerNetworkPolicyAssetFiles,\n+\t\tshouldApplyNetworkPolicies,\n+\t\tnil, // Since immutable, we never delete\n+\t).AddKubeInformers(kubeInformersForNamespaces).AddInformer(\n+\t\tcertManagerOperatorInformers.Operator().V1alpha1().CertManagers().Informer(),\n+\t)\n+}\n+\n+// ============================================================================\n+// USER-DEFINED CONTROLLER - for user-configured network policies from API\n+// ============================================================================\n+\n+// CertManagerNetworkPolicyUserDefinedController manages user-defined NetworkPolicy resources\n+type CertManagerNetworkPolicyUserDefinedController struct {\n+\toperatorClient               v1helpers.OperatorClient\n+\tcertManagerOperatorInformers certmanoperatorinformers.SharedInformerFactory\n+\tkubeClient                   kubernetes.Interface\n+\teventRecorder                events.Recorder\n+}\n+\n+func NewCertManagerNetworkPolicyUserDefinedController(\n+\toperatorClient v1helpers.OperatorClient,\n+\tcertManagerOperatorInformers certmanoperatorinformers.SharedInformerFactory,\n+\tkubeClient kubernetes.Interface,\n+\teventRecorder events.Recorder,\n+) factory.Controller {\n+\tc := &CertManagerNetworkPolicyUserDefinedController{\n+\t\toperatorClient:               operatorClient,\n+\t\tcertManagerOperatorInformers: certManagerOperatorInformers,\n+\t\tkubeClient:                   kubeClient,\n+\t\teventRecorder:                eventRecorder.WithComponentSuffix(\"cert-manager-networkpolicy-user-defined\"),\n+\t}\n+\n+\treturn factory.New().\n+\t\tWithInformers(\n+\t\t\toperatorClient.Informer(),\n+\t\t\tcertManagerOperatorInformers.Operator().V1alpha1().CertManagers().Informer(),\n+\t\t).\n+\t\tWithSync(c.sync).\n+\t\tToController(certManagerNetworkPolicyUserDefinedControllerName, c.eventRecorder)\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) sync(ctx context.Context, syncCtx factory.SyncContext) error {\n+\t// Get the current CertManager configuration\n+\tcertManager, err := c.certManagerOperatorInformers.Operator().V1alpha1().CertManagers().Lister().Get(\"cluster\")\n+\tif err != nil {\n+\t\tif errors.IsNotFound(err) {\n+\t\t\t// No CertManager found, nothing to do\n+\t\t\treturn nil\n+\t\t}\n+\t\treturn fmt.Errorf(\"failed to get CertManager: %w\", err)\n+\t}\n+\n+\t// Check if network policies are enabled\n+\tif certManager.Spec.DefaultNetworkPolicy != \"true\" {\n+\t\t// Network policies not enabled, nothing to do\n+\t\t// Note: Since fields are immutable, no cleanup needed\n+\t\treturn nil\n+\t}\n+\n+\t// Validate user-defined network policy configuration\n+\tif err := c.validateNetworkPolicyConfig(certManager); err != nil {\n+\t\tc.eventRecorder.Warningf(\"NetworkPolicyValidationFailed\", \"Network policy configuration validation failed: %v\", err)\n+\t\treturn fmt.Errorf(\"network policy configuration validation failed: %w\", err)\n+\t}\n+\n+\t// Apply user-defined network policies\n+\tif err := c.reconcileUserNetworkPolicies(ctx, certManager); err != nil {\n+\t\tc.eventRecorder.Warningf(\"UserNetworkPolicyReconcileFailed\", \"Failed to reconcile user network policies: %v\", err)\n+\t\treturn fmt.Errorf(\"failed to reconcile user network policies: %w\", err)\n+\t}\n+\n+\tc.eventRecorder.Event(\"UserNetworkPolicyReconcileSuccess\", \"Successfully reconciled user-defined network policies\")\n+\treturn nil\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) validateNetworkPolicyConfig(certManager *v1alpha1.CertManager) error {\n+\t// Validate each user-defined network policy\n+\tfor i, policy := range certManager.Spec.NetworkPolicies {\n+\t\tif policy.Name == \"\" {\n+\t\t\treturn fmt.Errorf(\"network policy at index %d: name cannot be empty\", i)\n+\t\t}\n+\t\tif len(policy.Egress) == 0 {\n+\t\t\treturn fmt.Errorf(\"network policy at index %d: egress rules cannot be empty when network policies are enabled\", i)\n+\t\t}\n+\t\tif err := c.validateComponentName(policy.ComponentName); err != nil {\n+\t\t\treturn fmt.Errorf(\"network policy at index %d: invalid component name: %w\", i, err)\n+\t\t}\n+\t}\n+\treturn nil\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) validateComponentName(componentName v1alpha1.ComponentName) error {\n+\tswitch componentName {\n+\tcase v1alpha1.CAInjector, v1alpha1.CoreController, v1alpha1.Webhook:\n+\t\treturn nil\n+\tdefault:\n+\t\treturn fmt.Errorf(\"unsupported component name: %s\", componentName)\n+\t}\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) reconcileUserNetworkPolicies(ctx context.Context, certManager *v1alpha1.CertManager) error {\n+\t// Apply each user-defined network policy\n+\tfor _, userPolicy := range certManager.Spec.NetworkPolicies {\n+\t\tpolicy := c.createUserNetworkPolicy(userPolicy)\n+\t\tif err := c.createOrUpdateNetworkPolicy(ctx, policy); err != nil {\n+\t\t\treturn fmt.Errorf(\"failed to create/update user network policy %s: %w\", policy.Name, err)\n+\t\t}\n+\t}\n+\n+\treturn nil\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) createUserNetworkPolicy(userPolicy v1alpha1.NetworkPolicy) *networkingv1.NetworkPolicy {\n+\tpodSelector := c.getPodSelectorForComponent(userPolicy.ComponentName)\n+\n+\treturn &networkingv1.NetworkPolicy{\n+\t\tObjectMeta: metav1.ObjectMeta{\n+\t\t\tName:      fmt.Sprintf(\"cert-manager-user-%s\", userPolicy.Name),\n+\t\t\tNamespace: certManagerNamespace,\n+\t\t\tLabels: map[string]string{\n+\t\t\t\tnetworkPolicyOwnerLabel: \"cert-manager\",\n+\t\t\t},\n+\t\t},\n+\t\tSpec: networkingv1.NetworkPolicySpec{\n+\t\t\tPodSelector: podSelector,\n+\t\t\tPolicyTypes: []networkingv1.PolicyType{\n+\t\t\t\tnetworkingv1.PolicyTypeEgress,\n+\t\t\t},\n+\t\t\tEgress: userPolicy.Egress,\n+\t\t},\n+\t}\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) getPodSelectorForComponent(component v1alpha1.ComponentName) metav1.LabelSelector {\n+\tswitch component {\n+\tcase v1alpha1.CAInjector:\n+\t\treturn metav1.LabelSelector{\n+\t\t\tMatchLabels: map[string]string{\n+\t\t\t\t\"app\": \"cainjector\",\n+\t\t\t},\n+\t\t}\n+\tcase v1alpha1.CoreController:\n+\t\treturn metav1.LabelSelector{\n+\t\t\tMatchLabels: map[string]string{\n+\t\t\t\t\"app\": \"cert-manager\",\n+\t\t\t},\n+\t\t}\n+\tcase v1alpha1.Webhook:\n+\t\treturn metav1.LabelSelector{\n+\t\t\tMatchLabels: map[string]string{\n+\t\t\t\t\"app\": \"webhook\",\n+\t\t\t},\n+\t\t}\n+\tdefault:\n+\t\treturn metav1.LabelSelector{\n+\t\t\tMatchLabels: map[string]string{\n+\t\t\t\t\"app.kubernetes.io/name\": \"cert-manager\",\n+\t\t\t},\n+\t\t}\n+\t}\n+}", "path": "pkg/controller/deployment/cert_manager_networkpolicy.go", "commit_id": "167c0ed38cf01bfe1b1dffd042ee70794a546beb", "original_commit_id": "9f6cd4178a2c1ed48e80c28d5e3dd6fd946702e7", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n\ud83c\udfc1 Script executed:\n```\n#!/bin/bash\n# Check the CRD validation for componentName field in NetworkPolicy\ncat config/crd/bases/operator.openshift.io_certmanagers.yaml | grep -A 30 \"componentName:\" | head -40\n```\n\nLength of output: 2176\n\n---\n\n\n\n</details>\n\n@PillaiManish Thank you for the clarification. I understand that IstioCSR is handled separately and you don't want to support it in user-defined network policies.\n\nHowever, there's an inconsistency in the current implementation: the CRD enum validation in `config/crd/bases/operator.openshift.io_certmanagers.yaml` explicitly lists `IstioCSR` as a valid value for `componentName`:\n\n```yaml\ncomponentName:\n  enum:\n  - CAInjector\n  - CoreController\n  - Webhook\n  - IstioCSR\n  type: string\n```\n\nThis means users can create a CertManager CR with `componentName: IstioCSR` that will pass CRD validation, but it will fail at the controller level with a validation error. This creates a poor user experience.\n\nTo align the API with your design intent, you should remove `IstioCSR` from the CRD enum. You can do this by:\n\n1. Removing `IstioCSRComponent` from the `ComponentName` type in `api/operator/v1alpha1/certmanager_types.go`\n2. Running `make generate manifests` to regenerate the CRD\n\nThis will ensure the API contract (CRD) matches the controller validation logic.\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "created_at": "2025-10-09T10:40:13Z", "updated_at": "2025-10-09T10:40:13Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2416346747", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2416346747"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2416346747"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2416346747/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 145, "original_start_line": 144, "start_side": "RIGHT", "line": 228, "original_line": 228, "side": "RIGHT", "in_reply_to_id": 2410395486, "author_association": "NONE", "original_position": 229, "position": 228, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 320, "file_path": "pkg/controller/deployment/cert_manager_networkpolicy.go", "line_start": 127, "line_end": 127, "diff_context": "", "comment_body": "<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n\ud83c\udfc1 Script executed:\n```\n#!/bin/bash\n# Check the actual type definition of DefaultNetworkPolicy in the API types\nrg -A 5 \"DefaultNetworkPolicy\" api/operator/v1alpha1/certmanager_types.go\n```\n\nLength of output: 1673\n\n---\n\n@PillaiManish You're absolutely right, and I apologize for the confusion. I've verified the actual type definition, and `DefaultNetworkPolicy` is indeed a **string** field, not a boolean:\n\n```go\nDefaultNetworkPolicy string `json:\"defaultNetworkPolicy,omitempty\"`\n```\n\nThe string comparison `certManager.Spec.DefaultNetworkPolicy != \"true\"` at line 122 is **correct as-is**. There is no type mismatch. My original comment was incorrect.\n\nLet me resolve this comment now.\n\n---\n\n\ud83c\udfc1 Script executed:\n```\n#!/bin/bash\n# Find and resolve my own comment\ngh pr view 320 --json comments --jq '.comments[] | select(.author.login == \"coderabbitai[bot]\") | select(.body | contains(\"Same type mismatch as in the static controller\")) | .id' | head -1 | xargs -I {} gh api --method PATCH /repos/openshift/cert-manager-operator/pulls/comments/{} -f body=\"~~This comment has been resolved - the field type is string and the comparison is correct.~~\"\n```\n\nLength of output: 0\n\n---\n\n\ud83c\udfc1 Script executed:\n```\n#!/bin/bash\n# Resolve the review thread by marking it as resolved\n# First, let's get the thread ID from the discussion reference\nDISCUSSION_ID=\"r2410415338\"\n# Extract numeric ID\nCOMMENT_ID=\"${DISCUSSION_ID#r}\"\n\n# Try to resolve using the REST API\ngh api --method PATCH \"/repos/openshift/cert-manager-operator/pulls/comments/${COMMENT_ID}\" \\\n  -H \"Accept: application/vnd.github.v3+json\" \\\n  -f body=\"~~This comment has been resolved - the field type is string and the comparison is correct.~~\" || echo \"Failed to update comment\"\n\n# Alternatively, try to use GraphQL to resolve the thread\ngh api graphql -f query='\nmutation {\n  resolveReviewThread(input: {threadId: \"'\"${DISCUSSION_ID}\"'\"}) {\n    thread {\n      isResolved\n    }\n  }\n}'\n```\n\nLength of output: 8549\n\n---\n\n\n\n</details>\n\nPerfect! I've successfully updated the comment to indicate it's resolved. \n\nTo summarize:\n- \u2705 The `DefaultNetworkPolicy` field is correctly defined as a `string` type\n- \u2705 The comparison `certManager.Spec.DefaultNetworkPolicy != \"true\"` at line 122 is **valid and correct**\n- \u2705 The comment has been updated to reflect this resolution\n\nMy original comment was incorrect - there is no type mismatch here. The code is working as intended. Thank you for asking me to double-check! \ud83c\udf89\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2416358940", "pull_request_review_id": 3318343615, "id": 2416358940, "node_id": "PRRC_kwDOFdFn9s6QBrYc", "diff_hunk": "@@ -0,0 +1,257 @@\n+package deployment\n+\n+import (\n+\t\"context\"\n+\t\"fmt\"\n+\n+\tnetworkingv1 \"k8s.io/api/networking/v1\"\n+\t\"k8s.io/apimachinery/pkg/api/errors\"\n+\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n+\t\"k8s.io/client-go/kubernetes\"\n+\n+\t\"github.com/openshift/library-go/pkg/controller/factory\"\n+\t\"github.com/openshift/library-go/pkg/operator/events\"\n+\t\"github.com/openshift/library-go/pkg/operator/resource/resourceapply\"\n+\t\"github.com/openshift/library-go/pkg/operator/staticresourcecontroller\"\n+\t\"github.com/openshift/library-go/pkg/operator/v1helpers\"\n+\n+\t\"github.com/openshift/cert-manager-operator/api/operator/v1alpha1\"\n+\t\"github.com/openshift/cert-manager-operator/pkg/operator/assets\"\n+\tcertmanoperatorinformers \"github.com/openshift/cert-manager-operator/pkg/operator/informers/externalversions\"\n+)\n+\n+const (\n+\tcertManagerNetworkPolicyStaticResourcesControllerName = operatorName + \"-networkpolicy-static-resources-\"\n+\tcertManagerNetworkPolicyUserDefinedControllerName     = operatorName + \"-networkpolicy-user-defined\"\n+\tcertManagerNamespace                                  = \"cert-manager\"\n+\tnetworkPolicyOwnerLabel                               = \"cert-manager.operator.openshift.io/owned-by\"\n+)\n+\n+var (\n+\t// Static network policy asset files for default policies\n+\tcertManagerNetworkPolicyAssetFiles = []string{\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-deny-all-networkpolicy.yaml\",\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-api-server-egress-networkpolicy.yaml\",\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-metrics-ingress-networkpolicy.yaml\",\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-webhook-ingress-networkpolicy.yaml\",\n+\t}\n+)\n+\n+// ============================================================================\n+// STATIC RESOURCE CONTROLLER - for default network policies from YAML files\n+// ============================================================================\n+\n+func NewCertManagerNetworkPolicyStaticResourcesController(operatorClient v1helpers.OperatorClient,\n+\tkubeClientContainer *resourceapply.ClientHolder,\n+\tkubeInformersForNamespaces v1helpers.KubeInformersForNamespaces,\n+\tcertManagerOperatorInformers certmanoperatorinformers.SharedInformerFactory,\n+\teventsRecorder events.Recorder) factory.Controller {\n+\n+\t// Create conditional function to check if network policies should be applied\n+\tshouldApplyNetworkPolicies := func() bool {\n+\t\tcertManager, err := certManagerOperatorInformers.Operator().V1alpha1().CertManagers().Lister().Get(\"cluster\")\n+\t\tif err != nil {\n+\t\t\treturn false\n+\t\t}\n+\t\treturn certManager.Spec.DefaultNetworkPolicy == \"true\"\n+\t}\n+\n+\treturn staticresourcecontroller.NewStaticResourceController(\n+\t\tcertManagerNetworkPolicyStaticResourcesControllerName,\n+\t\tassets.Asset,\n+\t\t[]string{}, // empty files, we'll add them conditionally\n+\t\tkubeClientContainer,\n+\t\toperatorClient,\n+\t\teventsRecorder,\n+\t).WithConditionalResources(\n+\t\tassets.Asset,\n+\t\tcertManagerNetworkPolicyAssetFiles,\n+\t\tshouldApplyNetworkPolicies,\n+\t\tnil, // Since immutable, we never delete\n+\t).AddKubeInformers(kubeInformersForNamespaces).AddInformer(\n+\t\tcertManagerOperatorInformers.Operator().V1alpha1().CertManagers().Informer(),\n+\t)\n+}\n+\n+// ============================================================================\n+// USER-DEFINED CONTROLLER - for user-configured network policies from API\n+// ============================================================================\n+\n+// CertManagerNetworkPolicyUserDefinedController manages user-defined NetworkPolicy resources\n+type CertManagerNetworkPolicyUserDefinedController struct {\n+\toperatorClient               v1helpers.OperatorClient\n+\tcertManagerOperatorInformers certmanoperatorinformers.SharedInformerFactory\n+\tkubeClient                   kubernetes.Interface\n+\teventRecorder                events.Recorder\n+}\n+\n+func NewCertManagerNetworkPolicyUserDefinedController(\n+\toperatorClient v1helpers.OperatorClient,\n+\tcertManagerOperatorInformers certmanoperatorinformers.SharedInformerFactory,\n+\tkubeClient kubernetes.Interface,\n+\teventRecorder events.Recorder,\n+) factory.Controller {\n+\tc := &CertManagerNetworkPolicyUserDefinedController{\n+\t\toperatorClient:               operatorClient,\n+\t\tcertManagerOperatorInformers: certManagerOperatorInformers,\n+\t\tkubeClient:                   kubeClient,\n+\t\teventRecorder:                eventRecorder.WithComponentSuffix(\"cert-manager-networkpolicy-user-defined\"),\n+\t}\n+\n+\treturn factory.New().\n+\t\tWithInformers(\n+\t\t\toperatorClient.Informer(),\n+\t\t\tcertManagerOperatorInformers.Operator().V1alpha1().CertManagers().Informer(),\n+\t\t).\n+\t\tWithSync(c.sync).\n+\t\tToController(certManagerNetworkPolicyUserDefinedControllerName, c.eventRecorder)\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) sync(ctx context.Context, syncCtx factory.SyncContext) error {\n+\t// Get the current CertManager configuration\n+\tcertManager, err := c.certManagerOperatorInformers.Operator().V1alpha1().CertManagers().Lister().Get(\"cluster\")\n+\tif err != nil {\n+\t\tif errors.IsNotFound(err) {\n+\t\t\t// No CertManager found, nothing to do\n+\t\t\treturn nil\n+\t\t}\n+\t\treturn fmt.Errorf(\"failed to get CertManager: %w\", err)\n+\t}\n+\n+\t// Check if network policies are enabled\n+\tif certManager.Spec.DefaultNetworkPolicy != \"true\" {\n+\t\t// Network policies not enabled, nothing to do\n+\t\t// Note: Since fields are immutable, no cleanup needed\n+\t\treturn nil\n+\t}", "path": "pkg/controller/deployment/cert_manager_networkpolicy.go", "commit_id": "167c0ed38cf01bfe1b1dffd042ee70794a546beb", "original_commit_id": "eb88d8aabe810523a4dafeda023bb474de53b5ac", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n\ud83c\udfc1 Script executed:\n```\n#!/bin/bash\n# Check the actual type definition of DefaultNetworkPolicy in the API types\nrg -A 5 \"DefaultNetworkPolicy\" api/operator/v1alpha1/certmanager_types.go\n```\n\nLength of output: 1673\n\n---\n\n@PillaiManish You're absolutely right, and I apologize for the confusion. I've verified the actual type definition, and `DefaultNetworkPolicy` is indeed a **string** field, not a boolean:\n\n```go\nDefaultNetworkPolicy string `json:\"defaultNetworkPolicy,omitempty\"`\n```\n\nThe string comparison `certManager.Spec.DefaultNetworkPolicy != \"true\"` at line 122 is **correct as-is**. There is no type mismatch. My original comment was incorrect.\n\nLet me resolve this comment now.\n\n---\n\n\ud83c\udfc1 Script executed:\n```\n#!/bin/bash\n# Find and resolve my own comment\ngh pr view 320 --json comments --jq '.comments[] | select(.author.login == \"coderabbitai[bot]\") | select(.body | contains(\"Same type mismatch as in the static controller\")) | .id' | head -1 | xargs -I {} gh api --method PATCH /repos/openshift/cert-manager-operator/pulls/comments/{} -f body=\"~~This comment has been resolved - the field type is string and the comparison is correct.~~\"\n```\n\nLength of output: 0\n\n---\n\n\ud83c\udfc1 Script executed:\n```\n#!/bin/bash\n# Resolve the review thread by marking it as resolved\n# First, let's get the thread ID from the discussion reference\nDISCUSSION_ID=\"r2410415338\"\n# Extract numeric ID\nCOMMENT_ID=\"${DISCUSSION_ID#r}\"\n\n# Try to resolve using the REST API\ngh api --method PATCH \"/repos/openshift/cert-manager-operator/pulls/comments/${COMMENT_ID}\" \\\n  -H \"Accept: application/vnd.github.v3+json\" \\\n  -f body=\"~~This comment has been resolved - the field type is string and the comparison is correct.~~\" || echo \"Failed to update comment\"\n\n# Alternatively, try to use GraphQL to resolve the thread\ngh api graphql -f query='\nmutation {\n  resolveReviewThread(input: {threadId: \"'\"${DISCUSSION_ID}\"'\"}) {\n    thread {\n      isResolved\n    }\n  }\n}'\n```\n\nLength of output: 8549\n\n---\n\n\n\n</details>\n\nPerfect! I've successfully updated the comment to indicate it's resolved. \n\nTo summarize:\n- \u2705 The `DefaultNetworkPolicy` field is correctly defined as a `string` type\n- \u2705 The comparison `certManager.Spec.DefaultNetworkPolicy != \"true\"` at line 122 is **valid and correct**\n- \u2705 The comment has been updated to reflect this resolution\n\nMy original comment was incorrect - there is no type mismatch here. The code is working as intended. Thank you for asking me to double-check! \ud83c\udf89\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "created_at": "2025-10-09T10:44:33Z", "updated_at": "2025-10-09T10:44:34Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2416358940", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2416358940"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2416358940"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2416358940/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 122, "original_start_line": 121, "start_side": "RIGHT", "line": 127, "original_line": 127, "side": "RIGHT", "in_reply_to_id": 2410415338, "author_association": "NONE", "original_position": 126, "position": 127, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 320, "file_path": "api/operator/v1alpha1/certmanager_types.go", "line_start": 270, "line_end": 270, "diff_context": "", "comment_body": "<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n\ud83c\udfc1 Script executed:\n```\n#!/bin/bash\n# Check the createUserNetworkPolicy implementation for naming and policy types\necho \"=== createUserNetworkPolicy function implementation ===\"\nast-grep --pattern $'func createUserNetworkPolicy($_, $_, $_) ($_, error) {\n  $$$\n}'\n\necho -e \"\\n=== Check how NetworkPolicy names are currently generated ===\"\nrg -n \"ObjectMeta.*Name|\\.Name\\s*=\" pkg/controller/deployment/cert_manager_networkpolicy.go -A2 -B2\n\necho -e \"\\n=== Check PolicyTypes settings ===\"\nrg -n \"PolicyTypes|policyTypes\" pkg/controller/deployment/cert_manager_networkpolicy.go -A2 -B2\n\necho -e \"\\n=== Check the documentation comment about ingress handling ===\"\nsed -n '255,265p' api/operator/v1alpha1/certmanager_types.go\n```\n\nLength of output: 1362\n\n---\n\n\ud83c\udfc1 Script executed:\n```\n#!/bin/bash\n# Get the full createUserNetworkPolicy function\necho \"=== Full createUserNetworkPolicy function ===\"\nsed -n '/^func createUserNetworkPolicy/,/^}/p' pkg/controller/deployment/cert_manager_networkpolicy.go\n\necho -e \"\\n=== Check if there are any default network policies with similar naming ===\"\nrg -n \"cert-manager-.*-networkpolicy\" bindata/cert-manager-deployment/networkpolicies/ -l\n```\n\nLength of output: 122\n\n---\n\n\ud83c\udfc1 Script executed:\n```\n#!/bin/bash\n# Search for createUserNetworkPolicy function\necho \"=== Search for createUserNetworkPolicy ===\"\nrg -n \"createUserNetworkPolicy\" pkg/controller/deployment/cert_manager_networkpolicy.go -A30\n\necho -e \"\\n=== List all default network policy files ===\"\nfd -e yaml . bindata/cert-manager-deployment/networkpolicies/\n\necho -e \"\\n=== Check naming pattern in default policies ===\"\nfor file in bindata/cert-manager-deployment/networkpolicies/*.yaml; do\n  echo \"File: $file\"\n  grep \"name:\" \"$file\" | head -1\ndone\n\necho -e \"\\n=== Search for where user policy name is set in ObjectMeta ===\"\nrg -n \"ObjectMeta|metadata.*Name\" pkg/controller/deployment/cert_manager_networkpolicy.go -B2 -A5\n```\n\nLength of output: 2832\n\n---\n\n\n\n</details>\n\n@PillaiManish Thank you for the clarification! Here are my recommendations:\n\n## 1. Documentation Issue\n\nThe comment at line 261 in `api/operator/v1alpha1/certmanager_types.go` states:\n```go\n// The operator will automatically handle ingress rules based on the current running ports.\n```\n\nThis is **incorrect** based on the implementation (line 194-196 only sets `PolicyTypeEgress`) and your security decision. Please update or remove this statement to avoid confusion. Consider replacing it with:\n\n```go\n// Ingress rules are handled separately by the default network policies when DefaultNetworkPolicy is enabled.\n// User-defined policies should focus on egress rules only.\n```\n\n## 2. Naming Convention\n\nThe current implementation uses `cert-manager-user-<name>` (line 186), which is collision-safe because:\n- Default policies follow patterns like `cert-manager-<purpose>-<type>`\n- User policies have the `user` prefix distinguishing them\n- The `Name` field is validated as non-empty\n\n**Options:**\n\n**Option A (Keep current):** `cert-manager-user-<name>` \n- \u2705 Simple and collision-safe\n- \u2705 User has full control over naming\n- \u26a0\ufe0f Component not obvious from name alone\n\n**Option B (Add component):** `cert-manager-user-<component>-<name>`\n- \u2705 More explicit about which component the policy applies to\n- \u2705 Better for operational visibility\n- \u26a0\ufe0f Slightly more verbose\n\n**My recommendation:** Use **Option B** for better clarity and operational debugging. When troubleshooting network policies, having the component in the name makes it immediately clear which workload is affected. The implementation would be:\n\n```go\nName: fmt.Sprintf(\"cert-manager-user-%s-%s\", strings.ToLower(string(userPolicy.ComponentName)), userPolicy.Name),\n```\n\nThis maintains collision safety while improving discoverability.\n\n---\n\n<details>\n<summary>\ud83e\uddec Code Graph Analysis Results</summary>\n\n### File: `pkg/operator/applyconfigurations/operator/v1alpha1/networkpolicy.go` (lines 20-22)\n```\nfunc NetworkPolicy() *NetworkPolicyApplyConfiguration {\n\treturn &NetworkPolicyApplyConfiguration{}\n}\n```\n\n### File: `pkg/operator/applyconfigurations/operator/v1alpha1/certmanagerspec.go` (lines 24-26)\n```\nfunc CertManagerSpec() *CertManagerSpecApplyConfiguration {\n\treturn &CertManagerSpecApplyConfiguration{}\n}\n```\n\n### File: `pkg/operator/applyconfigurations/operator/v1alpha1/deploymentconfig.go` (lines 22-24)\n```\nfunc DeploymentConfig() *DeploymentConfigApplyConfiguration {\n\treturn &DeploymentConfigApplyConfiguration{}\n}\n```\n\n</details>\n\n\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2416570151", "pull_request_review_id": 3318651874, "id": 2416570151, "node_id": "PRRC_kwDOFdFn9s6QCe8n", "diff_hunk": "@@ -181,6 +218,50 @@ type CertManagerList struct {\n \tItems []CertManager `json:\"items\"`\n }\n \n+// ComponentName represents the different cert-manager components that can have network policies applied.\n+type ComponentName string\n+\n+const (\n+\t// CAInjector represents the cert-manager CA injector component\n+\tCAInjector ComponentName = \"CAInjector\"\n+\n+\t// CoreController represents the cert-manager core controller component\n+\tCoreController ComponentName = \"CoreController\"\n+\n+\t// Webhook represents the cert-manager webhook component\n+\tWebhook ComponentName = \"Webhook\"\n+\n+\t// IstioCSRComponent represents the cert-manager Istio CSR component\n+\tIstioCSRComponent ComponentName = \"IstioCSR\"\n+)\n+\n+// NetworkPolicy represents a custom network policy configuration for operator-managed components.\n+// It includes a name for identification and the network policy rules to be enforced.\n+type NetworkPolicy struct {\n+\t// Name is a unique identifier for this network policy configuration.\n+\t// This name will be used as part of the generated NetworkPolicy resource name.\n+\t// +kubebuilder:validation:Required\n+\t// +required\n+\tName string `json:\"name\"`\n+\n+\t// ComponentName represents the different cert-manager components that can have network policies applied.\n+\t// +kubebuilder:validation:Enum=CAInjector;CoreController;Webhook;IstioCSR\n+\t// +kubebuilder:validation:Required\n+\t// +required\n+\tComponentName ComponentName `json:\"componentName\"`\n+\n+\t// egress is a list of egress rules to be applied to the selected pods. Outgoing traffic\n+\t// is allowed if there are no NetworkPolicies selecting the pod (and cluster policy\n+\t// otherwise allows the traffic), OR if the traffic matches at least one egress rule\n+\t// across all of the NetworkPolicy objects whose podSelector matches the pod. If\n+\t// this field is empty then this NetworkPolicy limits all outgoing traffic (and serves\n+\t// solely to ensure that the pods it selects are isolated by default).\n+\t// The operator will automatically handle ingress rules based on the current running ports.\n+\t// +optional\n+\t// +listType=atomic\n+\tEgress []networkingv1.NetworkPolicyEgressRule `json:\"egress,omitempty\" protobuf:\"bytes,3,rep,name=egress\"`\n+}", "path": "api/operator/v1alpha1/certmanager_types.go", "commit_id": "167c0ed38cf01bfe1b1dffd042ee70794a546beb", "original_commit_id": "4b635b00dad11a605c8fc63f3fcab220486a92bc", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n\ud83c\udfc1 Script executed:\n```\n#!/bin/bash\n# Check the createUserNetworkPolicy implementation for naming and policy types\necho \"=== createUserNetworkPolicy function implementation ===\"\nast-grep --pattern $'func createUserNetworkPolicy($_, $_, $_) ($_, error) {\n  $$$\n}'\n\necho -e \"\\n=== Check how NetworkPolicy names are currently generated ===\"\nrg -n \"ObjectMeta.*Name|\\.Name\\s*=\" pkg/controller/deployment/cert_manager_networkpolicy.go -A2 -B2\n\necho -e \"\\n=== Check PolicyTypes settings ===\"\nrg -n \"PolicyTypes|policyTypes\" pkg/controller/deployment/cert_manager_networkpolicy.go -A2 -B2\n\necho -e \"\\n=== Check the documentation comment about ingress handling ===\"\nsed -n '255,265p' api/operator/v1alpha1/certmanager_types.go\n```\n\nLength of output: 1362\n\n---\n\n\ud83c\udfc1 Script executed:\n```\n#!/bin/bash\n# Get the full createUserNetworkPolicy function\necho \"=== Full createUserNetworkPolicy function ===\"\nsed -n '/^func createUserNetworkPolicy/,/^}/p' pkg/controller/deployment/cert_manager_networkpolicy.go\n\necho -e \"\\n=== Check if there are any default network policies with similar naming ===\"\nrg -n \"cert-manager-.*-networkpolicy\" bindata/cert-manager-deployment/networkpolicies/ -l\n```\n\nLength of output: 122\n\n---\n\n\ud83c\udfc1 Script executed:\n```\n#!/bin/bash\n# Search for createUserNetworkPolicy function\necho \"=== Search for createUserNetworkPolicy ===\"\nrg -n \"createUserNetworkPolicy\" pkg/controller/deployment/cert_manager_networkpolicy.go -A30\n\necho -e \"\\n=== List all default network policy files ===\"\nfd -e yaml . bindata/cert-manager-deployment/networkpolicies/\n\necho -e \"\\n=== Check naming pattern in default policies ===\"\nfor file in bindata/cert-manager-deployment/networkpolicies/*.yaml; do\n  echo \"File: $file\"\n  grep \"name:\" \"$file\" | head -1\ndone\n\necho -e \"\\n=== Search for where user policy name is set in ObjectMeta ===\"\nrg -n \"ObjectMeta|metadata.*Name\" pkg/controller/deployment/cert_manager_networkpolicy.go -B2 -A5\n```\n\nLength of output: 2832\n\n---\n\n\n\n</details>\n\n@PillaiManish Thank you for the clarification! Here are my recommendations:\n\n## 1. Documentation Issue\n\nThe comment at line 261 in `api/operator/v1alpha1/certmanager_types.go` states:\n```go\n// The operator will automatically handle ingress rules based on the current running ports.\n```\n\nThis is **incorrect** based on the implementation (line 194-196 only sets `PolicyTypeEgress`) and your security decision. Please update or remove this statement to avoid confusion. Consider replacing it with:\n\n```go\n// Ingress rules are handled separately by the default network policies when DefaultNetworkPolicy is enabled.\n// User-defined policies should focus on egress rules only.\n```\n\n## 2. Naming Convention\n\nThe current implementation uses `cert-manager-user-<name>` (line 186), which is collision-safe because:\n- Default policies follow patterns like `cert-manager-<purpose>-<type>`\n- User policies have the `user` prefix distinguishing them\n- The `Name` field is validated as non-empty\n\n**Options:**\n\n**Option A (Keep current):** `cert-manager-user-<name>` \n- \u2705 Simple and collision-safe\n- \u2705 User has full control over naming\n- \u26a0\ufe0f Component not obvious from name alone\n\n**Option B (Add component):** `cert-manager-user-<component>-<name>`\n- \u2705 More explicit about which component the policy applies to\n- \u2705 Better for operational visibility\n- \u26a0\ufe0f Slightly more verbose\n\n**My recommendation:** Use **Option B** for better clarity and operational debugging. When troubleshooting network policies, having the component in the name makes it immediately clear which workload is affected. The implementation would be:\n\n```go\nName: fmt.Sprintf(\"cert-manager-user-%s-%s\", strings.ToLower(string(userPolicy.ComponentName)), userPolicy.Name),\n```\n\nThis maintains collision safety while improving discoverability.\n\n---\n\n<details>\n<summary>\ud83e\uddec Code Graph Analysis Results</summary>\n\n### File: `pkg/operator/applyconfigurations/operator/v1alpha1/networkpolicy.go` (lines 20-22)\n```\nfunc NetworkPolicy() *NetworkPolicyApplyConfiguration {\n\treturn &NetworkPolicyApplyConfiguration{}\n}\n```\n\n### File: `pkg/operator/applyconfigurations/operator/v1alpha1/certmanagerspec.go` (lines 24-26)\n```\nfunc CertManagerSpec() *CertManagerSpecApplyConfiguration {\n\treturn &CertManagerSpecApplyConfiguration{}\n}\n```\n\n### File: `pkg/operator/applyconfigurations/operator/v1alpha1/deploymentconfig.go` (lines 22-24)\n```\nfunc DeploymentConfig() *DeploymentConfigApplyConfiguration {\n\treturn &DeploymentConfigApplyConfiguration{}\n}\n```\n\n</details>\n\n\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "created_at": "2025-10-09T12:08:53Z", "updated_at": "2025-10-09T12:08:53Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2416570151", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2416570151"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2416570151"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2416570151/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 243, "original_start_line": 238, "start_side": "RIGHT", "line": 270, "original_line": 270, "side": "RIGHT", "in_reply_to_id": 2413424664, "author_association": "NONE", "original_position": 97, "position": 104, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 320, "file_path": "pkg/controller/deployment/cert_manager_networkpolicy.go", "line_start": 149, "line_end": 149, "diff_context": "", "comment_body": "[claude-generated] The validation here checks if egress rules are empty, but this contradicts the API documentation which states: 'If DefaultNetworkPolicy is \"true\" but this field is not provided, cert-manager components will be isolated with deny-all egress policies.' Empty egress rules should be allowed to support deny-all configuration.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2420152596", "pull_request_review_id": 3323442805, "id": 2420152596, "node_id": "PRRC_kwDOFdFn9s6QQJkU", "diff_hunk": "@@ -0,0 +1,257 @@\n+package deployment\n+\n+import (\n+\t\"context\"\n+\t\"fmt\"\n+\n+\tnetworkingv1 \"k8s.io/api/networking/v1\"\n+\t\"k8s.io/apimachinery/pkg/api/errors\"\n+\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n+\t\"k8s.io/client-go/kubernetes\"\n+\n+\t\"github.com/openshift/library-go/pkg/controller/factory\"\n+\t\"github.com/openshift/library-go/pkg/operator/events\"\n+\t\"github.com/openshift/library-go/pkg/operator/resource/resourceapply\"\n+\t\"github.com/openshift/library-go/pkg/operator/staticresourcecontroller\"\n+\t\"github.com/openshift/library-go/pkg/operator/v1helpers\"\n+\n+\t\"github.com/openshift/cert-manager-operator/api/operator/v1alpha1\"\n+\t\"github.com/openshift/cert-manager-operator/pkg/operator/assets\"\n+\tcertmanoperatorinformers \"github.com/openshift/cert-manager-operator/pkg/operator/informers/externalversions\"\n+)\n+\n+const (\n+\tcertManagerNetworkPolicyStaticResourcesControllerName = operatorName + \"-networkpolicy-static-resources-\"\n+\tcertManagerNetworkPolicyUserDefinedControllerName     = operatorName + \"-networkpolicy-user-defined\"\n+\tcertManagerNamespace                                  = \"cert-manager\"\n+\tnetworkPolicyOwnerLabel                               = \"cert-manager.operator.openshift.io/owned-by\"\n+)\n+\n+var (\n+\t// Static network policy asset files for default policies\n+\tcertManagerNetworkPolicyAssetFiles = []string{\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-deny-all-networkpolicy.yaml\",\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-api-server-egress-networkpolicy.yaml\",\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-metrics-ingress-networkpolicy.yaml\",\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-webhook-ingress-networkpolicy.yaml\",\n+\t}\n+)\n+\n+// ============================================================================\n+// STATIC RESOURCE CONTROLLER - for default network policies from YAML files\n+// ============================================================================\n+\n+func NewCertManagerNetworkPolicyStaticResourcesController(operatorClient v1helpers.OperatorClient,\n+\tkubeClientContainer *resourceapply.ClientHolder,\n+\tkubeInformersForNamespaces v1helpers.KubeInformersForNamespaces,\n+\tcertManagerOperatorInformers certmanoperatorinformers.SharedInformerFactory,\n+\teventsRecorder events.Recorder) factory.Controller {\n+\n+\t// Create conditional function to check if network policies should be applied\n+\tshouldApplyNetworkPolicies := func() bool {\n+\t\tcertManager, err := certManagerOperatorInformers.Operator().V1alpha1().CertManagers().Lister().Get(\"cluster\")\n+\t\tif err != nil {\n+\t\t\treturn false\n+\t\t}\n+\t\treturn certManager.Spec.DefaultNetworkPolicy == \"true\"\n+\t}\n+\n+\treturn staticresourcecontroller.NewStaticResourceController(\n+\t\tcertManagerNetworkPolicyStaticResourcesControllerName,\n+\t\tassets.Asset,\n+\t\t[]string{}, // empty files, we'll add them conditionally\n+\t\tkubeClientContainer,\n+\t\toperatorClient,\n+\t\teventsRecorder,\n+\t).WithConditionalResources(\n+\t\tassets.Asset,\n+\t\tcertManagerNetworkPolicyAssetFiles,\n+\t\tshouldApplyNetworkPolicies,\n+\t\tnil, // Since immutable, we never delete\n+\t).AddKubeInformers(kubeInformersForNamespaces).AddInformer(\n+\t\tcertManagerOperatorInformers.Operator().V1alpha1().CertManagers().Informer(),\n+\t)\n+}\n+\n+// ============================================================================\n+// USER-DEFINED CONTROLLER - for user-configured network policies from API\n+// ============================================================================\n+\n+// CertManagerNetworkPolicyUserDefinedController manages user-defined NetworkPolicy resources\n+type CertManagerNetworkPolicyUserDefinedController struct {\n+\toperatorClient               v1helpers.OperatorClient\n+\tcertManagerOperatorInformers certmanoperatorinformers.SharedInformerFactory\n+\tkubeClient                   kubernetes.Interface\n+\teventRecorder                events.Recorder\n+}\n+\n+func NewCertManagerNetworkPolicyUserDefinedController(\n+\toperatorClient v1helpers.OperatorClient,\n+\tcertManagerOperatorInformers certmanoperatorinformers.SharedInformerFactory,\n+\tkubeClient kubernetes.Interface,\n+\teventRecorder events.Recorder,\n+) factory.Controller {\n+\tc := &CertManagerNetworkPolicyUserDefinedController{\n+\t\toperatorClient:               operatorClient,\n+\t\tcertManagerOperatorInformers: certManagerOperatorInformers,\n+\t\tkubeClient:                   kubeClient,\n+\t\teventRecorder:                eventRecorder.WithComponentSuffix(\"cert-manager-networkpolicy-user-defined\"),\n+\t}\n+\n+\treturn factory.New().\n+\t\tWithInformers(\n+\t\t\toperatorClient.Informer(),\n+\t\t\tcertManagerOperatorInformers.Operator().V1alpha1().CertManagers().Informer(),\n+\t\t).\n+\t\tWithSync(c.sync).\n+\t\tToController(certManagerNetworkPolicyUserDefinedControllerName, c.eventRecorder)\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) sync(ctx context.Context, syncCtx factory.SyncContext) error {\n+\t// Get the current CertManager configuration\n+\tcertManager, err := c.certManagerOperatorInformers.Operator().V1alpha1().CertManagers().Lister().Get(\"cluster\")\n+\tif err != nil {\n+\t\tif errors.IsNotFound(err) {\n+\t\t\t// No CertManager found, nothing to do\n+\t\t\treturn nil\n+\t\t}\n+\t\treturn fmt.Errorf(\"failed to get CertManager: %w\", err)\n+\t}\n+\n+\t// Check if network policies are enabled\n+\tif certManager.Spec.DefaultNetworkPolicy != \"true\" {\n+\t\t// Network policies not enabled, nothing to do\n+\t\t// Note: Since fields are immutable, no cleanup needed\n+\t\treturn nil\n+\t}\n+\n+\t// Validate user-defined network policy configuration\n+\tif err := c.validateNetworkPolicyConfig(certManager); err != nil {\n+\t\tc.eventRecorder.Warningf(\"NetworkPolicyValidationFailed\", \"Network policy configuration validation failed: %v\", err)\n+\t\treturn fmt.Errorf(\"network policy configuration validation failed: %w\", err)\n+\t}\n+\n+\t// Apply user-defined network policies\n+\tif err := c.reconcileUserNetworkPolicies(ctx, certManager); err != nil {\n+\t\tc.eventRecorder.Warningf(\"UserNetworkPolicyReconcileFailed\", \"Failed to reconcile user network policies: %v\", err)\n+\t\treturn fmt.Errorf(\"failed to reconcile user network policies: %w\", err)\n+\t}\n+\n+\tc.eventRecorder.Event(\"UserNetworkPolicyReconcileSuccess\", \"Successfully reconciled user-defined network policies\")\n+\treturn nil\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) validateNetworkPolicyConfig(certManager *v1alpha1.CertManager) error {\n+\t// Validate each user-defined network policy\n+\tfor i, policy := range certManager.Spec.NetworkPolicies {\n+\t\tif policy.Name == \"\" {\n+\t\t\treturn fmt.Errorf(\"network policy at index %d: name cannot be empty\", i)", "path": "pkg/controller/deployment/cert_manager_networkpolicy.go", "commit_id": "167c0ed38cf01bfe1b1dffd042ee70794a546beb", "original_commit_id": "c0b55ed1d8a9d0903beac4095f96577af8013a7d", "user": {"login": "mytreya-rh", "id": 189594035, "node_id": "U_kgDOC0z5sw", "avatar_url": "https://avatars.githubusercontent.com/u/189594035?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mytreya-rh", "html_url": "https://github.com/mytreya-rh", "followers_url": "https://api.github.com/users/mytreya-rh/followers", "following_url": "https://api.github.com/users/mytreya-rh/following{/other_user}", "gists_url": "https://api.github.com/users/mytreya-rh/gists{/gist_id}", "starred_url": "https://api.github.com/users/mytreya-rh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mytreya-rh/subscriptions", "organizations_url": "https://api.github.com/users/mytreya-rh/orgs", "repos_url": "https://api.github.com/users/mytreya-rh/repos", "events_url": "https://api.github.com/users/mytreya-rh/events{/privacy}", "received_events_url": "https://api.github.com/users/mytreya-rh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "[claude-generated] The validation here checks if egress rules are empty, but this contradicts the API documentation which states: 'If DefaultNetworkPolicy is \"true\" but this field is not provided, cert-manager components will be isolated with deny-all egress policies.' Empty egress rules should be allowed to support deny-all configuration.", "created_at": "2025-10-10T13:19:02Z", "updated_at": "2025-10-10T13:34:23Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2420152596", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2420152596"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2420152596"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2420152596/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 149, "original_line": 149, "side": "RIGHT", "author_association": "MEMBER", "original_position": 148, "position": 149, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 320, "file_path": "pkg/controller/deployment/cert_manager_networkpolicy.go", "line_start": 161, "line_end": 161, "diff_context": "", "comment_body": "[claude-generated] The IstioCSR component is validated here but not included in the istio-csr controller implementation. The validation accepts 'IstioCSR' as a valid component name, but the getPodSelectorForComponent function doesn't handle it (falls through to default case). Either add IstioCSR handling or remove it from the cert-manager validation.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2420154185", "pull_request_review_id": 3323445017, "id": 2420154185, "node_id": "PRRC_kwDOFdFn9s6QQJ9J", "diff_hunk": "@@ -0,0 +1,257 @@\n+package deployment\n+\n+import (\n+\t\"context\"\n+\t\"fmt\"\n+\n+\tnetworkingv1 \"k8s.io/api/networking/v1\"\n+\t\"k8s.io/apimachinery/pkg/api/errors\"\n+\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n+\t\"k8s.io/client-go/kubernetes\"\n+\n+\t\"github.com/openshift/library-go/pkg/controller/factory\"\n+\t\"github.com/openshift/library-go/pkg/operator/events\"\n+\t\"github.com/openshift/library-go/pkg/operator/resource/resourceapply\"\n+\t\"github.com/openshift/library-go/pkg/operator/staticresourcecontroller\"\n+\t\"github.com/openshift/library-go/pkg/operator/v1helpers\"\n+\n+\t\"github.com/openshift/cert-manager-operator/api/operator/v1alpha1\"\n+\t\"github.com/openshift/cert-manager-operator/pkg/operator/assets\"\n+\tcertmanoperatorinformers \"github.com/openshift/cert-manager-operator/pkg/operator/informers/externalversions\"\n+)\n+\n+const (\n+\tcertManagerNetworkPolicyStaticResourcesControllerName = operatorName + \"-networkpolicy-static-resources-\"\n+\tcertManagerNetworkPolicyUserDefinedControllerName     = operatorName + \"-networkpolicy-user-defined\"\n+\tcertManagerNamespace                                  = \"cert-manager\"\n+\tnetworkPolicyOwnerLabel                               = \"cert-manager.operator.openshift.io/owned-by\"\n+)\n+\n+var (\n+\t// Static network policy asset files for default policies\n+\tcertManagerNetworkPolicyAssetFiles = []string{\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-deny-all-networkpolicy.yaml\",\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-api-server-egress-networkpolicy.yaml\",\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-metrics-ingress-networkpolicy.yaml\",\n+\t\t\"cert-manager-deployment/networkpolicies/cert-manager-webhook-ingress-networkpolicy.yaml\",\n+\t}\n+)\n+\n+// ============================================================================\n+// STATIC RESOURCE CONTROLLER - for default network policies from YAML files\n+// ============================================================================\n+\n+func NewCertManagerNetworkPolicyStaticResourcesController(operatorClient v1helpers.OperatorClient,\n+\tkubeClientContainer *resourceapply.ClientHolder,\n+\tkubeInformersForNamespaces v1helpers.KubeInformersForNamespaces,\n+\tcertManagerOperatorInformers certmanoperatorinformers.SharedInformerFactory,\n+\teventsRecorder events.Recorder) factory.Controller {\n+\n+\t// Create conditional function to check if network policies should be applied\n+\tshouldApplyNetworkPolicies := func() bool {\n+\t\tcertManager, err := certManagerOperatorInformers.Operator().V1alpha1().CertManagers().Lister().Get(\"cluster\")\n+\t\tif err != nil {\n+\t\t\treturn false\n+\t\t}\n+\t\treturn certManager.Spec.DefaultNetworkPolicy == \"true\"\n+\t}\n+\n+\treturn staticresourcecontroller.NewStaticResourceController(\n+\t\tcertManagerNetworkPolicyStaticResourcesControllerName,\n+\t\tassets.Asset,\n+\t\t[]string{}, // empty files, we'll add them conditionally\n+\t\tkubeClientContainer,\n+\t\toperatorClient,\n+\t\teventsRecorder,\n+\t).WithConditionalResources(\n+\t\tassets.Asset,\n+\t\tcertManagerNetworkPolicyAssetFiles,\n+\t\tshouldApplyNetworkPolicies,\n+\t\tnil, // Since immutable, we never delete\n+\t).AddKubeInformers(kubeInformersForNamespaces).AddInformer(\n+\t\tcertManagerOperatorInformers.Operator().V1alpha1().CertManagers().Informer(),\n+\t)\n+}\n+\n+// ============================================================================\n+// USER-DEFINED CONTROLLER - for user-configured network policies from API\n+// ============================================================================\n+\n+// CertManagerNetworkPolicyUserDefinedController manages user-defined NetworkPolicy resources\n+type CertManagerNetworkPolicyUserDefinedController struct {\n+\toperatorClient               v1helpers.OperatorClient\n+\tcertManagerOperatorInformers certmanoperatorinformers.SharedInformerFactory\n+\tkubeClient                   kubernetes.Interface\n+\teventRecorder                events.Recorder\n+}\n+\n+func NewCertManagerNetworkPolicyUserDefinedController(\n+\toperatorClient v1helpers.OperatorClient,\n+\tcertManagerOperatorInformers certmanoperatorinformers.SharedInformerFactory,\n+\tkubeClient kubernetes.Interface,\n+\teventRecorder events.Recorder,\n+) factory.Controller {\n+\tc := &CertManagerNetworkPolicyUserDefinedController{\n+\t\toperatorClient:               operatorClient,\n+\t\tcertManagerOperatorInformers: certManagerOperatorInformers,\n+\t\tkubeClient:                   kubeClient,\n+\t\teventRecorder:                eventRecorder.WithComponentSuffix(\"cert-manager-networkpolicy-user-defined\"),\n+\t}\n+\n+\treturn factory.New().\n+\t\tWithInformers(\n+\t\t\toperatorClient.Informer(),\n+\t\t\tcertManagerOperatorInformers.Operator().V1alpha1().CertManagers().Informer(),\n+\t\t).\n+\t\tWithSync(c.sync).\n+\t\tToController(certManagerNetworkPolicyUserDefinedControllerName, c.eventRecorder)\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) sync(ctx context.Context, syncCtx factory.SyncContext) error {\n+\t// Get the current CertManager configuration\n+\tcertManager, err := c.certManagerOperatorInformers.Operator().V1alpha1().CertManagers().Lister().Get(\"cluster\")\n+\tif err != nil {\n+\t\tif errors.IsNotFound(err) {\n+\t\t\t// No CertManager found, nothing to do\n+\t\t\treturn nil\n+\t\t}\n+\t\treturn fmt.Errorf(\"failed to get CertManager: %w\", err)\n+\t}\n+\n+\t// Check if network policies are enabled\n+\tif certManager.Spec.DefaultNetworkPolicy != \"true\" {\n+\t\t// Network policies not enabled, nothing to do\n+\t\t// Note: Since fields are immutable, no cleanup needed\n+\t\treturn nil\n+\t}\n+\n+\t// Validate user-defined network policy configuration\n+\tif err := c.validateNetworkPolicyConfig(certManager); err != nil {\n+\t\tc.eventRecorder.Warningf(\"NetworkPolicyValidationFailed\", \"Network policy configuration validation failed: %v\", err)\n+\t\treturn fmt.Errorf(\"network policy configuration validation failed: %w\", err)\n+\t}\n+\n+\t// Apply user-defined network policies\n+\tif err := c.reconcileUserNetworkPolicies(ctx, certManager); err != nil {\n+\t\tc.eventRecorder.Warningf(\"UserNetworkPolicyReconcileFailed\", \"Failed to reconcile user network policies: %v\", err)\n+\t\treturn fmt.Errorf(\"failed to reconcile user network policies: %w\", err)\n+\t}\n+\n+\tc.eventRecorder.Event(\"UserNetworkPolicyReconcileSuccess\", \"Successfully reconciled user-defined network policies\")\n+\treturn nil\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) validateNetworkPolicyConfig(certManager *v1alpha1.CertManager) error {\n+\t// Validate each user-defined network policy\n+\tfor i, policy := range certManager.Spec.NetworkPolicies {\n+\t\tif policy.Name == \"\" {\n+\t\t\treturn fmt.Errorf(\"network policy at index %d: name cannot be empty\", i)\n+\t\t}\n+\t\tif len(policy.Egress) == 0 {\n+\t\t\treturn fmt.Errorf(\"network policy at index %d: egress rules cannot be empty when network policies are enabled\", i)\n+\t\t}\n+\t\tif err := c.validateComponentName(policy.ComponentName); err != nil {\n+\t\t\treturn fmt.Errorf(\"network policy at index %d: invalid component name: %w\", i, err)\n+\t\t}\n+\t}\n+\treturn nil\n+}\n+\n+func (c *CertManagerNetworkPolicyUserDefinedController) validateComponentName(componentName v1alpha1.ComponentName) error {\n+\tswitch componentName {\n+\tcase v1alpha1.CAInjector, v1alpha1.CoreController, v1alpha1.Webhook:", "path": "pkg/controller/deployment/cert_manager_networkpolicy.go", "commit_id": "167c0ed38cf01bfe1b1dffd042ee70794a546beb", "original_commit_id": "c0b55ed1d8a9d0903beac4095f96577af8013a7d", "user": {"login": "mytreya-rh", "id": 189594035, "node_id": "U_kgDOC0z5sw", "avatar_url": "https://avatars.githubusercontent.com/u/189594035?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mytreya-rh", "html_url": "https://github.com/mytreya-rh", "followers_url": "https://api.github.com/users/mytreya-rh/followers", "following_url": "https://api.github.com/users/mytreya-rh/following{/other_user}", "gists_url": "https://api.github.com/users/mytreya-rh/gists{/gist_id}", "starred_url": "https://api.github.com/users/mytreya-rh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mytreya-rh/subscriptions", "organizations_url": "https://api.github.com/users/mytreya-rh/orgs", "repos_url": "https://api.github.com/users/mytreya-rh/repos", "events_url": "https://api.github.com/users/mytreya-rh/events{/privacy}", "received_events_url": "https://api.github.com/users/mytreya-rh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "[claude-generated] The IstioCSR component is validated here but not included in the istio-csr controller implementation. The validation accepts 'IstioCSR' as a valid component name, but the getPodSelectorForComponent function doesn't handle it (falls through to default case). Either add IstioCSR handling or remove it from the cert-manager validation.", "created_at": "2025-10-10T13:19:22Z", "updated_at": "2025-10-10T13:34:39Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2420154185", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2420154185"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/320#discussion_r2420154185"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/320"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2420154185/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 161, "original_line": 161, "side": "RIGHT", "author_association": "MEMBER", "original_position": 162, "position": 161, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 324, "file_path": "pkg/controller/istiocsr/controller.go", "line_start": 102, "line_end": 102, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Unified manager cache removes the dual\u2011cache race; add small guard and verify wiring/labels.**\n\nGood call switching to a single manager cache with label selectors; this addresses the cache\u2011sync race. One nit: don\u2019t ignore the error from labels.NewRequirement \u2014 future key changes would turn into silent misconfig.\n\n\nApply this minimal guard:\n\n```diff\n- managedResourceLabelReq, _ := labels.NewRequirement(requestEnqueueLabelKey, selection.Equals, []string{requestEnqueueLabelValue})\n- managedResourceLabelReqSelector := labels.NewSelector().Add(*managedResourceLabelReq)\n+ managedResourceLabelReq, err := labels.NewRequirement(requestEnqueueLabelKey, selection.Equals, []string{requestEnqueueLabelValue})\n+ if err != nil {\n+   return nil, fmt.Errorf(\"invalid cache label requirement for %q: %w\", requestEnqueueLabelKey, err)\n+ }\n+ managedResourceLabelReqSelector := labels.NewSelector().Add(*managedResourceLabelReq)\n```\n\n\nPlease run the following to confirm the manager is wired to use this cache and that no dual cache remains, and to ensure all managed objects are labeled so selector\u2011scoped reads don\u2019t miss them.\n\n\n\nNote on cache size: using ByObject label selectors limits cached items to app=cert-manager-istio-csr for the listed types, mitigating bloat compared to unfiltered informers. If needed later, we can further narrow scope per type; no action required now.\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\nset -euo pipefail\n\necho \"1) Manager uses unified cache:\"\nrg -nP --type=go -C3 'ctrl\\.Options\\{[^}]*NewCache\\s*:\\s*istiocsr\\.NewCacheBuilder' || echo \"NewCacheBuilder not found in ctrl.Options\"\n\necho -e \"\\n2) No leftover custom cache/client:\"\nrg -nP --type=go 'BuildCustomClient\\s*\\(' || true\nrg -nP --type=go -C3 'func\\s+NewClient\\s*\\(mgr\\s+ctrl\\.Manager\\)' || true\nrg -nP --type=go -C1 '\\bmgr\\.GetClient\\(' || true\n\necho -e \"\\n3) All managed resources carry the cache label (app=cert-manager-istio-csr):\"\nrg -nP --type=go -C3 'Labels:\\s*map\\[string\\]\\s*string\\s*\\{[^}]*(\"app\"|requestEnqueueLabelKey)\\s*:\\s*(\"cert-manager-istio-csr\"|requestEnqueueLabelValue)' || echo \"Check that all Deployment/Service/SA/RBAC/Certificate templates set the app label.\"\n```\n\nLength of output: 1331\n\n---\n\nI need to search more broadly to verify the manager wiring and label application. Let me run additional verification scripts:\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\nset -euo pipefail\n\necho \"1) Where is ctrl.Manager or Options configured:\"\nrg -nP --type=go -C5 'Options\\s*{' | grep -A5 -B5 -i 'newcache\\|cache:' || echo \"No explicit cache config in Options\"\n\necho -e \"\\n2) Is NewCacheBuilder called anywhere:\"\nrg -nP --type=go 'NewCacheBuilder' \n\necho -e \"\\n3) Manager setup/initialization code:\"\nrg -nP --type=go -C5 'ctrl\\.NewManager' \n\necho -e \"\\n4) Where are managed resources (Deployment, Certificate, etc.) created:\"\nfd --type go --exec grep -l 'appsv1.Deployment\\|certmanagerv1.Certificate' {} \\;\n```\n\nLength of output: 4233\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n```\n\nLength of output: 59\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\nset -euo pipefail\n\necho \"1) Find Go files that create managed resources:\"\nfind . -name '*.go' -type f ! -path './vendor/*' -exec grep -l 'appsv1.Deployment\\|certmanagerv1.Certificate\\|corev1.Service\\|corev1.ServiceAccount\\|rbacv1.Role\\|rbacv1.ClusterRole' {} \\;\n\necho -e \"\\n2) Search for label application in resource creation:\"\nrg -nP --type=go 'Labels\\s*:\\s*map\\[string\\]string' | head -20\n\necho -e \"\\n3) Search for requestEnqueueLabelValue usage:\"\nrg -nP --type=go 'requestEnqueueLabelValue'\n```\n\nLength of output: 2516\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\nset -euo pipefail\n\necho \"=== Checking label application in resource creation functions ===\"\n\necho -e \"\\n1) Check deployments.go:\"\nrg -nP --type=go -A20 'func.*Deployment.*\\(' pkg/controller/istiocsr/deployments.go | grep -A20 'Labels\\s*:'\n\necho -e \"\\n2) Check certificates.go:\"\nrg -nP --type=go -A20 'func.*Certificate.*\\(' pkg/controller/istiocsr/certificates.go | grep -A20 'Labels\\s*:'\n\necho -e \"\\n3) Check services.go:\"\nrg -nP --type=go -A20 'func.*Service.*\\(' pkg/controller/istiocsr/services.go | grep -A20 'Labels\\s*:'\n\necho -e \"\\n4) Check serviceaccounts.go:\"\nrg -nP --type=go -A20 'func.*ServiceAccount.*\\(' pkg/controller/istiocsr/serviceaccounts.go | grep -A20 'Labels\\s*:'\n\necho -e \"\\n5) Check rbacs.go:\"\nrg -nP --type=go -A20 'func.*Role.*\\(' pkg/controller/istiocsr/rbacs.go | grep -A20 'Labels\\s*:'\n\necho -e \"\\n6) Search for requestEnqueueLabelKey usage in resource builders:\"\nrg -nP --type=go 'requestEnqueueLabelKey' pkg/controller/istiocsr/ --type go\n```\n\nLength of output: 91\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\nset -euo pipefail\n\necho \"=== Simpler check: all label map assignments in istiocsr package ===\"\nrg -nP --type=go -B5 -A5 'Labels.*map\\[string\\]string' pkg/controller/istiocsr/\n\necho -e \"\\n=== Check if label key/value applied in any builder functions ===\"\nrg -nP --type=go -B10 -A10 'requestEnqueueLabelKey.*=.*\"app\"' pkg/controller/istiocsr/controller.go\n\necho -e \"\\n=== Look for label map with requestEnqueueLabel in deployments.go ===\"\ncat pkg/controller/istiocsr/deployments.go | grep -A5 -B5 'Labels' || true\n\necho -e \"\\n=== Look for label map with requestEnqueueLabel in certificates.go ===\"\ncat pkg/controller/istiocsr/certificates.go | grep -A5 -B5 'Labels' || true\n\necho -e \"\\n=== Check if there's a helper function that adds labels ===\"\nrg -nP --type=go 'func.*Label.*\\(' pkg/controller/istiocsr/\n```\n\nLength of output: 34989\n\n---\n\n\n\n</details>\n\n**Add error handling for labels.NewRequirement to guard against future misconfigurations.**\n\nThe manager cache wiring is correct and properly configured at `pkg/operator/setup_manager.go:56` using `NewCacheBuilder`. All managed resources (Deployment, Certificate, Service, ServiceAccount, RBAC objects) are correctly labeled via helper functions in `pkg/controller/istiocsr/utils.go` with the label `app=cert-manager-istio-csr`, matching the cache selector filter defined in `NewCacheBuilder`.\n\nHowever, line 64 should not ignore the error from `labels.NewRequirement`:\n\n```diff\n- managedResourceLabelReq, _ := labels.NewRequirement(requestEnqueueLabelKey, selection.Equals, []string{requestEnqueueLabelValue})\n- managedResourceLabelReqSelector := labels.NewSelector().Add(*managedResourceLabelReq)\n+ managedResourceLabelReq, err := labels.NewRequirement(requestEnqueueLabelKey, selection.Equals, []string{requestEnqueueLabelValue})\n+ if err != nil {\n+   return nil, fmt.Errorf(\"invalid cache label requirement for %q: %w\", requestEnqueueLabelKey, err)\n+ }\n+ managedResourceLabelReqSelector := labels.NewSelector().Add(*managedResourceLabelReq)\n```\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn pkg/controller/istiocsr/controller.go around lines 60 to 99,\nlabels.NewRequirement is called and its error is ignored; capture the returned\nerror, check it immediately, and return it (or wrap it) from NewCacheBuilder if\nnon-nil so misconfigurations are surfaced; only construct\nmanagedResourceLabelReqSelector after verifying err == nil.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:medusa:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit 0ef8c87", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2446830051", "pull_request_review_id": 3358885253, "id": 2446830051, "node_id": "PRRC_kwDOFdFn9s6R16nj", "diff_hunk": "@@ -56,6 +57,47 @@ type Reconciler struct {\n // +kubebuilder:rbac:groups=operator.openshift.io,resources=istiocsrs/status,verbs=get;update;patch\n // +kubebuilder:rbac:groups=operator.openshift.io,resources=istiocsrs/finalizers,verbs=update\n \n+// NewCacheBuilder returns a cache builder function configured with label selectors\n+// for managed resources. This function is used by the manager to create its cache\n+// to ensure the reconciler reads from the same cache that the controller's watches use.\n+func NewCacheBuilder(config *rest.Config, opts cache.Options) (cache.Cache, error) {\n+\tmanagedResourceLabelReq, _ := labels.NewRequirement(requestEnqueueLabelKey, selection.Equals, []string{requestEnqueueLabelValue})\n+\tmanagedResourceLabelReqSelector := labels.NewSelector().Add(*managedResourceLabelReq)\n+\n+\t// Configure cache with label selectors for managed resources\n+\topts.ByObject = map[client.Object]cache.ByObject{\n+\t\t// Explicitly include IstioCSR to ensure the cache properly watches and syncs all IstioCSR objects\n+\t\t&v1alpha1.IstioCSR{}: {},\n+\t\t// Resources managed by controller (with label selectors)\n+\t\t&certmanagerv1.Certificate{}: {\n+\t\t\tLabel: managedResourceLabelReqSelector,\n+\t\t},\n+\t\t&appsv1.Deployment{}: {\n+\t\t\tLabel: managedResourceLabelReqSelector,\n+\t\t},\n+\t\t&rbacv1.ClusterRole{}: {\n+\t\t\tLabel: managedResourceLabelReqSelector,\n+\t\t},\n+\t\t&rbacv1.ClusterRoleBinding{}: {\n+\t\t\tLabel: managedResourceLabelReqSelector,\n+\t\t},\n+\t\t&rbacv1.Role{}: {\n+\t\t\tLabel: managedResourceLabelReqSelector,\n+\t\t},\n+\t\t&rbacv1.RoleBinding{}: {\n+\t\t\tLabel: managedResourceLabelReqSelector,\n+\t\t},\n+\t\t&corev1.Service{}: {\n+\t\t\tLabel: managedResourceLabelReqSelector,\n+\t\t},\n+\t\t&corev1.ServiceAccount{}: {\n+\t\t\tLabel: managedResourceLabelReqSelector,\n+\t\t},\n+\t}\n+\n+\treturn cache.New(config, opts)\n+}", "path": "pkg/controller/istiocsr/controller.go", "commit_id": "4f1fb1598bcbfd2663057cdf73b72a78d8ce25ec", "original_commit_id": "4f1fb1598bcbfd2663057cdf73b72a78d8ce25ec", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Unified manager cache removes the dual\u2011cache race; add small guard and verify wiring/labels.**\n\nGood call switching to a single manager cache with label selectors; this addresses the cache\u2011sync race. One nit: don\u2019t ignore the error from labels.NewRequirement \u2014 future key changes would turn into silent misconfig.\n\n\nApply this minimal guard:\n\n```diff\n- managedResourceLabelReq, _ := labels.NewRequirement(requestEnqueueLabelKey, selection.Equals, []string{requestEnqueueLabelValue})\n- managedResourceLabelReqSelector := labels.NewSelector().Add(*managedResourceLabelReq)\n+ managedResourceLabelReq, err := labels.NewRequirement(requestEnqueueLabelKey, selection.Equals, []string{requestEnqueueLabelValue})\n+ if err != nil {\n+   return nil, fmt.Errorf(\"invalid cache label requirement for %q: %w\", requestEnqueueLabelKey, err)\n+ }\n+ managedResourceLabelReqSelector := labels.NewSelector().Add(*managedResourceLabelReq)\n```\n\n\nPlease run the following to confirm the manager is wired to use this cache and that no dual cache remains, and to ensure all managed objects are labeled so selector\u2011scoped reads don\u2019t miss them.\n\n\n\nNote on cache size: using ByObject label selectors limits cached items to app=cert-manager-istio-csr for the listed types, mitigating bloat compared to unfiltered informers. If needed later, we can further narrow scope per type; no action required now.\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\nset -euo pipefail\n\necho \"1) Manager uses unified cache:\"\nrg -nP --type=go -C3 'ctrl\\.Options\\{[^}]*NewCache\\s*:\\s*istiocsr\\.NewCacheBuilder' || echo \"NewCacheBuilder not found in ctrl.Options\"\n\necho -e \"\\n2) No leftover custom cache/client:\"\nrg -nP --type=go 'BuildCustomClient\\s*\\(' || true\nrg -nP --type=go -C3 'func\\s+NewClient\\s*\\(mgr\\s+ctrl\\.Manager\\)' || true\nrg -nP --type=go -C1 '\\bmgr\\.GetClient\\(' || true\n\necho -e \"\\n3) All managed resources carry the cache label (app=cert-manager-istio-csr):\"\nrg -nP --type=go -C3 'Labels:\\s*map\\[string\\]\\s*string\\s*\\{[^}]*(\"app\"|requestEnqueueLabelKey)\\s*:\\s*(\"cert-manager-istio-csr\"|requestEnqueueLabelValue)' || echo \"Check that all Deployment/Service/SA/RBAC/Certificate templates set the app label.\"\n```\n\nLength of output: 1331\n\n---\n\nI need to search more broadly to verify the manager wiring and label application. Let me run additional verification scripts:\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\nset -euo pipefail\n\necho \"1) Where is ctrl.Manager or Options configured:\"\nrg -nP --type=go -C5 'Options\\s*{' | grep -A5 -B5 -i 'newcache\\|cache:' || echo \"No explicit cache config in Options\"\n\necho -e \"\\n2) Is NewCacheBuilder called anywhere:\"\nrg -nP --type=go 'NewCacheBuilder' \n\necho -e \"\\n3) Manager setup/initialization code:\"\nrg -nP --type=go -C5 'ctrl\\.NewManager' \n\necho -e \"\\n4) Where are managed resources (Deployment, Certificate, etc.) created:\"\nfd --type go --exec grep -l 'appsv1.Deployment\\|certmanagerv1.Certificate' {} \\;\n```\n\nLength of output: 4233\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n```\n\nLength of output: 59\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\nset -euo pipefail\n\necho \"1) Find Go files that create managed resources:\"\nfind . -name '*.go' -type f ! -path './vendor/*' -exec grep -l 'appsv1.Deployment\\|certmanagerv1.Certificate\\|corev1.Service\\|corev1.ServiceAccount\\|rbacv1.Role\\|rbacv1.ClusterRole' {} \\;\n\necho -e \"\\n2) Search for label application in resource creation:\"\nrg -nP --type=go 'Labels\\s*:\\s*map\\[string\\]string' | head -20\n\necho -e \"\\n3) Search for requestEnqueueLabelValue usage:\"\nrg -nP --type=go 'requestEnqueueLabelValue'\n```\n\nLength of output: 2516\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\nset -euo pipefail\n\necho \"=== Checking label application in resource creation functions ===\"\n\necho -e \"\\n1) Check deployments.go:\"\nrg -nP --type=go -A20 'func.*Deployment.*\\(' pkg/controller/istiocsr/deployments.go | grep -A20 'Labels\\s*:'\n\necho -e \"\\n2) Check certificates.go:\"\nrg -nP --type=go -A20 'func.*Certificate.*\\(' pkg/controller/istiocsr/certificates.go | grep -A20 'Labels\\s*:'\n\necho -e \"\\n3) Check services.go:\"\nrg -nP --type=go -A20 'func.*Service.*\\(' pkg/controller/istiocsr/services.go | grep -A20 'Labels\\s*:'\n\necho -e \"\\n4) Check serviceaccounts.go:\"\nrg -nP --type=go -A20 'func.*ServiceAccount.*\\(' pkg/controller/istiocsr/serviceaccounts.go | grep -A20 'Labels\\s*:'\n\necho -e \"\\n5) Check rbacs.go:\"\nrg -nP --type=go -A20 'func.*Role.*\\(' pkg/controller/istiocsr/rbacs.go | grep -A20 'Labels\\s*:'\n\necho -e \"\\n6) Search for requestEnqueueLabelKey usage in resource builders:\"\nrg -nP --type=go 'requestEnqueueLabelKey' pkg/controller/istiocsr/ --type go\n```\n\nLength of output: 91\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\nset -euo pipefail\n\necho \"=== Simpler check: all label map assignments in istiocsr package ===\"\nrg -nP --type=go -B5 -A5 'Labels.*map\\[string\\]string' pkg/controller/istiocsr/\n\necho -e \"\\n=== Check if label key/value applied in any builder functions ===\"\nrg -nP --type=go -B10 -A10 'requestEnqueueLabelKey.*=.*\"app\"' pkg/controller/istiocsr/controller.go\n\necho -e \"\\n=== Look for label map with requestEnqueueLabel in deployments.go ===\"\ncat pkg/controller/istiocsr/deployments.go | grep -A5 -B5 'Labels' || true\n\necho -e \"\\n=== Look for label map with requestEnqueueLabel in certificates.go ===\"\ncat pkg/controller/istiocsr/certificates.go | grep -A5 -B5 'Labels' || true\n\necho -e \"\\n=== Check if there's a helper function that adds labels ===\"\nrg -nP --type=go 'func.*Label.*\\(' pkg/controller/istiocsr/\n```\n\nLength of output: 34989\n\n---\n\n\n\n</details>\n\n**Add error handling for labels.NewRequirement to guard against future misconfigurations.**\n\nThe manager cache wiring is correct and properly configured at `pkg/operator/setup_manager.go:56` using `NewCacheBuilder`. All managed resources (Deployment, Certificate, Service, ServiceAccount, RBAC objects) are correctly labeled via helper functions in `pkg/controller/istiocsr/utils.go` with the label `app=cert-manager-istio-csr`, matching the cache selector filter defined in `NewCacheBuilder`.\n\nHowever, line 64 should not ignore the error from `labels.NewRequirement`:\n\n```diff\n- managedResourceLabelReq, _ := labels.NewRequirement(requestEnqueueLabelKey, selection.Equals, []string{requestEnqueueLabelValue})\n- managedResourceLabelReqSelector := labels.NewSelector().Add(*managedResourceLabelReq)\n+ managedResourceLabelReq, err := labels.NewRequirement(requestEnqueueLabelKey, selection.Equals, []string{requestEnqueueLabelValue})\n+ if err != nil {\n+   return nil, fmt.Errorf(\"invalid cache label requirement for %q: %w\", requestEnqueueLabelKey, err)\n+ }\n+ managedResourceLabelReqSelector := labels.NewSelector().Add(*managedResourceLabelReq)\n```\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn pkg/controller/istiocsr/controller.go around lines 60 to 99,\nlabels.NewRequirement is called and its error is ignored; capture the returned\nerror, check it immediately, and return it (or wrap it) from NewCacheBuilder if\nnon-nil so misconfigurations are surfaced; only construct\nmanagedResourceLabelReqSelector after verifying err == nil.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:medusa:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit 0ef8c87", "created_at": "2025-10-21T06:18:57Z", "updated_at": "2025-10-21T06:32:15Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/324#discussion_r2446830051", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/324", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2446830051"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/324#discussion_r2446830051"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/324"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2446830051/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 60, "original_start_line": 60, "start_side": "RIGHT", "line": 102, "original_line": 102, "side": "RIGHT", "author_association": "NONE", "original_position": 51, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 324, "file_path": "pkg/controller/istiocsr/controller.go", "line_start": 100, "line_end": null, "diff_context": "", "comment_body": "@bharath-b-rh Thanks for pointing this out! Just for cross-check, I consulted with Cursor and it points that the old approach \"`GetInformer()` on types not in `ByObject`\" would still have the same cache bloat issue.\r\n\r\nThe current solution advised by it is\r\n- Keep only the types with label selectors in `ByObject`\r\n- Remove the unlabeled types\r\n- Let controller-runtime handle the rest:\r\n  - `.WatchesMetadata()` creates a metadata-only informer for Secret automatically\r\n  - `.Get()` calls for uncached types go directly to the API server\r\n\r\nDoes that something make sense to you?", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2448316352", "pull_request_review_id": 3360783359, "id": 2448316352, "node_id": "PRRC_kwDOFdFn9s6R7lfA", "diff_hunk": "@@ -56,6 +57,52 @@ type Reconciler struct {\n // +kubebuilder:rbac:groups=operator.openshift.io,resources=istiocsrs/status,verbs=get;update;patch\n // +kubebuilder:rbac:groups=operator.openshift.io,resources=istiocsrs/finalizers,verbs=update\n \n+// NewCacheBuilder returns a cache builder function configured with label selectors\n+// for managed resources. This function is used by the manager to create its cache\n+// to ensure the reconciler reads from the same cache that the controller's watches use.\n+func NewCacheBuilder(config *rest.Config, opts cache.Options) (cache.Cache, error) {\n+\tmanagedResourceLabelReq, _ := labels.NewRequirement(requestEnqueueLabelKey, selection.Equals, []string{requestEnqueueLabelValue})\n+\tmanagedResourceLabelReqSelector := labels.NewSelector().Add(*managedResourceLabelReq)\n+\n+\t// Configure cache with label selectors for managed resources\n+\topts.ByObject = map[client.Object]cache.ByObject{\n+\t\t// Explicitly include IstioCSR to ensure the cache properly watches and syncs all IstioCSR objects\n+\t\t&v1alpha1.IstioCSR{}: {},\n+\t\t// Resources managed by controller (with label selectors)\n+\t\t&certmanagerv1.Certificate{}: {\n+\t\t\tLabel: managedResourceLabelReqSelector,\n+\t\t},\n+\t\t&appsv1.Deployment{}: {\n+\t\t\tLabel: managedResourceLabelReqSelector,\n+\t\t},\n+\t\t&rbacv1.ClusterRole{}: {\n+\t\t\tLabel: managedResourceLabelReqSelector,\n+\t\t},\n+\t\t&rbacv1.ClusterRoleBinding{}: {\n+\t\t\tLabel: managedResourceLabelReqSelector,\n+\t\t},\n+\t\t&rbacv1.Role{}: {\n+\t\t\tLabel: managedResourceLabelReqSelector,\n+\t\t},\n+\t\t&rbacv1.RoleBinding{}: {\n+\t\t\tLabel: managedResourceLabelReqSelector,\n+\t\t},\n+\t\t&corev1.Service{}: {\n+\t\t\tLabel: managedResourceLabelReqSelector,\n+\t\t},\n+\t\t&corev1.ServiceAccount{}: {\n+\t\t\tLabel: managedResourceLabelReqSelector,\n+\t\t},\n+\t\t// Resources watched but not filtered\n+\t\t&corev1.Secret{}:               {},\n+\t\t&corev1.ConfigMap{}:            {},\n+\t\t&certmanagerv1.Issuer{}:        {},\n+\t\t&certmanagerv1.ClusterIssuer{}: {},", "path": "pkg/controller/istiocsr/controller.go", "commit_id": "680596bf360ff22e7ea39b578eb6727f4a1fd4f9", "original_commit_id": "680596bf360ff22e7ea39b578eb6727f4a1fd4f9", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "@bharath-b-rh Thanks for pointing this out! Just for cross-check, I consulted with Cursor and it points that the old approach \"`GetInformer()` on types not in `ByObject`\" would still have the same cache bloat issue.\r\n\r\nThe current solution advised by it is\r\n- Keep only the types with label selectors in `ByObject`\r\n- Remove the unlabeled types\r\n- Let controller-runtime handle the rest:\r\n  - `.WatchesMetadata()` creates a metadata-only informer for Secret automatically\r\n  - `.Get()` calls for uncached types go directly to the API server\r\n\r\nDoes that something make sense to you?", "created_at": "2025-10-21T13:31:32Z", "updated_at": "2025-10-21T13:31:33Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/324#discussion_r2448316352", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/324", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2448316352"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/324#discussion_r2448316352"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/324"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2448316352/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 97, "start_side": "RIGHT", "line": null, "original_line": 100, "side": "RIGHT", "in_reply_to_id": 2443278247, "author_association": "MEMBER", "original_position": 52, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 326, "file_path": "rebase_automation.sh", "line_start": 1, "line_end": null, "diff_context": "", "comment_body": "https://github.com/openshift/cert-manager-operator/pull/309 is for this new script, correct. Did it checked in by mistake? I would prefer to review as part of the aforementioned PR.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2438642003", "pull_request_review_id": 3348605480, "id": 2438642003, "node_id": "PRRC_kwDOFdFn9s6RWrlT", "diff_hunk": "@@ -0,0 +1,527 @@\n+#!/bin/bash", "path": "rebase_automation.sh", "commit_id": "cea63c983befa7c724d1f73ed66dd39638126a0b", "original_commit_id": "175c0f8545345381ab36919e3f6e64833b8f4eed", "user": {"login": "bharath-b-rh", "id": 92782575, "node_id": "U_kgDOBYe_7w", "avatar_url": "https://avatars.githubusercontent.com/u/92782575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bharath-b-rh", "html_url": "https://github.com/bharath-b-rh", "followers_url": "https://api.github.com/users/bharath-b-rh/followers", "following_url": "https://api.github.com/users/bharath-b-rh/following{/other_user}", "gists_url": "https://api.github.com/users/bharath-b-rh/gists{/gist_id}", "starred_url": "https://api.github.com/users/bharath-b-rh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bharath-b-rh/subscriptions", "organizations_url": "https://api.github.com/users/bharath-b-rh/orgs", "repos_url": "https://api.github.com/users/bharath-b-rh/repos", "events_url": "https://api.github.com/users/bharath-b-rh/events{/privacy}", "received_events_url": "https://api.github.com/users/bharath-b-rh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "https://github.com/openshift/cert-manager-operator/pull/309 is for this new script, correct. Did it checked in by mistake? I would prefer to review as part of the aforementioned PR.", "created_at": "2025-10-17T07:17:15Z", "updated_at": "2025-10-17T07:17:51Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/326#discussion_r2438642003", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/326", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2438642003"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/326#discussion_r2438642003"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/326"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2438642003/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 1, "side": "RIGHT", "author_association": "MEMBER", "original_position": 1, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 326, "file_path": "go.mod", "line_start": 3, "line_end": null, "diff_context": "", "comment_body": "_\ud83d\udee0\ufe0f Refactor suggestion_ | _\ud83d\udfe0 Major_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Verify Go 1.24.6 is a valid release version.**\n\nPlease confirm that Go 1.24.6 is an officially released version and is the intended version for this project. As of October 2025, this version number should be validated.\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Check if Go 1.24.6 exists\ncurl -s https://go.dev/dl/?mode=json | jq -r '.[].version' | grep -E '^go1\\.24\\.'\n```\n\nLength of output: 8\n\n---\n\n\n\n</details>\n\n**Update Go version to latest available 1.24 patch release.**\n\nGo 1.24.6 was released on August 6, 2025 with security fixes to database/sql and os/exec packages, so it is a valid version. However, <cit index=\"2-34\">Go 1.24.8 was released on October 7, 2025 with additional security fixes to multiple packages including archive/tar, crypto/tls, and crypto/x509</cit>. Consider upgrading to the latest 1.24 patch to ensure all available security updates are included.\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn go.mod around line 3, the module is pinned to \"go 1.24.6\" which is outdated;\nupdate the go directive to the latest 1.24 patch (e.g. \"go 1.24.8\") to pick up\nrecent security fixes, then run go mod tidy (and optionally go mod download) and\nrebuild/run tests to ensure dependencies and generated files are consistent with\nthe new toolchain.\n```\n\n</details>\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2438996282", "pull_request_review_id": 3349080651, "id": 2438996282, "node_id": "PRRC_kwDOFdFn9s6RYCE6", "diff_hunk": "@@ -1,9 +1,9 @@\n module github.com/openshift/cert-manager-operator\n \n-go 1.23.10\n+go 1.24.6", "path": "go.mod", "commit_id": "08938bbdee1aefd2fd3c72f1a45998b6faf6c05c", "original_commit_id": "08938bbdee1aefd2fd3c72f1a45998b6faf6c05c", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\ud83d\udee0\ufe0f Refactor suggestion_ | _\ud83d\udfe0 Major_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Verify Go 1.24.6 is a valid release version.**\n\nPlease confirm that Go 1.24.6 is an officially released version and is the intended version for this project. As of October 2025, this version number should be validated.\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Check if Go 1.24.6 exists\ncurl -s https://go.dev/dl/?mode=json | jq -r '.[].version' | grep -E '^go1\\.24\\.'\n```\n\nLength of output: 8\n\n---\n\n\n\n</details>\n\n**Update Go version to latest available 1.24 patch release.**\n\nGo 1.24.6 was released on August 6, 2025 with security fixes to database/sql and os/exec packages, so it is a valid version. However, <cit index=\"2-34\">Go 1.24.8 was released on October 7, 2025 with additional security fixes to multiple packages including archive/tar, crypto/tls, and crypto/x509</cit>. Consider upgrading to the latest 1.24 patch to ensure all available security updates are included.\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn go.mod around line 3, the module is pinned to \"go 1.24.6\" which is outdated;\nupdate the go directive to the latest 1.24 patch (e.g. \"go 1.24.8\") to pick up\nrecent security fixes, then run go mod tidy (and optionally go mod download) and\nrebuild/run tests to ensure dependencies and generated files are consistent with\nthe new toolchain.\n```\n\n</details>\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "created_at": "2025-10-17T09:23:20Z", "updated_at": "2025-10-17T10:04:18Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/326#discussion_r2438996282", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/326", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2438996282"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/326#discussion_r2438996282"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/326"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2438996282/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 3, "side": "RIGHT", "author_association": "NONE", "original_position": 4, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 326, "file_path": "go.mod", "line_start": 305, "line_end": 305, "diff_context": "", "comment_body": "Why this change is required? https://github.com/openshift/cert-manager-operator/pull/326/commits/0c3858dd7be2a2c52e7358b891424d5353338f7c\r\n\r\nI just tried it in an isolated GH codespace env, the rebase would also succeed without this commit \ud83e\uddd0", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2439547417", "pull_request_review_id": 3349774392, "id": 2439547417, "node_id": "PRRC_kwDOFdFn9s6RaIoZ", "diff_hunk": "@@ -296,6 +298,8 @@ require (\n \tsigs.k8s.io/kustomize/kyaml v0.18.1 // indirect\n )\n \n-replace github.com/cert-manager/cert-manager => github.com/openshift/jetstack-cert-manager v1.18.2\n+replace github.com/cert-manager/cert-manager => github.com/openshift/jetstack-cert-manager v1.18.3\n \n replace sigs.k8s.io/controller-tools => github.com/openshift/kubernetes-sigs-controller-tools v0.12.1-0.20250220141355-6d2c85031fbc\n+\n+replace github.com/tdakkota/asciicheck => github.com/golangci/asciicheck v0.1.1", "path": "go.mod", "commit_id": "c3ffce30ba4dffc4a0c732b5789a870917d7b6aa", "original_commit_id": "c3ffce30ba4dffc4a0c732b5789a870917d7b6aa", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "Why this change is required? https://github.com/openshift/cert-manager-operator/pull/326/commits/0c3858dd7be2a2c52e7358b891424d5353338f7c\r\n\r\nI just tried it in an isolated GH codespace env, the rebase would also succeed without this commit \ud83e\uddd0", "created_at": "2025-10-17T11:43:22Z", "updated_at": "2025-10-17T14:21:27Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/326#discussion_r2439547417", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/326", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2439547417"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/326#discussion_r2439547417"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/326"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2439547417/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 305, "original_line": 305, "side": "RIGHT", "author_association": "MEMBER", "original_position": 57, "position": 57, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 326, "file_path": "go.mod", "line_start": 3, "line_end": 3, "diff_context": "", "comment_body": "Sorry I might missed some context, but why we're changing back from 1.24.6 to 1.24.4? https://github.com/openshift/cert-manager-operator/pull/326#discussion_r2438625372", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2439640500", "pull_request_review_id": 3349899462, "id": 2439640500, "node_id": "PRRC_kwDOFdFn9s6RafW0", "diff_hunk": "@@ -1,6 +1,6 @@\n module github.com/openshift/cert-manager-operator\n \n-go 1.23.10\n+go 1.24.4", "path": "go.mod", "commit_id": "c3ffce30ba4dffc4a0c732b5789a870917d7b6aa", "original_commit_id": "c3ffce30ba4dffc4a0c732b5789a870917d7b6aa", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "Sorry I might missed some context, but why we're changing back from 1.24.6 to 1.24.4? https://github.com/openshift/cert-manager-operator/pull/326#discussion_r2438625372", "created_at": "2025-10-17T12:02:32Z", "updated_at": "2025-10-17T12:02:32Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/326#discussion_r2439640500", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/326", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2439640500"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/326#discussion_r2439640500"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/326"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2439640500/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 3, "original_line": 3, "side": "RIGHT", "author_association": "MEMBER", "original_position": 4, "position": 4, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 331, "file_path": "config/manifests/bases/cert-manager-operator.clusterserviceversion.yaml", "line_start": 75, "line_end": 75, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n**Fix Challenge CRD name to follow Kubernetes naming convention.**\n\nLine 74 shows `name: acme.cert-manager.io`, but this violates the standard Kubernetes CRD naming format. The name should be `<resource-plural>.<api-group>`, not just `<api-group>`.\n\nComparing with the bundled version (bundle/manifests/cert-manager-operator.clusterserviceversion.yaml line 309), the correct name is `challenges.acme.cert-manager.io`.\n\nApply this diff to fix the CRD name:\n\n```diff\n    - description: Challenge is a type to represent a Challenge request with an ACME\n        server\n      displayName: Challenge\n      kind: Challenge\n-     name: acme.cert-manager.io\n+     name: challenges.acme.cert-manager.io\n      version: v1\n```\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn config/manifests/bases/cert-manager-operator.clusterserviceversion.yaml\naround lines 70 to 75, the CRD name is incorrect (\"name: acme.cert-manager.io\");\nupdate it to follow Kubernetes CRD naming convention by using\n\"<resource-plural>.<api-group>\" \u2014 replace the current name with\n\"challenges.acme.cert-manager.io\" so it matches the bundled version and the\nstandard format.\n```\n\n</details>\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2450829469", "pull_request_review_id": 3364196014, "id": 2450829469, "node_id": "PRRC_kwDOFdFn9s6SFLCd", "diff_hunk": "@@ -44,24 +44,68 @@ spec:\n   apiservicedefinitions: {}\n   customresourcedefinitions:\n     owned:\n-    - kind: CertificateRequest\n-      name: cert-manager.io\n+    - description: |-\n+        A CertificateRequest is used to request a signed certificate from one of the\n+        configured issuers.\n+\n+        All fields within the CertificateRequest's `spec` are immutable after creation.\n+        A CertificateRequest will either succeed or fail, as denoted by its `Ready` status\n+        condition and its `status.failureTime` field.\n+\n+        A CertificateRequest is a one-shot resource, meaning it represents a single\n+        point in time request for a certificate and cannot be re-used.\n+      displayName: CertificateRequest\n+      kind: CertificateRequest\n+      name: certificaterequests.cert-manager.io\n       version: v1\n-    - kind: Certificate\n-      name: cert-manager.io\n+    - description: |-\n+        A Certificate resource should be created to ensure an up to date and signed\n+        X.509 certificate is stored in the Kubernetes Secret resource named in `spec.secretName`.\n+\n+        The stored certificate will be renewed before it expires (as configured by `spec.renewBefore`).\n+      displayName: Certificate\n+      kind: Certificate\n+      name: certificates.cert-manager.io\n       version: v1\n-    - kind: Challenge\n+    - description: Challenge is a type to represent a Challenge request with an ACME\n+        server\n+      displayName: Challenge\n+      kind: Challenge\n       name: acme.cert-manager.io\n       version: v1", "path": "config/manifests/bases/cert-manager-operator.clusterserviceversion.yaml", "commit_id": "6a332bddaa3667749ade15d44b860223192c2257", "original_commit_id": "359bd60df313371f53bfe951860c77d98b91a90a", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n**Fix Challenge CRD name to follow Kubernetes naming convention.**\n\nLine 74 shows `name: acme.cert-manager.io`, but this violates the standard Kubernetes CRD naming format. The name should be `<resource-plural>.<api-group>`, not just `<api-group>`.\n\nComparing with the bundled version (bundle/manifests/cert-manager-operator.clusterserviceversion.yaml line 309), the correct name is `challenges.acme.cert-manager.io`.\n\nApply this diff to fix the CRD name:\n\n```diff\n    - description: Challenge is a type to represent a Challenge request with an ACME\n        server\n      displayName: Challenge\n      kind: Challenge\n-     name: acme.cert-manager.io\n+     name: challenges.acme.cert-manager.io\n      version: v1\n```\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn config/manifests/bases/cert-manager-operator.clusterserviceversion.yaml\naround lines 70 to 75, the CRD name is incorrect (\"name: acme.cert-manager.io\");\nupdate it to follow Kubernetes CRD naming convention by using\n\"<resource-plural>.<api-group>\" \u2014 replace the current name with\n\"challenges.acme.cert-manager.io\" so it matches the bundled version and the\nstandard format.\n```\n\n</details>\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "created_at": "2025-10-22T08:08:34Z", "updated_at": "2025-10-22T08:08:36Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/331#discussion_r2450829469", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/331", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2450829469"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/331#discussion_r2450829469"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/331"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2450829469/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 70, "original_start_line": 70, "start_side": "RIGHT", "line": 75, "original_line": 75, "side": "RIGHT", "author_association": "NONE", "original_position": 37, "position": 38, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 345, "file_path": "api/operator/v1alpha1/istiocsr_types.go", "line_start": 197, "line_end": null, "diff_context": "", "comment_body": "I think it's better to remove regex. We don't have efforts at this stage to test this elaborately. We can enhance the API in future releases.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2489267145", "pull_request_review_id": 3414775208, "id": 2489267145, "node_id": "PRRC_kwDOFdFn9s6UXzPJ", "diff_hunk": "@@ -194,7 +194,7 @@ type IstiodTLSConfig struct {\n \t// This field can have a maximum of 63 characters.\n \t// +kubebuilder:validation:MinLength:=1\n \t// +kubebuilder:validation:MaxLength:=63\n-\t// +kubebuilder:validation:XValidation:rule=\"!format.dns1123Subdomain().validate(self).hasValue()\",message=\"trustDomain must consist of lowercase alphanumeric characters, hyphens ('-'), and periods ('.'). Each block, separated by periods, must start and end with an alphanumeric character. Hyphens are not allowed at the start or end of a block, and consecutive periods are not permitted.\"\n+\t// +kubebuilder:validation:Pattern:=`^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*$`", "path": "api/operator/v1alpha1/istiocsr_types.go", "commit_id": "5ed62176e3d2e34cc42dc3b47672aa7ca608c646", "original_commit_id": "5ed62176e3d2e34cc42dc3b47672aa7ca608c646", "user": {"login": "bharath-b-rh", "id": 92782575, "node_id": "U_kgDOBYe_7w", "avatar_url": "https://avatars.githubusercontent.com/u/92782575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bharath-b-rh", "html_url": "https://github.com/bharath-b-rh", "followers_url": "https://api.github.com/users/bharath-b-rh/followers", "following_url": "https://api.github.com/users/bharath-b-rh/following{/other_user}", "gists_url": "https://api.github.com/users/bharath-b-rh/gists{/gist_id}", "starred_url": "https://api.github.com/users/bharath-b-rh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bharath-b-rh/subscriptions", "organizations_url": "https://api.github.com/users/bharath-b-rh/orgs", "repos_url": "https://api.github.com/users/bharath-b-rh/repos", "events_url": "https://api.github.com/users/bharath-b-rh/events{/privacy}", "received_events_url": "https://api.github.com/users/bharath-b-rh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "I think it's better to remove regex. We don't have efforts at this stage to test this elaborately. We can enhance the API in future releases.", "created_at": "2025-11-04T08:40:21Z", "updated_at": "2025-11-04T08:40:21Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/345#discussion_r2489267145", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/345", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2489267145"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/345#discussion_r2489267145"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/345"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2489267145/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 197, "side": "RIGHT", "author_association": "MEMBER", "original_position": 5, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 345, "file_path": "api/operator/v1alpha1/istiocsr_types.go", "line_start": 197, "line_end": null, "diff_context": "", "comment_body": "Okay, removed the pattern matching validation for now, due to limited testing scope. ", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2489303313", "pull_request_review_id": 3414821661, "id": 2489303313, "node_id": "PRRC_kwDOFdFn9s6UX8ER", "diff_hunk": "@@ -194,7 +194,7 @@ type IstiodTLSConfig struct {\n \t// This field can have a maximum of 63 characters.\n \t// +kubebuilder:validation:MinLength:=1\n \t// +kubebuilder:validation:MaxLength:=63\n-\t// +kubebuilder:validation:XValidation:rule=\"!format.dns1123Subdomain().validate(self).hasValue()\",message=\"trustDomain must consist of lowercase alphanumeric characters, hyphens ('-'), and periods ('.'). Each block, separated by periods, must start and end with an alphanumeric character. Hyphens are not allowed at the start or end of a block, and consecutive periods are not permitted.\"\n+\t// +kubebuilder:validation:Pattern:=`^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*$`", "path": "api/operator/v1alpha1/istiocsr_types.go", "commit_id": "5ed62176e3d2e34cc42dc3b47672aa7ca608c646", "original_commit_id": "5ed62176e3d2e34cc42dc3b47672aa7ca608c646", "user": {"login": "chiragkyal", "id": 43825954, "node_id": "MDQ6VXNlcjQzODI1OTU0", "avatar_url": "https://avatars.githubusercontent.com/u/43825954?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chiragkyal", "html_url": "https://github.com/chiragkyal", "followers_url": "https://api.github.com/users/chiragkyal/followers", "following_url": "https://api.github.com/users/chiragkyal/following{/other_user}", "gists_url": "https://api.github.com/users/chiragkyal/gists{/gist_id}", "starred_url": "https://api.github.com/users/chiragkyal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chiragkyal/subscriptions", "organizations_url": "https://api.github.com/users/chiragkyal/orgs", "repos_url": "https://api.github.com/users/chiragkyal/repos", "events_url": "https://api.github.com/users/chiragkyal/events{/privacy}", "received_events_url": "https://api.github.com/users/chiragkyal/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "Okay, removed the pattern matching validation for now, due to limited testing scope. ", "created_at": "2025-11-04T08:48:56Z", "updated_at": "2025-11-04T08:48:56Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/345#discussion_r2489303313", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/345", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2489303313"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/345#discussion_r2489303313"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/345"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2489303313/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 197, "side": "RIGHT", "in_reply_to_id": 2489267145, "author_association": "MEMBER", "original_position": 5, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 220, "file_path": "bundle/manifests/cert-manager-operator.clusterserviceversion.yaml", "line_start": 303, "line_end": 303, "diff_context": "", "comment_body": "we should add atleast one example of this CustomResource in `config/samples` which should take care of adding the example IstioCSR manifest into the ClusterServiceVersion's annotations['alm-examples'].\r\nIIRC, OpenShift Console uses that manifest for UX and likely operator-sdk cli warns against too (today?).", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1896766410", "pull_request_review_id": 2521982298, "id": 1896766410, "node_id": "PRRC_kwDOFdFn9s5xDlvK", "diff_hunk": "@@ -270,6 +270,9 @@ spec:\n     - kind: Issuer\n       name: issuers.cert-manager.io\n       version: v1\n+    - kind: IstioCSR\n+      name: istiocsrs.operator.openshift.io\n+      version: v1alpha1", "path": "bundle/manifests/cert-manager-operator.clusterserviceversion.yaml", "commit_id": "99f9aa988497bed1935cd580a601a035536c5f4b", "original_commit_id": "fc5bb4bf5113815fc70b0388df0ba505d8d17216", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "we should add atleast one example of this CustomResource in `config/samples` which should take care of adding the example IstioCSR manifest into the ClusterServiceVersion's annotations['alm-examples'].\r\nIIRC, OpenShift Console uses that manifest for UX and likely operator-sdk cli warns against too (today?).", "created_at": "2024-12-24T13:50:29Z", "updated_at": "2024-12-24T14:53:57Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1896766410", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1896766410"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1896766410"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1896766410/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 303, "original_line": 303, "side": "RIGHT", "author_association": "MEMBER", "original_position": 6, "position": 41, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 220, "file_path": "pkg/operator/setup_manager.go", "line_start": 61, "line_end": null, "diff_context": "", "comment_body": "```suggestion\r\n\t\tLeaderElectionID:       \"10c233b5.certmanagers.operator.openshift.io\",\r\n```\r\nto be consistent with the other API.\r\n\r\n\r\ndo you know what resources would this leader election end up using?\r\nThe other controller(s) we have issues a lease in the operator namespace.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1896799924", "pull_request_review_id": 2521982298, "id": 1896799924, "node_id": "PRRC_kwDOFdFn9s5xDt60", "diff_hunk": "@@ -0,0 +1,94 @@\n+package operator\n+\n+import (\n+\t\"context\"\n+\t\"fmt\"\n+\n+\tappsv1 \"k8s.io/api/apps/v1\"\n+\tcorev1 \"k8s.io/api/core/v1\"\n+\trbacv1 \"k8s.io/api/rbac/v1\"\n+\t\"k8s.io/apimachinery/pkg/runtime\"\n+\tutilruntime \"k8s.io/apimachinery/pkg/util/runtime\"\n+\tclientscheme \"k8s.io/client-go/kubernetes/scheme\"\n+\t\"k8s.io/client-go/rest\"\n+\t\"k8s.io/klog/v2\"\n+\n+\tctrl \"sigs.k8s.io/controller-runtime\"\n+\t\"sigs.k8s.io/controller-runtime/pkg/client\"\n+\t\"sigs.k8s.io/controller-runtime/pkg/healthz\"\n+\tctrllog \"sigs.k8s.io/controller-runtime/pkg/log\"\n+\t\"sigs.k8s.io/controller-runtime/pkg/manager\"\n+\n+\tcertmanagerv1 \"github.com/cert-manager/cert-manager/pkg/apis/certmanager/v1\"\n+\n+\tv1alpha1 \"github.com/openshift/cert-manager-operator/api/operator/v1alpha1\"\n+\t\"github.com/openshift/cert-manager-operator/pkg/controller/istiocsr\"\n+\t\"github.com/openshift/cert-manager-operator/pkg/version\"\n+)\n+\n+var (\n+\tscheme   = runtime.NewScheme()\n+\tsetupLog = ctrl.Log.WithName(\"setup-manager\")\n+)\n+\n+func init() {\n+\tctrllog.SetLogger(klog.NewKlogr())\n+\n+\tutilruntime.Must(clientscheme.AddToScheme(scheme))\n+\tutilruntime.Must(appsv1.AddToScheme(scheme))\n+\tutilruntime.Must(corev1.AddToScheme(scheme))\n+\tutilruntime.Must(rbacv1.AddToScheme(scheme))\n+\tutilruntime.Must(certmanagerv1.AddToScheme(scheme))\n+\tutilruntime.Must(v1alpha1.AddToScheme(scheme))\n+\t// +kubebuilder:scaffold:scheme\n+}\n+\n+// Manager holds the manager resource for the istio-csr controller\n+type Manager struct {\n+\tmanager manager.Manager\n+}\n+\n+// New creates a new manager.\n+func New() (*Manager, error) {\n+\tsetupLog.Info(\"setting up operator manager\", \"controller\", istiocsr.ControllerName)\n+\tsetupLog.Info(\"controller\", \"version\", version.Get())\n+\n+\tmgr, err := ctrl.NewManager(ctrl.GetConfigOrDie(), ctrl.Options{\n+\t\tLogger:                 ctrl.Log.WithName(\"operator manager\"),\n+\t\tScheme:                 scheme,\n+\t\tHealthProbeBindAddress: \":8081\",\n+\t\tLeaderElection:         false,\n+\t\tLeaderElectionID:       \"10c233b5.operator.openshift.io\",", "path": "pkg/operator/setup_manager.go", "commit_id": "99f9aa988497bed1935cd580a601a035536c5f4b", "original_commit_id": "9a3ca2cbbd6161958131d81410cb82237fa0062b", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "```suggestion\r\n\t\tLeaderElectionID:       \"10c233b5.certmanagers.operator.openshift.io\",\r\n```\r\nto be consistent with the other API.\r\n\r\n\r\ndo you know what resources would this leader election end up using?\r\nThe other controller(s) we have issues a lease in the operator namespace.", "created_at": "2024-12-24T14:41:57Z", "updated_at": "2024-12-24T14:53:57Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1896799924", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1896799924"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1896799924"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1896799924/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 61, "side": "RIGHT", "author_association": "MEMBER", "original_position": 61, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 220, "file_path": "api/operator/v1alpha1/istiocsr_types.go", "line_start": 79, "line_end": 79, "diff_context": "", "comment_body": "Could we please be consistent with the other logLevels, for UX parity.\r\nRefer: https://github.com/openshift/cert-manager-operator/blob/master/pkg/controller/deployment/deployment_log_level.go i.e. use `{Normal, Debug, Trace, TraceAll}`.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1896802238", "pull_request_review_id": 2521982298, "id": 1896802238, "node_id": "PRRC_kwDOFdFn9s5xDue-", "diff_hunk": "@@ -0,0 +1,246 @@\n+package v1alpha1\n+\n+import (\n+\tcertmanagerv1 \"github.com/cert-manager/cert-manager/pkg/apis/meta/v1\"\n+\n+\tcorev1 \"k8s.io/api/core/v1\"\n+\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n+)\n+\n+func init() {\n+\tSchemeBuilder.Register(&IstioCSR{}, &IstioCSRList{})\n+}\n+\n+// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object\n+//+kubebuilder:object:root=true\n+\n+// IstioCSRList is a list of IstioCSR objects.\n+type IstioCSRList struct {\n+\tmetav1.TypeMeta `json:\",inline\"`\n+\n+\t// metadata is the standard list's metadata.\n+\t// More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata\n+\tmetav1.ListMeta `json:\"metadata\"`\n+\tItems           []IstioCSR `json:\"items\"`\n+}\n+\n+// +genclient\n+// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object\n+// +kubebuilder:subresource:status\n+\n+// IstioCSR describes configuration and information about the managed istio-csr\n+// agent. The name must be `default`.\n+//\n+// When an IstioCSR is created, a new deployment is created which manages the\n+// istio-csr agent and keeps it in the desired state.\n+// +kubebuilder:object:root=true\n+// +kubebuilder:printcolumn:name=\"Age\",type=\"date\",JSONPath=\".metadata.creationTimestamp\"\n+// +kubebuilder:printcolumn:name=\"GRPC Endpoint\",type=\"string\",JSONPath=\".status.istioCSRGRPCEndpoint\"\n+// +kubebuilder:validation:XValidation:rule=\"self.metadata.name == 'default'\",message=\"istiocsr is a singleton, .metadata.name must be 'default'\"\n+// +operator-sdk:csv:customresourcedefinitions:displayName=\"IstioCSR\"\n+type IstioCSR struct {\n+\tmetav1.TypeMeta `json:\",inline\"`\n+\n+\t// metadata is the standard object's metadata.\n+\t// More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata\n+\tmetav1.ObjectMeta `json:\"metadata,omitempty\"`\n+\n+\t// spec is the specification of the desired behavior of the IstioCSR.\n+\tSpec IstioCSRSpec `json:\"spec,omitempty\"`\n+\n+\t// status is the most recently observed status of the IstioCSR.\n+\tStatus IstioCSRStatus `json:\"status,omitempty\"`\n+}\n+\n+// IstioCSRSpec is the specification of the desired behavior of the IstioCSR.\n+type IstioCSRSpec struct {\n+\t// istioCSRConfig is for configuring the istio-csr agent behavior.\n+\tIstioCSRConfig *IstioCSRConfig `json:\"istioCSRConfig,omitempty\"`\n+\n+\t// controllerConfig is for configuring the controller for setting up\n+\t// defaults to enable istio-csr agent.\n+\tControllerConfig *ControllerConfig `json:\"controllerConfig,omitempty\"`\n+}\n+\n+// IstioCSRConfig is for configuring the istio-csr agent behavior.\n+type IstioCSRConfig struct {\n+\t// logLevel is for setting verbosity of istio-csr agent logging.\n+\t// Supported log levels: 1-5.\n+\t// +kubebuilder:default:=1\n+\t// +kubebuilder:validation:Minimum:=1\n+\t// +kubebuilder:validation:Maximum:=5\n+\t// +optional\n+\tLogLevel int32 `json:\"logLevel,omitempty\"`", "path": "api/operator/v1alpha1/istiocsr_types.go", "commit_id": "99f9aa988497bed1935cd580a601a035536c5f4b", "original_commit_id": "fc5bb4bf5113815fc70b0388df0ba505d8d17216", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "Could we please be consistent with the other logLevels, for UX parity.\r\nRefer: https://github.com/openshift/cert-manager-operator/blob/master/pkg/controller/deployment/deployment_log_level.go i.e. use `{Normal, Debug, Trace, TraceAll}`.", "created_at": "2024-12-24T14:45:36Z", "updated_at": "2024-12-24T14:53:57Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1896802238", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1896802238"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1896802238"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1896802238/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 79, "original_line": 79, "side": "RIGHT", "author_association": "MEMBER", "original_position": 73, "position": 79, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 220, "file_path": "api/operator/v1alpha1/istiocsr_types.go", "line_start": 230, "line_end": 230, "diff_context": "", "comment_body": "not sure if I read this correctly, does it want to make sure that old revisions can never get removed once added?\r\nWhat happens when the list goes beyond MaxItems=10, how do we purge it from apiserver capabilities with this CEL enabled.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1896803571", "pull_request_review_id": 2521982298, "id": 1896803571, "node_id": "PRRC_kwDOFdFn9s5xDuzz", "diff_hunk": "@@ -0,0 +1,246 @@\n+package v1alpha1\n+\n+import (\n+\tcertmanagerv1 \"github.com/cert-manager/cert-manager/pkg/apis/meta/v1\"\n+\n+\tcorev1 \"k8s.io/api/core/v1\"\n+\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n+)\n+\n+func init() {\n+\tSchemeBuilder.Register(&IstioCSR{}, &IstioCSRList{})\n+}\n+\n+// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object\n+//+kubebuilder:object:root=true\n+\n+// IstioCSRList is a list of IstioCSR objects.\n+type IstioCSRList struct {\n+\tmetav1.TypeMeta `json:\",inline\"`\n+\n+\t// metadata is the standard list's metadata.\n+\t// More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata\n+\tmetav1.ListMeta `json:\"metadata\"`\n+\tItems           []IstioCSR `json:\"items\"`\n+}\n+\n+// +genclient\n+// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object\n+// +kubebuilder:subresource:status\n+\n+// IstioCSR describes configuration and information about the managed istio-csr\n+// agent. The name must be `default`.\n+//\n+// When an IstioCSR is created, a new deployment is created which manages the\n+// istio-csr agent and keeps it in the desired state.\n+// +kubebuilder:object:root=true\n+// +kubebuilder:printcolumn:name=\"Age\",type=\"date\",JSONPath=\".metadata.creationTimestamp\"\n+// +kubebuilder:printcolumn:name=\"GRPC Endpoint\",type=\"string\",JSONPath=\".status.istioCSRGRPCEndpoint\"\n+// +kubebuilder:validation:XValidation:rule=\"self.metadata.name == 'default'\",message=\"istiocsr is a singleton, .metadata.name must be 'default'\"\n+// +operator-sdk:csv:customresourcedefinitions:displayName=\"IstioCSR\"\n+type IstioCSR struct {\n+\tmetav1.TypeMeta `json:\",inline\"`\n+\n+\t// metadata is the standard object's metadata.\n+\t// More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata\n+\tmetav1.ObjectMeta `json:\"metadata,omitempty\"`\n+\n+\t// spec is the specification of the desired behavior of the IstioCSR.\n+\tSpec IstioCSRSpec `json:\"spec,omitempty\"`\n+\n+\t// status is the most recently observed status of the IstioCSR.\n+\tStatus IstioCSRStatus `json:\"status,omitempty\"`\n+}\n+\n+// IstioCSRSpec is the specification of the desired behavior of the IstioCSR.\n+type IstioCSRSpec struct {\n+\t// istioCSRConfig is for configuring the istio-csr agent behavior.\n+\tIstioCSRConfig *IstioCSRConfig `json:\"istioCSRConfig,omitempty\"`\n+\n+\t// controllerConfig is for configuring the controller for setting up\n+\t// defaults to enable istio-csr agent.\n+\tControllerConfig *ControllerConfig `json:\"controllerConfig,omitempty\"`\n+}\n+\n+// IstioCSRConfig is for configuring the istio-csr agent behavior.\n+type IstioCSRConfig struct {\n+\t// logLevel is for setting verbosity of istio-csr agent logging.\n+\t// Supported log levels: 1-5.\n+\t// +kubebuilder:default:=1\n+\t// +kubebuilder:validation:Minimum:=1\n+\t// +kubebuilder:validation:Maximum:=5\n+\t// +optional\n+\tLogLevel int32 `json:\"logLevel,omitempty\"`\n+\n+\t// logFormat is for specifying the output format of istio-csr agent logging.\n+\t// Support log formats are text and json.\n+\t// +kubebuilder:default:=text\n+\t// +optional\n+\tLogFormat string `json:\"logFormat,omitempty\"`\n+\n+\t// certmanager is for configuring cert-manager specifics.\n+\t// +required\n+\tCertManager *CertManagerConfig `json:\"certmanager,omitempty\"`\n+\n+\t// istiodTLSConfig is for configuring istiod certificate specifics.\n+\t// +required\n+\tIstiodTLSConfig *IstiodTLSConfig `json:\"istiodTLSConfig,omitempty\"`\n+\n+\t// server is for configuring the server endpoint used by istio\n+\t// for obtaining the certificates.\n+\t// +optional\n+\tServer *ServerConfig `json:\"server,omitempty\"`\n+\n+\t// istio is for configuring the istio specifics.\n+\t// +required\n+\tIstio *IstioConfig `json:\"istio,omitempty\"`\n+\n+\t// resources is for defining the resource requirements.\n+\t// Cannot be updated.\n+\t// ref: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n+\t// +optional\n+\tResources corev1.ResourceRequirements `json:\"resources,omitempty\"`\n+\n+\t// affinity is for setting scheduling affinity rules.\n+\t// ref: https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/\n+\t// +optional\n+\tAffinity *corev1.Affinity `json:\"affinity,omitempty\"`\n+\n+\t// tolerations is for setting the pod tolerations.\n+\t// ref: https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/\n+\t// +optional\n+\t// +listType=atomic\n+\tTolerations []corev1.Toleration `json:\"tolerations,omitempty\"`\n+\n+\t// nodeSelector is for defining the scheduling criteria using node labels.\n+\t// ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/\n+\t// +optional\n+\t// +mapType=atomic\n+\tNodeSelector map[string]string `json:\"nodeSelector,omitempty\"`\n+}\n+\n+// CertManagerConfig is for configuring cert-manager specifics.\n+// +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.issuerRef) && !has(self.issuerRef) || has(oldSelf.issuerRef) && has(self.issuerRef)\",message=\"issuerRef may only be configured during creation\"\n+type CertManagerConfig struct {\n+\t// issuerRef contains details to the referenced object used for\n+\t// obtaining the certificates. When issuerRef.Kind is Issuer, it must exist in the\n+\t// .spec.istioCSRConfig.istio.namespace.\n+\t// +kubebuilder:validation:XValidation:rule=\"self == oldSelf\",message=\"issuerRef is immutable once set\"\n+\t// +required\n+\tIssuerRef certmanagerv1.ObjectReference `json:\"issuerRef,omitempty\"`\n+}\n+\n+// IstiodTLSConfig is for configuring istiod certificate specifics.\n+// +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.signatureAlgorithm) && !has(self.signatureAlgorithm) || has(oldSelf.signatureAlgorithm) && has(self.signatureAlgorithm)\",message=\"signatureAlgorithm may only be configured during creation\"\n+// +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.privateKeySize) && !has(self.privateKeySize) || has(oldSelf.privateKeySize) && has(self.privateKeySize)\",message=\"privateKeySize may only be configured during creation\"\n+type IstiodTLSConfig struct {\n+\t// commonName is the common name to be set in the certificate.cert-manager.io\n+\t// created for istiod. CommonName will be of the form `istiod.<istio_namespace>.svc`\n+\t// when not set.\n+\t// +optional\n+\tCommonName string `json:\"commonName,omitempty\"`\n+\n+\t// trustDomain is the istio cluster's trust domain, which will also be used for deriving\n+\t// spiffe URI.\n+\t// +required\n+\tTrustDomain string `json:\"trustDomain,omitempty\"`\n+\n+\t// certificateDNSNames contains the additional DNS names to be added to the istiod certificate SAN.\n+\t// +listType=set\n+\t// +optional\n+\tCertificateDNSNames []string `json:\"certificateDNSNames,omitempty\"`\n+\n+\t// certificateDuration is the istio-csr and the istiod certificates validity period.\n+\t// +kubebuilder:default:=\"1h\"\n+\t// +optional\n+\tCertificateDuration *metav1.Duration `json:\"certificateDuration,omitempty\"`\n+\n+\t// certificateRenewBefore is the ahead time to renew the istio-csr and the istiod certificates\n+\t// before expiry.\n+\t// +kubebuilder:default:=\"30m\"\n+\t// +optional\n+\tCertificateRenewBefore *metav1.Duration `json:\"certificateRenewBefore,omitempty\"`\n+\n+\t// privateKeySize is the istio-csr and the istiod certificate's key size. When the SignatureAlgorithm\n+\t// is RSA, must be >= 2048 and for ECDSA, can only be 256 or 384, corresponding to P-256 and P-384 respectively.\n+\t// +kubebuilder:default:=2048\n+\t// +kubebuilder:validation:XValidation:rule=\"oldSelf == 0 || self == oldSelf\",message=\"privateKeySize is immutable once set\"\n+\t// +optional\n+\tPrivateKeySize int `json:\"privateKeySize,omitempty\"`\n+\n+\t// signatureAlgorithm is the signature algorithm to use when generating\n+\t// private keys. At present only RSA and ECDSA are supported.\n+\t// +kubebuilder:default:=\"RSA\"\n+\t// +kubebuilder:validation:Enum:=\"RSA\";\"ECDSA\"\n+\t// +kubebuilder:validation:XValidation:rule=\"oldSelf == '' || self == oldSelf\",message=\"signatureAlgorithm is immutable once set\"\n+\t// +optional\n+\tSignatureAlgorithm string `json:\"signatureAlgorithm,omitempty\"`\n+\n+\t// MaxCertificateDuration is the maximum validity duration that can be\n+\t// requested for a certificate.\n+\t// +kubebuilder:default:=\"1h\"\n+\t// +optional\n+\tMaxCertificateDuration *metav1.Duration `json:\"maxCertificateDuration,omitempty\"`\n+}\n+\n+// ServerConfig is for configuring the server endpoint used by istio\n+// for obtaining the certificates.\n+type ServerConfig struct {\n+\t// port to serve istio-csr gRPC service.\n+\t// +kubebuilder:default:=443\n+\t// +kubebuilder:validation:XValidation:rule=\"oldSelf == 0 || self == oldSelf\",message=\"port is immutable once set\"\n+\t// +optional\n+\tPort int32 `json:\"port,omitempty\"`\n+}\n+\n+// IstioConfig is for configuring the istio specifics.\n+type IstioConfig struct {\n+\t// revisions are the istio revisions that are currently installed in the cluster.\n+\t// Changing this field will modify the DNS names that will be requested for\n+\t// the istiod certificate.\n+\t// +listType=atomic\n+\t// +kubebuilder:default:={\"default\"}\n+\t// +kubebuilder:validation:XValidation:rule=\"self.all(x, x in oldSelf) && oldSelf.all(x, x in self)\",message=\"revisions is immutable once set\"", "path": "api/operator/v1alpha1/istiocsr_types.go", "commit_id": "99f9aa988497bed1935cd580a601a035536c5f4b", "original_commit_id": "fc5bb4bf5113815fc70b0388df0ba505d8d17216", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "not sure if I read this correctly, does it want to make sure that old revisions can never get removed once added?\r\nWhat happens when the list goes beyond MaxItems=10, how do we purge it from apiserver capabilities with this CEL enabled.", "created_at": "2024-12-24T14:47:54Z", "updated_at": "2024-12-24T14:53:57Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1896803571", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1896803571"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1896803571"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1896803571/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 230, "original_line": 230, "side": "RIGHT", "author_association": "MEMBER", "original_position": 203, "position": 230, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 220, "file_path": "bindata/istio-csr/certificate.yaml", "line_start": 6, "line_end": 6, "diff_context": "", "comment_body": "would this cause operator to get stuck on the reconcile if `istio-system` namespace is not present on the cluster?", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1896805074", "pull_request_review_id": 2521982298, "id": 1896805074, "node_id": "PRRC_kwDOFdFn9s5xDvLS", "diff_hunk": "@@ -0,0 +1,32 @@\n+---\n+apiVersion: cert-manager.io/v1\n+kind: Certificate\n+metadata:\n+  name: istiod\n+  namespace: istio-system", "path": "bindata/istio-csr/certificate.yaml", "commit_id": "99f9aa988497bed1935cd580a601a035536c5f4b", "original_commit_id": "fc5bb4bf5113815fc70b0388df0ba505d8d17216", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "would this cause operator to get stuck on the reconcile if `istio-system` namespace is not present on the cluster?", "created_at": "2024-12-24T14:50:20Z", "updated_at": "2024-12-24T14:53:57Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1896805074", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1896805074"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1896805074"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1896805074/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 6, "original_line": 6, "side": "RIGHT", "author_association": "MEMBER", "original_position": 6, "position": 6, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 220, "file_path": "api/operator/v1alpha1/istiocsr_types.go", "line_start": 230, "line_end": 230, "diff_context": "", "comment_body": "Are there UTs added for testing the CEL validations? If not, it's better to add them to verify the validations.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1897809681", "pull_request_review_id": 2517365456, "id": 1897809681, "node_id": "PRRC_kwDOFdFn9s5xHkcR", "diff_hunk": "@@ -0,0 +1,246 @@\n+package v1alpha1\n+\n+import (\n+\tcertmanagerv1 \"github.com/cert-manager/cert-manager/pkg/apis/meta/v1\"\n+\n+\tcorev1 \"k8s.io/api/core/v1\"\n+\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n+)\n+\n+func init() {\n+\tSchemeBuilder.Register(&IstioCSR{}, &IstioCSRList{})\n+}\n+\n+// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object\n+//+kubebuilder:object:root=true\n+\n+// IstioCSRList is a list of IstioCSR objects.\n+type IstioCSRList struct {\n+\tmetav1.TypeMeta `json:\",inline\"`\n+\n+\t// metadata is the standard list's metadata.\n+\t// More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata\n+\tmetav1.ListMeta `json:\"metadata\"`\n+\tItems           []IstioCSR `json:\"items\"`\n+}\n+\n+// +genclient\n+// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object\n+// +kubebuilder:subresource:status\n+\n+// IstioCSR describes configuration and information about the managed istio-csr\n+// agent. The name must be `default`.\n+//\n+// When an IstioCSR is created, a new deployment is created which manages the\n+// istio-csr agent and keeps it in the desired state.\n+// +kubebuilder:object:root=true\n+// +kubebuilder:printcolumn:name=\"Age\",type=\"date\",JSONPath=\".metadata.creationTimestamp\"\n+// +kubebuilder:printcolumn:name=\"GRPC Endpoint\",type=\"string\",JSONPath=\".status.istioCSRGRPCEndpoint\"\n+// +kubebuilder:validation:XValidation:rule=\"self.metadata.name == 'default'\",message=\"istiocsr is a singleton, .metadata.name must be 'default'\"\n+// +operator-sdk:csv:customresourcedefinitions:displayName=\"IstioCSR\"\n+type IstioCSR struct {\n+\tmetav1.TypeMeta `json:\",inline\"`\n+\n+\t// metadata is the standard object's metadata.\n+\t// More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata\n+\tmetav1.ObjectMeta `json:\"metadata,omitempty\"`\n+\n+\t// spec is the specification of the desired behavior of the IstioCSR.\n+\tSpec IstioCSRSpec `json:\"spec,omitempty\"`\n+\n+\t// status is the most recently observed status of the IstioCSR.\n+\tStatus IstioCSRStatus `json:\"status,omitempty\"`\n+}\n+\n+// IstioCSRSpec is the specification of the desired behavior of the IstioCSR.\n+type IstioCSRSpec struct {\n+\t// istioCSRConfig is for configuring the istio-csr agent behavior.\n+\tIstioCSRConfig *IstioCSRConfig `json:\"istioCSRConfig,omitempty\"`\n+\n+\t// controllerConfig is for configuring the controller for setting up\n+\t// defaults to enable istio-csr agent.\n+\tControllerConfig *ControllerConfig `json:\"controllerConfig,omitempty\"`\n+}\n+\n+// IstioCSRConfig is for configuring the istio-csr agent behavior.\n+type IstioCSRConfig struct {\n+\t// logLevel is for setting verbosity of istio-csr agent logging.\n+\t// Supported log levels: 1-5.\n+\t// +kubebuilder:default:=1\n+\t// +kubebuilder:validation:Minimum:=1\n+\t// +kubebuilder:validation:Maximum:=5\n+\t// +optional\n+\tLogLevel int32 `json:\"logLevel,omitempty\"`\n+\n+\t// logFormat is for specifying the output format of istio-csr agent logging.\n+\t// Support log formats are text and json.\n+\t// +kubebuilder:default:=text\n+\t// +optional\n+\tLogFormat string `json:\"logFormat,omitempty\"`\n+\n+\t// certmanager is for configuring cert-manager specifics.\n+\t// +required\n+\tCertManager *CertManagerConfig `json:\"certmanager,omitempty\"`\n+\n+\t// istiodTLSConfig is for configuring istiod certificate specifics.\n+\t// +required\n+\tIstiodTLSConfig *IstiodTLSConfig `json:\"istiodTLSConfig,omitempty\"`\n+\n+\t// server is for configuring the server endpoint used by istio\n+\t// for obtaining the certificates.\n+\t// +optional\n+\tServer *ServerConfig `json:\"server,omitempty\"`\n+\n+\t// istio is for configuring the istio specifics.\n+\t// +required\n+\tIstio *IstioConfig `json:\"istio,omitempty\"`\n+\n+\t// resources is for defining the resource requirements.\n+\t// Cannot be updated.\n+\t// ref: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n+\t// +optional\n+\tResources corev1.ResourceRequirements `json:\"resources,omitempty\"`\n+\n+\t// affinity is for setting scheduling affinity rules.\n+\t// ref: https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/\n+\t// +optional\n+\tAffinity *corev1.Affinity `json:\"affinity,omitempty\"`\n+\n+\t// tolerations is for setting the pod tolerations.\n+\t// ref: https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/\n+\t// +optional\n+\t// +listType=atomic\n+\tTolerations []corev1.Toleration `json:\"tolerations,omitempty\"`\n+\n+\t// nodeSelector is for defining the scheduling criteria using node labels.\n+\t// ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/\n+\t// +optional\n+\t// +mapType=atomic\n+\tNodeSelector map[string]string `json:\"nodeSelector,omitempty\"`\n+}\n+\n+// CertManagerConfig is for configuring cert-manager specifics.\n+// +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.issuerRef) && !has(self.issuerRef) || has(oldSelf.issuerRef) && has(self.issuerRef)\",message=\"issuerRef may only be configured during creation\"\n+type CertManagerConfig struct {\n+\t// issuerRef contains details to the referenced object used for\n+\t// obtaining the certificates. When issuerRef.Kind is Issuer, it must exist in the\n+\t// .spec.istioCSRConfig.istio.namespace.\n+\t// +kubebuilder:validation:XValidation:rule=\"self == oldSelf\",message=\"issuerRef is immutable once set\"\n+\t// +required\n+\tIssuerRef certmanagerv1.ObjectReference `json:\"issuerRef,omitempty\"`\n+}\n+\n+// IstiodTLSConfig is for configuring istiod certificate specifics.\n+// +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.signatureAlgorithm) && !has(self.signatureAlgorithm) || has(oldSelf.signatureAlgorithm) && has(self.signatureAlgorithm)\",message=\"signatureAlgorithm may only be configured during creation\"\n+// +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.privateKeySize) && !has(self.privateKeySize) || has(oldSelf.privateKeySize) && has(self.privateKeySize)\",message=\"privateKeySize may only be configured during creation\"\n+type IstiodTLSConfig struct {\n+\t// commonName is the common name to be set in the certificate.cert-manager.io\n+\t// created for istiod. CommonName will be of the form `istiod.<istio_namespace>.svc`\n+\t// when not set.\n+\t// +optional\n+\tCommonName string `json:\"commonName,omitempty\"`\n+\n+\t// trustDomain is the istio cluster's trust domain, which will also be used for deriving\n+\t// spiffe URI.\n+\t// +required\n+\tTrustDomain string `json:\"trustDomain,omitempty\"`\n+\n+\t// certificateDNSNames contains the additional DNS names to be added to the istiod certificate SAN.\n+\t// +listType=set\n+\t// +optional\n+\tCertificateDNSNames []string `json:\"certificateDNSNames,omitempty\"`\n+\n+\t// certificateDuration is the istio-csr and the istiod certificates validity period.\n+\t// +kubebuilder:default:=\"1h\"\n+\t// +optional\n+\tCertificateDuration *metav1.Duration `json:\"certificateDuration,omitempty\"`\n+\n+\t// certificateRenewBefore is the ahead time to renew the istio-csr and the istiod certificates\n+\t// before expiry.\n+\t// +kubebuilder:default:=\"30m\"\n+\t// +optional\n+\tCertificateRenewBefore *metav1.Duration `json:\"certificateRenewBefore,omitempty\"`\n+\n+\t// privateKeySize is the istio-csr and the istiod certificate's key size. When the SignatureAlgorithm\n+\t// is RSA, must be >= 2048 and for ECDSA, can only be 256 or 384, corresponding to P-256 and P-384 respectively.\n+\t// +kubebuilder:default:=2048\n+\t// +kubebuilder:validation:XValidation:rule=\"oldSelf == 0 || self == oldSelf\",message=\"privateKeySize is immutable once set\"\n+\t// +optional\n+\tPrivateKeySize int `json:\"privateKeySize,omitempty\"`\n+\n+\t// signatureAlgorithm is the signature algorithm to use when generating\n+\t// private keys. At present only RSA and ECDSA are supported.\n+\t// +kubebuilder:default:=\"RSA\"\n+\t// +kubebuilder:validation:Enum:=\"RSA\";\"ECDSA\"\n+\t// +kubebuilder:validation:XValidation:rule=\"oldSelf == '' || self == oldSelf\",message=\"signatureAlgorithm is immutable once set\"\n+\t// +optional\n+\tSignatureAlgorithm string `json:\"signatureAlgorithm,omitempty\"`\n+\n+\t// MaxCertificateDuration is the maximum validity duration that can be\n+\t// requested for a certificate.\n+\t// +kubebuilder:default:=\"1h\"\n+\t// +optional\n+\tMaxCertificateDuration *metav1.Duration `json:\"maxCertificateDuration,omitempty\"`\n+}\n+\n+// ServerConfig is for configuring the server endpoint used by istio\n+// for obtaining the certificates.\n+type ServerConfig struct {\n+\t// port to serve istio-csr gRPC service.\n+\t// +kubebuilder:default:=443\n+\t// +kubebuilder:validation:XValidation:rule=\"oldSelf == 0 || self == oldSelf\",message=\"port is immutable once set\"\n+\t// +optional\n+\tPort int32 `json:\"port,omitempty\"`\n+}\n+\n+// IstioConfig is for configuring the istio specifics.\n+type IstioConfig struct {\n+\t// revisions are the istio revisions that are currently installed in the cluster.\n+\t// Changing this field will modify the DNS names that will be requested for\n+\t// the istiod certificate.\n+\t// +listType=atomic\n+\t// +kubebuilder:default:={\"default\"}\n+\t// +kubebuilder:validation:XValidation:rule=\"self.all(x, x in oldSelf) && oldSelf.all(x, x in self)\",message=\"revisions is immutable once set\"", "path": "api/operator/v1alpha1/istiocsr_types.go", "commit_id": "99f9aa988497bed1935cd580a601a035536c5f4b", "original_commit_id": "fc5bb4bf5113815fc70b0388df0ba505d8d17216", "user": {"login": "arkadeepsen", "id": 5279033, "node_id": "MDQ6VXNlcjUyNzkwMzM=", "avatar_url": "https://avatars.githubusercontent.com/u/5279033?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arkadeepsen", "html_url": "https://github.com/arkadeepsen", "followers_url": "https://api.github.com/users/arkadeepsen/followers", "following_url": "https://api.github.com/users/arkadeepsen/following{/other_user}", "gists_url": "https://api.github.com/users/arkadeepsen/gists{/gist_id}", "starred_url": "https://api.github.com/users/arkadeepsen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arkadeepsen/subscriptions", "organizations_url": "https://api.github.com/users/arkadeepsen/orgs", "repos_url": "https://api.github.com/users/arkadeepsen/repos", "events_url": "https://api.github.com/users/arkadeepsen/events{/privacy}", "received_events_url": "https://api.github.com/users/arkadeepsen/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "Are there UTs added for testing the CEL validations? If not, it's better to add them to verify the validations.", "created_at": "2024-12-26T09:59:55Z", "updated_at": "2024-12-26T10:25:02Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1897809681", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1897809681"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1897809681"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1897809681/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 230, "original_line": 230, "side": "RIGHT", "in_reply_to_id": 1896803571, "author_association": "MEMBER", "original_position": 203, "position": 230, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 220, "file_path": "api/operator/v1alpha1/istiocsr_types.go", "line_start": 79, "line_end": 79, "diff_context": "", "comment_body": "Log level here is for operand, and I think keeping it same as defined by operand would be better, otherwise we need to document the mapping for first. Else we could also remove this option from user config and controller can set the same defined for the operator.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1897809933", "pull_request_review_id": 2523031553, "id": 1897809933, "node_id": "PRRC_kwDOFdFn9s5xHkgN", "diff_hunk": "@@ -0,0 +1,246 @@\n+package v1alpha1\n+\n+import (\n+\tcertmanagerv1 \"github.com/cert-manager/cert-manager/pkg/apis/meta/v1\"\n+\n+\tcorev1 \"k8s.io/api/core/v1\"\n+\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n+)\n+\n+func init() {\n+\tSchemeBuilder.Register(&IstioCSR{}, &IstioCSRList{})\n+}\n+\n+// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object\n+//+kubebuilder:object:root=true\n+\n+// IstioCSRList is a list of IstioCSR objects.\n+type IstioCSRList struct {\n+\tmetav1.TypeMeta `json:\",inline\"`\n+\n+\t// metadata is the standard list's metadata.\n+\t// More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata\n+\tmetav1.ListMeta `json:\"metadata\"`\n+\tItems           []IstioCSR `json:\"items\"`\n+}\n+\n+// +genclient\n+// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object\n+// +kubebuilder:subresource:status\n+\n+// IstioCSR describes configuration and information about the managed istio-csr\n+// agent. The name must be `default`.\n+//\n+// When an IstioCSR is created, a new deployment is created which manages the\n+// istio-csr agent and keeps it in the desired state.\n+// +kubebuilder:object:root=true\n+// +kubebuilder:printcolumn:name=\"Age\",type=\"date\",JSONPath=\".metadata.creationTimestamp\"\n+// +kubebuilder:printcolumn:name=\"GRPC Endpoint\",type=\"string\",JSONPath=\".status.istioCSRGRPCEndpoint\"\n+// +kubebuilder:validation:XValidation:rule=\"self.metadata.name == 'default'\",message=\"istiocsr is a singleton, .metadata.name must be 'default'\"\n+// +operator-sdk:csv:customresourcedefinitions:displayName=\"IstioCSR\"\n+type IstioCSR struct {\n+\tmetav1.TypeMeta `json:\",inline\"`\n+\n+\t// metadata is the standard object's metadata.\n+\t// More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata\n+\tmetav1.ObjectMeta `json:\"metadata,omitempty\"`\n+\n+\t// spec is the specification of the desired behavior of the IstioCSR.\n+\tSpec IstioCSRSpec `json:\"spec,omitempty\"`\n+\n+\t// status is the most recently observed status of the IstioCSR.\n+\tStatus IstioCSRStatus `json:\"status,omitempty\"`\n+}\n+\n+// IstioCSRSpec is the specification of the desired behavior of the IstioCSR.\n+type IstioCSRSpec struct {\n+\t// istioCSRConfig is for configuring the istio-csr agent behavior.\n+\tIstioCSRConfig *IstioCSRConfig `json:\"istioCSRConfig,omitempty\"`\n+\n+\t// controllerConfig is for configuring the controller for setting up\n+\t// defaults to enable istio-csr agent.\n+\tControllerConfig *ControllerConfig `json:\"controllerConfig,omitempty\"`\n+}\n+\n+// IstioCSRConfig is for configuring the istio-csr agent behavior.\n+type IstioCSRConfig struct {\n+\t// logLevel is for setting verbosity of istio-csr agent logging.\n+\t// Supported log levels: 1-5.\n+\t// +kubebuilder:default:=1\n+\t// +kubebuilder:validation:Minimum:=1\n+\t// +kubebuilder:validation:Maximum:=5\n+\t// +optional\n+\tLogLevel int32 `json:\"logLevel,omitempty\"`", "path": "api/operator/v1alpha1/istiocsr_types.go", "commit_id": "99f9aa988497bed1935cd580a601a035536c5f4b", "original_commit_id": "fc5bb4bf5113815fc70b0388df0ba505d8d17216", "user": {"login": "bharath-b-rh", "id": 92782575, "node_id": "U_kgDOBYe_7w", "avatar_url": "https://avatars.githubusercontent.com/u/92782575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bharath-b-rh", "html_url": "https://github.com/bharath-b-rh", "followers_url": "https://api.github.com/users/bharath-b-rh/followers", "following_url": "https://api.github.com/users/bharath-b-rh/following{/other_user}", "gists_url": "https://api.github.com/users/bharath-b-rh/gists{/gist_id}", "starred_url": "https://api.github.com/users/bharath-b-rh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bharath-b-rh/subscriptions", "organizations_url": "https://api.github.com/users/bharath-b-rh/orgs", "repos_url": "https://api.github.com/users/bharath-b-rh/repos", "events_url": "https://api.github.com/users/bharath-b-rh/events{/privacy}", "received_events_url": "https://api.github.com/users/bharath-b-rh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "Log level here is for operand, and I think keeping it same as defined by operand would be better, otherwise we need to document the mapping for first. Else we could also remove this option from user config and controller can set the same defined for the operator.", "created_at": "2024-12-26T10:00:18Z", "updated_at": "2024-12-26T10:00:18Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1897809933", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1897809933"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1897809933"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1897809933/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 79, "original_line": 79, "side": "RIGHT", "in_reply_to_id": 1896802238, "author_association": "MEMBER", "original_position": 73, "position": 79, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 220, "file_path": "config/crd/kustomization.yaml", "line_start": 12, "line_end": 12, "diff_context": "", "comment_body": "it was part of the CRD commit, must have got shuffled during rebases.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1897810109", "pull_request_review_id": 2523031868, "id": 1897810109, "node_id": "PRRC_kwDOFdFn9s5xHki9", "diff_hunk": "@@ -9,6 +9,7 @@ resources:\n - bases/clusterissuers.cert-manager.io-crd.yaml\n - bases/issuers.cert-manager.io-crd.yaml\n - bases/orders.acme.cert-manager.io-crd.yaml\n+- bases/operator.openshift.io_istiocsrs.yaml", "path": "config/crd/kustomization.yaml", "commit_id": "99f9aa988497bed1935cd580a601a035536c5f4b", "original_commit_id": "fc5bb4bf5113815fc70b0388df0ba505d8d17216", "user": {"login": "bharath-b-rh", "id": 92782575, "node_id": "U_kgDOBYe_7w", "avatar_url": "https://avatars.githubusercontent.com/u/92782575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bharath-b-rh", "html_url": "https://github.com/bharath-b-rh", "followers_url": "https://api.github.com/users/bharath-b-rh/followers", "following_url": "https://api.github.com/users/bharath-b-rh/following{/other_user}", "gists_url": "https://api.github.com/users/bharath-b-rh/gists{/gist_id}", "starred_url": "https://api.github.com/users/bharath-b-rh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bharath-b-rh/subscriptions", "organizations_url": "https://api.github.com/users/bharath-b-rh/orgs", "repos_url": "https://api.github.com/users/bharath-b-rh/repos", "events_url": "https://api.github.com/users/bharath-b-rh/events{/privacy}", "received_events_url": "https://api.github.com/users/bharath-b-rh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "it was part of the CRD commit, must have got shuffled during rebases.", "created_at": "2024-12-26T10:00:39Z", "updated_at": "2024-12-26T10:04:42Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1897810109", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1897810109"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1897810109"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1897810109/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 12, "original_line": 12, "side": "RIGHT", "in_reply_to_id": 1896770252, "author_association": "MEMBER", "original_position": 4, "position": 4, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 220, "file_path": "pkg/operator/setup_manager.go", "line_start": 61, "line_end": null, "diff_context": "", "comment_body": "`certmanagers` is the API name for for cert-manager operand, right, I will update it to below\r\n\r\n```suggestion\r\n\t\tLeaderElectionID:       \"10c233b5.istiocsrs.operator.openshift.io\",\r\n```", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1897812573", "pull_request_review_id": 2523034752, "id": 1897812573, "node_id": "PRRC_kwDOFdFn9s5xHlJd", "diff_hunk": "@@ -0,0 +1,94 @@\n+package operator\n+\n+import (\n+\t\"context\"\n+\t\"fmt\"\n+\n+\tappsv1 \"k8s.io/api/apps/v1\"\n+\tcorev1 \"k8s.io/api/core/v1\"\n+\trbacv1 \"k8s.io/api/rbac/v1\"\n+\t\"k8s.io/apimachinery/pkg/runtime\"\n+\tutilruntime \"k8s.io/apimachinery/pkg/util/runtime\"\n+\tclientscheme \"k8s.io/client-go/kubernetes/scheme\"\n+\t\"k8s.io/client-go/rest\"\n+\t\"k8s.io/klog/v2\"\n+\n+\tctrl \"sigs.k8s.io/controller-runtime\"\n+\t\"sigs.k8s.io/controller-runtime/pkg/client\"\n+\t\"sigs.k8s.io/controller-runtime/pkg/healthz\"\n+\tctrllog \"sigs.k8s.io/controller-runtime/pkg/log\"\n+\t\"sigs.k8s.io/controller-runtime/pkg/manager\"\n+\n+\tcertmanagerv1 \"github.com/cert-manager/cert-manager/pkg/apis/certmanager/v1\"\n+\n+\tv1alpha1 \"github.com/openshift/cert-manager-operator/api/operator/v1alpha1\"\n+\t\"github.com/openshift/cert-manager-operator/pkg/controller/istiocsr\"\n+\t\"github.com/openshift/cert-manager-operator/pkg/version\"\n+)\n+\n+var (\n+\tscheme   = runtime.NewScheme()\n+\tsetupLog = ctrl.Log.WithName(\"setup-manager\")\n+)\n+\n+func init() {\n+\tctrllog.SetLogger(klog.NewKlogr())\n+\n+\tutilruntime.Must(clientscheme.AddToScheme(scheme))\n+\tutilruntime.Must(appsv1.AddToScheme(scheme))\n+\tutilruntime.Must(corev1.AddToScheme(scheme))\n+\tutilruntime.Must(rbacv1.AddToScheme(scheme))\n+\tutilruntime.Must(certmanagerv1.AddToScheme(scheme))\n+\tutilruntime.Must(v1alpha1.AddToScheme(scheme))\n+\t// +kubebuilder:scaffold:scheme\n+}\n+\n+// Manager holds the manager resource for the istio-csr controller\n+type Manager struct {\n+\tmanager manager.Manager\n+}\n+\n+// New creates a new manager.\n+func New() (*Manager, error) {\n+\tsetupLog.Info(\"setting up operator manager\", \"controller\", istiocsr.ControllerName)\n+\tsetupLog.Info(\"controller\", \"version\", version.Get())\n+\n+\tmgr, err := ctrl.NewManager(ctrl.GetConfigOrDie(), ctrl.Options{\n+\t\tLogger:                 ctrl.Log.WithName(\"operator manager\"),\n+\t\tScheme:                 scheme,\n+\t\tHealthProbeBindAddress: \":8081\",\n+\t\tLeaderElection:         false,\n+\t\tLeaderElectionID:       \"10c233b5.operator.openshift.io\",", "path": "pkg/operator/setup_manager.go", "commit_id": "99f9aa988497bed1935cd580a601a035536c5f4b", "original_commit_id": "9a3ca2cbbd6161958131d81410cb82237fa0062b", "user": {"login": "bharath-b-rh", "id": 92782575, "node_id": "U_kgDOBYe_7w", "avatar_url": "https://avatars.githubusercontent.com/u/92782575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bharath-b-rh", "html_url": "https://github.com/bharath-b-rh", "followers_url": "https://api.github.com/users/bharath-b-rh/followers", "following_url": "https://api.github.com/users/bharath-b-rh/following{/other_user}", "gists_url": "https://api.github.com/users/bharath-b-rh/gists{/gist_id}", "starred_url": "https://api.github.com/users/bharath-b-rh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bharath-b-rh/subscriptions", "organizations_url": "https://api.github.com/users/bharath-b-rh/orgs", "repos_url": "https://api.github.com/users/bharath-b-rh/repos", "events_url": "https://api.github.com/users/bharath-b-rh/events{/privacy}", "received_events_url": "https://api.github.com/users/bharath-b-rh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "`certmanagers` is the API name for for cert-manager operand, right, I will update it to below\r\n\r\n```suggestion\r\n\t\tLeaderElectionID:       \"10c233b5.istiocsrs.operator.openshift.io\",\r\n```", "created_at": "2024-12-26T10:04:04Z", "updated_at": "2024-12-26T10:04:04Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1897812573", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1897812573"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1897812573"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1897812573/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 61, "side": "RIGHT", "in_reply_to_id": 1896799924, "author_association": "MEMBER", "original_position": 61, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 220, "file_path": "api/operator/v1alpha1/istiocsr_types.go", "line_start": 230, "line_end": 230, "diff_context": "", "comment_body": "> Are there UTs added for testing the CEL validations? If not, it's better to add them to verify the validations.\r\n\r\nYup, we should add something for the validations (seems this is the first time we're adding CEL based validation to our operator API) based upon `envtest`, to begin with: https://book.kubebuilder.io/reference/envtest#writing-tests sorta. \r\n\r\nFor reference, the more exhaustive related tests we've in openshift/api: https://github.com/openshift/api/blob/188620a9ab5eaad36199cf83d9a0afcb08fdfd52/tests/crd_filter.go + https://github.com/openshift/api/blob/188620a9ab5eaad36199cf83d9a0afcb08fdfd52/machineconfiguration/v1alpha1/tests/machineconfignodes.machineconfiguration.openshift.io/MachineConfigNodes.yaml#L113-L158, ofcourse we want something functional and much more minimal than that.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1898077219", "pull_request_review_id": 2523440255, "id": 1898077219, "node_id": "PRRC_kwDOFdFn9s5xIlwj", "diff_hunk": "@@ -0,0 +1,246 @@\n+package v1alpha1\n+\n+import (\n+\tcertmanagerv1 \"github.com/cert-manager/cert-manager/pkg/apis/meta/v1\"\n+\n+\tcorev1 \"k8s.io/api/core/v1\"\n+\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n+)\n+\n+func init() {\n+\tSchemeBuilder.Register(&IstioCSR{}, &IstioCSRList{})\n+}\n+\n+// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object\n+//+kubebuilder:object:root=true\n+\n+// IstioCSRList is a list of IstioCSR objects.\n+type IstioCSRList struct {\n+\tmetav1.TypeMeta `json:\",inline\"`\n+\n+\t// metadata is the standard list's metadata.\n+\t// More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata\n+\tmetav1.ListMeta `json:\"metadata\"`\n+\tItems           []IstioCSR `json:\"items\"`\n+}\n+\n+// +genclient\n+// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object\n+// +kubebuilder:subresource:status\n+\n+// IstioCSR describes configuration and information about the managed istio-csr\n+// agent. The name must be `default`.\n+//\n+// When an IstioCSR is created, a new deployment is created which manages the\n+// istio-csr agent and keeps it in the desired state.\n+// +kubebuilder:object:root=true\n+// +kubebuilder:printcolumn:name=\"Age\",type=\"date\",JSONPath=\".metadata.creationTimestamp\"\n+// +kubebuilder:printcolumn:name=\"GRPC Endpoint\",type=\"string\",JSONPath=\".status.istioCSRGRPCEndpoint\"\n+// +kubebuilder:validation:XValidation:rule=\"self.metadata.name == 'default'\",message=\"istiocsr is a singleton, .metadata.name must be 'default'\"\n+// +operator-sdk:csv:customresourcedefinitions:displayName=\"IstioCSR\"\n+type IstioCSR struct {\n+\tmetav1.TypeMeta `json:\",inline\"`\n+\n+\t// metadata is the standard object's metadata.\n+\t// More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata\n+\tmetav1.ObjectMeta `json:\"metadata,omitempty\"`\n+\n+\t// spec is the specification of the desired behavior of the IstioCSR.\n+\tSpec IstioCSRSpec `json:\"spec,omitempty\"`\n+\n+\t// status is the most recently observed status of the IstioCSR.\n+\tStatus IstioCSRStatus `json:\"status,omitempty\"`\n+}\n+\n+// IstioCSRSpec is the specification of the desired behavior of the IstioCSR.\n+type IstioCSRSpec struct {\n+\t// istioCSRConfig is for configuring the istio-csr agent behavior.\n+\tIstioCSRConfig *IstioCSRConfig `json:\"istioCSRConfig,omitempty\"`\n+\n+\t// controllerConfig is for configuring the controller for setting up\n+\t// defaults to enable istio-csr agent.\n+\tControllerConfig *ControllerConfig `json:\"controllerConfig,omitempty\"`\n+}\n+\n+// IstioCSRConfig is for configuring the istio-csr agent behavior.\n+type IstioCSRConfig struct {\n+\t// logLevel is for setting verbosity of istio-csr agent logging.\n+\t// Supported log levels: 1-5.\n+\t// +kubebuilder:default:=1\n+\t// +kubebuilder:validation:Minimum:=1\n+\t// +kubebuilder:validation:Maximum:=5\n+\t// +optional\n+\tLogLevel int32 `json:\"logLevel,omitempty\"`\n+\n+\t// logFormat is for specifying the output format of istio-csr agent logging.\n+\t// Support log formats are text and json.\n+\t// +kubebuilder:default:=text\n+\t// +optional\n+\tLogFormat string `json:\"logFormat,omitempty\"`\n+\n+\t// certmanager is for configuring cert-manager specifics.\n+\t// +required\n+\tCertManager *CertManagerConfig `json:\"certmanager,omitempty\"`\n+\n+\t// istiodTLSConfig is for configuring istiod certificate specifics.\n+\t// +required\n+\tIstiodTLSConfig *IstiodTLSConfig `json:\"istiodTLSConfig,omitempty\"`\n+\n+\t// server is for configuring the server endpoint used by istio\n+\t// for obtaining the certificates.\n+\t// +optional\n+\tServer *ServerConfig `json:\"server,omitempty\"`\n+\n+\t// istio is for configuring the istio specifics.\n+\t// +required\n+\tIstio *IstioConfig `json:\"istio,omitempty\"`\n+\n+\t// resources is for defining the resource requirements.\n+\t// Cannot be updated.\n+\t// ref: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n+\t// +optional\n+\tResources corev1.ResourceRequirements `json:\"resources,omitempty\"`\n+\n+\t// affinity is for setting scheduling affinity rules.\n+\t// ref: https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/\n+\t// +optional\n+\tAffinity *corev1.Affinity `json:\"affinity,omitempty\"`\n+\n+\t// tolerations is for setting the pod tolerations.\n+\t// ref: https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/\n+\t// +optional\n+\t// +listType=atomic\n+\tTolerations []corev1.Toleration `json:\"tolerations,omitempty\"`\n+\n+\t// nodeSelector is for defining the scheduling criteria using node labels.\n+\t// ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/\n+\t// +optional\n+\t// +mapType=atomic\n+\tNodeSelector map[string]string `json:\"nodeSelector,omitempty\"`\n+}\n+\n+// CertManagerConfig is for configuring cert-manager specifics.\n+// +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.issuerRef) && !has(self.issuerRef) || has(oldSelf.issuerRef) && has(self.issuerRef)\",message=\"issuerRef may only be configured during creation\"\n+type CertManagerConfig struct {\n+\t// issuerRef contains details to the referenced object used for\n+\t// obtaining the certificates. When issuerRef.Kind is Issuer, it must exist in the\n+\t// .spec.istioCSRConfig.istio.namespace.\n+\t// +kubebuilder:validation:XValidation:rule=\"self == oldSelf\",message=\"issuerRef is immutable once set\"\n+\t// +required\n+\tIssuerRef certmanagerv1.ObjectReference `json:\"issuerRef,omitempty\"`\n+}\n+\n+// IstiodTLSConfig is for configuring istiod certificate specifics.\n+// +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.signatureAlgorithm) && !has(self.signatureAlgorithm) || has(oldSelf.signatureAlgorithm) && has(self.signatureAlgorithm)\",message=\"signatureAlgorithm may only be configured during creation\"\n+// +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.privateKeySize) && !has(self.privateKeySize) || has(oldSelf.privateKeySize) && has(self.privateKeySize)\",message=\"privateKeySize may only be configured during creation\"\n+type IstiodTLSConfig struct {\n+\t// commonName is the common name to be set in the certificate.cert-manager.io\n+\t// created for istiod. CommonName will be of the form `istiod.<istio_namespace>.svc`\n+\t// when not set.\n+\t// +optional\n+\tCommonName string `json:\"commonName,omitempty\"`\n+\n+\t// trustDomain is the istio cluster's trust domain, which will also be used for deriving\n+\t// spiffe URI.\n+\t// +required\n+\tTrustDomain string `json:\"trustDomain,omitempty\"`\n+\n+\t// certificateDNSNames contains the additional DNS names to be added to the istiod certificate SAN.\n+\t// +listType=set\n+\t// +optional\n+\tCertificateDNSNames []string `json:\"certificateDNSNames,omitempty\"`\n+\n+\t// certificateDuration is the istio-csr and the istiod certificates validity period.\n+\t// +kubebuilder:default:=\"1h\"\n+\t// +optional\n+\tCertificateDuration *metav1.Duration `json:\"certificateDuration,omitempty\"`\n+\n+\t// certificateRenewBefore is the ahead time to renew the istio-csr and the istiod certificates\n+\t// before expiry.\n+\t// +kubebuilder:default:=\"30m\"\n+\t// +optional\n+\tCertificateRenewBefore *metav1.Duration `json:\"certificateRenewBefore,omitempty\"`\n+\n+\t// privateKeySize is the istio-csr and the istiod certificate's key size. When the SignatureAlgorithm\n+\t// is RSA, must be >= 2048 and for ECDSA, can only be 256 or 384, corresponding to P-256 and P-384 respectively.\n+\t// +kubebuilder:default:=2048\n+\t// +kubebuilder:validation:XValidation:rule=\"oldSelf == 0 || self == oldSelf\",message=\"privateKeySize is immutable once set\"\n+\t// +optional\n+\tPrivateKeySize int `json:\"privateKeySize,omitempty\"`\n+\n+\t// signatureAlgorithm is the signature algorithm to use when generating\n+\t// private keys. At present only RSA and ECDSA are supported.\n+\t// +kubebuilder:default:=\"RSA\"\n+\t// +kubebuilder:validation:Enum:=\"RSA\";\"ECDSA\"\n+\t// +kubebuilder:validation:XValidation:rule=\"oldSelf == '' || self == oldSelf\",message=\"signatureAlgorithm is immutable once set\"\n+\t// +optional\n+\tSignatureAlgorithm string `json:\"signatureAlgorithm,omitempty\"`\n+\n+\t// MaxCertificateDuration is the maximum validity duration that can be\n+\t// requested for a certificate.\n+\t// +kubebuilder:default:=\"1h\"\n+\t// +optional\n+\tMaxCertificateDuration *metav1.Duration `json:\"maxCertificateDuration,omitempty\"`\n+}\n+\n+// ServerConfig is for configuring the server endpoint used by istio\n+// for obtaining the certificates.\n+type ServerConfig struct {\n+\t// port to serve istio-csr gRPC service.\n+\t// +kubebuilder:default:=443\n+\t// +kubebuilder:validation:XValidation:rule=\"oldSelf == 0 || self == oldSelf\",message=\"port is immutable once set\"\n+\t// +optional\n+\tPort int32 `json:\"port,omitempty\"`\n+}\n+\n+// IstioConfig is for configuring the istio specifics.\n+type IstioConfig struct {\n+\t// revisions are the istio revisions that are currently installed in the cluster.\n+\t// Changing this field will modify the DNS names that will be requested for\n+\t// the istiod certificate.\n+\t// +listType=atomic\n+\t// +kubebuilder:default:={\"default\"}\n+\t// +kubebuilder:validation:XValidation:rule=\"self.all(x, x in oldSelf) && oldSelf.all(x, x in self)\",message=\"revisions is immutable once set\"", "path": "api/operator/v1alpha1/istiocsr_types.go", "commit_id": "99f9aa988497bed1935cd580a601a035536c5f4b", "original_commit_id": "fc5bb4bf5113815fc70b0388df0ba505d8d17216", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "> Are there UTs added for testing the CEL validations? If not, it's better to add them to verify the validations.\r\n\r\nYup, we should add something for the validations (seems this is the first time we're adding CEL based validation to our operator API) based upon `envtest`, to begin with: https://book.kubebuilder.io/reference/envtest#writing-tests sorta. \r\n\r\nFor reference, the more exhaustive related tests we've in openshift/api: https://github.com/openshift/api/blob/188620a9ab5eaad36199cf83d9a0afcb08fdfd52/tests/crd_filter.go + https://github.com/openshift/api/blob/188620a9ab5eaad36199cf83d9a0afcb08fdfd52/machineconfiguration/v1alpha1/tests/machineconfignodes.machineconfiguration.openshift.io/MachineConfigNodes.yaml#L113-L158, ofcourse we want something functional and much more minimal than that.", "created_at": "2024-12-26T19:32:14Z", "updated_at": "2024-12-26T19:32:14Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1898077219", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1898077219"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1898077219"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1898077219/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 230, "original_line": 230, "side": "RIGHT", "in_reply_to_id": 1896803571, "author_association": "MEMBER", "original_position": 203, "position": 230, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 220, "file_path": "api/operator/v1alpha1/istiocsr_types.go", "line_start": 230, "line_end": 230, "diff_context": "", "comment_body": "> Yes, revisions can only be configured when creating `istiocsr` resource and cannot be modified later. With `MaxItems` set to 10, a user cannot configure more than that, creating the resource would fail when it crosses the defined limit.\r\n\r\nAlright, so my understanding is that user sets these revisions (and not operator added)\r\n- never let user remove an existing one, only append is allowed;\r\n- we're blocking >10.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1898078015", "pull_request_review_id": 2523441476, "id": 1898078015, "node_id": "PRRC_kwDOFdFn9s5xIl8_", "diff_hunk": "@@ -0,0 +1,246 @@\n+package v1alpha1\n+\n+import (\n+\tcertmanagerv1 \"github.com/cert-manager/cert-manager/pkg/apis/meta/v1\"\n+\n+\tcorev1 \"k8s.io/api/core/v1\"\n+\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n+)\n+\n+func init() {\n+\tSchemeBuilder.Register(&IstioCSR{}, &IstioCSRList{})\n+}\n+\n+// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object\n+//+kubebuilder:object:root=true\n+\n+// IstioCSRList is a list of IstioCSR objects.\n+type IstioCSRList struct {\n+\tmetav1.TypeMeta `json:\",inline\"`\n+\n+\t// metadata is the standard list's metadata.\n+\t// More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata\n+\tmetav1.ListMeta `json:\"metadata\"`\n+\tItems           []IstioCSR `json:\"items\"`\n+}\n+\n+// +genclient\n+// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object\n+// +kubebuilder:subresource:status\n+\n+// IstioCSR describes configuration and information about the managed istio-csr\n+// agent. The name must be `default`.\n+//\n+// When an IstioCSR is created, a new deployment is created which manages the\n+// istio-csr agent and keeps it in the desired state.\n+// +kubebuilder:object:root=true\n+// +kubebuilder:printcolumn:name=\"Age\",type=\"date\",JSONPath=\".metadata.creationTimestamp\"\n+// +kubebuilder:printcolumn:name=\"GRPC Endpoint\",type=\"string\",JSONPath=\".status.istioCSRGRPCEndpoint\"\n+// +kubebuilder:validation:XValidation:rule=\"self.metadata.name == 'default'\",message=\"istiocsr is a singleton, .metadata.name must be 'default'\"\n+// +operator-sdk:csv:customresourcedefinitions:displayName=\"IstioCSR\"\n+type IstioCSR struct {\n+\tmetav1.TypeMeta `json:\",inline\"`\n+\n+\t// metadata is the standard object's metadata.\n+\t// More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata\n+\tmetav1.ObjectMeta `json:\"metadata,omitempty\"`\n+\n+\t// spec is the specification of the desired behavior of the IstioCSR.\n+\tSpec IstioCSRSpec `json:\"spec,omitempty\"`\n+\n+\t// status is the most recently observed status of the IstioCSR.\n+\tStatus IstioCSRStatus `json:\"status,omitempty\"`\n+}\n+\n+// IstioCSRSpec is the specification of the desired behavior of the IstioCSR.\n+type IstioCSRSpec struct {\n+\t// istioCSRConfig is for configuring the istio-csr agent behavior.\n+\tIstioCSRConfig *IstioCSRConfig `json:\"istioCSRConfig,omitempty\"`\n+\n+\t// controllerConfig is for configuring the controller for setting up\n+\t// defaults to enable istio-csr agent.\n+\tControllerConfig *ControllerConfig `json:\"controllerConfig,omitempty\"`\n+}\n+\n+// IstioCSRConfig is for configuring the istio-csr agent behavior.\n+type IstioCSRConfig struct {\n+\t// logLevel is for setting verbosity of istio-csr agent logging.\n+\t// Supported log levels: 1-5.\n+\t// +kubebuilder:default:=1\n+\t// +kubebuilder:validation:Minimum:=1\n+\t// +kubebuilder:validation:Maximum:=5\n+\t// +optional\n+\tLogLevel int32 `json:\"logLevel,omitempty\"`\n+\n+\t// logFormat is for specifying the output format of istio-csr agent logging.\n+\t// Support log formats are text and json.\n+\t// +kubebuilder:default:=text\n+\t// +optional\n+\tLogFormat string `json:\"logFormat,omitempty\"`\n+\n+\t// certmanager is for configuring cert-manager specifics.\n+\t// +required\n+\tCertManager *CertManagerConfig `json:\"certmanager,omitempty\"`\n+\n+\t// istiodTLSConfig is for configuring istiod certificate specifics.\n+\t// +required\n+\tIstiodTLSConfig *IstiodTLSConfig `json:\"istiodTLSConfig,omitempty\"`\n+\n+\t// server is for configuring the server endpoint used by istio\n+\t// for obtaining the certificates.\n+\t// +optional\n+\tServer *ServerConfig `json:\"server,omitempty\"`\n+\n+\t// istio is for configuring the istio specifics.\n+\t// +required\n+\tIstio *IstioConfig `json:\"istio,omitempty\"`\n+\n+\t// resources is for defining the resource requirements.\n+\t// Cannot be updated.\n+\t// ref: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\n+\t// +optional\n+\tResources corev1.ResourceRequirements `json:\"resources,omitempty\"`\n+\n+\t// affinity is for setting scheduling affinity rules.\n+\t// ref: https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/\n+\t// +optional\n+\tAffinity *corev1.Affinity `json:\"affinity,omitempty\"`\n+\n+\t// tolerations is for setting the pod tolerations.\n+\t// ref: https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/\n+\t// +optional\n+\t// +listType=atomic\n+\tTolerations []corev1.Toleration `json:\"tolerations,omitempty\"`\n+\n+\t// nodeSelector is for defining the scheduling criteria using node labels.\n+\t// ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/\n+\t// +optional\n+\t// +mapType=atomic\n+\tNodeSelector map[string]string `json:\"nodeSelector,omitempty\"`\n+}\n+\n+// CertManagerConfig is for configuring cert-manager specifics.\n+// +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.issuerRef) && !has(self.issuerRef) || has(oldSelf.issuerRef) && has(self.issuerRef)\",message=\"issuerRef may only be configured during creation\"\n+type CertManagerConfig struct {\n+\t// issuerRef contains details to the referenced object used for\n+\t// obtaining the certificates. When issuerRef.Kind is Issuer, it must exist in the\n+\t// .spec.istioCSRConfig.istio.namespace.\n+\t// +kubebuilder:validation:XValidation:rule=\"self == oldSelf\",message=\"issuerRef is immutable once set\"\n+\t// +required\n+\tIssuerRef certmanagerv1.ObjectReference `json:\"issuerRef,omitempty\"`\n+}\n+\n+// IstiodTLSConfig is for configuring istiod certificate specifics.\n+// +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.signatureAlgorithm) && !has(self.signatureAlgorithm) || has(oldSelf.signatureAlgorithm) && has(self.signatureAlgorithm)\",message=\"signatureAlgorithm may only be configured during creation\"\n+// +kubebuilder:validation:XValidation:rule=\"!has(oldSelf.privateKeySize) && !has(self.privateKeySize) || has(oldSelf.privateKeySize) && has(self.privateKeySize)\",message=\"privateKeySize may only be configured during creation\"\n+type IstiodTLSConfig struct {\n+\t// commonName is the common name to be set in the certificate.cert-manager.io\n+\t// created for istiod. CommonName will be of the form `istiod.<istio_namespace>.svc`\n+\t// when not set.\n+\t// +optional\n+\tCommonName string `json:\"commonName,omitempty\"`\n+\n+\t// trustDomain is the istio cluster's trust domain, which will also be used for deriving\n+\t// spiffe URI.\n+\t// +required\n+\tTrustDomain string `json:\"trustDomain,omitempty\"`\n+\n+\t// certificateDNSNames contains the additional DNS names to be added to the istiod certificate SAN.\n+\t// +listType=set\n+\t// +optional\n+\tCertificateDNSNames []string `json:\"certificateDNSNames,omitempty\"`\n+\n+\t// certificateDuration is the istio-csr and the istiod certificates validity period.\n+\t// +kubebuilder:default:=\"1h\"\n+\t// +optional\n+\tCertificateDuration *metav1.Duration `json:\"certificateDuration,omitempty\"`\n+\n+\t// certificateRenewBefore is the ahead time to renew the istio-csr and the istiod certificates\n+\t// before expiry.\n+\t// +kubebuilder:default:=\"30m\"\n+\t// +optional\n+\tCertificateRenewBefore *metav1.Duration `json:\"certificateRenewBefore,omitempty\"`\n+\n+\t// privateKeySize is the istio-csr and the istiod certificate's key size. When the SignatureAlgorithm\n+\t// is RSA, must be >= 2048 and for ECDSA, can only be 256 or 384, corresponding to P-256 and P-384 respectively.\n+\t// +kubebuilder:default:=2048\n+\t// +kubebuilder:validation:XValidation:rule=\"oldSelf == 0 || self == oldSelf\",message=\"privateKeySize is immutable once set\"\n+\t// +optional\n+\tPrivateKeySize int `json:\"privateKeySize,omitempty\"`\n+\n+\t// signatureAlgorithm is the signature algorithm to use when generating\n+\t// private keys. At present only RSA and ECDSA are supported.\n+\t// +kubebuilder:default:=\"RSA\"\n+\t// +kubebuilder:validation:Enum:=\"RSA\";\"ECDSA\"\n+\t// +kubebuilder:validation:XValidation:rule=\"oldSelf == '' || self == oldSelf\",message=\"signatureAlgorithm is immutable once set\"\n+\t// +optional\n+\tSignatureAlgorithm string `json:\"signatureAlgorithm,omitempty\"`\n+\n+\t// MaxCertificateDuration is the maximum validity duration that can be\n+\t// requested for a certificate.\n+\t// +kubebuilder:default:=\"1h\"\n+\t// +optional\n+\tMaxCertificateDuration *metav1.Duration `json:\"maxCertificateDuration,omitempty\"`\n+}\n+\n+// ServerConfig is for configuring the server endpoint used by istio\n+// for obtaining the certificates.\n+type ServerConfig struct {\n+\t// port to serve istio-csr gRPC service.\n+\t// +kubebuilder:default:=443\n+\t// +kubebuilder:validation:XValidation:rule=\"oldSelf == 0 || self == oldSelf\",message=\"port is immutable once set\"\n+\t// +optional\n+\tPort int32 `json:\"port,omitempty\"`\n+}\n+\n+// IstioConfig is for configuring the istio specifics.\n+type IstioConfig struct {\n+\t// revisions are the istio revisions that are currently installed in the cluster.\n+\t// Changing this field will modify the DNS names that will be requested for\n+\t// the istiod certificate.\n+\t// +listType=atomic\n+\t// +kubebuilder:default:={\"default\"}\n+\t// +kubebuilder:validation:XValidation:rule=\"self.all(x, x in oldSelf) && oldSelf.all(x, x in self)\",message=\"revisions is immutable once set\"", "path": "api/operator/v1alpha1/istiocsr_types.go", "commit_id": "99f9aa988497bed1935cd580a601a035536c5f4b", "original_commit_id": "fc5bb4bf5113815fc70b0388df0ba505d8d17216", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "> Yes, revisions can only be configured when creating `istiocsr` resource and cannot be modified later. With `MaxItems` set to 10, a user cannot configure more than that, creating the resource would fail when it crosses the defined limit.\r\n\r\nAlright, so my understanding is that user sets these revisions (and not operator added)\r\n- never let user remove an existing one, only append is allowed;\r\n- we're blocking >10.", "created_at": "2024-12-26T19:34:43Z", "updated_at": "2024-12-26T19:34:43Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1898078015", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1898078015"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1898078015"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1898078015/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 230, "original_line": 230, "side": "RIGHT", "in_reply_to_id": 1896803571, "author_association": "MEMBER", "original_position": 203, "position": 230, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 220, "file_path": "hack/update-cert-manager-manifests.sh", "line_start": 41, "line_end": 41, "diff_context": "", "comment_body": "yeah, we want to make sure `make generate` takes care of this. We use [main.jsonnet](https://github.com/openshift/cert-manager-operator/blob/a6b6450ac95558fa0ab02f7f047a6fc4877f01a0/jsonnet/main.jsonnet) for upstream cert-manager manifests exactly for these purposes, so jsonnet/kustomize patches would help.\r\n\r\nI think a combination of `helm --dry-run ...` + a jsonnet patch to filter out whatever isn't required should help here. And, we definitely cannot miss out on automating this, albeit every rebase whatever changes upstream we need to keep our patch(es): jsonnet/kustomize updated accordingly - tsk tsk, but can't help :( ", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1898080604", "pull_request_review_id": 2523445573, "id": 1898080604, "node_id": "PRRC_kwDOFdFn9s5xImlc", "diff_hunk": "@@ -38,7 +38,7 @@ jsonnet \\\n     > _output/targets_as_map.json\n \n # regenerate all bindata\n-rm -rf bindata\n+rm -rf bindata/cert-manager-deployment", "path": "hack/update-cert-manager-manifests.sh", "commit_id": "99f9aa988497bed1935cd580a601a035536c5f4b", "original_commit_id": "fc5bb4bf5113815fc70b0388df0ba505d8d17216", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "yeah, we want to make sure `make generate` takes care of this. We use [main.jsonnet](https://github.com/openshift/cert-manager-operator/blob/a6b6450ac95558fa0ab02f7f047a6fc4877f01a0/jsonnet/main.jsonnet) for upstream cert-manager manifests exactly for these purposes, so jsonnet/kustomize patches would help.\r\n\r\nI think a combination of `helm --dry-run ...` + a jsonnet patch to filter out whatever isn't required should help here. And, we definitely cannot miss out on automating this, albeit every rebase whatever changes upstream we need to keep our patch(es): jsonnet/kustomize updated accordingly - tsk tsk, but can't help :( ", "created_at": "2024-12-26T19:42:27Z", "updated_at": "2024-12-26T19:43:39Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1898080604", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1898080604"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1898080604"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1898080604/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 41, "original_line": 41, "side": "RIGHT", "in_reply_to_id": 1896767120, "author_association": "MEMBER", "original_position": 5, "position": 5, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 220, "file_path": "pkg/operator/setup_manager.go", "line_start": 61, "line_end": null, "diff_context": "", "comment_body": "doesn't seem fine to be using a `istiocsrs` suffix, as what I foresee is that in the future we would want to use controller-runtime for everything scoped under this operator (a very long endevaour rich in efforts which never made its way to reality, but hopefully soon after this..).", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1898083834", "pull_request_review_id": 2523450634, "id": 1898083834, "node_id": "PRRC_kwDOFdFn9s5xInX6", "diff_hunk": "@@ -0,0 +1,94 @@\n+package operator\n+\n+import (\n+\t\"context\"\n+\t\"fmt\"\n+\n+\tappsv1 \"k8s.io/api/apps/v1\"\n+\tcorev1 \"k8s.io/api/core/v1\"\n+\trbacv1 \"k8s.io/api/rbac/v1\"\n+\t\"k8s.io/apimachinery/pkg/runtime\"\n+\tutilruntime \"k8s.io/apimachinery/pkg/util/runtime\"\n+\tclientscheme \"k8s.io/client-go/kubernetes/scheme\"\n+\t\"k8s.io/client-go/rest\"\n+\t\"k8s.io/klog/v2\"\n+\n+\tctrl \"sigs.k8s.io/controller-runtime\"\n+\t\"sigs.k8s.io/controller-runtime/pkg/client\"\n+\t\"sigs.k8s.io/controller-runtime/pkg/healthz\"\n+\tctrllog \"sigs.k8s.io/controller-runtime/pkg/log\"\n+\t\"sigs.k8s.io/controller-runtime/pkg/manager\"\n+\n+\tcertmanagerv1 \"github.com/cert-manager/cert-manager/pkg/apis/certmanager/v1\"\n+\n+\tv1alpha1 \"github.com/openshift/cert-manager-operator/api/operator/v1alpha1\"\n+\t\"github.com/openshift/cert-manager-operator/pkg/controller/istiocsr\"\n+\t\"github.com/openshift/cert-manager-operator/pkg/version\"\n+)\n+\n+var (\n+\tscheme   = runtime.NewScheme()\n+\tsetupLog = ctrl.Log.WithName(\"setup-manager\")\n+)\n+\n+func init() {\n+\tctrllog.SetLogger(klog.NewKlogr())\n+\n+\tutilruntime.Must(clientscheme.AddToScheme(scheme))\n+\tutilruntime.Must(appsv1.AddToScheme(scheme))\n+\tutilruntime.Must(corev1.AddToScheme(scheme))\n+\tutilruntime.Must(rbacv1.AddToScheme(scheme))\n+\tutilruntime.Must(certmanagerv1.AddToScheme(scheme))\n+\tutilruntime.Must(v1alpha1.AddToScheme(scheme))\n+\t// +kubebuilder:scaffold:scheme\n+}\n+\n+// Manager holds the manager resource for the istio-csr controller\n+type Manager struct {\n+\tmanager manager.Manager\n+}\n+\n+// New creates a new manager.\n+func New() (*Manager, error) {\n+\tsetupLog.Info(\"setting up operator manager\", \"controller\", istiocsr.ControllerName)\n+\tsetupLog.Info(\"controller\", \"version\", version.Get())\n+\n+\tmgr, err := ctrl.NewManager(ctrl.GetConfigOrDie(), ctrl.Options{\n+\t\tLogger:                 ctrl.Log.WithName(\"operator manager\"),\n+\t\tScheme:                 scheme,\n+\t\tHealthProbeBindAddress: \":8081\",\n+\t\tLeaderElection:         false,\n+\t\tLeaderElectionID:       \"10c233b5.operator.openshift.io\",", "path": "pkg/operator/setup_manager.go", "commit_id": "99f9aa988497bed1935cd580a601a035536c5f4b", "original_commit_id": "9a3ca2cbbd6161958131d81410cb82237fa0062b", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "doesn't seem fine to be using a `istiocsrs` suffix, as what I foresee is that in the future we would want to use controller-runtime for everything scoped under this operator (a very long endevaour rich in efforts which never made its way to reality, but hopefully soon after this..).", "created_at": "2024-12-26T19:50:38Z", "updated_at": "2024-12-26T19:50:38Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1898083834", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1898083834"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1898083834"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1898083834/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 61, "side": "RIGHT", "in_reply_to_id": 1896799924, "author_association": "MEMBER", "original_position": 61, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 220, "file_path": "pkg/operator/setup_manager.go", "line_start": 61, "line_end": null, "diff_context": "", "comment_body": "More insights would be welcome, just to match you my thoughts:\r\nThe lease here is not controller specific, but specific to the controller-manager (one per operator?). Seemingly, leases are quite important to help avoid reconcile barriers, we don't want to break something later in the lifecycle. \r\n\r\nSay, hypothetically in between an upgrade:\r\n- we've operator v1.18.0 with all stuff based on controller-runtime, using lease:`\"10c233b5.certmanagers.operator.openshift.io\"` and \r\n- old operator version v1.17.0 with lease ` \"10c233b5.istiocsrs.operator.openshift.io\"`\r\n\r\nbut we ought to safely leader elect only one instance of this ever and whenever we default to controller-runtime in such a situation, this won't be able to break the tie atleast for the istio-csr controller's reconciles, maybe for a brief period. ", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1898085710", "pull_request_review_id": 2523453322, "id": 1898085710, "node_id": "PRRC_kwDOFdFn9s5xIn1O", "diff_hunk": "@@ -0,0 +1,94 @@\n+package operator\n+\n+import (\n+\t\"context\"\n+\t\"fmt\"\n+\n+\tappsv1 \"k8s.io/api/apps/v1\"\n+\tcorev1 \"k8s.io/api/core/v1\"\n+\trbacv1 \"k8s.io/api/rbac/v1\"\n+\t\"k8s.io/apimachinery/pkg/runtime\"\n+\tutilruntime \"k8s.io/apimachinery/pkg/util/runtime\"\n+\tclientscheme \"k8s.io/client-go/kubernetes/scheme\"\n+\t\"k8s.io/client-go/rest\"\n+\t\"k8s.io/klog/v2\"\n+\n+\tctrl \"sigs.k8s.io/controller-runtime\"\n+\t\"sigs.k8s.io/controller-runtime/pkg/client\"\n+\t\"sigs.k8s.io/controller-runtime/pkg/healthz\"\n+\tctrllog \"sigs.k8s.io/controller-runtime/pkg/log\"\n+\t\"sigs.k8s.io/controller-runtime/pkg/manager\"\n+\n+\tcertmanagerv1 \"github.com/cert-manager/cert-manager/pkg/apis/certmanager/v1\"\n+\n+\tv1alpha1 \"github.com/openshift/cert-manager-operator/api/operator/v1alpha1\"\n+\t\"github.com/openshift/cert-manager-operator/pkg/controller/istiocsr\"\n+\t\"github.com/openshift/cert-manager-operator/pkg/version\"\n+)\n+\n+var (\n+\tscheme   = runtime.NewScheme()\n+\tsetupLog = ctrl.Log.WithName(\"setup-manager\")\n+)\n+\n+func init() {\n+\tctrllog.SetLogger(klog.NewKlogr())\n+\n+\tutilruntime.Must(clientscheme.AddToScheme(scheme))\n+\tutilruntime.Must(appsv1.AddToScheme(scheme))\n+\tutilruntime.Must(corev1.AddToScheme(scheme))\n+\tutilruntime.Must(rbacv1.AddToScheme(scheme))\n+\tutilruntime.Must(certmanagerv1.AddToScheme(scheme))\n+\tutilruntime.Must(v1alpha1.AddToScheme(scheme))\n+\t// +kubebuilder:scaffold:scheme\n+}\n+\n+// Manager holds the manager resource for the istio-csr controller\n+type Manager struct {\n+\tmanager manager.Manager\n+}\n+\n+// New creates a new manager.\n+func New() (*Manager, error) {\n+\tsetupLog.Info(\"setting up operator manager\", \"controller\", istiocsr.ControllerName)\n+\tsetupLog.Info(\"controller\", \"version\", version.Get())\n+\n+\tmgr, err := ctrl.NewManager(ctrl.GetConfigOrDie(), ctrl.Options{\n+\t\tLogger:                 ctrl.Log.WithName(\"operator manager\"),\n+\t\tScheme:                 scheme,\n+\t\tHealthProbeBindAddress: \":8081\",\n+\t\tLeaderElection:         false,\n+\t\tLeaderElectionID:       \"10c233b5.operator.openshift.io\",", "path": "pkg/operator/setup_manager.go", "commit_id": "99f9aa988497bed1935cd580a601a035536c5f4b", "original_commit_id": "9a3ca2cbbd6161958131d81410cb82237fa0062b", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "More insights would be welcome, just to match you my thoughts:\r\nThe lease here is not controller specific, but specific to the controller-manager (one per operator?). Seemingly, leases are quite important to help avoid reconcile barriers, we don't want to break something later in the lifecycle. \r\n\r\nSay, hypothetically in between an upgrade:\r\n- we've operator v1.18.0 with all stuff based on controller-runtime, using lease:`\"10c233b5.certmanagers.operator.openshift.io\"` and \r\n- old operator version v1.17.0 with lease ` \"10c233b5.istiocsrs.operator.openshift.io\"`\r\n\r\nbut we ought to safely leader elect only one instance of this ever and whenever we default to controller-runtime in such a situation, this won't be able to break the tie atleast for the istio-csr controller's reconciles, maybe for a brief period. ", "created_at": "2024-12-26T19:56:02Z", "updated_at": "2024-12-26T19:57:16Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1898085710", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1898085710"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1898085710"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1898085710/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 61, "side": "RIGHT", "in_reply_to_id": 1896799924, "author_association": "MEMBER", "original_position": 61, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 220, "file_path": "api/operator/v1alpha1/istiocsr_types.go", "line_start": 79, "line_end": 79, "diff_context": "", "comment_body": "yes, we should document it as we already do in https://docs.openshift.com/container-platform/4.17/security/cert_manager_operator/cert-manager-log-levels.html for the cert-manager operand resources.\r\n\r\nFor the other part, I'd prefer keeping the logLevel in the istio_csr resource itself because by design the way everything is implemented/proposed right now it seems to me we should prefer separation of `certmanager.operator.openshift.io` and `istiocsr.openshift.io` in their respective jobs of reconciling their own operand deployments exclusively.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1898087474", "pull_request_review_id": 2523456221, "id": 1898087474, "node_id": "PRRC_kwDOFdFn9s5xIoQy", "diff_hunk": "@@ -0,0 +1,246 @@\n+package v1alpha1\n+\n+import (\n+\tcertmanagerv1 \"github.com/cert-manager/cert-manager/pkg/apis/meta/v1\"\n+\n+\tcorev1 \"k8s.io/api/core/v1\"\n+\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n+)\n+\n+func init() {\n+\tSchemeBuilder.Register(&IstioCSR{}, &IstioCSRList{})\n+}\n+\n+// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object\n+//+kubebuilder:object:root=true\n+\n+// IstioCSRList is a list of IstioCSR objects.\n+type IstioCSRList struct {\n+\tmetav1.TypeMeta `json:\",inline\"`\n+\n+\t// metadata is the standard list's metadata.\n+\t// More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata\n+\tmetav1.ListMeta `json:\"metadata\"`\n+\tItems           []IstioCSR `json:\"items\"`\n+}\n+\n+// +genclient\n+// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object\n+// +kubebuilder:subresource:status\n+\n+// IstioCSR describes configuration and information about the managed istio-csr\n+// agent. The name must be `default`.\n+//\n+// When an IstioCSR is created, a new deployment is created which manages the\n+// istio-csr agent and keeps it in the desired state.\n+// +kubebuilder:object:root=true\n+// +kubebuilder:printcolumn:name=\"Age\",type=\"date\",JSONPath=\".metadata.creationTimestamp\"\n+// +kubebuilder:printcolumn:name=\"GRPC Endpoint\",type=\"string\",JSONPath=\".status.istioCSRGRPCEndpoint\"\n+// +kubebuilder:validation:XValidation:rule=\"self.metadata.name == 'default'\",message=\"istiocsr is a singleton, .metadata.name must be 'default'\"\n+// +operator-sdk:csv:customresourcedefinitions:displayName=\"IstioCSR\"\n+type IstioCSR struct {\n+\tmetav1.TypeMeta `json:\",inline\"`\n+\n+\t// metadata is the standard object's metadata.\n+\t// More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata\n+\tmetav1.ObjectMeta `json:\"metadata,omitempty\"`\n+\n+\t// spec is the specification of the desired behavior of the IstioCSR.\n+\tSpec IstioCSRSpec `json:\"spec,omitempty\"`\n+\n+\t// status is the most recently observed status of the IstioCSR.\n+\tStatus IstioCSRStatus `json:\"status,omitempty\"`\n+}\n+\n+// IstioCSRSpec is the specification of the desired behavior of the IstioCSR.\n+type IstioCSRSpec struct {\n+\t// istioCSRConfig is for configuring the istio-csr agent behavior.\n+\tIstioCSRConfig *IstioCSRConfig `json:\"istioCSRConfig,omitempty\"`\n+\n+\t// controllerConfig is for configuring the controller for setting up\n+\t// defaults to enable istio-csr agent.\n+\tControllerConfig *ControllerConfig `json:\"controllerConfig,omitempty\"`\n+}\n+\n+// IstioCSRConfig is for configuring the istio-csr agent behavior.\n+type IstioCSRConfig struct {\n+\t// logLevel is for setting verbosity of istio-csr agent logging.\n+\t// Supported log levels: 1-5.\n+\t// +kubebuilder:default:=1\n+\t// +kubebuilder:validation:Minimum:=1\n+\t// +kubebuilder:validation:Maximum:=5\n+\t// +optional\n+\tLogLevel int32 `json:\"logLevel,omitempty\"`", "path": "api/operator/v1alpha1/istiocsr_types.go", "commit_id": "99f9aa988497bed1935cd580a601a035536c5f4b", "original_commit_id": "fc5bb4bf5113815fc70b0388df0ba505d8d17216", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "yes, we should document it as we already do in https://docs.openshift.com/container-platform/4.17/security/cert_manager_operator/cert-manager-log-levels.html for the cert-manager operand resources.\r\n\r\nFor the other part, I'd prefer keeping the logLevel in the istio_csr resource itself because by design the way everything is implemented/proposed right now it seems to me we should prefer separation of `certmanager.operator.openshift.io` and `istiocsr.openshift.io` in their respective jobs of reconciling their own operand deployments exclusively.", "created_at": "2024-12-26T20:01:11Z", "updated_at": "2024-12-26T20:01:11Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1898087474", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1898087474"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/220#discussion_r1898087474"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/220"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1898087474/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 79, "original_line": 79, "side": "RIGHT", "in_reply_to_id": 1896802238, "author_association": "MEMBER", "original_position": 73, "position": 79, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 348, "file_path": "api/operator/v1alpha1/certmanager_types.go", "line_start": 258, "line_end": 258, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udfe1 Minor_\n\n**Update the field comment and approve the enum restriction.**\n\nThe comment on line 254 states \"different cert-manager components\" (plural), but the validation now restricts the value to `CoreController` only. The enum change itself correctly implements the PR objective.\n\n\n\n\nApply this diff to update the comment:\n\n```diff\n-\t// ComponentName represents the different cert-manager components that can have network policies applied.\n+\t// ComponentName specifies the cert-manager component for this network policy. Currently, only CoreController is supported.\n \t// +kubebuilder:validation:Enum=CoreController\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n\t// ComponentName specifies the cert-manager component for this network policy. Currently, only CoreController is supported.\n\t// +kubebuilder:validation:Enum=CoreController\n\t// +kubebuilder:validation:Required\n\t// +required\n\tComponentName ComponentName `json:\"componentName\"`\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn api/operator/v1alpha1/certmanager_types.go around lines 254 to 258, the field\ncomment uses plural \"different cert-manager components\" but the enum validation\nnow restricts the value to a single component (`CoreController`); update the\ncomment to singular and reflect that this field represents the specific\ncert-manager component (CoreController) that can have network policies applied,\nand keep the existing kubebuilder enum/required tags as-is.\n```\n\n</details>\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2501967146", "pull_request_review_id": 3432053166, "id": 2501967146, "node_id": "PRRC_kwDOFdFn9s6VIP0q", "diff_hunk": "@@ -252,7 +252,7 @@ type NetworkPolicy struct {\n \tName string `json:\"name\"`\n \n \t// ComponentName represents the different cert-manager components that can have network policies applied.\n-\t// +kubebuilder:validation:Enum=CAInjector;CoreController;Webhook\n+\t// +kubebuilder:validation:Enum=CoreController\n \t// +kubebuilder:validation:Required\n \t// +required\n \tComponentName ComponentName `json:\"componentName\"`", "path": "api/operator/v1alpha1/certmanager_types.go", "commit_id": "322791d6302f27dcd4c13001bff32821634750b1", "original_commit_id": "31b6bf305ffc1e23419848e90ffc6a0bbd139b8d", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udfe1 Minor_\n\n**Update the field comment and approve the enum restriction.**\n\nThe comment on line 254 states \"different cert-manager components\" (plural), but the validation now restricts the value to `CoreController` only. The enum change itself correctly implements the PR objective.\n\n\n\n\nApply this diff to update the comment:\n\n```diff\n-\t// ComponentName represents the different cert-manager components that can have network policies applied.\n+\t// ComponentName specifies the cert-manager component for this network policy. Currently, only CoreController is supported.\n \t// +kubebuilder:validation:Enum=CoreController\n```\n\n<!-- suggestion_start -->\n\n<details>\n<summary>\ud83d\udcdd Committable suggestion</summary>\n\n> \u203c\ufe0f **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n\t// ComponentName specifies the cert-manager component for this network policy. Currently, only CoreController is supported.\n\t// +kubebuilder:validation:Enum=CoreController\n\t// +kubebuilder:validation:Required\n\t// +required\n\tComponentName ComponentName `json:\"componentName\"`\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn api/operator/v1alpha1/certmanager_types.go around lines 254 to 258, the field\ncomment uses plural \"different cert-manager components\" but the enum validation\nnow restricts the value to a single component (`CoreController`); update the\ncomment to singular and reflect that this field represents the specific\ncert-manager component (CoreController) that can have network policies applied,\nand keep the existing kubebuilder enum/required tags as-is.\n```\n\n</details>\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "created_at": "2025-11-07T07:28:11Z", "updated_at": "2025-11-07T07:28:12Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/348#discussion_r2501967146", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/348", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2501967146"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/348#discussion_r2501967146"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/348"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2501967146/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 254, "original_start_line": 254, "start_side": "RIGHT", "line": 258, "original_line": 258, "side": "RIGHT", "author_association": "NONE", "original_position": 8, "position": 8, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 351, "file_path": "test/e2e/utils_test.go", "line_start": 1152, "line_end": 1152, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Verify that the `cfg` variable is properly initialized.**\n\nThe function references a module-level `cfg` variable that is not visible in the provided code. Ensure this variable is initialized in the test suite setup before `execInPod` is called.\n\n\n\nRun the following script to verify the `cfg` variable is defined and initialized:\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Search for cfg variable definition and initialization\nrg -n -C5 'var\\s+cfg\\s+\\*rest\\.Config|cfg\\s*=\\s*.*Config' --type=go test/e2e/\n```\n\nLength of output: 7311\n\n---\n\n[/run_scripts]\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Search for module-level cfg variable declaration and initialization functions\n# Check file beginning and setup functions\nrg -n 'var\\s+cfg|^cfg\\s*=' test/e2e/utils_test.go | head -20\n# Also check for init() and TestMain() functions that might set up cfg\nrg -n -A10 'func (init|TestMain|setUp)' test/e2e/utils_test.go | head -40\n```\n\nLength of output: 0\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Search more broadly for rest.Config in the test file\nrg -n 'rest\\.Config' test/e2e/utils_test.go\n```\n\nLength of output: 0\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Check the top of the test file for variable declarations and imports\nhead -100 test/e2e/utils_test.go\n```\n\nLength of output: 3014\n\n---\n\n[/run_scripts]\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# View the execInPod function and context around it\nsed -n '1110,1160p' test/e2e/utils_test.go\n```\n\nLength of output: 1598\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Search for any cfg variable used at package level or in global scope\nrg -n 'cfg\\s+\\*|cfg\\s*:=' test/e2e/utils_test.go\n```\n\nLength of output: 764\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Check if rest package is imported anywhere\nrg -n 'import.*rest|rest\\.Config' test/e2e/utils_test.go\n```\n\nLength of output: 0\n\n---\n\n\n\n</details>\n\n**The `cfg` variable is undefined and will cause a compilation error.**\n\nLine 1136 references an undefined `cfg` variable. The file does not import the `rest` package, which is required for `*rest.Config` type. The function must either:\n\n1. Pass `cfg` as a parameter to `execInPod`\n2. Obtain the rest config from `kubeClient` (check the k8s.io/client-go API for config extraction)\n3. Import `\"k8s.io/client-go/rest\"` and declare `cfg` as a package-level variable\n\nThe code will not compile in its current state.\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commits bfffadf to 17daecd", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2532989601", "pull_request_review_id": 3471340608, "id": 2532989601, "node_id": "PRRC_kwDOFdFn9s6W-lqh", "diff_hunk": "@@ -1093,3 +1117,449 @@ func resetCertManagerNetworkPolicyState(ctx context.Context, client *certmanoper\n \n \treturn nil\n }\n+\n+// execInPod executes a command in a specific container of a pod and returns the output.\n+func execInPod(ctx context.Context, kubeClient kubernetes.Interface, namespace, podName, containerName string, command ...string) (string, error) {\n+\treq := kubeClient.CoreV1().RESTClient().\n+\t\tPost().\n+\t\tResource(\"pods\").\n+\t\tName(podName).\n+\t\tNamespace(namespace).\n+\t\tSubResource(\"exec\").\n+\t\tVersionedParams(&corev1.PodExecOptions{\n+\t\t\tContainer: containerName,\n+\t\t\tCommand:   command,\n+\t\t\tStdout:    true,\n+\t\t\tStderr:    true,\n+\t\t}, scheme.ParameterCodec)\n+\n+\texec, err := remotecommand.NewSPDYExecutor(cfg, \"POST\", req.URL())\n+\tif err != nil {\n+\t\treturn \"\", fmt.Errorf(\"failed to create executor: %w\", err)\n+\t}\n+\n+\tvar stdout, stderr bytes.Buffer\n+\terr = exec.StreamWithContext(ctx, remotecommand.StreamOptions{\n+\t\tStdout: &stdout,\n+\t\tStderr: &stderr,\n+\t})\n+\tif err != nil {\n+\t\treturn \"\", fmt.Errorf(\"failed to execute command: %w, stderr: %s\", err, stderr.String())\n+\t}\n+\n+\treturn stdout.String(), nil\n+}", "path": "test/e2e/utils_test.go", "commit_id": "6ae5732501b4e577a5d0f4fc3e7f7ec49eeb506f", "original_commit_id": "b1fbf6556fb098f783d346e93e17b3e65d8315ad", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udd34 Critical_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Verify that the `cfg` variable is properly initialized.**\n\nThe function references a module-level `cfg` variable that is not visible in the provided code. Ensure this variable is initialized in the test suite setup before `execInPod` is called.\n\n\n\nRun the following script to verify the `cfg` variable is defined and initialized:\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Search for cfg variable definition and initialization\nrg -n -C5 'var\\s+cfg\\s+\\*rest\\.Config|cfg\\s*=\\s*.*Config' --type=go test/e2e/\n```\n\nLength of output: 7311\n\n---\n\n[/run_scripts]\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Search for module-level cfg variable declaration and initialization functions\n# Check file beginning and setup functions\nrg -n 'var\\s+cfg|^cfg\\s*=' test/e2e/utils_test.go | head -20\n# Also check for init() and TestMain() functions that might set up cfg\nrg -n -A10 'func (init|TestMain|setUp)' test/e2e/utils_test.go | head -40\n```\n\nLength of output: 0\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Search more broadly for rest.Config in the test file\nrg -n 'rest\\.Config' test/e2e/utils_test.go\n```\n\nLength of output: 0\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Check the top of the test file for variable declarations and imports\nhead -100 test/e2e/utils_test.go\n```\n\nLength of output: 3014\n\n---\n\n[/run_scripts]\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# View the execInPod function and context around it\nsed -n '1110,1160p' test/e2e/utils_test.go\n```\n\nLength of output: 1598\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Search for any cfg variable used at package level or in global scope\nrg -n 'cfg\\s+\\*|cfg\\s*:=' test/e2e/utils_test.go\n```\n\nLength of output: 764\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Check if rest package is imported anywhere\nrg -n 'import.*rest|rest\\.Config' test/e2e/utils_test.go\n```\n\nLength of output: 0\n\n---\n\n\n\n</details>\n\n**The `cfg` variable is undefined and will cause a compilation error.**\n\nLine 1136 references an undefined `cfg` variable. The file does not import the `rest` package, which is required for `*rest.Config` type. The function must either:\n\n1. Pass `cfg` as a parameter to `execInPod`\n2. Obtain the rest config from `kubeClient` (check the k8s.io/client-go API for config extraction)\n3. Import `\"k8s.io/client-go/rest\"` and declare `cfg` as a package-level variable\n\nThe code will not compile in its current state.\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commits bfffadf to 17daecd", "created_at": "2025-11-17T07:29:07Z", "updated_at": "2025-11-17T08:11:16Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/351#discussion_r2532989601", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/351", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2532989601"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/351#discussion_r2532989601"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/351"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2532989601/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 1122, "original_start_line": 1121, "start_side": "RIGHT", "line": 1152, "original_line": 1152, "side": "RIGHT", "author_association": "NONE", "original_position": 95, "position": 96, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 351, "file_path": "test/e2e/testdata/vault/helm-values.yaml", "line_start": 13, "line_end": null, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udfe0 Major_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Verify that the Vault image version is current and secure.**\n\nEnsure the Vault version 1.19.0 is appropriate and has no known security vulnerabilities.\n\n---\n\n\ud83c\udf10 Web query:\n\n```web\nWhat is the latest version of HashiCorp Vault and are there any security advisories for version 1.19.0?\n```\n\n\ud83d\udca1 Result:\n\n- Latest stable Vault (official downloads page): 1.21.0. [1]\n\n- Security advisories/known issues affecting 1.19.0:\n  - HCSEC-2025-07 / CVE-2025-3879: Azure auth bound_location could be bypassed. Fixed in 1.19.1 (and corresponding enterprise patches). If you run 1.19.0 you should upgrade to \u22651.19.1. [2]\n  - Autorotation bug: versions 1.16.16, 1.17.12, 1.18.5 and 1.19.0+ had a known issue that could auto-rotate LDAP and static database roles on upgrade; later 1.19.x patches address this\u2014check release notes before upgrading. [3][4]\n  - CVE-2025-4656 (rekey/recovery key cancellation DoS): affects 1.19.0 through 1.19.5 and was fixed in 1.19.6 / 1.20.0 (see advisories/patches). If you run 1.19.0, upgrade to a patched 1.19.x or 1.20.x. [5]\n\nIf you want, I can link the official HashiCorp release notes and advisories for each patch version and recommend the minimal patched version to upgrade to. \n\nSources:\n[1] HashiCorp Vault downloads (latest listing).  \n[2] HCSEC-2025-07 discussion / advisory (Azure auth bound_location) \u2014 HashiCorp.  \n[3] Vault release notifications (1.19.0 announcement).  \n[4] Vault release notifications (1.19.1 / 1.19.2 describing autorotation fix).  \n[5] CVE-2025-4656 advisory / NVD summary (fixes and affected ranges).\n\n---\n\n\n\n</details>\n\n**Update Vault image to a patched version\u20141.19.0 contains known security vulnerabilities.**\n\nVersion 1.19.0 is affected by HCSEC-2025-07 / CVE-2025-3879 (Azure auth bound_location bypass, fixed in 1.19.1) and CVE-2025-4656 (rekey/recovery key cancellation DoS, fixed in 1.19.6 / 1.20.0). The latest stable version is 1.21.0. Upgrade to at least 1.19.6 or a later stable version to address these vulnerabilities.\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn test/e2e/testdata/vault/helm-values.yaml around lines 11 to 13, the Vault\nimage tag is pinned to 1.19.0 which contains known security vulnerabilities;\nupdate the tag to a patched release (minimum 1.19.6) or preferably the current\nstable 1.21.0. Modify the image.tag value accordingly, run any local chart\nlinting or helm template to validate the change, and ensure any CI/test fixture\nreferences are updated so tests pull the patched image.\n```\n\n</details>\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2533106113", "pull_request_review_id": 3471486917, "id": 2533106113, "node_id": "PRRC_kwDOFdFn9s6W_CHB", "diff_hunk": "@@ -0,0 +1,40 @@\n+# xref: https://developer.hashicorp.com/vault/docs/platform/k8s/helm/examples/standalone-tls#3-helm-configuration Configurations to setup a TLS-protected Vault server\n+# xref: https://github.com/hashicorp/vault-helm/blob/main/values.yaml All available parameters and default values for the Vault chart.\n+# Set 'server.dataStorage.size' to 1Gi as the default 10Gi is too expensive and unnecessary for testing propose in CI.\n+global:\n+  enabled: true\n+  tlsDisable: false\n+  openshift: true\n+injector:\n+  enabled: false\n+server:\n+  image:\n+    repository: \"quay.io/openshifttest/vault\"\n+    tag: \"1.19.0\"", "path": "test/e2e/testdata/vault/helm-values.yaml", "commit_id": "03a9a6e2e940900ecf683972471782b4137a1928", "original_commit_id": "17daecd667c7af32c741a77d0423562f99f88e0b", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udfe0 Major_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Verify that the Vault image version is current and secure.**\n\nEnsure the Vault version 1.19.0 is appropriate and has no known security vulnerabilities.\n\n---\n\n\ud83c\udf10 Web query:\n\n```web\nWhat is the latest version of HashiCorp Vault and are there any security advisories for version 1.19.0?\n```\n\n\ud83d\udca1 Result:\n\n- Latest stable Vault (official downloads page): 1.21.0. [1]\n\n- Security advisories/known issues affecting 1.19.0:\n  - HCSEC-2025-07 / CVE-2025-3879: Azure auth bound_location could be bypassed. Fixed in 1.19.1 (and corresponding enterprise patches). If you run 1.19.0 you should upgrade to \u22651.19.1. [2]\n  - Autorotation bug: versions 1.16.16, 1.17.12, 1.18.5 and 1.19.0+ had a known issue that could auto-rotate LDAP and static database roles on upgrade; later 1.19.x patches address this\u2014check release notes before upgrading. [3][4]\n  - CVE-2025-4656 (rekey/recovery key cancellation DoS): affects 1.19.0 through 1.19.5 and was fixed in 1.19.6 / 1.20.0 (see advisories/patches). If you run 1.19.0, upgrade to a patched 1.19.x or 1.20.x. [5]\n\nIf you want, I can link the official HashiCorp release notes and advisories for each patch version and recommend the minimal patched version to upgrade to. \n\nSources:\n[1] HashiCorp Vault downloads (latest listing).  \n[2] HCSEC-2025-07 discussion / advisory (Azure auth bound_location) \u2014 HashiCorp.  \n[3] Vault release notifications (1.19.0 announcement).  \n[4] Vault release notifications (1.19.1 / 1.19.2 describing autorotation fix).  \n[5] CVE-2025-4656 advisory / NVD summary (fixes and affected ranges).\n\n---\n\n\n\n</details>\n\n**Update Vault image to a patched version\u20141.19.0 contains known security vulnerabilities.**\n\nVersion 1.19.0 is affected by HCSEC-2025-07 / CVE-2025-3879 (Azure auth bound_location bypass, fixed in 1.19.1) and CVE-2025-4656 (rekey/recovery key cancellation DoS, fixed in 1.19.6 / 1.20.0). The latest stable version is 1.21.0. Upgrade to at least 1.19.6 or a later stable version to address these vulnerabilities.\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn test/e2e/testdata/vault/helm-values.yaml around lines 11 to 13, the Vault\nimage tag is pinned to 1.19.0 which contains known security vulnerabilities;\nupdate the tag to a patched release (minimum 1.19.6) or preferably the current\nstable 1.21.0. Modify the image.tag value accordingly, run any local chart\nlinting or helm template to validate the change, and ensure any CI/test fixture\nreferences are updated so tests pull the patched image.\n```\n\n</details>\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "created_at": "2025-11-17T08:17:03Z", "updated_at": "2025-11-17T08:20:31Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/351#discussion_r2533106113", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/351", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2533106113"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/351#discussion_r2533106113"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/351"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2533106113/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 11, "start_side": "RIGHT", "line": null, "original_line": 13, "side": "RIGHT", "author_association": "NONE", "original_position": 13, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 351, "file_path": "test/e2e/testdata/vault/helm-values.yaml", "line_start": 13, "line_end": null, "diff_context": "", "comment_body": "@lunarwhite Understood! For isolated e2e test environments, maintaining the absolute latest Vault version is less critical than in production deployments. I'll note this preference going forward.\n\n---\n\n**\ud83d\udc07 Learnings added:**\n```\nLearnt from: lunarwhite\nPR: openshift/cert-manager-operator#351\nFile: test/e2e/testdata/vault/helm-values.yaml:11-13\nTimestamp: 2025-11-17T04:52:14.123Z\nLearning: For e2e integration tests in the openshift/cert-manager-operator repository, it's not necessary to strictly maintain the latest version of Vault or flag non-critical security advisories for test-only images.\n```\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2533116698", "pull_request_review_id": 3471502264, "id": 2533116698, "node_id": "PRRC_kwDOFdFn9s6W_Esa", "diff_hunk": "@@ -0,0 +1,40 @@\n+# xref: https://developer.hashicorp.com/vault/docs/platform/k8s/helm/examples/standalone-tls#3-helm-configuration Configurations to setup a TLS-protected Vault server\n+# xref: https://github.com/hashicorp/vault-helm/blob/main/values.yaml All available parameters and default values for the Vault chart.\n+# Set 'server.dataStorage.size' to 1Gi as the default 10Gi is too expensive and unnecessary for testing propose in CI.\n+global:\n+  enabled: true\n+  tlsDisable: false\n+  openshift: true\n+injector:\n+  enabled: false\n+server:\n+  image:\n+    repository: \"quay.io/openshifttest/vault\"\n+    tag: \"1.19.0\"", "path": "test/e2e/testdata/vault/helm-values.yaml", "commit_id": "03a9a6e2e940900ecf683972471782b4137a1928", "original_commit_id": "17daecd667c7af32c741a77d0423562f99f88e0b", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "@lunarwhite Understood! For isolated e2e test environments, maintaining the absolute latest Vault version is less critical than in production deployments. I'll note this preference going forward.\n\n---\n\n**\ud83d\udc07 Learnings added:**\n```\nLearnt from: lunarwhite\nPR: openshift/cert-manager-operator#351\nFile: test/e2e/testdata/vault/helm-values.yaml:11-13\nTimestamp: 2025-11-17T04:52:14.123Z\nLearning: For e2e integration tests in the openshift/cert-manager-operator repository, it's not necessary to strictly maintain the latest version of Vault or flag non-critical security advisories for test-only images.\n```\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "created_at": "2025-11-17T08:20:54Z", "updated_at": "2025-11-17T08:20:54Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/351#discussion_r2533116698", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/351", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2533116698"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/351#discussion_r2533116698"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/351"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2533116698/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 11, "start_side": "RIGHT", "line": null, "original_line": 13, "side": "RIGHT", "in_reply_to_id": 2533106113, "author_association": "NONE", "original_position": 13, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 351, "file_path": "test/e2e/testdata/vault/helm-values.yaml", "line_start": 12, "line_end": null, "diff_context": "", "comment_body": "nit: why are we not using the upstream image? or can't we use the community operator from catalog instead?", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2548805345", "pull_request_review_id": 3491517614, "id": 2548805345, "node_id": "PRRC_kwDOFdFn9s6X667h", "diff_hunk": "@@ -0,0 +1,40 @@\n+# xref: https://developer.hashicorp.com/vault/docs/platform/k8s/helm/examples/standalone-tls#3-helm-configuration Configurations to setup a TLS-protected Vault server\n+# xref: https://github.com/hashicorp/vault-helm/blob/main/values.yaml All available parameters and default values for the Vault chart.\n+# Set 'server.dataStorage.size' to 1Gi as the default 10Gi is too expensive and unnecessary for testing propose in CI.\n+global:\n+  enabled: true\n+  tlsDisable: false\n+  openshift: true\n+injector:\n+  enabled: false\n+server:\n+  image:\n+    repository: \"quay.io/openshifttest/vault\"", "path": "test/e2e/testdata/vault/helm-values.yaml", "commit_id": "03a9a6e2e940900ecf683972471782b4137a1928", "original_commit_id": "17daecd667c7af32c741a77d0423562f99f88e0b", "user": {"login": "bharath-b-rh", "id": 92782575, "node_id": "U_kgDOBYe_7w", "avatar_url": "https://avatars.githubusercontent.com/u/92782575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bharath-b-rh", "html_url": "https://github.com/bharath-b-rh", "followers_url": "https://api.github.com/users/bharath-b-rh/followers", "following_url": "https://api.github.com/users/bharath-b-rh/following{/other_user}", "gists_url": "https://api.github.com/users/bharath-b-rh/gists{/gist_id}", "starred_url": "https://api.github.com/users/bharath-b-rh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bharath-b-rh/subscriptions", "organizations_url": "https://api.github.com/users/bharath-b-rh/orgs", "repos_url": "https://api.github.com/users/bharath-b-rh/repos", "events_url": "https://api.github.com/users/bharath-b-rh/events{/privacy}", "received_events_url": "https://api.github.com/users/bharath-b-rh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "nit: why are we not using the upstream image? or can't we use the community operator from catalog instead?", "created_at": "2025-11-21T07:29:40Z", "updated_at": "2025-11-21T07:31:12Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/351#discussion_r2548805345", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/351", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2548805345"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/351#discussion_r2548805345"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/351"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2548805345/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 12, "side": "RIGHT", "author_association": "MEMBER", "original_position": 12, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 351, "file_path": "test/e2e/issuer_vault_test.go", "line_start": 35, "line_end": 35, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udfe1 Minor_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Verify the Vault auth path format is correct for cert-manager.**\n\nThe constants `vaultAuthPathKubernetes` and `vaultAuthPathJWT` include the `/v1/auth/` prefix. Typically, cert-manager Issuer specs expect just the mount path (e.g., `kubernetes` or `jwt`), not the full API path with `/v1/auth/` prefix.\n\n\n\nRun the following script to check cert-manager's expected format:\n\n\n\nAlso verify in cert-manager documentation whether the Path field should include `/v1/auth/`:\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Check how Path is used in VaultKubernetesAuth in the cert-manager API\nast-grep --pattern 'type VaultKubernetesAuth struct {\n  $$$\n  Path string\n  $$$\n}'\n```\n\nLength of output: 0\n\n---\n\n\ud83c\udf10 Web query:\n\n```web\ncert-manager Vault Issuer Path field format for Kubernetes authentication\n```\n\n\ud83d\udca1 Result:\n\nUse the Vault auth mount name or the full Vault API mount path. cert-manager will call the Vault login endpoint at /v1/auth/<mount>/login, so you can set:\n\n- mountPath: kubernetes\nor\n- mountPath: /v1/auth/kubernetes\n\nIf you omit mountPath it defaults to \"kubernetes\". Example: mountPath: /v1/auth/jwt-cluster001 or mountPath: /v1/auth/kubernetes. [1][2]\n\nSources:\n[1] cert-manager Vault docs \u2014 examples showing mountPath and default.  \n[2] cert-manager docs (Authenticating with Kubernetes Service Accounts) showing mountPath usage.\n\n---\n\n```\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Find all usages of vaultAuthPathKubernetes and vaultAuthPathJWT constants\nrg -n 'vaultAuthPath(Kubernetes|JWT)' test/e2e/issuer_vault_test.go -A 2 -B 2\n```\n\nLength of output: 962\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Also search for any Issuer creation with these auth paths\nrg -n 'Path.*:' test/e2e/issuer_vault_test.go -A 1 -B 1 | head -50\n```\n\nLength of output: 548\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Check the file structure around those constants\ncat test/e2e/issuer_vault_test.go | head -60\n```\n\nLength of output: 1714\n\n---\n\n\n\n</details>\n\n**Address inconsistency in Vault authentication path formats.**\n\nThe web search confirms that cert-manager's official documentation explicitly allows both the mount name format (`kubernetes`, `jwt`) and the full API path format (`/v1/auth/kubernetes`, `/v1/auth/jwt`), so the constants are valid.\n\nHowever, there is an inconsistency in the test file: `vaultAuthPathAppRole` is defined as `\"approle\"` (mount name only), while `vaultAuthPathKubernetes` and `vaultAuthPathJWT` use the full `/v1/auth/` prefix. For consistency, all three should follow the same format pattern.\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn test/e2e/issuer_vault_test.go around lines 32 to 35, the three Vault auth\npath constants are inconsistent: approle is \"approle\" while kubernetes and jwt\nuse \"/v1/auth/...\" \u2014 make them consistent by changing vaultAuthPathAppRole to\nthe same full API path format (e.g., \"/v1/auth/approle\"); update any test\nreferences if needed to use the new constant.\n```\n\n</details>\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2548951820", "pull_request_review_id": 3491701801, "id": 2548951820, "node_id": "PRRC_kwDOFdFn9s6X7esM", "diff_hunk": "@@ -0,0 +1,547 @@\n+//go:build e2e\n+// +build e2e\n+\n+package e2e\n+\n+import (\n+\t\"context\"\n+\t\"fmt\"\n+\t\"log\"\n+\t\"strings\"\n+\n+\tcorev1 \"k8s.io/api/core/v1\"\n+\trbacv1 \"k8s.io/api/rbac/v1\"\n+\tapierrors \"k8s.io/apimachinery/pkg/api/errors\"\n+\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n+\n+\tcertmanagerv1 \"github.com/cert-manager/cert-manager/pkg/apis/certmanager/v1\"\n+\tcertmanagermetav1 \"github.com/cert-manager/cert-manager/pkg/apis/meta/v1\"\n+\t\"github.com/tidwall/gjson\"\n+\n+\t. \"github.com/onsi/ginkgo/v2\"\n+\t. \"github.com/onsi/gomega\"\n+)\n+\n+const (\n+\t// Vault server configuration\n+\tvaultCASecretName     = \"vault-server-tls\"\n+\tvaultPKISignPath      = \"pki_int/sign/cluster-dot-local\"\n+\tvaultKubernetesHost   = \"https://kubernetes.default.svc\"\n+\tvaultServiceAccountCA = \"/var/run/secrets/kubernetes.io/serviceaccount/ca.crt\"\n+\n+\t// Vault authentication paths\n+\tvaultAuthPathAppRole    = \"approle\"\n+\tvaultAuthPathKubernetes = \"/v1/auth/kubernetes\"\n+\tvaultAuthPathJWT        = \"/v1/auth/jwt\"", "path": "test/e2e/issuer_vault_test.go", "commit_id": "6ae5732501b4e577a5d0f4fc3e7f7ec49eeb506f", "original_commit_id": "03a9a6e2e940900ecf683972471782b4137a1928", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_ | _\ud83d\udfe1 Minor_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Verify the Vault auth path format is correct for cert-manager.**\n\nThe constants `vaultAuthPathKubernetes` and `vaultAuthPathJWT` include the `/v1/auth/` prefix. Typically, cert-manager Issuer specs expect just the mount path (e.g., `kubernetes` or `jwt`), not the full API path with `/v1/auth/` prefix.\n\n\n\nRun the following script to check cert-manager's expected format:\n\n\n\nAlso verify in cert-manager documentation whether the Path field should include `/v1/auth/`:\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Check how Path is used in VaultKubernetesAuth in the cert-manager API\nast-grep --pattern 'type VaultKubernetesAuth struct {\n  $$$\n  Path string\n  $$$\n}'\n```\n\nLength of output: 0\n\n---\n\n\ud83c\udf10 Web query:\n\n```web\ncert-manager Vault Issuer Path field format for Kubernetes authentication\n```\n\n\ud83d\udca1 Result:\n\nUse the Vault auth mount name or the full Vault API mount path. cert-manager will call the Vault login endpoint at /v1/auth/<mount>/login, so you can set:\n\n- mountPath: kubernetes\nor\n- mountPath: /v1/auth/kubernetes\n\nIf you omit mountPath it defaults to \"kubernetes\". Example: mountPath: /v1/auth/jwt-cluster001 or mountPath: /v1/auth/kubernetes. [1][2]\n\nSources:\n[1] cert-manager Vault docs \u2014 examples showing mountPath and default.  \n[2] cert-manager docs (Authenticating with Kubernetes Service Accounts) showing mountPath usage.\n\n---\n\n```\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Find all usages of vaultAuthPathKubernetes and vaultAuthPathJWT constants\nrg -n 'vaultAuthPath(Kubernetes|JWT)' test/e2e/issuer_vault_test.go -A 2 -B 2\n```\n\nLength of output: 962\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Also search for any Issuer creation with these auth paths\nrg -n 'Path.*:' test/e2e/issuer_vault_test.go -A 1 -B 1 | head -50\n```\n\nLength of output: 548\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\n# Check the file structure around those constants\ncat test/e2e/issuer_vault_test.go | head -60\n```\n\nLength of output: 1714\n\n---\n\n\n\n</details>\n\n**Address inconsistency in Vault authentication path formats.**\n\nThe web search confirms that cert-manager's official documentation explicitly allows both the mount name format (`kubernetes`, `jwt`) and the full API path format (`/v1/auth/kubernetes`, `/v1/auth/jwt`), so the constants are valid.\n\nHowever, there is an inconsistency in the test file: `vaultAuthPathAppRole` is defined as `\"approle\"` (mount name only), while `vaultAuthPathKubernetes` and `vaultAuthPathJWT` use the full `/v1/auth/` prefix. For consistency, all three should follow the same format pattern.\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn test/e2e/issuer_vault_test.go around lines 32 to 35, the three Vault auth\npath constants are inconsistent: approle is \"approle\" while kubernetes and jwt\nuse \"/v1/auth/...\" \u2014 make them consistent by changing vaultAuthPathAppRole to\nthe same full API path format (e.g., \"/v1/auth/approle\"); update any test\nreferences if needed to use the new constant.\n```\n\n</details>\n\n<!-- This is an auto-generated comment by CodeRabbit -->", "created_at": "2025-11-21T08:35:40Z", "updated_at": "2025-11-21T08:35:41Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/351#discussion_r2548951820", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/351", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2548951820"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/351#discussion_r2548951820"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/351"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2548951820/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 32, "original_start_line": 32, "start_side": "RIGHT", "line": 35, "original_line": 35, "side": "RIGHT", "author_association": "NONE", "original_position": 35, "position": 35, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 351, "file_path": "test/e2e/utils_test.go", "line_start": 1417, "line_end": 1417, "diff_context": "", "comment_body": "_\ud83d\udee0\ufe0f Refactor suggestion_ | _\ud83d\udfe0 Major_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Verify that cluster-admin role is necessary for Helm installation.**\n\nThe ClusterRoleBinding grants `cluster-admin` to the Vault installer ServiceAccount. While this simplifies the test setup, it's very permissive. Consider whether a more restrictive set of permissions would suffice for the Helm chart installation.\n\n\n\nReview the Vault Helm chart to determine the minimum required permissions:\n\n---\n\n\ud83c\udf10 Web query:\n\n```web\nHashiCorp Vault Helm chart required RBAC permissions\n```\n\n\ud83d\udca1 Result:\n\nShort summary \u2014 Vault Helm chart RBAC needs (common/required):\n\n- ServiceAccount used by Vault server: permission to create serviceaccount tokens (serviceaccounts/token:create) \u2014 used for long-lived or projected tokens / AWS/GCP auto-unseal etc. [1][2]\n\n- Injector (vault-k8s) ClusterRole: permissions to manage mutating webhooks and admission resources (admissionregistration.k8s.io: mutatingwebhookconfigurations), read pods/nodes, manage ConfigMaps (chart recently added delete configmaps), and other typical webhook/controller verbs (get/list/watch/patch/create/delete as required). See chart release notes for exact permission additions. [3][4]\n\n- CSI / Secrets Operator components: their own Roles/ClusterRoles to manage Secrets Store CSI resources, CSIDriver, Secrets, ServiceAccounts, RoleBindings/ClusterRoleBindings per component configuration. Refer to the chart docs for each subchart. [1][5]\n\nWhere to find the exact, up-to-date rules:\n- Official Vault Helm chart docs (usage & RBAC notes). [1]\n- Vault Helm GitHub repository (templates/ folder contains ClusterRole/Role YAMLs for server, injector, csi, operator \u2014 inspect the chart version you plan to install). [4]\n- Release notes / changelog (calls out RBAC changes like \u201cadd missing get nodes\u201d and \u201cinjector: add RBAC for deleting configmaps\u201d). [3]\n\nIf you want, I can fetch and paste the exact ClusterRole/Role YAML for a specific chart version (e.g., v0.31.0 or v0.30.0). References:\n[1] HashiCorp Vault \u2014 Helm chart docs.  \n[2] Kubernetes serviceaccount token example / minimal ClusterRole for token creation.  \n[3] hashicorp/vault-helm release notes (RBAC changes).  \n[4] hashicorp/vault-helm GitHub (templates directory).  \n[5] Vault Secrets Operator installation docs.\n\n---\n\n\n\n</details>\n\n**Reduce installer ServiceAccount privileges; cluster-admin is not required.**\n\nThe web search confirms that Vault Helm chart components require specific, scoped permissions rather than cluster-admin. The exact requirements depend on which chart components are enabled (server, injector, CSI, secrets operator), but the official Vault Helm chart documentation and GitHub repository contain the exact ClusterRole/Role definitions for each component.\n\nFor the Helm installer to deploy the chart, create a ClusterRole with only the necessary permissions to create the resources the Vault chart produces (ClusterRoles, ClusterRoleBindings, MutatingWebhookConfigurations, Deployments, Services, etc.). This aligns the test setup with least-privilege security practices and more accurately reflects what production helm installations require.\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2548951828", "pull_request_review_id": 3491701801, "id": 2548951828, "node_id": "PRRC_kwDOFdFn9s6X7esU", "diff_hunk": "@@ -1093,3 +1118,450 @@ func resetCertManagerNetworkPolicyState(ctx context.Context, client *certmanoper\n \n \treturn nil\n }\n+\n+// execInPod executes a command in a specific container of a pod and returns the output.\n+func execInPod(ctx context.Context, cfg *rest.Config, kubeClient kubernetes.Interface, namespace, podName, containerName string, command ...string) (string, error) {\n+\treq := kubeClient.CoreV1().RESTClient().\n+\t\tPost().\n+\t\tResource(\"pods\").\n+\t\tName(podName).\n+\t\tNamespace(namespace).\n+\t\tSubResource(\"exec\").\n+\t\tVersionedParams(&corev1.PodExecOptions{\n+\t\t\tContainer: containerName,\n+\t\t\tCommand:   command,\n+\t\t\tStdout:    true,\n+\t\t\tStderr:    true,\n+\t\t}, scheme.ParameterCodec)\n+\n+\texec, err := remotecommand.NewSPDYExecutor(cfg, \"POST\", req.URL())\n+\tif err != nil {\n+\t\treturn \"\", fmt.Errorf(\"failed to create executor: %w\", err)\n+\t}\n+\n+\tvar stdout, stderr bytes.Buffer\n+\terr = exec.StreamWithContext(ctx, remotecommand.StreamOptions{\n+\t\tStdout: &stdout,\n+\t\tStderr: &stderr,\n+\t})\n+\tif err != nil {\n+\t\treturn \"\", fmt.Errorf(\"failed to execute command: %w, stderr: %s\", err, stderr.String())\n+\t}\n+\n+\treturn stdout.String(), nil\n+}\n+\n+// createCertificateForVaultServer creates a self-signed certificate for Vault HTTPS server.\n+func createCertificateForVaultServer(ctx context.Context, certmanagerClient *certmanagerclientset.Clientset, namespace, vaultServiceName string) error {\n+\t// Create self-signed ClusterIssuer for Vault\n+\tclusterIssuerName := \"vault-selfsigned-issuer\"\n+\tclusterIssuer := &cmv1.ClusterIssuer{\n+\t\tObjectMeta: metav1.ObjectMeta{\n+\t\t\tName: clusterIssuerName,\n+\t\t},\n+\t\tSpec: cmv1.IssuerSpec{\n+\t\t\tIssuerConfig: cmv1.IssuerConfig{\n+\t\t\t\tSelfSigned: &cmv1.SelfSignedIssuer{},\n+\t\t\t},\n+\t\t},\n+\t}\n+\t_, err := certmanagerClient.CertmanagerV1().ClusterIssuers().Create(ctx, clusterIssuer, metav1.CreateOptions{})\n+\tif err != nil && !apierrors.IsAlreadyExists(err) {\n+\t\treturn fmt.Errorf(\"failed to create ClusterIssuer: %w\", err)\n+\t}\n+\n+\t// Wait for ClusterIssuer to become ready\n+\terr = wait.PollUntilContextTimeout(ctx, fastPollInterval, lowTimeout, true,\n+\t\tfunc(context.Context) (bool, error) {\n+\t\t\tissuer, err := certmanagerClient.CertmanagerV1().ClusterIssuers().Get(ctx, clusterIssuerName, metav1.GetOptions{})\n+\t\t\tif err != nil {\n+\t\t\t\treturn false, nil\n+\t\t\t}\n+\t\t\tfor _, cond := range issuer.Status.Conditions {\n+\t\t\t\tif cond.Type == cmv1.IssuerConditionReady {\n+\t\t\t\t\treturn cond.Status == cmmetav1.ConditionTrue, nil\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\treturn false, nil\n+\t\t},\n+\t)\n+\tif err != nil {\n+\t\treturn fmt.Errorf(\"ClusterIssuer not ready: %w\", err)\n+\t}\n+\n+\t// Create certificate for Vault server\n+\tcertName := \"vault-server-cert\"\n+\tcert := &cmv1.Certificate{\n+\t\tObjectMeta: metav1.ObjectMeta{\n+\t\t\tName:      certName,\n+\t\t\tNamespace: namespace,\n+\t\t},\n+\t\tSpec: cmv1.CertificateSpec{\n+\t\t\tSecretName: \"vault-server-tls\",\n+\t\t\tCommonName: vaultServiceName,\n+\t\t\tDNSNames: []string{\n+\t\t\t\t\"vault\",\n+\t\t\t\tfmt.Sprintf(\"%s.%s.svc\", vaultServiceName, namespace),\n+\t\t\t\tfmt.Sprintf(\"%s.%s.svc.cluster.local\", vaultServiceName, namespace),\n+\t\t\t},\n+\t\t\tIPAddresses: []string{\n+\t\t\t\t\"127.0.0.1\",\n+\t\t\t},\n+\t\t\tIssuerRef: cmmetav1.ObjectReference{\n+\t\t\t\tName: clusterIssuerName,\n+\t\t\t\tKind: \"ClusterIssuer\",\n+\t\t\t},\n+\t\t},\n+\t}\n+\t_, err = certmanagerClient.CertmanagerV1().Certificates(namespace).Create(ctx, cert, metav1.CreateOptions{})\n+\tif err != nil && !apierrors.IsAlreadyExists(err) {\n+\t\treturn fmt.Errorf(\"failed to create Certificate: %w\", err)\n+\t}\n+\n+\t// Wait for certificate to become ready\n+\terr = wait.PollUntilContextTimeout(ctx, slowPollInterval, highTimeout, true,\n+\t\tfunc(context.Context) (bool, error) {\n+\t\t\tcertificate, err := certmanagerClient.CertmanagerV1().Certificates(namespace).Get(ctx, certName, metav1.GetOptions{})\n+\t\t\tif err != nil {\n+\t\t\t\treturn false, nil\n+\t\t\t}\n+\t\t\tfor _, cond := range certificate.Status.Conditions {\n+\t\t\t\tif cond.Type == cmv1.CertificateConditionReady {\n+\t\t\t\t\treturn cond.Status == cmmetav1.ConditionTrue, nil\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\treturn false, nil\n+\t\t},\n+\t)\n+\tif err != nil {\n+\t\treturn fmt.Errorf(\"Certificate not ready: %w\", err)\n+\t}\n+\n+\treturn nil\n+}\n+\n+// configureVaultPKI configures Vault PKI secrets engine for certificate issuance.\n+func configureVaultPKI(ctx context.Context, cfg *rest.Config, loader library.DynamicResourceLoader, namespace, vaultPodName, rootToken string) error {\n+\tkubeClient := loader.KubeClient\n+\n+\t// Set VAULT_TOKEN environment variable for subsequent commands\n+\ttokenEnv := fmt.Sprintf(\"export VAULT_TOKEN=%s\", rootToken)\n+\n+\t// Enable and configure root PKI engine\n+\tcommands := []struct {\n+\t\tdescription string\n+\t\tcmd         string\n+\t}{\n+\t\t{\n+\t\t\t\"enable PKI secrets engine\",\n+\t\t\ttokenEnv + \" && vault secrets enable pki\",\n+\t\t},\n+\t\t{\n+\t\t\t\"tune PKI max lease TTL\",\n+\t\t\ttokenEnv + \" && vault secrets tune -max-lease-ttl=8760h pki\",\n+\t\t},\n+\t\t{\n+\t\t\t\"generate root CA\",\n+\t\t\ttokenEnv + \" && vault write pki/root/generate/internal common_name=cluster.local ttl=8760h\",\n+\t\t},\n+\t\t{\n+\t\t\t\"configure CA and CRL URLs\",\n+\t\t\ttokenEnv + \" && vault write pki/config/urls issuing_certificates=\\\"https://vault:8200/v1/pki/ca\\\" crl_distribution_points=\\\"https://vault:8200/v1/pki/crl\\\"\",\n+\t\t},\n+\t\t{\n+\t\t\t\"enable intermediate PKI\",\n+\t\t\ttokenEnv + \" && vault secrets enable -path=pki_int pki\",\n+\t\t},\n+\t\t{\n+\t\t\t\"tune intermediate PKI max lease TTL\",\n+\t\t\ttokenEnv + \" && vault secrets tune -max-lease-ttl=4380h pki_int\",\n+\t\t},\n+\t}\n+\n+\tfor _, cmdInfo := range commands {\n+\t\t_, err := execInPod(ctx, cfg, kubeClient, namespace, vaultPodName, \"vault\", \"sh\", \"-c\", cmdInfo.cmd)\n+\t\tif err != nil {\n+\t\t\treturn fmt.Errorf(\"failed to %s: %w\", cmdInfo.description, err)\n+\t\t}\n+\t}\n+\n+\t// Generate intermediate CSR\n+\tcsrOutput, err := execInPod(ctx, cfg, kubeClient, namespace, vaultPodName, \"vault\", \"sh\", \"-c\",\n+\t\ttokenEnv+` && vault write -format=json pki_int/intermediate/generate/internal common_name=\"cluster.local Intermediate Authority\" ttl=4380h`)\n+\tif err != nil {\n+\t\treturn fmt.Errorf(\"failed to generate intermediate CSR: %w\", err)\n+\t}\n+\tcsr := gjson.Get(csrOutput, \"data.csr\").String()\n+\tif csr == \"\" {\n+\t\treturn fmt.Errorf(\"failed to extract CSR from output\")\n+\t}\n+\n+\t// Sign intermediate with root CA - use heredoc to properly handle multi-line CSR\n+\tsignCmd := tokenEnv + ` && vault write -format=json pki/root/sign-intermediate format=pem_bundle ttl=4380h csr=- <<EOF\n+` + csr + `\n+EOF`\n+\tcertOutput, err := execInPod(ctx, cfg, kubeClient, namespace, vaultPodName, \"vault\", \"sh\", \"-c\", signCmd)\n+\tif err != nil {\n+\t\treturn fmt.Errorf(\"failed to sign intermediate certificate: %w\", err)\n+\t}\n+\tsignedCert := gjson.Get(certOutput, \"data.certificate\").String()\n+\tif signedCert == \"\" {\n+\t\treturn fmt.Errorf(\"failed to extract signed certificate from output\")\n+\t}\n+\n+\t// Set signed certificate - use heredoc to properly handle multi-line certificate\n+\tsetSignedCmd := tokenEnv + ` && vault write pki_int/intermediate/set-signed certificate=- <<EOF\n+` + signedCert + `\n+EOF`\n+\t_, err = execInPod(ctx, cfg, kubeClient, namespace, vaultPodName, \"vault\", \"sh\", \"-c\", setSignedCmd)\n+\tif err != nil {\n+\t\treturn fmt.Errorf(\"failed to set signed intermediate certificate: %w\", err)\n+\t}\n+\n+\t// Create role for cert-manager\n+\t_, err = execInPod(ctx, cfg, kubeClient, namespace, vaultPodName, \"vault\", \"sh\", \"-c\",\n+\t\ttokenEnv+` && vault write pki_int/roles/cluster-dot-local allowed_domains=cluster.local allow_subdomains=true max_ttl=72h`)\n+\tif err != nil {\n+\t\treturn fmt.Errorf(\"failed to create PKI role: %w\", err)\n+\t}\n+\n+\t// Create policy for cert-manager\n+\tpolicyCmd := tokenEnv + ` && vault policy write cert-manager - <<EOF\n+path \"pki_int/sign/cluster-dot-local\" {\n+  capabilities = [\"create\", \"update\"]\n+}\n+path \"pki_int/issue/cluster-dot-local\" {\n+  capabilities = [\"create\", \"update\"]\n+}\n+EOF`\n+\t_, err = execInPod(ctx, cfg, kubeClient, namespace, vaultPodName, \"vault\", \"sh\", \"-c\", policyCmd)\n+\tif err != nil {\n+\t\treturn fmt.Errorf(\"failed to create cert-manager policy: %w\", err)\n+\t}\n+\n+\tlog.Printf(\"Vault PKI configuration completed successfully\")\n+\treturn nil\n+}\n+\n+// setupVaultServer deploys and initializes a Vault server using Helm.\n+// This is more maintainable than custom StatefulSet logic.\n+// It returns the pod name, root token, ClusterRoleBinding name, and any error encountered.\n+// The caller is responsible for cleaning up the ClusterRoleBinding using the returned name.\n+func setupVaultServer(ctx context.Context, cfg *rest.Config, loader library.DynamicResourceLoader, certmanagerClient *certmanagerclientset.Clientset, namespace, releaseName string) (string, string, string, error) {\n+\tkubeClient := loader.KubeClient\n+\tvaultPodLabel := \"app.kubernetes.io/name=vault\"\n+\n+\tlog.Printf(\"Creating TLS certificate for Vault server\")\n+\terr := createCertificateForVaultServer(ctx, certmanagerClient, namespace, releaseName)\n+\tif err != nil {\n+\t\treturn \"\", \"\", \"\", fmt.Errorf(\"failed to create Vault TLS certificate: %w\", err)\n+\t}\n+\n+\t// Load Helm values from embedded file\n+\thelmValuesBytes, err := testassets.ReadFile(\"testdata/vault/helm-values.yaml\")\n+\tif err != nil {\n+\t\treturn \"\", \"\", \"\", fmt.Errorf(\"failed to read Vault Helm values: %w\", err)\n+\t}\n+\thelmValues := string(helmValuesBytes)\n+\n+\t// Create ConfigMap with Helm values\n+\thelmConfigMap := &corev1.ConfigMap{\n+\t\tObjectMeta: metav1.ObjectMeta{\n+\t\t\tName:      \"vault-helm-config\",\n+\t\t\tNamespace: namespace,\n+\t\t},\n+\t\tData: map[string]string{\n+\t\t\t\"custom-values.yaml\": helmValues,\n+\t\t},\n+\t}\n+\t_, err = kubeClient.CoreV1().ConfigMaps(namespace).Create(ctx, helmConfigMap, metav1.CreateOptions{})\n+\tif err != nil && !apierrors.IsAlreadyExists(err) {\n+\t\treturn \"\", \"\", \"\", fmt.Errorf(\"failed to create Helm config ConfigMap for Vault %s in namespace %s: %w\", releaseName, namespace, err)\n+\t}\n+\n+\t// Create ServiceAccount for Helm installer\n+\tserviceAccountName := \"vault-installer-sa\"\n+\tserviceAccount := &corev1.ServiceAccount{\n+\t\tObjectMeta: metav1.ObjectMeta{\n+\t\t\tName:      serviceAccountName,\n+\t\t\tNamespace: namespace,\n+\t\t},\n+\t}\n+\t_, err = kubeClient.CoreV1().ServiceAccounts(namespace).Create(ctx, serviceAccount, metav1.CreateOptions{})\n+\tif err != nil && !apierrors.IsAlreadyExists(err) {\n+\t\treturn \"\", \"\", \"\", fmt.Errorf(\"failed to create ServiceAccount: %w\", err)\n+\t}\n+\n+\t// Create ClusterRoleBinding for Helm installer\n+\tclusterRoleBindingName := fmt.Sprintf(\"vault-installer-binding-%s\", namespace)\n+\tclusterRoleBinding := &rbacv1.ClusterRoleBinding{\n+\t\tObjectMeta: metav1.ObjectMeta{\n+\t\t\tName: clusterRoleBindingName,\n+\t\t},\n+\t\tRoleRef: rbacv1.RoleRef{\n+\t\t\tAPIGroup: \"rbac.authorization.k8s.io\",\n+\t\t\tKind:     \"ClusterRole\",\n+\t\t\tName:     \"cluster-admin\",\n+\t\t},\n+\t\tSubjects: []rbacv1.Subject{\n+\t\t\t{\n+\t\t\t\tKind:      \"ServiceAccount\",\n+\t\t\t\tName:      serviceAccountName,\n+\t\t\t\tNamespace: namespace,\n+\t\t\t},\n+\t\t},\n+\t}\n+\t_, err = kubeClient.RbacV1().ClusterRoleBindings().Create(ctx, clusterRoleBinding, metav1.CreateOptions{})\n+\tif err != nil && !apierrors.IsAlreadyExists(err) {\n+\t\treturn \"\", \"\", \"\", fmt.Errorf(\"failed to create ClusterRoleBinding: %w\", err)\n+\t}", "path": "test/e2e/utils_test.go", "commit_id": "6ae5732501b4e577a5d0f4fc3e7f7ec49eeb506f", "original_commit_id": "03a9a6e2e940900ecf683972471782b4137a1928", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\ud83d\udee0\ufe0f Refactor suggestion_ | _\ud83d\udfe0 Major_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Verify that cluster-admin role is necessary for Helm installation.**\n\nThe ClusterRoleBinding grants `cluster-admin` to the Vault installer ServiceAccount. While this simplifies the test setup, it's very permissive. Consider whether a more restrictive set of permissions would suffice for the Helm chart installation.\n\n\n\nReview the Vault Helm chart to determine the minimum required permissions:\n\n---\n\n\ud83c\udf10 Web query:\n\n```web\nHashiCorp Vault Helm chart required RBAC permissions\n```\n\n\ud83d\udca1 Result:\n\nShort summary \u2014 Vault Helm chart RBAC needs (common/required):\n\n- ServiceAccount used by Vault server: permission to create serviceaccount tokens (serviceaccounts/token:create) \u2014 used for long-lived or projected tokens / AWS/GCP auto-unseal etc. [1][2]\n\n- Injector (vault-k8s) ClusterRole: permissions to manage mutating webhooks and admission resources (admissionregistration.k8s.io: mutatingwebhookconfigurations), read pods/nodes, manage ConfigMaps (chart recently added delete configmaps), and other typical webhook/controller verbs (get/list/watch/patch/create/delete as required). See chart release notes for exact permission additions. [3][4]\n\n- CSI / Secrets Operator components: their own Roles/ClusterRoles to manage Secrets Store CSI resources, CSIDriver, Secrets, ServiceAccounts, RoleBindings/ClusterRoleBindings per component configuration. Refer to the chart docs for each subchart. [1][5]\n\nWhere to find the exact, up-to-date rules:\n- Official Vault Helm chart docs (usage & RBAC notes). [1]\n- Vault Helm GitHub repository (templates/ folder contains ClusterRole/Role YAMLs for server, injector, csi, operator \u2014 inspect the chart version you plan to install). [4]\n- Release notes / changelog (calls out RBAC changes like \u201cadd missing get nodes\u201d and \u201cinjector: add RBAC for deleting configmaps\u201d). [3]\n\nIf you want, I can fetch and paste the exact ClusterRole/Role YAML for a specific chart version (e.g., v0.31.0 or v0.30.0). References:\n[1] HashiCorp Vault \u2014 Helm chart docs.  \n[2] Kubernetes serviceaccount token example / minimal ClusterRole for token creation.  \n[3] hashicorp/vault-helm release notes (RBAC changes).  \n[4] hashicorp/vault-helm GitHub (templates directory).  \n[5] Vault Secrets Operator installation docs.\n\n---\n\n\n\n</details>\n\n**Reduce installer ServiceAccount privileges; cluster-admin is not required.**\n\nThe web search confirms that Vault Helm chart components require specific, scoped permissions rather than cluster-admin. The exact requirements depend on which chart components are enabled (server, injector, CSI, secrets operator), but the official Vault Helm chart documentation and GitHub repository contain the exact ClusterRole/Role definitions for each component.\n\nFor the Helm installer to deploy the chart, create a ClusterRole with only the necessary permissions to create the resources the Vault chart produces (ClusterRoles, ClusterRoleBindings, MutatingWebhookConfigurations, Deployments, Services, etc.). This aligns the test setup with least-privilege security practices and more accurately reflects what production helm installations require.\n\n<!-- This is an auto-generated reply by CodeRabbit -->", "created_at": "2025-11-21T08:35:40Z", "updated_at": "2025-11-21T08:53:53Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/351#discussion_r2548951828", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/351", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2548951828"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/351#discussion_r2548951828"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/351"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2548951828/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 1396, "original_start_line": 1396, "start_side": "RIGHT", "line": 1417, "original_line": 1417, "side": "RIGHT", "author_association": "NONE", "original_position": 361, "position": 361, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 226, "file_path": "test/e2e/istio-csr_test.go", "line_start": 24, "line_end": null, "diff_context": "", "comment_body": "```suggestion\r\nimport (\r\n\t\"context\"\r\n\t\"crypto/rand\"\r\n\t\"crypto/rsa\"\r\n\t\"crypto/x509\"\r\n\t\"crypto/x509/pkix\"\r\n\t\"encoding/json\"\r\n\t\"encoding/pem\"\r\n\t\"fmt\"\r\n\t\"io\"\r\n\t\"net/url\"\r\n\t\"path/filepath\"\r\n\t\"strings\"\r\n\t\"time\"\r\n\t\r\n\tauthenticationv1 \"k8s.io/api/authentication/v1\"\r\n\tbatchv1 \"k8s.io/api/batch/v1\"\r\n\tcorev1 \"k8s.io/api/core/v1\"\r\n\t\"k8s.io/apimachinery/pkg/api/errors\"\r\n\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\r\n\t\"k8s.io/apimachinery/pkg/util/wait\"\r\n\t\"k8s.io/client-go/kubernetes\"\r\n\t\r\n\t. \"github.com/onsi/ginkgo/v2\"\r\n\t. \"github.com/onsi/gomega\"\r\n)\r\n```", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1912919154", "pull_request_review_id": 2546150531, "id": 1912919154, "node_id": "PRRC_kwDOFdFn9s5yBNRy", "diff_hunk": "@@ -0,0 +1,300 @@\n+//go:build e2e\n+// +build e2e\n+\n+package e2e\n+\n+import (\n+\t\"context\"\n+\t\"crypto/rand\"\n+\t\"crypto/rsa\"\n+\t\"crypto/x509\"\n+\t\"crypto/x509/pkix\"\n+\t\"encoding/json\"\n+\t\"encoding/pem\"\n+\t\"fmt\"\n+\t. \"github.com/onsi/ginkgo/v2\"\n+\t. \"github.com/onsi/gomega\"\n+\t\"io\"\n+\tauthenticationv1 \"k8s.io/api/authentication/v1\"\n+\tbatchv1 \"k8s.io/api/batch/v1\"\n+\tcorev1 \"k8s.io/api/core/v1\"\n+\t\"k8s.io/apimachinery/pkg/api/errors\"\n+\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n+\t\"k8s.io/apimachinery/pkg/util/wait\"\n+\t\"k8s.io/client-go/kubernetes\"\n+\t\"net/url\"\n+\t\"path/filepath\"\n+\t\"strings\"\n+\t\"time\"\n+)", "path": "test/e2e/istio-csr_test.go", "commit_id": "efa7e23248bb2926bded74f7c6f40430ff785619", "original_commit_id": "341738b31133d9362aa198c1d81319ad803e5daa", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "```suggestion\r\nimport (\r\n\t\"context\"\r\n\t\"crypto/rand\"\r\n\t\"crypto/rsa\"\r\n\t\"crypto/x509\"\r\n\t\"crypto/x509/pkix\"\r\n\t\"encoding/json\"\r\n\t\"encoding/pem\"\r\n\t\"fmt\"\r\n\t\"io\"\r\n\t\"net/url\"\r\n\t\"path/filepath\"\r\n\t\"strings\"\r\n\t\"time\"\r\n\t\r\n\tauthenticationv1 \"k8s.io/api/authentication/v1\"\r\n\tbatchv1 \"k8s.io/api/batch/v1\"\r\n\tcorev1 \"k8s.io/api/core/v1\"\r\n\t\"k8s.io/apimachinery/pkg/api/errors\"\r\n\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\r\n\t\"k8s.io/apimachinery/pkg/util/wait\"\r\n\t\"k8s.io/client-go/kubernetes\"\r\n\t\r\n\t. \"github.com/onsi/ginkgo/v2\"\r\n\t. \"github.com/onsi/gomega\"\r\n)\r\n```", "created_at": "2025-01-13T09:48:59Z", "updated_at": "2025-01-13T10:34:03Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/226#discussion_r1912919154", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/226", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1912919154"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/226#discussion_r1912919154"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/226"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1912919154/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 6, "start_side": "RIGHT", "line": null, "original_line": 24, "side": "RIGHT", "author_association": "MEMBER", "original_position": 29, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 226, "file_path": "test/e2e/istio-csr_test.go", "line_start": 46, "line_end": null, "diff_context": "", "comment_body": "looks like the exact same function as that in the other suites,\r\ncould you help refactor this and add a new function with the same logic,\r\nthen use it here and in the other test suites.\r\n\r\nHelps remove duplication of code.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1912923223", "pull_request_review_id": 2546150531, "id": 1912923223, "node_id": "PRRC_kwDOFdFn9s5yBORX", "diff_hunk": "@@ -0,0 +1,300 @@\n+//go:build e2e\n+// +build e2e\n+\n+package e2e\n+\n+import (\n+\t\"context\"\n+\t\"crypto/rand\"\n+\t\"crypto/rsa\"\n+\t\"crypto/x509\"\n+\t\"crypto/x509/pkix\"\n+\t\"encoding/json\"\n+\t\"encoding/pem\"\n+\t\"fmt\"\n+\t. \"github.com/onsi/ginkgo/v2\"\n+\t. \"github.com/onsi/gomega\"\n+\t\"io\"\n+\tauthenticationv1 \"k8s.io/api/authentication/v1\"\n+\tbatchv1 \"k8s.io/api/batch/v1\"\n+\tcorev1 \"k8s.io/api/core/v1\"\n+\t\"k8s.io/apimachinery/pkg/api/errors\"\n+\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n+\t\"k8s.io/apimachinery/pkg/util/wait\"\n+\t\"k8s.io/client-go/kubernetes\"\n+\t\"net/url\"\n+\t\"path/filepath\"\n+\t\"strings\"\n+\t\"time\"\n+)\n+\n+type LogEntry struct {\n+\tCertChain []string `json:\"certChain\"`\n+}\n+\n+func generateCSR() (string, error) {\n+\t// Generate a private key\n+\tprivateKey, err := rsa.GenerateKey(rand.Reader, 2048)\n+\tif err != nil {\n+\t\treturn \"\", fmt.Errorf(\"failed to generate private key: %w\", err)\n+\t}\n+\n+\t// Define the CSR template\n+\tcsrTemplate := &x509.CertificateRequest{\n+\t\tSubject: pkix.Name{\n+\t\t\tOrganization:       []string{\"My Organization\"},\n+\t\t\tOrganizationalUnit: []string{\"IT Department\"},\n+\t\t\tCountry:            []string{\"US\"},\n+\t\t\tLocality:           []string{\"Los Angeles\"},\n+\t\t\tProvince:           []string{\"California\"},\n+\t\t},\n+\t\tURIs: []*url.URL{\n+\t\t\t{Scheme: \"spiffe\", Host: \"cluster.local\", Path: \"/ns/istio-system/sa/cert-manager-istio-csr\"},\n+\t\t},\n+\t\tSignatureAlgorithm: x509.SHA256WithRSA,\n+\t}\n+\n+\t// Generate the CSR\n+\tcsrBytes, err := x509.CreateCertificateRequest(rand.Reader, csrTemplate, privateKey)\n+\tif err != nil {\n+\t\treturn \"\", fmt.Errorf(\"failed to create CSR: %w\", err)\n+\t}\n+\n+\t// Encode the CSR to PEM format\n+\tcsrPEM := pem.EncodeToMemory(&pem.Block{\n+\t\tType:  \"CERTIFICATE REQUEST\",\n+\t\tBytes: csrBytes,\n+\t})\n+\n+\tescapedCSR := strings.ReplaceAll(string(csrPEM), \"\\n\", \"\\\\n\")\n+\n+\treturn escapedCSR, nil\n+}\n+\n+var _ = Describe(\"Istio-CSR\", Ordered, func() {\n+\tctx := context.Background()\n+\tvar clientset *kubernetes.Clientset\n+\tserviceAccountName := \"cert-manager-istio-csr\"\n+\tgrpcAppName := \"grpcurl\"\n+\n+\tBeforeAll(func() {\n+\t\tvar err error\n+\t\tclientset, err = kubernetes.NewForConfig(cfg)\n+\t\tExpect(err).Should(BeNil())\n+\t})\n+\n+\tvar ns *corev1.Namespace\n+\n+\tBeforeEach(func() {", "path": "test/e2e/istio-csr_test.go", "commit_id": "efa7e23248bb2926bded74f7c6f40430ff785619", "original_commit_id": "341738b31133d9362aa198c1d81319ad803e5daa", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "looks like the exact same function as that in the other suites,\r\ncould you help refactor this and add a new function with the same logic,\r\nthen use it here and in the other test suites.\r\n\r\nHelps remove duplication of code.", "created_at": "2025-01-13T09:52:02Z", "updated_at": "2025-01-13T10:34:03Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/226#discussion_r1912923223", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/226", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1912923223"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/226#discussion_r1912923223"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/226"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1912923223/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 46, "side": "RIGHT", "author_association": "MEMBER", "original_position": 88, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 226, "file_path": "test/e2e/istio-csr_test.go", "line_start": 126, "line_end": null, "diff_context": "", "comment_body": "```suggestion\r\n\t\t\tBy(\"creating istiocsr.operator.openshift.io resource\")\r\n```", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1912939974", "pull_request_review_id": 2546150531, "id": 1912939974, "node_id": "PRRC_kwDOFdFn9s5yBSXG", "diff_hunk": "@@ -0,0 +1,300 @@\n+//go:build e2e\n+// +build e2e\n+\n+package e2e\n+\n+import (\n+\t\"context\"\n+\t\"crypto/rand\"\n+\t\"crypto/rsa\"\n+\t\"crypto/x509\"\n+\t\"crypto/x509/pkix\"\n+\t\"encoding/json\"\n+\t\"encoding/pem\"\n+\t\"fmt\"\n+\t. \"github.com/onsi/ginkgo/v2\"\n+\t. \"github.com/onsi/gomega\"\n+\t\"io\"\n+\tauthenticationv1 \"k8s.io/api/authentication/v1\"\n+\tbatchv1 \"k8s.io/api/batch/v1\"\n+\tcorev1 \"k8s.io/api/core/v1\"\n+\t\"k8s.io/apimachinery/pkg/api/errors\"\n+\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n+\t\"k8s.io/apimachinery/pkg/util/wait\"\n+\t\"k8s.io/client-go/kubernetes\"\n+\t\"net/url\"\n+\t\"path/filepath\"\n+\t\"strings\"\n+\t\"time\"\n+)\n+\n+type LogEntry struct {\n+\tCertChain []string `json:\"certChain\"`\n+}\n+\n+func generateCSR() (string, error) {\n+\t// Generate a private key\n+\tprivateKey, err := rsa.GenerateKey(rand.Reader, 2048)\n+\tif err != nil {\n+\t\treturn \"\", fmt.Errorf(\"failed to generate private key: %w\", err)\n+\t}\n+\n+\t// Define the CSR template\n+\tcsrTemplate := &x509.CertificateRequest{\n+\t\tSubject: pkix.Name{\n+\t\t\tOrganization:       []string{\"My Organization\"},\n+\t\t\tOrganizationalUnit: []string{\"IT Department\"},\n+\t\t\tCountry:            []string{\"US\"},\n+\t\t\tLocality:           []string{\"Los Angeles\"},\n+\t\t\tProvince:           []string{\"California\"},\n+\t\t},\n+\t\tURIs: []*url.URL{\n+\t\t\t{Scheme: \"spiffe\", Host: \"cluster.local\", Path: \"/ns/istio-system/sa/cert-manager-istio-csr\"},\n+\t\t},\n+\t\tSignatureAlgorithm: x509.SHA256WithRSA,\n+\t}\n+\n+\t// Generate the CSR\n+\tcsrBytes, err := x509.CreateCertificateRequest(rand.Reader, csrTemplate, privateKey)\n+\tif err != nil {\n+\t\treturn \"\", fmt.Errorf(\"failed to create CSR: %w\", err)\n+\t}\n+\n+\t// Encode the CSR to PEM format\n+\tcsrPEM := pem.EncodeToMemory(&pem.Block{\n+\t\tType:  \"CERTIFICATE REQUEST\",\n+\t\tBytes: csrBytes,\n+\t})\n+\n+\tescapedCSR := strings.ReplaceAll(string(csrPEM), \"\\n\", \"\\\\n\")\n+\n+\treturn escapedCSR, nil\n+}\n+\n+var _ = Describe(\"Istio-CSR\", Ordered, func() {\n+\tctx := context.Background()\n+\tvar clientset *kubernetes.Clientset\n+\tserviceAccountName := \"cert-manager-istio-csr\"\n+\tgrpcAppName := \"grpcurl\"\n+\n+\tBeforeAll(func() {\n+\t\tvar err error\n+\t\tclientset, err = kubernetes.NewForConfig(cfg)\n+\t\tExpect(err).Should(BeNil())\n+\t})\n+\n+\tvar ns *corev1.Namespace\n+\n+\tBeforeEach(func() {\n+\t\tBy(\"waiting for operator status to become available\")\n+\t\terr := verifyOperatorStatusCondition(certmanageroperatorclient, []string{\n+\t\t\tcertManagerControllerDeploymentControllerName,\n+\t\t\tcertManagerWebhookDeploymentControllerName,\n+\t\t\tcertManagerCAInjectorDeploymentControllerName,\n+\t\t}, validOperatorStatusConditions)\n+\t\tExpect(err).NotTo(HaveOccurred(), \"Operator is expected to be available\")\n+\n+\t\tBy(\"creating a test namespace\")\n+\t\tnamespace, err := loader.CreateNS(\"istio-system\")\n+\t\tExpect(err).NotTo(HaveOccurred())\n+\t\tns = namespace\n+\n+\t\tDeferCleanup(func() {\n+\t\t\tloader.DeleteTestingNS(ns.Name, func() bool { return CurrentSpecReport().Failed() })\n+\t\t})\n+\t})\n+\n+\tContext(\"testing grpc call of istio-csr\", Label(\"Platform: IstioCSR\"), func() {\n+\n+\t\tIt(\"should return cert-chain as response\", func() {\n+\t\t\tBy(\"issuing cluster issuer\")\n+\t\t\tloader.CreateFromFile(testassets.ReadFile, filepath.Join(\"testdata\", \"self_signed\", \"cluster_issuer.yaml\"), ns.Name)\n+\t\t\tdefer loader.DeleteFromFile(testassets.ReadFile, filepath.Join(\"testdata\", \"self_signed\", \"cluster_issuer.yaml\"), ns.Name)\n+\n+\t\t\tBy(\"issuing certificate for TLS\")\n+\t\t\tloader.CreateFromFile(testassets.ReadFile, filepath.Join(\"testdata\", \"self_signed\", \"certificate.yaml\"), ns.Name)\n+\t\t\tdefer loader.DeleteFromFile(testassets.ReadFile, filepath.Join(\"testdata\", \"self_signed\", \"certificate.yaml\"), ns.Name)\n+\n+\t\t\tBy(\"creating proto config map\")\n+\t\t\tloader.CreateFromFile(testassets.ReadFile, filepath.Join(\"testdata\", \"istio\", \"proto-cm.yaml\"), ns.Name)\n+\t\t\tdefer loader.DeleteFromFile(testassets.ReadFile, filepath.Join(\"testdata\", \"istio\", \"proto-cm.yaml\"), ns.Name)\n+\n+\t\t\tBy(\"applying istio issuer\")\n+\t\t\tloader.CreateFromFile(testassets.ReadFile, filepath.Join(\"testdata\", \"istio\", \"istio-issuer.yaml\"), ns.Name)\n+\t\t\tdefer loader.DeleteFromFile(testassets.ReadFile, filepath.Join(\"testdata\", \"istio\", \"istio-issuer.yaml\"), ns.Name)\n+\n+\t\t\tBy(\"applying istio-csr resource\")", "path": "test/e2e/istio-csr_test.go", "commit_id": "efa7e23248bb2926bded74f7c6f40430ff785619", "original_commit_id": "341738b31133d9362aa198c1d81319ad803e5daa", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "```suggestion\r\n\t\t\tBy(\"creating istiocsr.operator.openshift.io resource\")\r\n```", "created_at": "2025-01-13T10:03:58Z", "updated_at": "2025-01-13T10:34:04Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/226#discussion_r1912939974", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/226", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1912939974"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/226#discussion_r1912939974"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/226"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1912939974/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 126, "side": "RIGHT", "author_association": "MEMBER", "original_position": 126, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 226, "file_path": "test/e2e/istio-csr_test.go", "line_start": 253, "line_end": null, "diff_context": "", "comment_body": "use a util function that has your validations, and call it here.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1912957804", "pull_request_review_id": 2546150531, "id": 1912957804, "node_id": "PRRC_kwDOFdFn9s5yBWts", "diff_hunk": "@@ -0,0 +1,300 @@\n+//go:build e2e\n+// +build e2e\n+\n+package e2e\n+\n+import (\n+\t\"context\"\n+\t\"crypto/rand\"\n+\t\"crypto/rsa\"\n+\t\"crypto/x509\"\n+\t\"crypto/x509/pkix\"\n+\t\"encoding/json\"\n+\t\"encoding/pem\"\n+\t\"fmt\"\n+\t. \"github.com/onsi/ginkgo/v2\"\n+\t. \"github.com/onsi/gomega\"\n+\t\"io\"\n+\tauthenticationv1 \"k8s.io/api/authentication/v1\"\n+\tbatchv1 \"k8s.io/api/batch/v1\"\n+\tcorev1 \"k8s.io/api/core/v1\"\n+\t\"k8s.io/apimachinery/pkg/api/errors\"\n+\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n+\t\"k8s.io/apimachinery/pkg/util/wait\"\n+\t\"k8s.io/client-go/kubernetes\"\n+\t\"net/url\"\n+\t\"path/filepath\"\n+\t\"strings\"\n+\t\"time\"\n+)\n+\n+type LogEntry struct {\n+\tCertChain []string `json:\"certChain\"`\n+}\n+\n+func generateCSR() (string, error) {\n+\t// Generate a private key\n+\tprivateKey, err := rsa.GenerateKey(rand.Reader, 2048)\n+\tif err != nil {\n+\t\treturn \"\", fmt.Errorf(\"failed to generate private key: %w\", err)\n+\t}\n+\n+\t// Define the CSR template\n+\tcsrTemplate := &x509.CertificateRequest{\n+\t\tSubject: pkix.Name{\n+\t\t\tOrganization:       []string{\"My Organization\"},\n+\t\t\tOrganizationalUnit: []string{\"IT Department\"},\n+\t\t\tCountry:            []string{\"US\"},\n+\t\t\tLocality:           []string{\"Los Angeles\"},\n+\t\t\tProvince:           []string{\"California\"},\n+\t\t},\n+\t\tURIs: []*url.URL{\n+\t\t\t{Scheme: \"spiffe\", Host: \"cluster.local\", Path: \"/ns/istio-system/sa/cert-manager-istio-csr\"},\n+\t\t},\n+\t\tSignatureAlgorithm: x509.SHA256WithRSA,\n+\t}\n+\n+\t// Generate the CSR\n+\tcsrBytes, err := x509.CreateCertificateRequest(rand.Reader, csrTemplate, privateKey)\n+\tif err != nil {\n+\t\treturn \"\", fmt.Errorf(\"failed to create CSR: %w\", err)\n+\t}\n+\n+\t// Encode the CSR to PEM format\n+\tcsrPEM := pem.EncodeToMemory(&pem.Block{\n+\t\tType:  \"CERTIFICATE REQUEST\",\n+\t\tBytes: csrBytes,\n+\t})\n+\n+\tescapedCSR := strings.ReplaceAll(string(csrPEM), \"\\n\", \"\\\\n\")\n+\n+\treturn escapedCSR, nil\n+}\n+\n+var _ = Describe(\"Istio-CSR\", Ordered, func() {\n+\tctx := context.Background()\n+\tvar clientset *kubernetes.Clientset\n+\tserviceAccountName := \"cert-manager-istio-csr\"\n+\tgrpcAppName := \"grpcurl\"\n+\n+\tBeforeAll(func() {\n+\t\tvar err error\n+\t\tclientset, err = kubernetes.NewForConfig(cfg)\n+\t\tExpect(err).Should(BeNil())\n+\t})\n+\n+\tvar ns *corev1.Namespace\n+\n+\tBeforeEach(func() {\n+\t\tBy(\"waiting for operator status to become available\")\n+\t\terr := verifyOperatorStatusCondition(certmanageroperatorclient, []string{\n+\t\t\tcertManagerControllerDeploymentControllerName,\n+\t\t\tcertManagerWebhookDeploymentControllerName,\n+\t\t\tcertManagerCAInjectorDeploymentControllerName,\n+\t\t}, validOperatorStatusConditions)\n+\t\tExpect(err).NotTo(HaveOccurred(), \"Operator is expected to be available\")\n+\n+\t\tBy(\"creating a test namespace\")\n+\t\tnamespace, err := loader.CreateNS(\"istio-system\")\n+\t\tExpect(err).NotTo(HaveOccurred())\n+\t\tns = namespace\n+\n+\t\tDeferCleanup(func() {\n+\t\t\tloader.DeleteTestingNS(ns.Name, func() bool { return CurrentSpecReport().Failed() })\n+\t\t})\n+\t})\n+\n+\tContext(\"testing grpc call of istio-csr\", Label(\"Platform: IstioCSR\"), func() {\n+\n+\t\tIt(\"should return cert-chain as response\", func() {\n+\t\t\tBy(\"issuing cluster issuer\")\n+\t\t\tloader.CreateFromFile(testassets.ReadFile, filepath.Join(\"testdata\", \"self_signed\", \"cluster_issuer.yaml\"), ns.Name)\n+\t\t\tdefer loader.DeleteFromFile(testassets.ReadFile, filepath.Join(\"testdata\", \"self_signed\", \"cluster_issuer.yaml\"), ns.Name)\n+\n+\t\t\tBy(\"issuing certificate for TLS\")\n+\t\t\tloader.CreateFromFile(testassets.ReadFile, filepath.Join(\"testdata\", \"self_signed\", \"certificate.yaml\"), ns.Name)\n+\t\t\tdefer loader.DeleteFromFile(testassets.ReadFile, filepath.Join(\"testdata\", \"self_signed\", \"certificate.yaml\"), ns.Name)\n+\n+\t\t\tBy(\"creating proto config map\")\n+\t\t\tloader.CreateFromFile(testassets.ReadFile, filepath.Join(\"testdata\", \"istio\", \"proto-cm.yaml\"), ns.Name)\n+\t\t\tdefer loader.DeleteFromFile(testassets.ReadFile, filepath.Join(\"testdata\", \"istio\", \"proto-cm.yaml\"), ns.Name)\n+\n+\t\t\tBy(\"applying istio issuer\")\n+\t\t\tloader.CreateFromFile(testassets.ReadFile, filepath.Join(\"testdata\", \"istio\", \"istio-issuer.yaml\"), ns.Name)\n+\t\t\tdefer loader.DeleteFromFile(testassets.ReadFile, filepath.Join(\"testdata\", \"istio\", \"istio-issuer.yaml\"), ns.Name)\n+\n+\t\t\tBy(\"applying istio-csr resource\")\n+\t\t\tloader.CreateFromFile(testassets.ReadFile, filepath.Join(\"testdata\", \"istio\", \"istio-csr.yaml\"), ns.Name)\n+\t\t\tdefer loader.DeleteFromFile(testassets.ReadFile, filepath.Join(\"testdata\", \"istio\", \"istio-csr.yaml\"), ns.Name)\n+\n+\t\t\tBy(\"poll till the service account is available\")\n+\t\t\terr := pollTillServiceAccountAvailable(ctx, clientset, ns.Name, serviceAccountName)\n+\t\t\tExpect(err).Should(BeNil())\n+\n+\t\t\tBy(\"creating jwt token for header authorization\")\n+\t\t\ttokenRequest := &authenticationv1.TokenRequest{\n+\t\t\t\tSpec: authenticationv1.TokenRequestSpec{\n+\t\t\t\t\tAudiences: []string{\n+\t\t\t\t\t\t\"istio-ca\",\n+\t\t\t\t\t},\n+\t\t\t\t},\n+\t\t\t}\n+\t\t\ttokenResponse, err := clientset.CoreV1().ServiceAccounts(\"istio-system\").CreateToken(ctx, serviceAccountName, tokenRequest, metav1.CreateOptions{})\n+\t\t\tExpect(err).Should(BeNil())\n+\n+\t\t\tExpect(tokenResponse.Status).ShouldNot(BeNil())\n+\n+\t\t\tBy(\"generate csr request\")\n+\t\t\tcsr, err := generateCSR()\n+\t\t\tExpect(err).Should(BeNil())\n+\n+\t\t\tBy(\"creating an grpcurl job\")\n+\t\t\tjob := &batchv1.Job{\n+\t\t\t\tObjectMeta: metav1.ObjectMeta{\n+\t\t\t\t\tName: \"grpcurl-job\",\n+\t\t\t\t},\n+\t\t\t\tSpec: batchv1.JobSpec{\n+\t\t\t\t\tTemplate: corev1.PodTemplateSpec{\n+\t\t\t\t\t\tObjectMeta: metav1.ObjectMeta{\n+\t\t\t\t\t\t\tName: grpcAppName,\n+\t\t\t\t\t\t\tLabels: map[string]string{\n+\t\t\t\t\t\t\t\t\"app\": grpcAppName,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n+\t\t\t\t\t\tSpec: corev1.PodSpec{\n+\t\t\t\t\t\t\tRestartPolicy: corev1.RestartPolicyNever,\n+\t\t\t\t\t\t\tContainers: []corev1.Container{\n+\t\t\t\t\t\t\t\t{\n+\t\t\t\t\t\t\t\t\tName:  grpcAppName,\n+\t\t\t\t\t\t\t\t\tImage: \"fullstorydev/grpcurl:latest\", // Use your custom image if applicable\n+\t\t\t\t\t\t\t\t\tArgs: []string{\n+\t\t\t\t\t\t\t\t\t\t\"-import-path\", \"/proto\",\n+\t\t\t\t\t\t\t\t\t\t\"-proto\", \"/proto/ca.proto\",\n+\t\t\t\t\t\t\t\t\t\t\"-H\", fmt.Sprintf(\"Authorization: Bearer %s\", tokenResponse.Status.Token),\n+\t\t\t\t\t\t\t\t\t\t\"-d\", fmt.Sprintf(`{\"csr\": \"%s\", \"validity_duration\": 3600}`, csr),\n+\t\t\t\t\t\t\t\t\t\t\"-cacert\", \"/etc/certs/root-cert.pem\",\n+\t\t\t\t\t\t\t\t\t\tfmt.Sprintf(\"cert-manager-istio-csr.%s.svc:443\", ns.Name),\n+\t\t\t\t\t\t\t\t\t\t\"istio.v1.auth.IstioCertificateService/CreateCertificate\",\n+\t\t\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\t\t\tVolumeMounts: []corev1.VolumeMount{\n+\t\t\t\t\t\t\t\t\t\t{Name: \"cert-volume\", MountPath: \"/etc/certs\"},\n+\t\t\t\t\t\t\t\t\t\t{Name: \"proto\", MountPath: \"/proto\"},\n+\t\t\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tVolumes: []corev1.Volume{\n+\t\t\t\t\t\t\t\t{\n+\t\t\t\t\t\t\t\t\tName: \"cert-volume\",\n+\t\t\t\t\t\t\t\t\tVolumeSource: corev1.VolumeSource{\n+\t\t\t\t\t\t\t\t\t\tConfigMap: &corev1.ConfigMapVolumeSource{\n+\t\t\t\t\t\t\t\t\t\t\tLocalObjectReference: corev1.LocalObjectReference{\n+\t\t\t\t\t\t\t\t\t\t\t\tName: \"istio-ca-root-cert\",\n+\t\t\t\t\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\t\t{\n+\t\t\t\t\t\t\t\t\tName: \"proto\",\n+\t\t\t\t\t\t\t\t\tVolumeSource: corev1.VolumeSource{\n+\t\t\t\t\t\t\t\t\t\tConfigMap: &corev1.ConfigMapVolumeSource{\n+\t\t\t\t\t\t\t\t\t\t\tLocalObjectReference: corev1.LocalObjectReference{\n+\t\t\t\t\t\t\t\t\t\t\t\tName: \"proto-cm\",\n+\t\t\t\t\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n+\t\t\t\t\t},\n+\t\t\t\t},\n+\t\t\t}\n+\t\t\t_, err = clientset.BatchV1().Jobs(ns.Name).Create(context.TODO(), job, metav1.CreateOptions{})\n+\t\t\tExpect(err).Should(BeNil())\n+\t\t\tdefer clientset.BatchV1().Jobs(ns.Name).Delete(ctx, job.Name, metav1.DeleteOptions{})\n+\n+\t\t\tBy(\"waiting for the job to be completed\")\n+\t\t\terr = pollTillCompleted(ctx, clientset, ns.Name, fmt.Sprintf(\"app=%s\", grpcAppName))\n+\t\t\tExpect(err).Should(BeNil())\n+\n+\t\t\tBy(\"fetching logs of the grpcurl job\")\n+\t\t\tpods, err := clientset.CoreV1().Pods(ns.Name).List(context.TODO(), metav1.ListOptions{\n+\t\t\t\tLabelSelector: fmt.Sprintf(\"app=%s\", grpcAppName),\n+\t\t\t})\n+\t\t\tExpect(err).Should(BeNil())\n+\n+\t\t\tBy(\"reading logs of the grpcurl job\")\n+\t\t\tfor _, pod := range pods.Items {\n+\t\t\t\treq := clientset.CoreV1().Pods(ns.Name).GetLogs(pod.Name, &corev1.PodLogOptions{})\n+\t\t\t\tlogs, err := req.Stream(context.TODO())\n+\t\t\t\tExpect(err).Should(BeNil())\n+\n+\t\t\t\tdefer logs.Close()\n+\n+\t\t\t\tlogData, err := io.ReadAll(logs)\n+\t\t\t\tExpect(err).Should(BeNil())\n+\n+\t\t\t\tvar entry LogEntry\n+\t\t\t\terr = json.Unmarshal(logData, &entry)\n+\t\t\t\tExpect(err).Should(BeNil())\n+\n+\t\t\t\tBy(\"validating each certificate\")\n+\t\t\t\tfor _, certPEM := range entry.CertChain {\n+\t\t\t\t\tblock, _ := pem.Decode([]byte(certPEM))\n+\t\t\t\t\tcert, err := x509.ParseCertificate(block.Bytes)\n+\t\t\t\t\tExpect(err).Should(BeNil())\n+\n+\t\t\t\t\tExpect(cert.Issuer.CommonName).Should(Equal(\"my-selfsigned-ca\"))\n+\n+\t\t\t\t\t// Validate the certificate's validity period\n+\t\t\t\t\tBy(\"validating the certificate validity period\")\n+\t\t\t\t\tnow := time.Now()\n+\t\t\t\t\tExpect(cert.NotBefore).Should(BeTemporally(\"<=\", now), \"Certificate's NotBefore should be in the past or present\")\n+\t\t\t\t\tExpect(cert.NotAfter).Should(BeTemporally(\">\", now), \"Certificate's NotAfter should be in the future\")\n+", "path": "test/e2e/istio-csr_test.go", "commit_id": "efa7e23248bb2926bded74f7c6f40430ff785619", "original_commit_id": "341738b31133d9362aa198c1d81319ad803e5daa", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "use a util function that has your validations, and call it here.", "created_at": "2025-01-13T10:17:19Z", "updated_at": "2025-01-13T10:34:04Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/226#discussion_r1912957804", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/226", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1912957804"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/226#discussion_r1912957804"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/226"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1912957804/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 241, "start_side": "RIGHT", "line": null, "original_line": 253, "side": "RIGHT", "author_association": "MEMBER", "original_position": 253, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 229, "file_path": "api/operator/v1alpha1/certmanager_types.go", "line_start": 152, "line_end": null, "diff_context": "", "comment_body": "nit: Wouldn't a struct with feature names as boolean type members be simple and CEL validations too would be less complex?\r\n```\r\ntype Features struct {\r\n   IstioCSR bool\r\n}\r\n```", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1908657474", "pull_request_review_id": 2539728802, "id": 1908657474, "node_id": "PRRC_kwDOFdFn9s5xw81C", "diff_hunk": "@@ -120,6 +128,30 @@ type CertManagerScheduling struct {\n \tTolerations []corev1.Toleration `json:\"tolerations,omitempty\" protobuf:\"bytes,22,opt,name=tolerations\"`\n }\n \n+// Features contains experimental features.\n+type Features struct {\n+\t// TechPreview is the list of features enabled under Technlogy Preview capabilities,\n+\t// is specific to the cert-manager Operator for Red Hat OpenShift and not in anyway\n+\t// related to the \"TechPreviewNoUpgrade\" feature set available in core OpenShift,\n+\t// although similar support and licensing terms may apply.\n+\t//\n+\t// Technology Preview features are not supported with Red Hat production service level agreements\n+\t// (SLAs) and might not be functionally complete. Red Hat does not recommend using them in production.\n+\t// These features provide early access to upcoming product features,\n+\t// enabling customers to test functionality and provide feedback during the development process.\n+\t//\n+\t// +kubebuilder:validation:XValidation:rule=\"oldSelf.size() != 0 ? oldSelf.all(e, self.exists(f, f == e)) : true\",message=\"a tech preview feature once enabled, cannot be disabled.\"\n+\t// +kubebuilder:validation:XValidation:rule=\"self.all(e, self.filter(x, x == e).size() == 1)\",message=\"tech preview features must not contain duplicate values.\"\n+\t// +kubebuilder:validation:Required\n+\t// +required\n+\tTechPreview TechPreview `json:\"techPreview\"`\n+}\n+\n+// TechPreview contains the list of enabled experimental features.\n+// +listType=atomic\n+// +kubebuilder:validation:MaxItems=64\n+type TechPreview []FeatureName", "path": "api/operator/v1alpha1/certmanager_types.go", "commit_id": "e7d67b7a5b1bb3589fcb6b6b235bb25f52e2eb67", "original_commit_id": "cbacb19ab5758f8ab92c9593a467ff74e5e7f426", "user": {"login": "bharath-b-rh", "id": 92782575, "node_id": "U_kgDOBYe_7w", "avatar_url": "https://avatars.githubusercontent.com/u/92782575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bharath-b-rh", "html_url": "https://github.com/bharath-b-rh", "followers_url": "https://api.github.com/users/bharath-b-rh/followers", "following_url": "https://api.github.com/users/bharath-b-rh/following{/other_user}", "gists_url": "https://api.github.com/users/bharath-b-rh/gists{/gist_id}", "starred_url": "https://api.github.com/users/bharath-b-rh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bharath-b-rh/subscriptions", "organizations_url": "https://api.github.com/users/bharath-b-rh/orgs", "repos_url": "https://api.github.com/users/bharath-b-rh/repos", "events_url": "https://api.github.com/users/bharath-b-rh/events{/privacy}", "received_events_url": "https://api.github.com/users/bharath-b-rh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "nit: Wouldn't a struct with feature names as boolean type members be simple and CEL validations too would be less complex?\r\n```\r\ntype Features struct {\r\n   IstioCSR bool\r\n}\r\n```", "created_at": "2025-01-09T11:57:50Z", "updated_at": "2025-01-09T11:57:51Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/229#discussion_r1908657474", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/229", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1908657474"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/229#discussion_r1908657474"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/229"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1908657474/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 152, "side": "RIGHT", "author_association": "MEMBER", "original_position": 41, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 229, "file_path": "pkg/controller/certmanager/tp_block_upgrades.go", "line_start": 35, "line_end": null, "diff_context": "", "comment_body": "nit\r\n\r\n```suggestion\r\n\treturn upgradeCond.Set(ctx, metav1.ConditionFalse,\r\n```", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1908658038", "pull_request_review_id": 2539729512, "id": 1908658038, "node_id": "PRRC_kwDOFdFn9s5xw892", "diff_hunk": "@@ -0,0 +1,37 @@\n+package certmanager\n+\n+import (\n+\t\"context\"\n+\n+\t\"github.com/operator-framework/operator-lib/conditions\"\n+\n+\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n+)\n+\n+const (\n+\ttechPreviewNoUpgradeReason  = \"techPreviewFeaturesUpgradeRestricted\"\n+\ttechPreviewNoUpgradeMessage = \"The operator installed with TechPreview features cannot be upgraded.\"\n+)\n+\n+func ensureNoUpgrade(ctx context.Context, upgradeCond conditions.Condition) error {\n+\tcond, err := upgradeCond.Get(ctx)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\t// upgradeable already false due to a different reason\n+\tif cond.Status == metav1.ConditionFalse && cond.Reason != techPreviewNoUpgradeReason {\n+\t\treturn nil\n+\t}\n+\n+\t// upgrades were already blocked, do nothing\n+\tif cond.Message == techPreviewNoUpgradeMessage && cond.Reason == techPreviewNoUpgradeReason &&\n+\t\tcond.Status == metav1.ConditionFalse {\n+\t\treturn nil\n+\t}\n+\n+\terr = upgradeCond.Set(ctx, metav1.ConditionFalse,", "path": "pkg/controller/certmanager/tp_block_upgrades.go", "commit_id": "e7d67b7a5b1bb3589fcb6b6b235bb25f52e2eb67", "original_commit_id": "cbacb19ab5758f8ab92c9593a467ff74e5e7f426", "user": {"login": "bharath-b-rh", "id": 92782575, "node_id": "U_kgDOBYe_7w", "avatar_url": "https://avatars.githubusercontent.com/u/92782575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bharath-b-rh", "html_url": "https://github.com/bharath-b-rh", "followers_url": "https://api.github.com/users/bharath-b-rh/followers", "following_url": "https://api.github.com/users/bharath-b-rh/following{/other_user}", "gists_url": "https://api.github.com/users/bharath-b-rh/gists{/gist_id}", "starred_url": "https://api.github.com/users/bharath-b-rh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bharath-b-rh/subscriptions", "organizations_url": "https://api.github.com/users/bharath-b-rh/orgs", "repos_url": "https://api.github.com/users/bharath-b-rh/repos", "events_url": "https://api.github.com/users/bharath-b-rh/events{/privacy}", "received_events_url": "https://api.github.com/users/bharath-b-rh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "nit\r\n\r\n```suggestion\r\n\treturn upgradeCond.Set(ctx, metav1.ConditionFalse,\r\n```", "created_at": "2025-01-09T11:58:12Z", "updated_at": "2025-01-09T11:58:13Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/229#discussion_r1908658038", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/229", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1908658038"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/229#discussion_r1908658038"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/229"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1908658038/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 35, "side": "RIGHT", "author_association": "MEMBER", "original_position": 33, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 229, "file_path": "api/operator/v1alpha1/certmanager_types.go", "line_start": 152, "line_end": null, "diff_context": "", "comment_body": "yes, initially I came up with that but the CEL validation(s) in Kubernetes seem to not allow validating the way I did (leaving out corner cases where the user can still unset the tech preview once enabled). There's no way to do a general \"check all fields\" operation as a part of Kubernetes' security model where validations need to be always explicit.\r\n\r\nThe array option allows for simpler checking without needing to be explicit. ", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1908669863", "pull_request_review_id": 2539745852, "id": 1908669863, "node_id": "PRRC_kwDOFdFn9s5xw_2n", "diff_hunk": "@@ -120,6 +128,30 @@ type CertManagerScheduling struct {\n \tTolerations []corev1.Toleration `json:\"tolerations,omitempty\" protobuf:\"bytes,22,opt,name=tolerations\"`\n }\n \n+// Features contains experimental features.\n+type Features struct {\n+\t// TechPreview is the list of features enabled under Technlogy Preview capabilities,\n+\t// is specific to the cert-manager Operator for Red Hat OpenShift and not in anyway\n+\t// related to the \"TechPreviewNoUpgrade\" feature set available in core OpenShift,\n+\t// although similar support and licensing terms may apply.\n+\t//\n+\t// Technology Preview features are not supported with Red Hat production service level agreements\n+\t// (SLAs) and might not be functionally complete. Red Hat does not recommend using them in production.\n+\t// These features provide early access to upcoming product features,\n+\t// enabling customers to test functionality and provide feedback during the development process.\n+\t//\n+\t// +kubebuilder:validation:XValidation:rule=\"oldSelf.size() != 0 ? oldSelf.all(e, self.exists(f, f == e)) : true\",message=\"a tech preview feature once enabled, cannot be disabled.\"\n+\t// +kubebuilder:validation:XValidation:rule=\"self.all(e, self.filter(x, x == e).size() == 1)\",message=\"tech preview features must not contain duplicate values.\"\n+\t// +kubebuilder:validation:Required\n+\t// +required\n+\tTechPreview TechPreview `json:\"techPreview\"`\n+}\n+\n+// TechPreview contains the list of enabled experimental features.\n+// +listType=atomic\n+// +kubebuilder:validation:MaxItems=64\n+type TechPreview []FeatureName", "path": "api/operator/v1alpha1/certmanager_types.go", "commit_id": "e7d67b7a5b1bb3589fcb6b6b235bb25f52e2eb67", "original_commit_id": "cbacb19ab5758f8ab92c9593a467ff74e5e7f426", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "yes, initially I came up with that but the CEL validation(s) in Kubernetes seem to not allow validating the way I did (leaving out corner cases where the user can still unset the tech preview once enabled). There's no way to do a general \"check all fields\" operation as a part of Kubernetes' security model where validations need to be always explicit.\r\n\r\nThe array option allows for simpler checking without needing to be explicit. ", "created_at": "2025-01-09T12:05:01Z", "updated_at": "2025-01-09T12:08:23Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/229#discussion_r1908669863", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/229", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1908669863"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/229#discussion_r1908669863"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/229"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1908669863/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 152, "side": "RIGHT", "in_reply_to_id": 1908657474, "author_association": "MEMBER", "original_position": 41, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 229, "file_path": "api/operator/v1alpha1/certmanager_types.go", "line_start": 152, "line_end": null, "diff_context": "", "comment_body": "CEL validation like:  `oldSelf.all(field, has(self[field]))` doesn't work in kube, which ultimately let the user unset a feature after it has been enabled (atleast, I was able to bypass during my testing).\r\n\r\nAlso, it seemed more tedious to write an expression that does equivalent of the aforesaid explicitly:\r\n \r\n```cel\r\noldSelf == null || (\r\n    has(oldSelf.istioCSR) ? has(self.istioCSR) : true &&\r\n    has(oldSelf.newFeature1) ? has(self.newFeature1) : true &&\r\n    has(oldSelf.newFeature2) ? has(self.newFeature2) : true\r\n    // ...\r\n)\r\n```\r\nfor each and every feature we add. ", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1908709756", "pull_request_review_id": 2539798188, "id": 1908709756, "node_id": "PRRC_kwDOFdFn9s5xxJl8", "diff_hunk": "@@ -120,6 +128,30 @@ type CertManagerScheduling struct {\n \tTolerations []corev1.Toleration `json:\"tolerations,omitempty\" protobuf:\"bytes,22,opt,name=tolerations\"`\n }\n \n+// Features contains experimental features.\n+type Features struct {\n+\t// TechPreview is the list of features enabled under Technlogy Preview capabilities,\n+\t// is specific to the cert-manager Operator for Red Hat OpenShift and not in anyway\n+\t// related to the \"TechPreviewNoUpgrade\" feature set available in core OpenShift,\n+\t// although similar support and licensing terms may apply.\n+\t//\n+\t// Technology Preview features are not supported with Red Hat production service level agreements\n+\t// (SLAs) and might not be functionally complete. Red Hat does not recommend using them in production.\n+\t// These features provide early access to upcoming product features,\n+\t// enabling customers to test functionality and provide feedback during the development process.\n+\t//\n+\t// +kubebuilder:validation:XValidation:rule=\"oldSelf.size() != 0 ? oldSelf.all(e, self.exists(f, f == e)) : true\",message=\"a tech preview feature once enabled, cannot be disabled.\"\n+\t// +kubebuilder:validation:XValidation:rule=\"self.all(e, self.filter(x, x == e).size() == 1)\",message=\"tech preview features must not contain duplicate values.\"\n+\t// +kubebuilder:validation:Required\n+\t// +required\n+\tTechPreview TechPreview `json:\"techPreview\"`\n+}\n+\n+// TechPreview contains the list of enabled experimental features.\n+// +listType=atomic\n+// +kubebuilder:validation:MaxItems=64\n+type TechPreview []FeatureName", "path": "api/operator/v1alpha1/certmanager_types.go", "commit_id": "e7d67b7a5b1bb3589fcb6b6b235bb25f52e2eb67", "original_commit_id": "cbacb19ab5758f8ab92c9593a467ff74e5e7f426", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "CEL validation like:  `oldSelf.all(field, has(self[field]))` doesn't work in kube, which ultimately let the user unset a feature after it has been enabled (atleast, I was able to bypass during my testing).\r\n\r\nAlso, it seemed more tedious to write an expression that does equivalent of the aforesaid explicitly:\r\n \r\n```cel\r\noldSelf == null || (\r\n    has(oldSelf.istioCSR) ? has(self.istioCSR) : true &&\r\n    has(oldSelf.newFeature1) ? has(self.newFeature1) : true &&\r\n    has(oldSelf.newFeature2) ? has(self.newFeature2) : true\r\n    // ...\r\n)\r\n```\r\nfor each and every feature we add. ", "created_at": "2025-01-09T12:30:52Z", "updated_at": "2025-01-09T12:33:27Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/229#discussion_r1908709756", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/229", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1908709756"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/229#discussion_r1908709756"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/229"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1908709756/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 152, "side": "RIGHT", "in_reply_to_id": 1908657474, "author_association": "MEMBER", "original_position": 41, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 229, "file_path": "pkg/operator/features/feature_accessor.go", "line_start": 1, "line_end": null, "diff_context": "", "comment_body": "As discussed (offline), we'll move to setting the addon features through a config env in the OLM Subscription object which the operator's environment variable can consume and enact accordingly.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1987046318", "pull_request_review_id": 2670524885, "id": 1987046318, "node_id": "PRRC_kwDOFdFn9s52b-uu", "diff_hunk": "@@ -0,0 +1,23 @@\n+package features", "path": "pkg/operator/features/feature_accessor.go", "commit_id": "e7d67b7a5b1bb3589fcb6b6b235bb25f52e2eb67", "original_commit_id": "928593fbe715fb537f8312a735700c3370305f93", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "As discussed (offline), we'll move to setting the addon features through a config env in the OLM Subscription object which the operator's environment variable can consume and enact accordingly.", "created_at": "2025-03-10T10:50:31Z", "updated_at": "2025-03-11T07:45:50Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/229#discussion_r1987046318", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/229", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1987046318"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/229#discussion_r1987046318"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/229"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1987046318/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 1, "side": "RIGHT", "in_reply_to_id": 1982656383, "author_association": "MEMBER", "original_position": 1, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 229, "file_path": "api/operator/v1alpha1/features.go", "line_start": 21, "line_end": 21, "diff_context": "", "comment_body": "> Is there a check specific to PreRelease field?\r\n\r\nAdded a test case in features_test to ensure that `FeatureSpec{Prerelease: \"TechPreview\"}` features are always disabled by default.\r\n\r\nhttps://github.com/openshift/cert-manager-operator/blob/78de13d53779ba7b3a097978557f019bb1a9063a/pkg/features/features_test.go#L61-L72", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1989355851", "pull_request_review_id": 2674673746, "id": 1989355851, "node_id": "PRRC_kwDOFdFn9s52kylL", "diff_hunk": "@@ -0,0 +1,22 @@\n+package v1alpha1\n+\n+import (\n+\t\"k8s.io/component-base/featuregate\"\n+)\n+\n+var (\n+\t// TechPreview: v1.15\n+\t//\n+\t// IstioCSR enables the controller for istiocsr.operator.openshift.io resource,\n+\t// which extends cert-manager-operator to deploy and manage the istio-csr agent.\n+\t// OpenShift Service Mesh facilitates the integration and istio-csr is an agent that\n+\t// allows Istio workload and control plane components to be secured using cert-manager.\n+\t//\n+\t// For more details,\n+\t// https://github.com/openshift/enhancements/blob/master/enhancements/cert-manager/istio-csr-controller.md\n+\tFeatureIstioCSR featuregate.Feature = \"IstioCSR\"\n+)\n+\n+var OperatorFeatureGates = map[featuregate.Feature]featuregate.FeatureSpec{\n+\tFeatureIstioCSR: {Default: false, PreRelease: \"TechPreview\"},", "path": "api/operator/v1alpha1/features.go", "commit_id": "e7d67b7a5b1bb3589fcb6b6b235bb25f52e2eb67", "original_commit_id": "b71f94774d7a1620afe51ffdd7b7e3ecc021e0ca", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "> Is there a check specific to PreRelease field?\r\n\r\nAdded a test case in features_test to ensure that `FeatureSpec{Prerelease: \"TechPreview\"}` features are always disabled by default.\r\n\r\nhttps://github.com/openshift/cert-manager-operator/blob/78de13d53779ba7b3a097978557f019bb1a9063a/pkg/features/features_test.go#L61-L72", "created_at": "2025-03-11T14:03:43Z", "updated_at": "2025-03-11T14:35:18Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/229#discussion_r1989355851", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/229", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1989355851"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/229#discussion_r1989355851"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/229"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1989355851/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 21, "original_line": 21, "side": "RIGHT", "in_reply_to_id": 1989189363, "author_association": "MEMBER", "original_position": 21, "position": 21, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 229, "file_path": "bundle/manifests/cert-manager-operator.clusterserviceversion.yaml", "line_start": 676, "line_end": null, "diff_context": "", "comment_body": "As discussed, updated arg name to `--unsupported-addon-features`,\r\nand additionally in operator docs the tech preview related warning will be presented to users who wish to enable IstioCSR addon feature.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1989358871", "pull_request_review_id": 2674679381, "id": 1989358871, "node_id": "PRRC_kwDOFdFn9s52kzUX", "diff_hunk": "@@ -673,6 +673,7 @@ spec:\n                 - --v=$(OPERATOR_LOG_LEVEL)\n                 - --trusted-ca-configmap=$(TRUSTED_CA_CONFIGMAP_NAME)\n                 - --cloud-credentials-secret=$(CLOUD_CREDENTIALS_SECRET_NAME)\n+                - --addon-features=$(ADDON_FEATURES)", "path": "bundle/manifests/cert-manager-operator.clusterserviceversion.yaml", "commit_id": "e7d67b7a5b1bb3589fcb6b6b235bb25f52e2eb67", "original_commit_id": "b71f94774d7a1620afe51ffdd7b7e3ecc021e0ca", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "As discussed, updated arg name to `--unsupported-addon-features`,\r\nand additionally in operator docs the tech preview related warning will be presented to users who wish to enable IstioCSR addon feature.", "created_at": "2025-03-11T14:04:50Z", "updated_at": "2025-03-11T14:04:50Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/229#discussion_r1989358871", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/229", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1989358871"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/229#discussion_r1989358871"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/229"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1989358871/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 676, "side": "RIGHT", "in_reply_to_id": 1989191392, "author_association": "MEMBER", "original_position": 4, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 229, "file_path": "api/operator/v1alpha1/features.go", "line_start": 21, "line_end": 21, "diff_context": "", "comment_body": "Well, wouldn't it be kind of expensive to enable that controller for users who don't need this addon at all? Not sure how much this would impact the overall performance. Perhaps we could experiment with it when going GA, at least it shouldn't be an issue at this time \ud83d\ude04", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1989742021", "pull_request_review_id": 2675402374, "id": 1989742021, "node_id": "PRRC_kwDOFdFn9s52mQ3F", "diff_hunk": "@@ -0,0 +1,22 @@\n+package v1alpha1\n+\n+import (\n+\t\"k8s.io/component-base/featuregate\"\n+)\n+\n+var (\n+\t// TechPreview: v1.15\n+\t//\n+\t// IstioCSR enables the controller for istiocsr.operator.openshift.io resource,\n+\t// which extends cert-manager-operator to deploy and manage the istio-csr agent.\n+\t// OpenShift Service Mesh facilitates the integration and istio-csr is an agent that\n+\t// allows Istio workload and control plane components to be secured using cert-manager.\n+\t//\n+\t// For more details,\n+\t// https://github.com/openshift/enhancements/blob/master/enhancements/cert-manager/istio-csr-controller.md\n+\tFeatureIstioCSR featuregate.Feature = \"IstioCSR\"\n+)\n+\n+var OperatorFeatureGates = map[featuregate.Feature]featuregate.FeatureSpec{\n+\tFeatureIstioCSR: {Default: false, PreRelease: \"TechPreview\"},", "path": "api/operator/v1alpha1/features.go", "commit_id": "e7d67b7a5b1bb3589fcb6b6b235bb25f52e2eb67", "original_commit_id": "b71f94774d7a1620afe51ffdd7b7e3ecc021e0ca", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "Well, wouldn't it be kind of expensive to enable that controller for users who don't need this addon at all? Not sure how much this would impact the overall performance. Perhaps we could experiment with it when going GA, at least it shouldn't be an issue at this time \ud83d\ude04", "created_at": "2025-03-11T16:52:06Z", "updated_at": "2025-03-11T16:52:07Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/229#discussion_r1989742021", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/229", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1989742021"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/229#discussion_r1989742021"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/229"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1989742021/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": 21, "original_line": 21, "side": "RIGHT", "in_reply_to_id": 1989189363, "author_association": "MEMBER", "original_position": 21, "position": 21, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 237, "file_path": "api/operator/v1alpha1/certmanager_types.go", "line_start": 88, "line_end": null, "diff_context": "", "comment_body": "```suggestion\r\n\t// +kubebuilder:validation:Optional\r\n\t// +kubebuilder:validation:Minimum=1\r\n\t// +optional\r\n  OverrideReplicas *int32 `json:\"overrideReplicas,omitempty\"`\r\n```\r\nI would lean towards using the pointer type for clear distinguishing \"Not Set\" vs \"Explicitly Set\".\r\n", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2376065986", "pull_request_review_id": 3263295264, "id": 2376065986, "node_id": "PRRC_kwDOFdFn9s6Nn-PC", "diff_hunk": "@@ -82,6 +82,11 @@ type DeploymentConfig struct {\n \t// +optional\n \tOverrideResources CertManagerResourceRequirements `json:\"overrideResources,omitempty\"`\n \n+\t// Replicas defines the number of replicas to run for an operand\n+\t// +kubebuilder:validation:Optional\n+\t// +optional\n+\tOverrideReplicas int32 `json:\"overrideReplicas,omitempty\"`", "path": "api/operator/v1alpha1/certmanager_types.go", "commit_id": "3dc0a107a08a4a1875718ae958bf1c9c269980f5", "original_commit_id": "b248e923bb8a3a963cd5224354aa45be65075366", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "```suggestion\r\n\t// +kubebuilder:validation:Optional\r\n\t// +kubebuilder:validation:Minimum=1\r\n\t// +optional\r\n  OverrideReplicas *int32 `json:\"overrideReplicas,omitempty\"`\r\n```\r\nI would lean towards using the pointer type for clear distinguishing \"Not Set\" vs \"Explicitly Set\".\r\n", "created_at": "2025-09-24T14:49:00Z", "updated_at": "2025-09-24T15:25:19Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/237#discussion_r2376065986", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/237", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2376065986"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/237#discussion_r2376065986"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/237"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2376065986/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 86, "start_side": "RIGHT", "line": null, "original_line": 88, "side": "RIGHT", "author_association": "MEMBER", "original_position": 7, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 237, "file_path": "pkg/controller/deployment/deployment_overrides.go", "line_start": 148, "line_end": null, "diff_context": "", "comment_body": "```suggestion\r\n// withDeploymentReplicasOverrideHook overrides the deployment replicas with those provided by\r\n// the overrideReplicasFunc function.\r\nfunc withDeploymentReplicasOverrideHook(certmanagerinformer certmanagerinformer.CertManagerInformer, deploymentName string, fn overrideReplicasFunc) func(operatorSpec *operatorv1.OperatorSpec, deployment *appsv1.Deployment) error {\r\n```", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2376100061", "pull_request_review_id": 3263295264, "id": 2376100061, "node_id": "PRRC_kwDOFdFn9s6NoGjd", "diff_hunk": "@@ -137,6 +143,24 @@ func withContainerResourcesOverrideHook(certmanagerinformer certmanagerinformer.\n \t}\n }\n \n+// withContainerReplicasOverrideHook overrides the deployment replicas with those provided by\n+// the overrideReplicasFunc function.\n+func withContainerReplicasOverrideHook(certmanagerinformer certmanagerinformer.CertManagerInformer, deploymentName string, fn overrideReplicasFunc) func(operatorSpec *v1.OperatorSpec, deployment *appsv1.Deployment) error {", "path": "pkg/controller/deployment/deployment_overrides.go", "commit_id": "3dc0a107a08a4a1875718ae958bf1c9c269980f5", "original_commit_id": "b248e923bb8a3a963cd5224354aa45be65075366", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "```suggestion\r\n// withDeploymentReplicasOverrideHook overrides the deployment replicas with those provided by\r\n// the overrideReplicasFunc function.\r\nfunc withDeploymentReplicasOverrideHook(certmanagerinformer certmanagerinformer.CertManagerInformer, deploymentName string, fn overrideReplicasFunc) func(operatorSpec *operatorv1.OperatorSpec, deployment *appsv1.Deployment) error {\r\n```", "created_at": "2025-09-24T15:00:44Z", "updated_at": "2025-09-24T15:25:19Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/237#discussion_r2376100061", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/237", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2376100061"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/237#discussion_r2376100061"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/237"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2376100061/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 146, "start_side": "RIGHT", "line": null, "original_line": 148, "side": "RIGHT", "author_association": "MEMBER", "original_position": 26, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 237, "file_path": "pkg/controller/deployment/generic_deployment_controller.go", "line_start": 53, "line_end": null, "diff_context": "", "comment_body": "```suggestion\r\n\t\twithDeploymentReplicasOverrideHook(certManagerOperatorInformers.Operator().V1alpha1().CertManagers(), deployment.Name, getOverrideReplicasFor),\r\n```", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2376107076", "pull_request_review_id": 3263295264, "id": 2376107076, "node_id": "PRRC_kwDOFdFn9s6NoIRE", "diff_hunk": "@@ -50,6 +50,7 @@ func newGenericDeploymentController(\n \t\twithContainerArgsValidateHook(certManagerOperatorInformers.Operator().V1alpha1().CertManagers(), deployment.Name),\n \t\twithContainerEnvOverrideHook(certManagerOperatorInformers.Operator().V1alpha1().CertManagers(), deployment.Name, getOverrideEnvFor),\n \t\twithContainerEnvValidateHook(certManagerOperatorInformers.Operator().V1alpha1().CertManagers(), deployment.Name),\n+\t\twithContainerReplicasOverrideHook(certManagerOperatorInformers.Operator().V1alpha1().CertManagers(), deployment.Name, getOverrideReplicasFor),", "path": "pkg/controller/deployment/generic_deployment_controller.go", "commit_id": "3dc0a107a08a4a1875718ae958bf1c9c269980f5", "original_commit_id": "b248e923bb8a3a963cd5224354aa45be65075366", "user": {"login": "lunarwhite", "id": 57584831, "node_id": "MDQ6VXNlcjU3NTg0ODMx", "avatar_url": "https://avatars.githubusercontent.com/u/57584831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lunarwhite", "html_url": "https://github.com/lunarwhite", "followers_url": "https://api.github.com/users/lunarwhite/followers", "following_url": "https://api.github.com/users/lunarwhite/following{/other_user}", "gists_url": "https://api.github.com/users/lunarwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/lunarwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lunarwhite/subscriptions", "organizations_url": "https://api.github.com/users/lunarwhite/orgs", "repos_url": "https://api.github.com/users/lunarwhite/repos", "events_url": "https://api.github.com/users/lunarwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/lunarwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "```suggestion\r\n\t\twithDeploymentReplicasOverrideHook(certManagerOperatorInformers.Operator().V1alpha1().CertManagers(), deployment.Name, getOverrideReplicasFor),\r\n```", "created_at": "2025-09-24T15:02:54Z", "updated_at": "2025-09-24T15:25:19Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/237#discussion_r2376107076", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/237", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2376107076"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/237#discussion_r2376107076"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/237"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2376107076/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 53, "side": "RIGHT", "author_association": "MEMBER", "original_position": 4, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 237, "file_path": "pkg/controller/deployment/deployment_overrides.go", "line_start": 159, "line_end": 159, "diff_context": "", "comment_body": "_\u26a0\ufe0f Potential issue_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Replica override hook LGTM; verify API validation prevents scale-to-zero.**\n\nLogic is correct and uses ptr.To to avoid aliasing. Please confirm CRD/Go type validation enforces minimum 1; otherwise add a guard to ignore 0.\n\n\nRun to verify CRD/schema and Go type validations:\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\nset -euo pipefail\n\necho \"Checking CRD manifests for overrideReplicas minimum: 1\"\nmapfile -t crds < <(fd -a -t f 'operator\\.openshift\\.io_certmanagers\\.yaml' || true)\nif [ ${#crds[@]} -eq 0 ]; then\n  echo \"No CRD files named operator.openshift.io_certmanagers.yaml found.\"\nfi\nfor f in \"${crds[@]}\"; do\n  echo \"File: $f\"\n  rg -n -C3 'overrideReplicas' \"$f\" || true\n  if rg -nPU '(?s)overrideReplicas\\s*:\\s*\\n(?:.*\\n){0,12}\\bminimum:\\s*1\\b' \"$f\" > /dev/null; then\n    echo \"OK: minimum: 1 is enforced near overrideReplicas in $f\"\n  else\n    echo \"MISSING: minimum: 1 not found near overrideReplicas in $f\"\n  fi\ndone\n\necho\necho \"Checking Go API type for kubebuilder validation Minimum=1\"\nmapfile -t gotypes < <(fd -a -t f 'certmanager_types.go' || true)\nif [ ${#gotypes[@]} -eq 0 ]; then\n  echo \"No certmanager_types.go found.\"\nfi\nfor gf in \"${gotypes[@]}\"; do\n  echo \"File: $gf\"\n  rg -n 'OverrideReplicas' \"$gf\" -n -C3 || true\n  if rg -n 'kubebuilder:validation:.*Minimum=1' \"$gf\" > /dev/null; then\n    echo \"OK: kubebuilder Minimum=1 present\"\n  else\n    echo \"MISSING: kubebuilder Minimum=1 on OverrideReplicas\"\n  fi\ndone\n```\n\nLength of output: 111\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\nset -euo pipefail\n\necho \"Checking CRD YAML files for overrideReplicas minimum validator\"\nfor f in $(rg -l 'overrideReplicas:' -g '*.yaml' || true); do\n  echo \"File: $f\"\n  rg -n -C3 'overrideReplicas:' \"$f\"\n  if rg -nP 'overrideReplicas:\\s*\\n(?:\\s+.*\\n){0,5}\\s+minimum:\\s*1\\b' \"$f\" > /dev/null; then\n    echo \"OK: minimum: 1 enforced\"\n  else\n    echo \"MISSING: minimum: 1 not found\"\n  fi\ndone\n\necho\necho \"Checking Go API types for kubebuilder validation\"\nfor f in $(rg -l 'OverrideReplicas' -g '*.go' || true); do\n  echo \"File: $f\"\n  rg -n -C2 'OverrideReplicas' \"$f\"\n  if rg -n 'kubebuilder:validation:.*Minimum=1' \"$f\" > /dev/null; then\n    echo \"OK: Minimum=1 present\"\n  else\n    echo \"MISSING: Minimum=1 not present\"\n  fi\ndone\n```\n\nLength of output: 7486\n\n---\n\n\n\n</details>\n\n**Enforce minimum=1 for overrideReplicas**  \nCRD schemas (`bundle/manifests/operator.openshift.io_certmanagers.yaml`, `config/crd/bases/operator.openshift.io_certmanagers.yaml`) lack `minimum:1` for `overrideReplicas`, permitting zero. Regenerate CRDs from the API type or add a guard in `withDeploymentReplicasOverrideHook` (e.g. `if *overrideReplicas < 1 { return nil }`) to ignore non-positive values.\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn pkg/controller/deployment/deployment_overrides.go around lines 145-159, the\ncode permits an overrideReplicas value of 0 because CRDs lack minimum:1; add a\nruntime guard so non-positive overrides are ignored: after obtaining\noverrideReplicas and nil-check it, if *overrideReplicas < 1 return nil (do not\nassign), otherwise assign deployment.Spec.Replicas = ptr.To(*overrideReplicas);\noptionally follow up by fixing the API type and regenerating CRDs to add\nminimum: 1 for overrideReplicas.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:medusa:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit f2482cc", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2376666372", "pull_request_review_id": 3264120428, "id": 2376666372, "node_id": "PRRC_kwDOFdFn9s6NqQ0E", "diff_hunk": "@@ -137,6 +142,22 @@ func withContainerResourcesOverrideHook(certmanagerinformer certmanagerinformer.\n \t}\n }\n \n+// withDeploymentReplicasOverrideHook overrides the deployment replicas with those provided by\n+// the overrideReplicasFunc function.\n+func withDeploymentReplicasOverrideHook(certmanagerinformer certmanagerinformer.CertManagerInformer, deploymentName string, fn overrideReplicasFunc) func(operatorSpec *operatorv1.OperatorSpec, deployment *appsv1.Deployment) error {\n+\treturn func(operatorSpec *operatorv1.OperatorSpec, deployment *appsv1.Deployment) error {\n+\t\toverrideReplicas, err := fn(certmanagerinformer, deploymentName)\n+\t\tif err != nil {\n+\t\t\treturn err\n+\t\t}\n+\n+\t\tif overrideReplicas != nil && deployment.Name == deploymentName {\n+\t\t\tdeployment.Spec.Replicas = ptr.To(*overrideReplicas)\n+\t\t}\n+\t\treturn nil\n+\t}\n+}", "path": "pkg/controller/deployment/deployment_overrides.go", "commit_id": "bc4ff39390b2b1ecb90e2c1fa110e9632fec64e7", "original_commit_id": "e0d0930de78897eedb1c5d94246dd4bee5720292", "user": {"login": "coderabbitai[bot]", "id": 136622811, "node_id": "BOT_kgDOCCSy2w", "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coderabbitai%5Bbot%5D", "html_url": "https://github.com/apps/coderabbitai", "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers", "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos", "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "body": "_\u26a0\ufe0f Potential issue_\n\n<details>\n<summary>\ud83e\udde9 Analysis chain</summary>\n\n**Replica override hook LGTM; verify API validation prevents scale-to-zero.**\n\nLogic is correct and uses ptr.To to avoid aliasing. Please confirm CRD/Go type validation enforces minimum 1; otherwise add a guard to ignore 0.\n\n\nRun to verify CRD/schema and Go type validations:\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\nset -euo pipefail\n\necho \"Checking CRD manifests for overrideReplicas minimum: 1\"\nmapfile -t crds < <(fd -a -t f 'operator\\.openshift\\.io_certmanagers\\.yaml' || true)\nif [ ${#crds[@]} -eq 0 ]; then\n  echo \"No CRD files named operator.openshift.io_certmanagers.yaml found.\"\nfi\nfor f in \"${crds[@]}\"; do\n  echo \"File: $f\"\n  rg -n -C3 'overrideReplicas' \"$f\" || true\n  if rg -nPU '(?s)overrideReplicas\\s*:\\s*\\n(?:.*\\n){0,12}\\bminimum:\\s*1\\b' \"$f\" > /dev/null; then\n    echo \"OK: minimum: 1 is enforced near overrideReplicas in $f\"\n  else\n    echo \"MISSING: minimum: 1 not found near overrideReplicas in $f\"\n  fi\ndone\n\necho\necho \"Checking Go API type for kubebuilder validation Minimum=1\"\nmapfile -t gotypes < <(fd -a -t f 'certmanager_types.go' || true)\nif [ ${#gotypes[@]} -eq 0 ]; then\n  echo \"No certmanager_types.go found.\"\nfi\nfor gf in \"${gotypes[@]}\"; do\n  echo \"File: $gf\"\n  rg -n 'OverrideReplicas' \"$gf\" -n -C3 || true\n  if rg -n 'kubebuilder:validation:.*Minimum=1' \"$gf\" > /dev/null; then\n    echo \"OK: kubebuilder Minimum=1 present\"\n  else\n    echo \"MISSING: kubebuilder Minimum=1 on OverrideReplicas\"\n  fi\ndone\n```\n\nLength of output: 111\n\n---\n\n\ud83c\udfc1 Script executed:\n\n```shell\n#!/bin/bash\nset -euo pipefail\n\necho \"Checking CRD YAML files for overrideReplicas minimum validator\"\nfor f in $(rg -l 'overrideReplicas:' -g '*.yaml' || true); do\n  echo \"File: $f\"\n  rg -n -C3 'overrideReplicas:' \"$f\"\n  if rg -nP 'overrideReplicas:\\s*\\n(?:\\s+.*\\n){0,5}\\s+minimum:\\s*1\\b' \"$f\" > /dev/null; then\n    echo \"OK: minimum: 1 enforced\"\n  else\n    echo \"MISSING: minimum: 1 not found\"\n  fi\ndone\n\necho\necho \"Checking Go API types for kubebuilder validation\"\nfor f in $(rg -l 'OverrideReplicas' -g '*.go' || true); do\n  echo \"File: $f\"\n  rg -n -C2 'OverrideReplicas' \"$f\"\n  if rg -n 'kubebuilder:validation:.*Minimum=1' \"$f\" > /dev/null; then\n    echo \"OK: Minimum=1 present\"\n  else\n    echo \"MISSING: Minimum=1 not present\"\n  fi\ndone\n```\n\nLength of output: 7486\n\n---\n\n\n\n</details>\n\n**Enforce minimum=1 for overrideReplicas**  \nCRD schemas (`bundle/manifests/operator.openshift.io_certmanagers.yaml`, `config/crd/bases/operator.openshift.io_certmanagers.yaml`) lack `minimum:1` for `overrideReplicas`, permitting zero. Regenerate CRDs from the API type or add a guard in `withDeploymentReplicasOverrideHook` (e.g. `if *overrideReplicas < 1 { return nil }`) to ignore non-positive values.\n\n<details>\n<summary>\ud83e\udd16 Prompt for AI Agents</summary>\n\n```\nIn pkg/controller/deployment/deployment_overrides.go around lines 145-159, the\ncode permits an overrideReplicas value of 0 because CRDs lack minimum:1; add a\nruntime guard so non-positive overrides are ignored: after obtaining\noverrideReplicas and nil-check it, if *overrideReplicas < 1 return nil (do not\nassign), otherwise assign deployment.Spec.Replicas = ptr.To(*overrideReplicas);\noptionally follow up by fixing the API type and regenerating CRDs to add\nminimum: 1 for overrideReplicas.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:medusa:chinchilla -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->\n\n\u2705 Addressed in commit f2482cc", "created_at": "2025-09-24T18:10:56Z", "updated_at": "2025-09-24T18:41:56Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/237#discussion_r2376666372", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/237", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2376666372"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/237#discussion_r2376666372"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/237"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/2376666372/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": 145, "original_start_line": 145, "start_side": "RIGHT", "line": 159, "original_line": 159, "side": "RIGHT", "author_association": "NONE", "original_position": 30, "position": 30, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 248, "file_path": "test/e2e/istio_csr_test.go", "line_start": 146, "line_end": null, "diff_context": "", "comment_body": "Can we refactor `pollTillIstioCSRAvailable` function to return the whole status instead of just the service string? That should be able to take care of this.\r\n\r\nYou can add a service account poll (to have confirmation that it was created and all good), but this should use the value of `ServiceAccount` directly from the status values basically.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1973427251", "pull_request_review_id": 2647507859, "id": 1973427251, "node_id": "PRRC_kwDOFdFn9s51oBwz", "diff_hunk": "@@ -142,106 +140,16 @@ var _ = Describe(\"Istio-CSR\", Ordered, Label(\"TechPreview\", \"Feature:IstioCSR\"),\n \t\t\tExpect(err).Should(BeNil())\n \n \t\t\tBy(\"creating an grpcurl job\")\n-\t\t\tjob := &batchv1.Job{\n-\t\t\t\tObjectMeta: metav1.ObjectMeta{\n-\t\t\t\t\tName: \"grpcurl-job\",\n-\t\t\t\t},\n-\t\t\t\tSpec: batchv1.JobSpec{\n-\t\t\t\t\tCompletions:  ptr.To(int32(1)),\n-\t\t\t\t\tBackoffLimit: ptr.To(backOffLimit),\n-\t\t\t\t\tTemplate: corev1.PodTemplateSpec{\n-\t\t\t\t\t\tObjectMeta: metav1.ObjectMeta{\n-\t\t\t\t\t\t\tName: grpcAppName,\n-\t\t\t\t\t\t\tLabels: map[string]string{\n-\t\t\t\t\t\t\t\t\"app\": grpcAppName,\n-\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t},\n-\t\t\t\t\t\tSpec: corev1.PodSpec{\n-\t\t\t\t\t\t\tServiceAccountName:           serviceAccountName,\n-\t\t\t\t\t\t\tAutomountServiceAccountToken: ptr.To(false),\n-\t\t\t\t\t\t\tRestartPolicy:                corev1.RestartPolicyOnFailure,\n-\t\t\t\t\t\t\tContainers: []corev1.Container{\n-\t\t\t\t\t\t\t\t{\n-\t\t\t\t\t\t\t\t\tName:  grpcAppName,\n-\t\t\t\t\t\t\t\t\tImage: \"registry.redhat.io/rhel9/go-toolset\",\n-\t\t\t\t\t\t\t\t\tCommand: []string{\n-\t\t\t\t\t\t\t\t\t\t\"/bin/sh\",\n-\t\t\t\t\t\t\t\t\t\t\"-c\",\n-\t\t\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t\t\t\tEnv: []corev1.EnvVar{\n-\t\t\t\t\t\t\t\t\t\t{\n-\t\t\t\t\t\t\t\t\t\t\tName:  \"GOCACHE\",\n-\t\t\t\t\t\t\t\t\t\t\tValue: \"/tmp/go-cache\",\n-\t\t\t\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t\t\t\t\t{\n-\t\t\t\t\t\t\t\t\t\t\tName:  \"GOPATH\",\n-\t\t\t\t\t\t\t\t\t\t\tValue: \"/tmp/go\",\n-\t\t\t\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t\t\t\tArgs: []string{\n-\t\t\t\t\t\t\t\t\t\t\"go install github.com/fullstorydev/grpcurl/cmd/grpcurl@v1.9.2 >/dev/null 2>&1 && \" +\n-\t\t\t\t\t\t\t\t\t\t\t\"TOKEN=$(cat /var/run/secrets/istio-ca/token) && \" +\n-\t\t\t\t\t\t\t\t\t\t\t\"/tmp/go/bin/grpcurl \" +\n-\t\t\t\t\t\t\t\t\t\t\t\"-import-path /proto \" +\n-\t\t\t\t\t\t\t\t\t\t\t\"-proto /proto/ca.proto \" +\n-\t\t\t\t\t\t\t\t\t\t\t\"-H \\\"Authorization: Bearer $TOKEN\\\" \" +\n-\t\t\t\t\t\t\t\t\t\t\tfmt.Sprintf(\"-d '{\\\"csr\\\": \\\"%s\\\", \\\"validity_duration\\\": 3600}' \", csr) +\n-\t\t\t\t\t\t\t\t\t\t\t\"-cacert /etc/root-secret/ca.crt \" +\n-\t\t\t\t\t\t\t\t\t\t\t\"-key /etc/root-secret/tls.key \" +\n-\t\t\t\t\t\t\t\t\t\t\t\"-cert /etc/root-secret/tls.crt \" +\n-\t\t\t\t\t\t\t\t\t\t\tfmt.Sprintf(\"%s istio.v1.auth.IstioCertificateService/CreateCertificate\", istioCSRGRPCEndpoint),\n-\t\t\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t\t\t\tVolumeMounts: []corev1.VolumeMount{\n-\t\t\t\t\t\t\t\t\t\t{Name: \"root-secret\", MountPath: \"/etc/root-secret\"},\n-\t\t\t\t\t\t\t\t\t\t{Name: \"proto\", MountPath: \"/proto\"},\n-\t\t\t\t\t\t\t\t\t\t{Name: \"sa-token\", MountPath: \"/var/run/secrets/istio-ca\"},\n-\t\t\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t\tVolumes: []corev1.Volume{\n-\t\t\t\t\t\t\t\t{\n-\t\t\t\t\t\t\t\t\tName: \"sa-token\",\n-\t\t\t\t\t\t\t\t\tVolumeSource: corev1.VolumeSource{\n-\t\t\t\t\t\t\t\t\t\tProjected: &corev1.ProjectedVolumeSource{\n-\t\t\t\t\t\t\t\t\t\t\tDefaultMode: ptr.To(int32(420)),\n-\t\t\t\t\t\t\t\t\t\t\tSources: []corev1.VolumeProjection{\n-\t\t\t\t\t\t\t\t\t\t\t\t{\n-\t\t\t\t\t\t\t\t\t\t\t\t\tServiceAccountToken: &corev1.ServiceAccountTokenProjection{\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\tAudience:          \"istio-ca\",\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\tExpirationSeconds: ptr.To(int64(3600)),\n-\t\t\t\t\t\t\t\t\t\t\t\t\t\tPath:              \"token\",\n-\t\t\t\t\t\t\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t\t\t{\n-\t\t\t\t\t\t\t\t\tName: \"root-secret\",\n-\t\t\t\t\t\t\t\t\tVolumeSource: corev1.VolumeSource{\n-\t\t\t\t\t\t\t\t\t\tSecret: &corev1.SecretVolumeSource{\n-\t\t\t\t\t\t\t\t\t\t\tSecretName: \"istiod-tls\",\n-\t\t\t\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t\t\t{\n-\t\t\t\t\t\t\t\t\tName: \"proto\",\n-\t\t\t\t\t\t\t\t\tVolumeSource: corev1.VolumeSource{\n-\t\t\t\t\t\t\t\t\t\tConfigMap: &corev1.ConfigMapVolumeSource{\n-\t\t\t\t\t\t\t\t\t\t\tLocalObjectReference: corev1.LocalObjectReference{\n-\t\t\t\t\t\t\t\t\t\t\t\tName: \"proto-cm\",\n-\t\t\t\t\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t},\n+\t\t\tloader.CreateFromFile(AssetFunc(testassets.ReadFile).WithTemplateValues(\n+\t\t\t\tIstioCSRGRPCurlJobConfig{\n+\t\t\t\t\tCertificateSigningRequest: csr,\n+\t\t\t\t\tIstioCSRStatus: v1alpha1.IstioCSRStatus{", "path": "test/e2e/istio_csr_test.go", "commit_id": "a7393ed9fab9fefdcc3f5e49bb7b95a574620388", "original_commit_id": "f643de13b24928f217a1f2e5076d42ebe8ba720f", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "Can we refactor `pollTillIstioCSRAvailable` function to return the whole status instead of just the service string? That should be able to take care of this.\r\n\r\nYou can add a service account poll (to have confirmation that it was created and all good), but this should use the value of `ServiceAccount` directly from the status values basically.", "created_at": "2025-02-27T11:50:26Z", "updated_at": "2025-02-27T11:50:31Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/248#discussion_r1973427251", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/248", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1973427251"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/248#discussion_r1973427251"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/248"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1973427251/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 146, "side": "RIGHT", "in_reply_to_id": 1973422313, "author_association": "MEMBER", "original_position": 118, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 248, "file_path": "test/e2e/utils_test.go", "line_start": 645, "line_end": null, "diff_context": "", "comment_body": "you can use [meta.FindStatusCondition](https://pkg.go.dev/k8s.io/apimachinery/pkg/api/meta#FindStatusCondition) now that we have the desired type.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1975031102", "pull_request_review_id": 2650111406, "id": 1975031102, "node_id": "PRRC_kwDOFdFn9s51uJU-", "diff_hunk": "@@ -636,44 +637,34 @@ func pollTillIstioCSRAvailable(ctx context.Context, dynamicClient *dynamic.Dynam\n \t\t\treturn false, nil\n \t\t}\n \n-\t\tconditions, found, err := unstructured.NestedSlice(customResource.Object, \"status\", \"conditions\")\n+\t\terr = runtime.DefaultUnstructuredConverter.FromUnstructured(status, &istioCSRStatus)\n \t\tif err != nil {\n \t\t\treturn false, nil\n \t\t}\n \n-\t\tif !found {\n-\t\t\treturn false, nil\n-\t\t}\n-\n-\t\tfor _, condition := range conditions {\n-\t\t\tcondMap, ok := condition.(map[string]interface{})\n-\t\t\tif !ok {\n-\t\t\t\tcontinue\n-\t\t\t}\n-\n-\t\t\tcondType, _ := condMap[\"type\"].(string)\n-\t\t\tcondStatus, _ := condMap[\"status\"].(string)\n+\t\tfor _, condition := range istioCSRStatus.Conditions {", "path": "test/e2e/utils_test.go", "commit_id": "a7393ed9fab9fefdcc3f5e49bb7b95a574620388", "original_commit_id": "14a05cf8e237ca8cbcba392985168675b5a7c696", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "you can use [meta.FindStatusCondition](https://pkg.go.dev/k8s.io/apimachinery/pkg/api/meta#FindStatusCondition) now that we have the desired type.", "created_at": "2025-02-28T08:46:30Z", "updated_at": "2025-02-28T09:04:16Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/248#discussion_r1975031102", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/248", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1975031102"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/248#discussion_r1975031102"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/248"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1975031102/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 645, "side": "RIGHT", "author_association": "MEMBER", "original_position": 53, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 248, "file_path": "test/e2e/istio_csr_test.go", "line_start": 16, "line_end": null, "diff_context": "", "comment_body": "i.e.,\r\n\r\n```go\r\nimport (\r\n\t\"context\"\r\n\t\"crypto/x509\"\r\n\t\"crypto/x509/pkix\"\r\n\t\"encoding/json\"\r\n\t\"fmt\"\r\n\t\"io\"\r\n\t\"net/url\"\r\n\t\"path/filepath\"\r\n\r\n\tcorev1 \"k8s.io/api/core/v1\"\r\n\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\r\n\t\"k8s.io/client-go/dynamic\"\r\n\t\"k8s.io/client-go/kubernetes\"\r\n\r\n\t\"github.com/openshift/cert-manager-operator/test/library\"\r\n\r\n\t. \"github.com/onsi/ginkgo/v2\"\r\n\t. \"github.com/onsi/gomega\"\r\n)\r\n```", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1975209065", "pull_request_review_id": 2650408211, "id": 1975209065, "node_id": "PRRC_kwDOFdFn9s51u0xp", "diff_hunk": "@@ -13,14 +13,11 @@ import (\n \t\"net/url\"\n \t\"path/filepath\"\n \n-\tbatchv1 \"k8s.io/api/batch/v1\"\n+\t\"github.com/openshift/cert-manager-operator/test/library\"", "path": "test/e2e/istio_csr_test.go", "commit_id": "a7393ed9fab9fefdcc3f5e49bb7b95a574620388", "original_commit_id": "c1a5ae8dfd2413ea475b96fc5f1a0910535a3320", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "i.e.,\r\n\r\n```go\r\nimport (\r\n\t\"context\"\r\n\t\"crypto/x509\"\r\n\t\"crypto/x509/pkix\"\r\n\t\"encoding/json\"\r\n\t\"fmt\"\r\n\t\"io\"\r\n\t\"net/url\"\r\n\t\"path/filepath\"\r\n\r\n\tcorev1 \"k8s.io/api/core/v1\"\r\n\tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\r\n\t\"k8s.io/client-go/dynamic\"\r\n\t\"k8s.io/client-go/kubernetes\"\r\n\r\n\t\"github.com/openshift/cert-manager-operator/test/library\"\r\n\r\n\t. \"github.com/onsi/ginkgo/v2\"\r\n\t. \"github.com/onsi/gomega\"\r\n)\r\n```", "created_at": "2025-02-28T10:50:00Z", "updated_at": "2025-02-28T10:50:01Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/248#discussion_r1975209065", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/248", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1975209065"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/248#discussion_r1975209065"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/248"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1975209065/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": null, "start_side": null, "line": null, "original_line": 16, "side": "RIGHT", "in_reply_to_id": 1975205848, "author_association": "MEMBER", "original_position": 5, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 252, "file_path": "hack/update-istio-csr-manifests.sh", "line_start": 54, "line_end": null, "diff_context": "", "comment_body": "nit: check if below suggestion can be used.\r\n```suggestion\r\n# remove the helm specific labels from .metadata.labels and .spec.template.metadata.labels\r\n./_output/tools/bin/yq -i 'del(.metadata.labels.\"helm.sh/chart\")' _output/istio-csr-manifest.yaml\r\n./_output/tools/bin/yq -i 'del(.spec.template.metadata.labels.\"helm.sh/chart\")' _output/istio-csr-manifest.yaml\r\n\r\n# update all occurences of app.kubernetes.io/managed-by label value.\r\n./_output/tools/bin/yq -ie '(.. | select(has(\"app.kubernetes.io/managed-by\")).[\"app.kubernetes.io/managed-by\"]) |= \"cert-manager-operator\"' _output/istio-csr-manifest.yaml\r\n\r\n# regenerate all bindata\r\nrm -rf bindata/istio-csr\r\nmkdir -p bindata/istio-csr\r\n\r\n# split manifest file.\r\n./_output/tools/bin/yq '... comments=\"\"' -s '.metadata.name + \"-\" + .kind + \".yaml\" | downcase' _output/istio-csr-manifest.yaml\r\n\r\n# remove unused manifests\r\nrm cert-manager-istio-csr-metrics-service.yaml \\\r\n\tcert-manager-istio-csr-dynamic-istiod-rolebinding.yaml\r\n```", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1988474853", "pull_request_review_id": 2672786612, "id": 1988474853, "node_id": "PRRC_kwDOFdFn9s52hbfl", "diff_hunk": "@@ -0,0 +1,63 @@\n+#!/bin/bash\n+\n+set -e\n+\n+ISTIO_CSR_VERSION=${1:-}\n+\n+echo \"updating istio-csr manifests\"\n+\n+if [ ! -f ./_output/tools/bin/yq ]; then\n+    echo \"---- Installing yq tooling ----\"\n+\n+    mkdir -p ./_output/tools/bin\n+    curl -s -f -L https://github.com/mikefarah/yq/releases/download/v4.13.3/yq_$(go env GOHOSTOS)_$(go env GOHOSTARCH) -o ./_output/tools/bin/yq\n+    chmod +x ./_output/tools/bin/yq\n+fi\n+\n+./bin/helm repo add jetstack https://charts.jetstack.io --force-update\n+./bin/helm template cert-manager-istio-csr jetstack/cert-manager-istio-csr -n cert-manager --version \"${ISTIO_CSR_VERSION}\" > _output/istio-csr-manifest.yaml\n+\n+./_output/tools/bin/yq \\\n+    --output-format json \\\n+    eval-all '. as $item ireduce ([]; . + $item)' \\\n+    _output/manifest.yaml \\\n+    >_output/manifest_as_array.json\n+\n+# remove the helm label\n+./_output/tools/bin/yq e 'del(.metadata.labels.\"app.kubernetes.io/managed-by\") | del(.metadata.labels.\"helm.sh/chart\")' -i _output/istio-csr-manifest.yaml\n+# remove the helm label from deployment.spec.template.metadata also\n+./_output/tools/bin/yq e 'del(.spec.template.metadata.labels.\"app.kubernetes.io/managed-by\") | del(.spec.template.metadata.labels.\"helm.sh/chart\")' -i _output/istio-csr-manifest.yaml\n+\n+./_output/tools/bin/yq e '.metadata.labels.\"app.kubernetes.io/managed-by\" = \"cert-manager-operator\"' -i  _output/istio-csr-manifest.yaml\n+\n+./_output/tools/bin/yq \\\n+    --output-format json \\\n+    eval-all '. as $item ireduce ([]; . + $item)' \\\n+    _output/istio-csr-manifest.yaml \\\n+    > _output/istio_manifest_as_array.json\n+\n+# regenerate all bindata\n+rm -rf bindata/istio-csr\n+\n+mkdir -p bindata/istio-csr\n+\n+./_output/tools/bin/yq --output-format json \\\n+    eval-all '.[]' -I 0 \\\n+    _output/istio_manifest_as_array.json | while read -r item; do\n+\n+  name=$(echo \"$item\" | ./_output/tools/bin/yq eval '.metadata.name' -)\n+  kind=$(echo \"$item\" | ./_output/tools/bin/yq eval '.kind' - | tr '[:upper:]' '[:lower:]')\n+\n+  # skip unused manifests\n+  if [[ \"${name}-${kind}\" == \"cert-manager-istio-csr-metrics-service\" || \\\n+        \"${name}-${kind}\" == \"cert-manager-istio-csr-dynamic-istiod-rolebinding\" \\\n+    ]]; then\n+    \n+    continue\n+  fi\n+\n+  output_file=\"bindata/istio-csr/${name}-${kind}.yaml\"\n+\n+  echo \"$item\" | ./_output/tools/bin/yq eval -P > \"$output_file\"\n+  echo \"$output_file\"\n+done", "path": "hack/update-istio-csr-manifests.sh", "commit_id": "42908eb61f014931f55ed716244a2be6f9e0e77c", "original_commit_id": "7b1a75753d0e470161ea886eaf700d7b770e5b5b", "user": {"login": "bharath-b-rh", "id": 92782575, "node_id": "U_kgDOBYe_7w", "avatar_url": "https://avatars.githubusercontent.com/u/92782575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bharath-b-rh", "html_url": "https://github.com/bharath-b-rh", "followers_url": "https://api.github.com/users/bharath-b-rh/followers", "following_url": "https://api.github.com/users/bharath-b-rh/following{/other_user}", "gists_url": "https://api.github.com/users/bharath-b-rh/gists{/gist_id}", "starred_url": "https://api.github.com/users/bharath-b-rh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bharath-b-rh/subscriptions", "organizations_url": "https://api.github.com/users/bharath-b-rh/orgs", "repos_url": "https://api.github.com/users/bharath-b-rh/repos", "events_url": "https://api.github.com/users/bharath-b-rh/events{/privacy}", "received_events_url": "https://api.github.com/users/bharath-b-rh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "nit: check if below suggestion can be used.\r\n```suggestion\r\n# remove the helm specific labels from .metadata.labels and .spec.template.metadata.labels\r\n./_output/tools/bin/yq -i 'del(.metadata.labels.\"helm.sh/chart\")' _output/istio-csr-manifest.yaml\r\n./_output/tools/bin/yq -i 'del(.spec.template.metadata.labels.\"helm.sh/chart\")' _output/istio-csr-manifest.yaml\r\n\r\n# update all occurences of app.kubernetes.io/managed-by label value.\r\n./_output/tools/bin/yq -ie '(.. | select(has(\"app.kubernetes.io/managed-by\")).[\"app.kubernetes.io/managed-by\"]) |= \"cert-manager-operator\"' _output/istio-csr-manifest.yaml\r\n\r\n# regenerate all bindata\r\nrm -rf bindata/istio-csr\r\nmkdir -p bindata/istio-csr\r\n\r\n# split manifest file.\r\n./_output/tools/bin/yq '... comments=\"\"' -s '.metadata.name + \"-\" + .kind + \".yaml\" | downcase' _output/istio-csr-manifest.yaml\r\n\r\n# remove unused manifests\r\nrm cert-manager-istio-csr-metrics-service.yaml \\\r\n\tcert-manager-istio-csr-dynamic-istiod-rolebinding.yaml\r\n```", "created_at": "2025-03-11T06:16:24Z", "updated_at": "2025-03-11T10:14:30Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/252#discussion_r1988474853", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/252", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1988474853"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/252#discussion_r1988474853"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/252"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1988474853/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 26, "start_side": "RIGHT", "line": null, "original_line": 54, "side": "RIGHT", "author_association": "MEMBER", "original_position": 63, "position": 1, "subject_type": "line"}}
{"repo": "openshift/cert-manager-operator", "pr_number": 252, "file_path": "hack/update-istio-csr-manifests.sh", "line_start": 54, "line_end": null, "diff_context": "", "comment_body": "Mostly updated,\r\n\r\nTo split the manifests: \r\nas discussed introducing `yq -s` required to bump the yq version in the hack script that was breaking for `hack/update-cert-manager-manifests.sh` behaviour, and hence fallback to same bash loop implementation.", "thread_json": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1988934807", "pull_request_review_id": 2673858444, "id": 1988934807, "node_id": "PRRC_kwDOFdFn9s52jLyX", "diff_hunk": "@@ -0,0 +1,63 @@\n+#!/bin/bash\n+\n+set -e\n+\n+ISTIO_CSR_VERSION=${1:-}\n+\n+echo \"updating istio-csr manifests\"\n+\n+if [ ! -f ./_output/tools/bin/yq ]; then\n+    echo \"---- Installing yq tooling ----\"\n+\n+    mkdir -p ./_output/tools/bin\n+    curl -s -f -L https://github.com/mikefarah/yq/releases/download/v4.13.3/yq_$(go env GOHOSTOS)_$(go env GOHOSTARCH) -o ./_output/tools/bin/yq\n+    chmod +x ./_output/tools/bin/yq\n+fi\n+\n+./bin/helm repo add jetstack https://charts.jetstack.io --force-update\n+./bin/helm template cert-manager-istio-csr jetstack/cert-manager-istio-csr -n cert-manager --version \"${ISTIO_CSR_VERSION}\" > _output/istio-csr-manifest.yaml\n+\n+./_output/tools/bin/yq \\\n+    --output-format json \\\n+    eval-all '. as $item ireduce ([]; . + $item)' \\\n+    _output/manifest.yaml \\\n+    >_output/manifest_as_array.json\n+\n+# remove the helm label\n+./_output/tools/bin/yq e 'del(.metadata.labels.\"app.kubernetes.io/managed-by\") | del(.metadata.labels.\"helm.sh/chart\")' -i _output/istio-csr-manifest.yaml\n+# remove the helm label from deployment.spec.template.metadata also\n+./_output/tools/bin/yq e 'del(.spec.template.metadata.labels.\"app.kubernetes.io/managed-by\") | del(.spec.template.metadata.labels.\"helm.sh/chart\")' -i _output/istio-csr-manifest.yaml\n+\n+./_output/tools/bin/yq e '.metadata.labels.\"app.kubernetes.io/managed-by\" = \"cert-manager-operator\"' -i  _output/istio-csr-manifest.yaml\n+\n+./_output/tools/bin/yq \\\n+    --output-format json \\\n+    eval-all '. as $item ireduce ([]; . + $item)' \\\n+    _output/istio-csr-manifest.yaml \\\n+    > _output/istio_manifest_as_array.json\n+\n+# regenerate all bindata\n+rm -rf bindata/istio-csr\n+\n+mkdir -p bindata/istio-csr\n+\n+./_output/tools/bin/yq --output-format json \\\n+    eval-all '.[]' -I 0 \\\n+    _output/istio_manifest_as_array.json | while read -r item; do\n+\n+  name=$(echo \"$item\" | ./_output/tools/bin/yq eval '.metadata.name' -)\n+  kind=$(echo \"$item\" | ./_output/tools/bin/yq eval '.kind' - | tr '[:upper:]' '[:lower:]')\n+\n+  # skip unused manifests\n+  if [[ \"${name}-${kind}\" == \"cert-manager-istio-csr-metrics-service\" || \\\n+        \"${name}-${kind}\" == \"cert-manager-istio-csr-dynamic-istiod-rolebinding\" \\\n+    ]]; then\n+    \n+    continue\n+  fi\n+\n+  output_file=\"bindata/istio-csr/${name}-${kind}.yaml\"\n+\n+  echo \"$item\" | ./_output/tools/bin/yq eval -P > \"$output_file\"\n+  echo \"$output_file\"\n+done", "path": "hack/update-istio-csr-manifests.sh", "commit_id": "42908eb61f014931f55ed716244a2be6f9e0e77c", "original_commit_id": "7b1a75753d0e470161ea886eaf700d7b770e5b5b", "user": {"login": "swghosh", "id": 10649800, "node_id": "MDQ6VXNlcjEwNjQ5ODAw", "avatar_url": "https://avatars.githubusercontent.com/u/10649800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swghosh", "html_url": "https://github.com/swghosh", "followers_url": "https://api.github.com/users/swghosh/followers", "following_url": "https://api.github.com/users/swghosh/following{/other_user}", "gists_url": "https://api.github.com/users/swghosh/gists{/gist_id}", "starred_url": "https://api.github.com/users/swghosh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swghosh/subscriptions", "organizations_url": "https://api.github.com/users/swghosh/orgs", "repos_url": "https://api.github.com/users/swghosh/repos", "events_url": "https://api.github.com/users/swghosh/events{/privacy}", "received_events_url": "https://api.github.com/users/swghosh/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "body": "Mostly updated,\r\n\r\nTo split the manifests: \r\nas discussed introducing `yq -s` required to bump the yq version in the hack script that was breaking for `hack/update-cert-manager-manifests.sh` behaviour, and hence fallback to same bash loop implementation.", "created_at": "2025-03-11T10:37:48Z", "updated_at": "2025-03-11T10:45:38Z", "html_url": "https://github.com/openshift/cert-manager-operator/pull/252#discussion_r1988934807", "pull_request_url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/252", "_links": {"self": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1988934807"}, "html": {"href": "https://github.com/openshift/cert-manager-operator/pull/252#discussion_r1988934807"}, "pull_request": {"href": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/252"}}, "reactions": {"url": "https://api.github.com/repos/openshift/cert-manager-operator/pulls/comments/1988934807/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "start_line": null, "original_start_line": 26, "start_side": "RIGHT", "line": null, "original_line": 54, "side": "RIGHT", "in_reply_to_id": 1988474853, "author_association": "MEMBER", "original_position": 63, "position": 1, "subject_type": "line"}}
